\subsection{Proofs for Theorem \ref{weak_error_bound}}\label{main4}
In this section, we first show the relation of Assumption \ref{invariance} and Assumption \ref{weak_invariance}. We then show that the MLE step in line 2 of Algorithm \ref{mle+erm} guarantees an upper bound on the Hellinger distance $H(\P_{\hat\phi}(x,s),\P_{\phi^* }(x,s))$. Then, using the same techniques as that in the proof of Theorem \ref{error_bound}, we prove Theorem \ref{weak_error_bound}.

\subsubsection{Relation of Assumption \ref{invariance} and Assumption \ref{weak_invariance}}\label{relation}

Assumption \ref{weak_invariance} is actually a relaxation of Assumption \ref{invariance}. To see this, by Assumption \ref{invariance}, for any $\phi\in\Phi$, we choose $T_1$ that satisfies \eqref{informative} and $T_2$ that satisfies \eqref{101701}. Let $\psi=T^{-1}_2\circ\psi^* $. It then holds that
\$
&\TV\big(\P_{\phi,\psi}(x,y),\P_{\phi^* ,\psi^* }(x,y)\big)\notag\\
&=\TV\big(\P_{T_1\circ\phi,\psi^* }(x,y),\P_{\phi^* ,\psi^* }(x,y)\big)\\
&\leq\TV\big(\P_{T_1\circ\phi}(x,z),\P_{\phi^* }(x,z)\big)\notag\\
&\leq \kappa \cdot\TV\big(\P_{\phi}(x,s),\P_{\phi^* }(x,s)\big).
\$
Note that the TV distance can be upper bounded by the Hellinger distance. Thus, Assumption \ref{invariance} directly implies Assumption \ref{weak_invariance}.

\subsubsection{Hellinger Distance Guarantee}
Suppose that $\hat\phi$ is the output of the MLE step in Algorithm \ref{mle+erm}, which satisfies 
\%
\hat\phi\leftarrow \argmax_{\phi\in\Phi}\sum^{m}_{i=1}\log p_{\phi}(x_i,s_i).
\%
We have the following theoretical guarantee on the Hellinger distance between $\P_{\hat\phi}(x,s)$ and $\P_{\phi^* }(x,s)$.
\begin{lemma}\label{mle_hellinger}
Let $\hat\phi$ be the output of Algorithm \ref{mle+erm}. It then holds that with probability at least $1-\delta$ that
\%
H\big(\P_{\hat\phi}(x,s),\P_{\phi^* }(x,s)\big)\leq \sqrt{\frac{2}{m}\log\frac{N_{\b}\big(\mP_{\mathcal{X}\times\mathcal{S}}(\Phi),1/m^2\big)}{\delta}},
\%
where we denote $\mP_{\mathcal{X}\times\mathcal{S}}(\Phi):=\{p_{\phi}(x,s)\,|\,\phi\in\Phi\}$.
\end{lemma}
\begin{proof}[Proof of Lemma \ref{mle_hellinger}]
For notation simplicity, we denote $\bm{x}:=(x,s)$. Let $\epsilon>0$. Similar to the proof of Theorem \ref{tv_mle}, we obtain with probability at least $1-\delta$
\%\label{101508}
1-\int\sqrt{\bar{p}_{\hat\phi}(\bm{x})p_{\phi^* }(\bm{x})}\,d\bm{x}\leq \frac{1}{m}\log\frac{N_{\b}\big(\mP_{\mathcal{X}\times\mathcal{S}}(\Phi),\epsilon\big)}{\delta}.
\%
Here $\bar{p}_{\hat\phi}(\bm{x})\in\mN_{\b}(\mP_{\mathcal{X}\times\mathcal{S}}(\Phi),\epsilon)$ that satisfies $\bar{p}_{\hat\phi}(\bm{x})\geq p_{\phi^* }(\bm{x})$ for any $\bm{x}$ and 
\%
\int \bar{p}_{\hat\phi}(\bm{x})-p_{\phi^* }(\bm{x})\,d\bm{x}\leq \epsilon.
\%
Note that
\%\label{101509}
&1-\int\sqrt{{p}_{\hat\phi}(\bm{x})p_{\phi^* }(\bm{x})}\,d\bm{x}-\bigg(1-\int\sqrt{\bar{p}_{\hat\phi}(\bm{x})p_{\phi^* }(\bm{x})}\,d\bm{x}\bigg)\notag\\
&=\int\Big(\sqrt{\bar{p}_{\hat\phi}(\bm{x})}-\sqrt{{p}_{\hat\phi}(\bm{x})}\Big)\sqrt{{p}_{\phi^* }(\bm{x})}\,d\bm{x}\notag\\
&\leq \sqrt{\int\Big(\sqrt{\bar{p}_{\hat\phi}(\bm{x})}-\sqrt{{p}_{\hat\phi}(\bm{x})}\Big)^2\,d\bm{x}}\notag\\
&=\sqrt{\int \bar{p}_{\hat\phi}(\bm{x})+{p}_{\hat\phi}(\bm{x})-2\sqrt{\bar{p}_{\hat\phi}(\bm{x}){p}_{\hat\phi}(\bm{x})} \,d\bm{x}}\notag\\
&\leq \sqrt{\int \bar{p}_{\hat\phi}(\bm{x})-{p}_{\hat\phi}(\bm{x})\,d\bm{x}}\notag\\
&\leq \sqrt{\epsilon}.
\%
Here the first inequality follows from Cauchy-Schwarz inequality and the second follows from the fact that $\sqrt{\bar{p}_{\hat\phi}(\bm{x}){p}_{\hat\phi}(\bm{x})}\geq{p}_{\hat\phi}(\bm{x})$. By \eqref{101508} and \eqref{101509}, we have
\%
1-\int\sqrt{{p}_{\hat\phi}(\bm{x})p_{\phi^* }(\bm{x})}\,d\bm{x}\leq \sqrt{\epsilon}+\frac{1}{m}\log\frac{N_{\b}\big(\mP_{\mathcal{X}\times\mathcal{S}}(\Phi),\epsilon\big)}{\delta},
\%
which implies that
\%
H^2\big(\P_{\hat{\phi}}(\bm{x}),\P_{\phi^{*}}(\bm{x})\big)=1-\int\sqrt{{p}_{\hat\phi}(\bm{x})p_{\phi^* }(\bm{x})}\,d\bm{x}\leq \sqrt{\epsilon}+\frac{1}{m}\log\frac{N_{\b}\big(\mP_{\mathcal{X}\times\mathcal{S}}(\Phi),\epsilon\big)}{\delta}.
\%
Set $\epsilon=1/m^2$. We have
\%
H^2\big({\P}_{\hat\phi}(x,s),\P_{\phi^* }(x,s)\big)\leq \frac{2}{m}\log\frac{N_{\b}\big(\mP_{\mathcal{X}\times\mathcal{S}}(\Phi),1/m^2\big)}{\delta}.
\%
\end{proof}


\subsubsection{Proof of Theorem \ref{weak_error_bound}}
With Lemma \ref{mle_hellinger} in hand, we are ready to prove Theorem \ref{weak_error_bound}.
\begin{proof}[Proof of Theorem \ref{weak_error_bound}]
Let $\hat\phi$ be the output of the MLE step in Algorithm \ref{mle+erm}. And for any $\phi \in \Phi, \psi \in \Psi$, we define
\%
\Delta_{\phi,\psi}:= \mathbb{E}_{\phi^{*}, \psi^{*}} [\ell (g_{\phi, \psi}(x),y)] - \frac{1}{n}\sum_{j=1}^{n} \ell (g_{\phi, \psi}(x_{j}),y_{j}).
\%
Following the same arguments as that in the proof of Theorem \ref{error_bound}, we have with probability at least $1-\delta$,
\%\label{111501}
H\big(\P_{\hat{\phi}}(x,s),\P_{\phi^{*}}(x,s)\big) \leq  \sqrt{\frac{2}{m} \log \frac{2N(\mathcal{P}_{\mathcal{X} \times \mathcal{S}}(\Phi), 1 / m^2)}{\delta}}
\%
and 
\%\label{111502}
\sup_{\psi \in \Psi}|\Delta_{\hat{\phi},\psi}| \leq R_{n} (\ell \circ \mathcal{G}_{\hat{\phi}, \Psi}) + L\sqrt{\frac{2\log (4/\delta)}{n}}.
\%
Moreover, as mentioned in \eqref{092705}, we have
\begin{align}\label{111504}
\operatorname{Error}_{\ell}(\hat{\phi},\hat\psi) &\leq\Delta_{\hat{\phi}, \hat{\psi}} - \Delta_{\hat{\phi}, \tilde{\psi}} + \mathbb{E}_{\phi^{*}, \psi^{*}} [\ell (g_{\hat{\phi}, \tilde{\psi}}(x),y)] - \mathbb{E}_{\phi^{*},\psi^{*}} [\ell (g_{\phi^{*},\psi^{*}}(x),y)]\notag\\
&\leq 2R_{n} (\ell \circ \mathcal{G}_{\hat{\phi}, \Psi}) + 2L\sqrt{\frac{2\log (4/\delta)}{n}}\notag\\
&\quad+\mathbb{E}_{\phi^{*},\psi^{*}} [\ell (g_{\phi^{*},\psi^{*}}(x),y)]-\mathbb{E}_{\phi^{*},\psi^{*}} [\ell (g_{\phi^{*},\psi^{*}}(x),y)],
\end{align}
where $\tilde{\psi} := \argmin_{\psi \in \Psi} d_\mathrm{TV} (\P_{\hat{\phi},\psi}(x,y),\P_{\phi^{*},\psi^{*}}(x,y))$ and the second inequality follows from \eqref{111502}. By lemma \ref{error_dtv}, we have
\begin{align}\label{111503}
&\mathbb{E}_{\phi^{*}, \psi^{*}} [\ell (g_{\hat{\phi}, \tilde{\psi}}(x),y)] - \mathbb{E}_{\phi^{*},\psi^{*}} [\ell (g_{\phi^{*},\psi^{*}}(x),y)] \notag \\
&\leq 4L \cdot d_\mathrm{TV} (\P_{\hat{\phi},\tilde{\psi}}(x,y),\P_{\phi^{*},\psi^{*}}(x,y)) \notag \\
&= 4L \cdot \min_{\psi \in \Psi} d_\mathrm{TV} (\P_{\hat{\phi},\psi}(x,y),\P_{\phi^{*},\psi^{*}}(x,y)) \quad (\text{by definition of } \tilde{\psi}) \notag \\
& \leq_{1)} 4\kappa L  \cdot H (\P_{\hat{\phi}}(x,s),\P_{\phi^{*}}(x,s))\notag\\
&\leq_{2)} 4\kappa L\sqrt{\frac{2}{m} \log \frac{2N(\mathcal{P}_{\mathcal{X} \times \mathcal{S}}(\Phi), 1 / m^2)}{\delta}},
\end{align}
where 1) follows from Assumption \ref{weak_invariance} and 2) follows from \eqref{111501}.
Combining \eqref{111504} and \eqref{111503}, we have
\%
\operatorname{Error}_{\ell}(\hat{\phi},\hat\psi)&\leq 2R_{n} (\ell \circ \mathcal{G}_{\hat{\phi}, \Psi}) + 2L\sqrt{\frac{2\log (4/\delta)}{n}}+4\kappa L\sqrt{\frac{2}{m} \log \frac{2N(\mathcal{P}_{\mathcal{X} \times \mathcal{S}}(\Phi), 1 / m^2)}{\delta}}\notag\\
&\leq 2\max_{\phi\in\Phi}R_{n} (\ell \circ \mathcal{G}_{{\phi}, \Psi}) + 2L\sqrt{\frac{2\log (4/\delta)}{n}}+4\kappa L\sqrt{\frac{2}{m} \log \frac{2N(\mathcal{P}_{\mathcal{X} \times \mathcal{S}}(\Phi), 1 / m^2)}{\delta}}.
\%
\end{proof}