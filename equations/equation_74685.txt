$g_t(x_i) \leftarrow (f(x_i)-y_i)\cdot \diag{\phi'((M\circ W(t))^\top \cdot x_i)}\cdot a$