\begin{align}\mathcal{L}^{\algn}_i(\vx) &= \underset{ \vy_1,\vy_2\sim\pi_{\theta_{\text{old}}} }{\E}\texttt{sg}\left(\left(r(\vy_i|\vx)-r(\vy_j|\vx)\right)\frac{\pi_\theta(\vy_j|\vx)}{\pi_{\theta_{\text{old}}}(\vy_j|\vx)}\right)\frac{\pi_\theta(\vy_i|\vx)}{\pi_{\theta_{\text{old}}}(\vy_i|\vx)}\\ \mathcal{L}^{\algn}_{i,\texttt{clip}}(\vx) &= \underset{ \vy_1,\vy_2\sim\pi_{\theta_{\text{old}}} }{\E}\texttt{sg}\left(\left(r(\vy_i|\vx)-r(\vy_j|\vx)\right)\frac{\pi_\theta(\vy_j|\vx)}{\pi_{\theta_{\text{old}}}(\vy_j|\vx)}\right)\texttt{clip}(\frac{\pi_\theta(\vy_i|\vx)}{\pi_{\theta_{\text{old}}}(\vy_i|\vx)}, 1-\epsilon, 1+\epsilon)\\ \mathcal{L}^{\algn}_{\text{sep}} &= \underset{\vx\sim\mathcal{D}}{\E}\left[\min(\mathcal{L}^{\algn}_1(\vx), \mathcal{L}^{\algn}_{1,\texttt{clip}}(\vx)) + \min(\mathcal{L}^{\algn}_2(\vx), \mathcal{L}^{\algn}_{2,\texttt{clip}}(\vx))\right]/2\end{align}