\begin{align}\mathcal{L}_{r'}^{\algn} &= \texttt{sg}\left(\left(r'(\vy_1|\vx)-r'(\vy_2|\vx)\right)\frac{\pi_\theta(\vy_1|\vx)}{\pi_{\theta_{\text{old}}}(\vy_1|\vx)}\frac{\pi_\theta(\vy_2|\vx)}{\pi_{\theta_{\text{old}}}(\vy_2|\vx)}\right)\log\frac{\pi_\theta(\vy_1|\vx)}{\pi_\theta(\vy_2|\vx)}\\ \mathcal{L}^{\algn}_{r',\texttt{clip}} &= \texttt{sg}\left(\left(r'(\vy_1|\vx)-r'(\vy_2|\vx)\right)\frac{\pi_\theta(\vy_1|\vx)}{\pi_{\theta_{\text{old}}}(\vy_1|\vx)}\frac{\pi_\theta(\vy_2|\vx)}{\pi_{\theta_{\text{old}}}(\vy_2|\vx)}\right) \\ &\quad\quad\times\texttt{clip}\left(\log\frac{\pi_\theta(\vy_1|\vx)}{\pi_\theta(\vy_2|\vx)},\log\frac{\pi_{\theta_\text{old}}(\vy_1|\vx)}{\pi_{\theta_\text{old}}(\vy_2|\vx)}-\epsilon,\log\frac{\pi_{\theta_\text{old}}(\vy_1|\vx)}{\pi_{\theta_\text{old}}(\vy_2|\vx)}+\epsilon\right)\\ \nabla\mathcal{L}^{\algn}_{r',\text{joi}} &= \nabla\min(\mathcal{L}_{r'}^{\algn}, \mathcal{L}^{\algn}_{r',\texttt{clip}})\end{align}