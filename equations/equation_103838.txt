\begin{align}\log b(x_i) &= \sum_{g:\ i \in ne(g)} \max_{\mathbf{x}_g\in \mathcal{T}_g:\ {\bf x}_i=x_i} \left[ \displaystyle\sum_{j \in ne(g):\ i \ne j} \log b({\bf x}_j) \right] = \\ &=& \displaystyle\sum_{c: i \in ne(g)} \max_{\mathbf{x}_g: x_{i}=x_i} \left[ MLP^1_\varphi(g)\left(x_1,\ldots,x_{|ne(g)|}\right) \right] = \\ &=& \sum_{c: i \in ne(g)}MLP^2_{ci}\left[ MLP^1_\varphi(g)\left(x_1,\ldots,x_{|ne(g)|}\right)\right] = \\ &= \underbrace{\sum_{g:\ i \in ne(g)}\underbrace{MLP^2_{\varphi(g),i} \Big(\underbrace{MLP^1_{\varphi(g)} \left(log\_b({\bf x}_{g}))\right)}_{\mbox{nodes to factor eqs. (\ref{eq:message_a_r})-(\ref{eq:update_r})}}\Big)}_{\mbox{factor to node equation (\ref{eq:message_r_a})}}}_{\mbox{aggregation equation~(\ref{eq:update_a})}}\end{align}