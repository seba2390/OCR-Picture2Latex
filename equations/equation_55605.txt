\begin{align}\mathcal{L}^{\algn}(\vx) &= \underset{ \vy_1,\vy_2\sim\pi_{\theta_{\text{old}}} }{\E}\texttt{sg}\left(\left(r(\vy_1|\vx)-r(\vy_2|\vx)\right)\frac{\pi_\theta(\vy_1|\vx)}{\pi_{\theta_{\text{old}}}(\vy_1|\vx)}\frac{\pi_\theta(\vy_2|\vx)}{\pi_{\theta_{\text{old}}}(\vy_2|\vx)}\right)\log\frac{\pi_\theta(\vy_1|\vx)}{\pi_\theta(\vy_2|\vx)}\\ \mathcal{L}^{\algn}_{\texttt{clip}}(\vx) &= \underset{ \vy_1,\vy_2\sim\pi_{\theta_{\text{old}}} }{\E}\texttt{sg}\left(\left(r(\vy_1|\vx)-r(\vy_2|\vx)\right)\frac{\pi_\theta(\vy_1|\vx)}{\pi_{\theta_{\text{old}}}(\vy_1|\vx)}\frac{\pi_\theta(\vy_2|\vx)}{\pi_{\theta_{\text{old}}}(\vy_2|\vx)}\right) \\ &\quad\quad\times\texttt{clip}\left(\log\frac{\pi_\theta(\vy_1|\vx)}{\pi_\theta(\vy_2|\vx)},\log\frac{\pi_{\theta_\text{old}}(\vy_1|\vx)}{\pi_{\theta_\text{old}}(\vy_2|\vx)}-\epsilon,\log\frac{\pi_{\theta_\text{old}}(\vy_1|\vx)}{\pi_{\theta_\text{old}}(\vy_2|\vx)}+\epsilon\right)\\ \mathcal{L}^{\algn}_{\text{joi}} &= \underset{\vx\sim\mathcal{D}}{\E}\min(\mathcal{L}^{\algn}(\vx), \mathcal{L}^{\algn}_{\texttt{clip}}(\vx))\end{align}