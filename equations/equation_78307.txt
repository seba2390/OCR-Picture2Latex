\begin{align}&c_{i,j}^{k}, \ p_{i,j}^{k} = f(e_{i, k}, e_{k+1, j})\\ &\widetilde{p}_{i,j}^{k} = p_{i,j}^{k} \,\, \widetilde{p}_{i,k} \,\, \widetilde{p}_{k+1,j}\\ &\boldsymbol{\alpha}_{i,j} = \text{\gumbel} (\log( \mathbf{\widetilde{p}}_{i,j}))\\ &e_{i,j} = [c_{i,j}^{i}, c_{i,j}^{i+1}, ..., c_{i,j}^{j-1}]\,\boldsymbol{\alpha}_{i,j}\\ &[p_{i,j},\widetilde{p}_{i,j}] = \boldsymbol{\alpha}_{i,j}^\intercal [\boldsymbol{p}_{i,j}, \boldsymbol{\widetilde{p}}_{i,j}]\end{align}