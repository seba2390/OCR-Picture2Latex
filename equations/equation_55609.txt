\begin{align}\nabla \mathcal{L}^{\text{VPG}}(\vx) &= \sum_{\vy} r(\vy|\vx)\nabla\pi_\theta(\vy|\vx)\\ &= \left(\sum_{\vy_1}r(\vy_1|\vx)\nabla \pi_\theta(\vy_1|\vx) - \sum_{\vy_1,\vy_2}r(\vy_2|\vx)\pi_\theta(\vy_2|\vx)\nabla \pi_\theta(\vy_1|\vx)\right)\\ &=\left(\sum_{\vy_1,\vy_2}r(\vy_1|\vx)\pi_\theta(\vy_2|\vx)\nabla \pi_\theta(\vy_1|\vx) - \sum_{\vy_1,\vy_2}r(\vy_2|\vx)\pi_\theta(\vy_2|\vx)\nabla \pi_\theta(\vy_1|\vx)\right)\\ &=\sum_{\vy_1,\vy_2}\left(r(\vy_1|\vx)-r(\vy_2|\vx)\right)\pi_\theta(\vy_2|\vx)\nabla\pi_\theta(\vy_1|\vx)\\ &=\underset{\vy_1,\vy_2\sim\pi_{\theta_{\text{old}}}}{\E}\left(r(\vy_1|\vx)-r(\vy_2|\vx)\right)\frac{\pi_\theta(\vy_2|\vx)}{\pi_{\theta_{\text{old}}}(\vy_2|\vx)}\frac{\nabla\pi_\theta(\vy_1|\vx)}{\pi_{\theta_{\text{old}}}(\vy_1|\vx)}\end{align}