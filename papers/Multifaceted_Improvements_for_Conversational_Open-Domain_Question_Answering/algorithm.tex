%% This declares a command \Comment
%% The argument will be surrounded by /* ... */
\SetKwComment{Comment}{/* }{ */}

\begin{algorithm}[t]
\caption{Training Scheduler}\label{alg:TS}
% \KwData{$n \geq 0$}
% \KwResult{$y = x^n$}
\LinesNumbered
\KwIn{Training data $\mathcal{D}_{train}=\{(q_i, a_i, p_i^+)\}_{i=1}^m$, \\
\qquad \quad Iteration number $L$.}
\KwOut{A set of optimal model parameters.}

\For{$l=1,\cdots, L$}{
    Sample a batch of questions $Q^{(l)}$\\
    \For{$q_i\in Q^{(l)}$}{
        $\mathcal{P}_{i}^{(l)} \gets \mathrm{arg\,max}_{p_{i,j}}(\mathrm{sim}(q_i^{en},p_{i,j}),K)$\\
        $\mathcal{P}_{Gi}^{(l)} \gets \mathcal{P}_{i}^{(l)}\cup\{p^+_i\}$\\
        Compute $\mathcal{L}^i_{retriever}$, $\mathcal{L}^i_{postranker}$, $\mathcal{L}^i_{reader}$\\ according to Eq.\ref{eq:retriever}, Eq.\ref{eq:rerank}, Eq.\ref{eq:reader}\\
    }
    % $\mathcal{L}^{(l)}_{retriever} \gets \frac{1}{|Q^{(l)}|}\sum_i\mathcal{L}^i_{retriever}$\\
    % $\mathcal{L}^{(l)}_{retriever} \gets \mathrm{Avg}(\mathcal{L}^i_{retriever})$,
    % $\mathcal{L}^{(l)}_{rerank} \gets \mathrm{Avg}(\mathcal{L}^i_{rerank})$,
    % $\mathcal{L}^{(l)}_{reader} \gets \mathrm{Avg}(\mathcal{L}^i_{reader})$\\
    % Compute $\mathcal{L}^{(l)}_{retriever}$, $\mathcal{L}^{(l)}_{rerank}$, and $\mathcal{L}^{(l)}_{reader}$ by averaging over $Q^{(l)}$\\
    $\mathcal{L}^{(l)} \gets \frac{1}{|Q^{(l)}|}\sum_i(\mathcal{L}^{i}_{retriever} + \mathcal{L}^{i}_{postranker}+ \mathcal{L}^{i}_{reader})$\\
    $\mathcal{P}^{(l)}_K\gets\{\mathcal{P}^{(l)}_i|q_i\in Q^{(l)}\}$,\quad $\mathcal{P}^{(l)}_{KG}\gets\{\mathcal{P}^{(l)}_{Gi}|q_i\in Q^{(l)}\}$\\
    Compute the coefficient $v^{(l)}$ according to Eq.~\ref{eq:v}\\
  \eIf{$ v^{(l)}=1$}{
    $\mathcal{L}^{(l)}_{final} \gets \mathcal{L}^{(l)}(\mathcal{P}_{KG}^{(l)})$\\
  }{
      $\mathcal{L}^{(l)}_{final} \gets \mathcal{L}^{(l)}(\mathcal{P}^{(l)}_{K}),$\\
    }
    Optimize $\mathcal{L}^{(l)}_{final}$
}
\end{algorithm}


%  \eIf{$ \mathcal{L}^{(l-1)}_{retriever}<\lambda$}{
%     $\mathcal{L}^{(l)}_{final} \gets \mathcal{L}^{(l)}(\mathcal{P}_K^{(l)})$\\
%   }{
%       $\mathcal{L}^{(l)}_{final} \gets \mathcal{L}^{(l)}(\mathcal{P}^{(l)}_{KG}),$\\
%     }