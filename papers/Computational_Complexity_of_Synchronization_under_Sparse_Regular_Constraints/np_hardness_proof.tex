\begin{proof}[Proof Sketch for Lemma~\ref{lem:np_hardness}]
 We construct a reduction from an instance
 of $\textsc{DisjointSetTransporter}$\footnote{Note that the problem $\textsc{DisjointSetTransporter}$ is over a unary alphabet, but for $L\textsc{-Constr-Sync}$
 we have $|\Sigma| > 1$. Indeed, we need the additional letters in $\Sigma$.}
 for unary input automata.
 %, which is $\NP$-complete in
 %this case, by Theorem~\ref{prop:set_transporter_np_complete},
 %to $L\textsc{-Constr-Sync}$ for $L$ as written in the statement\footnote{Note that the problem $\textsc{DisjointSetTransporter}$ is over a unary alphabet, but for $L\textsc{-Constr-Sync}$
 %we have $|\Sigma| > 1$. Indeed, we need the additional letters in $\Sigma$ in our reduction.}.
 
 To demonstrate the basic idea, we only do the proof
 in the case $L \subseteq a^* b^* a^*$.
 %By Theorem~\ref{thm:bounded_regular_form},
 %we can write $L = \bigcup_{i=1}^n A_1^{(i)} A_2^{(i)} A_3^{(i)}$
 %with regular languages $A_1^{(i)}, A_3^{(i)} \subseteq \{a\}^*$
 %and $A_2^{(i)} \subseteq \{b\}^*$.
 By assumption we can deduce $a^{r_1} b^{r_2} a^{r_3} \in L(\mathcal B)$
 with $p_2 \ge |P|$ and $r_1, r_3 \ge 1$.
 By the pigeonhole principle, in $\mathcal B$, 
 when reading the factor $b^{r_2}$, at least one state has to be traversed twice.
 Hence, we find $0 < p_2 \le |P|$ such that $a^{r_1} b^{r_2 + i\cdot p_2} a^{r_3}
 \subseteq L(\mathcal B)$ for each $i \ge 0$.
 %Then, by Lemma~\ref{lem:L_j1j2j3_intersection},
 %we must find $i_0 \in \{1,\ldots,n\}$
 %such that $a^+ \cap A_1^{(i_0)} \ne \emptyset$, $a^+ \cap A_3^{(i_0)} \ne \emptyset$
 %and $A_2^{(i_0)}$ is infinite.
%  As a shorthand,
%  we set $A_1 = A_1^{(i_0)}$, $A_2 = A_2^{(i_0)}$ and $A_3^{(i_0)} = A_3$.
% %  By Lemma~\ref{todo}, the languages could be written
% %  as a finite union of languages recognizable
% %  by unary automata with a single final state.
% %  As concatenation distributes over union, 
% %  %we can then write $A_1^{(i_0)} A_2^{(i_0)} A_3^{(i_0)}$
% %  %as a finite union of languages
% %  without loss of generality, as by such a rearranging the above assumption
% %  still holds true for at least one part of the union, we can 
% %  suppose $A_1$,  $A_2$ and $A_3$
% %  are recognizable by unary automata with a single final state.
% Then, it is easy to see that we find numbers $r_i, p_i$ such that
% $
%     a^{r_1}(a^{p_1})^* \subseteq A_1,
%     b^{r_2}(b^{p_2})^* \subseteq A_2, 
%     a^{r_3}(a^{p_3})^* \subseteq A_3
% $
% with, by the other assumptions, $p_2 > 0$ ($A_2$ infinite)
% and $r_1 + p_1 > 0$, $r_3 + p_3 > 0$ ($A_1$, $A_3$ non-empty and do not equal $\{\varepsilon\}$).
% todo hinschreiben, wenn ncihts gesagt immer complete und deterministic


Let $\mathcal A = (\{c\}, Q, \delta)$ and $(\mathcal A, S, T)$
be an instance of \textsc{DisjointSetTransporter}.
We can assume $S$ and $T$ are non-empty, as for $S = \emptyset$
it is solvable, and if $T = \emptyset$ we have no solution.
Construct $\mathcal A' = (\Sigma, Q', \delta')$
by setting
$
 Q' = S_{r_2} \cup \ldots \cup S_{1} \cup Q \cup Q_1 \cup \ldots \cup Q_{p_2-1} \cup \{ t \},
$
where $t$ is a new state, $S_i = \{ s_i \mid s \in S \}$ for $i \in \{1,\ldots, r_2 \}$
are pairwise disjoint copies of $S$
and $Q_i = \{ q^i \mid q \in Q \}$ are\footnote{Observe
that by the indices a correspondence between the sets
is implied. The index
in $Q_i$ at the top to distinguish, for $s \in S$ and $i \in \{1,\ldots,\min\{r_2, p_2-1\}\}$, between
 $s_i \in S_i$ and $s^i \in Q_i$. Hence, for each $s \in S$ and $i \in \{1,\ldots, r_2\}$,
 the states $s$ and $s_i$ correspond to each other, and for $q \in Q$
 and $i \in \{1,\ldots, p_2-1\}$ the states $q$ and $q^i$.} 
 also pairwise disjoint 
copies of $Q$. Note that also $S_i \cap Q_j = \emptyset$
for $i \in \{1,\ldots, r_2 \}$ and $j \in \{1,\ldots, p_2-1\}$.
Set $S_0 = S$ %and $Q_0 = Q$ 
as a shorthand.
Choose any $\hat s \in S_{r_2}$, then, for $q \in Q$ and $x \in \Sigma$, the transition function is given by
\[
 \delta'(q, x) = \left\{
 \begin{array}{ll}
  s_{i-1} & \mbox{if } x = b \mbox{ and } q = s_i \in S_i \mbox{ for some } i \in \{1,\ldots, r_2\}; \\ 
  \hat s & \mbox{if } x = a \mbox{ and } q \in (Q \cup Q_1 \cup \ldots \cup Q_{p_2-1}) \setminus S; \\
  s_{r_2} & \mbox{if } x= a \mbox{ and } q = s_i \in S_i \mbox{ for some } i \in \{0,\ldots,r_2\}; \\
  t       & \mbox{if } x = a \mbox{ and } q \in T; \\
  q^{p_2-1} & \mbox{if } x = b \mbox{ and } q \in Q; \\
  q^{i-1} & \mbox{if } x = b \mbox{ and } q = q^i \in Q_i \mbox{ for some } i \in \{2,\ldots,p_2-1\}; \\
  \delta(q, c) & \mbox{if } x = b \mbox{ and } q = q^1 \in Q_1; \\
  q       & \mbox{otherwise}.
 \end{array}
 \right.
\]

\input{tikz_np_reduction}

Please see Figure~\ref{fig:reduction_np_hard} for a sketch
of the reduction.
For the constructed automaton $\mathcal A'$, the following could be shown:
$\exists m \ge 0 : \delta(S, c^m) \subseteq T$
if and only if $\mathcal A'$ has a synchronizing word in $ab^{r_2}(b^{p_2})^*a$
if and only if $\mathcal A'$ has a synchronizing word in $ab^*a$
if and only if $\mathcal A'$ has a synchronizing word in $a^*b^*a^*$.
% \begin{align*}
%     \exists m \ge 0 : \delta(S, c^m) \subseteq T 
%                               & \Leftrightarrow \mathcal A'\mbox{ has a synchronizing word in $ab^{r_2}(b^{p_2})^*a$.} \\
%                               & \Leftrightarrow \mathcal A'\mbox{ has a synchronizing word in $ab^*a$.} \\
%                               & \Leftrightarrow \mathcal A'\mbox{ has a synchronizing word in $a^*b^*a^*$}
% \end{align*} 

\begin{toappendix}

Next, we supply the proof of the claim made in the proof sketch of Lemma~\ref{lem:np_hardness}
from the main text.

\medskip

\noindent\underline{Claim:} 
 For the constructed automaton $\mathcal A'$ from
 the proof sketch of Lemma~\ref{lem:np_hardness} in the main text, we have:
\begin{align*}
    \exists m \ge 0 : \delta(S, c^m) \subseteq T 
                               & \Leftrightarrow \mathcal A'\mbox{ has a synchronizing word in $ab^{r_2}(b^{p_2})^*a$.} \\
                               & \Leftrightarrow \mathcal A'\mbox{ has a synchronizing word in $ab^*a$.} \\
                               & \Leftrightarrow \mathcal A'\mbox{ has a synchronizing word in $a^*b^*a^*$}
\end{align*} 
%\begin{quote}
%\begin{proof}[Proof of Claim]
 \emph{Proof of the Claim.}
 First, suppose $\delta(S, c^m) \subseteq T$.
 %Choose any $a^r \in A_1$ with $r > 0$
 %and $a^s \in A_3$ with $s > 0$. 
 By construction of $\mathcal A'$,
 for any $q, q' \in Q$,
 \begin{equation}\label{eqn:transition_Astar}
  \delta(q, c) = q'  \mbox{ in $\mathcal A$}  \Leftrightarrow \delta'(q, b^{p_2}) = q'  \mbox{ in $\mathcal A'$} .
 \end{equation}
 Also, $\delta'(Q'\setminus\{t\},a) = S_{r_2}$
 and $\delta'(S_{r_2}, b^{r_2}) = S$.
 Combining these facts, we find
 \[
  \delta'(Q', ab^{r_2}b^{p_2m}) \subseteq T \cup \{t\}. 
 \]
 A final application of $a$ then maps
 all states in $T$ to the single sink %(and synchronizing) 
 state~$t$.
 
 Clearly, as $ab^{r_2}(b^{p_2})^*a \subseteq a b^* a$
 and $a b^* a \subseteq a^* b^* a^*$, the next two implications are shown.
 Finally, to complete the argument, let $u = a^{p} b^q a^r$ be a synchronizing word, $p,q,r \ge 0$.
 Then, as $t$ is a sink state, $\delta'(Q', u) = \{t\}$.
 The only way to enter $t$ from the outside is to read $a$ at least once, and 
 as $t$ is a sink state, we have $\delta'(Q', a^p b^q a^r) = \{t\}$.
 Also, as for $q \notin T$, we have $\delta'(q, a) \notin T$,
 we must have $\delta'(Q', a^p b^q) \subseteq T \cup \{t\}$,
  or more specifically, $\delta'(Q' \setminus \{t\}, a^p b^q) \subseteq T$.
  We distinguish two cases for~$p$.
 
 \begin{enumerate}
 \item If $p = 0$, then, in particular, $\delta'(S, b^q)  \subseteq T$.
     By construction of $\mathcal A'$, for any $q \in Q$,
 \[
  \delta'(q, b^n) \in Q
 \]
 if and only if $n \equiv 0\pmod{p_2}$.
 So, $q = p_2 m$ for some $m \ge 0$.
 Hence, by Equation~\eqref{eqn:transition_Astar} above from the first case, in $\mathcal A$,
 we find $\delta(S, c^m) \subseteq T$.
 
 \item  If $p > 0$, then $\delta'(Q' \setminus\{t\}, a^p) = S_{r_2}$.
 The only way to leave any state in $S_{r_2}$
 is to read $b$, which transfers $S_{r_2}$ to $S_{r_2-1}$.
 Reasoning similarly, we find that we have to read in $b$
 at least $r_2$ many times, which finally maps $S_{r_2}$
 onto $S_0 = S$. So, $q \ge r_2$. By construction of $\mathcal A'$, for any $q \in Q$,
 \[
  \delta'(q, b^n) \in Q
 \]
 if and only if $n \equiv 0\pmod{p_2}$.
 So, as $\delta'(S, b^{q - r_2}) \subseteq T$, $q - r_2 = p_2 m$ for some $m \ge 0$.
 Hence, by Equation~\eqref{eqn:transition_Astar} above, in $\mathcal A$,
 we find $\delta(S, c^m) \subseteq T$.
 \end{enumerate}
This ends the proof of the claim. \emph{[End, proof of the Claim.]}
%\end{proof}
%\end{quote}
\end{toappendix}

%Finally, we show that we have some $m \ge 0$
%such that $\delta(S, c^m) \subseteq T$
%if and only if $\mathcal A'$ has a synchronizing word in $L$:
 Now, suppose $\delta(s, c^m) \subseteq T$ for some $m \ge 0$.
 By the above, $\mathcal A'$ 
 has a synchronizing word $u$ in $ab^{r_2}(b^{p_2})^*a$.
%  As $A_1$ is non-empty
%  and does not equal $\{\varepsilon\}$, we can choose $a^p \in A_1$ with $p > 0$.
%  Similarly, choose $a^r \in A_3$.
%  Then
%  $
%   a^{p-1} u a^{r-1} v \in A_1 A_2 A_3 \subseteq L,
%  $
%  and %by Lemma~\ref{lem:append_sync}, 
%  this word also synchronizes $\mathcal A'$.
 Then, $a^{r_1 - 1}u a^{r_3-1} \in L(\mathcal B)$ also synchronizes~$\mathcal A'$.
 
 
 Conversely, suppose we have a synchronizing word $w \in L$
 for $\mathcal A'$.
 As $L \subseteq a^* b^* a^*$
 by the above equivalences,
 $\delta(S, c^m) \subseteq T$
 for some $m \ge 0$. \qed
\end{proof}
