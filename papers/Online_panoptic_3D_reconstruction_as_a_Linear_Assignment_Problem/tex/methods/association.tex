
% Multi-object tracking:
% https://arxiv.org/pdf/2008.08063.pdf
% https://arxiv.org/pdf/2101.08684.pdf
% https://arxiv.org/pdf/2001.05673.pdf

% https://openaccess.thecvf.com/content_iccv_2015/papers/Rezatofighi_Joint_Probabilistic_Data_ICCV_2015_paper.pdf

% https://markusthill.github.io/mahalanbis-chi-squared/

The most essential part of integrating 2D panoptic segmentations to a 3D reconstruction is the association of detected segments with both temporally and spatially consistent labels. While classes determined as \textit{stuff} -- amorphous, unquantifiable regions like sky, road or floor -- can always simply be associated with the same persistent ID, the association of \textit{things} -- quantifiable objects -- is not as trivial. The output of an image segmentation model is only consistent within the single frame: the same instance label is guaranteed to point to the same object only in the image it originates from. On the other hand, while video segmentation methods like \cite{video_panoptic_segmentation} can be applied to maintain temporal consistency of instance labels in the current camera view, they can not necessarily hold spatial consistency throughout the sequence: if an object is first perceived in the sequence, then lost, and later seen again, it will be assigned a new instance label unless it can be re-identified as the same object. A static object instance can be tracked in 3D, however, by associating detected instances with the existing portion of the 3D reconstruction even if it leaves the current camera view. 

The data-association task of matching \textit{thing} detections with the reconstruction can be formulated as a Linear Assignment Problem (LAP). Assume we have $n$ detected segments $S_d$, each a set of 3D points associated with an instance label and the segmentation model's confidence scores corresponding to semantic classes. On the other hand, let's assume a set of $m$ tracking targets $S_t$ in the 3D reconstruction formed thus far with similar properties. Since there are no overlaps between the segments in panoptic segmentation and the model's objective is to segment each object as a whole, we can make the common assumption that a detection can only originate from a single target and only one target should be associated with a detection. \cite{ab3dmot,two_stage_data_association,probabilistic_3d_mot} With these assumptions, the problem can be formulated into a $n \times m$ matrix, where each row corresponds to a detection, each column corresponds to a target and cell values are the likelihoods of the the detections originating from from each target. An optimal solution to the problem is then achieved by matching each row with a single column in a way that maximises the sum of likelihoods across all matches.

Because the amount of possible objects in the reconstructed scene is unknown beforehand, a mechanism for generating new target segments is required. With an LAP such a mechanism is quite simple to implement: if an optimal detection-target match has a likelihood below a certain threshold, the detection is assumed to be a new object and it is associated with a new instance label. Since the number of detections and targets might not be equal, a number of temporary dummy IDs are generated to form a square matrix. The likelihood of a detection or a target -- depending on which set is smaller -- matching these dummies is set to zero. Thus, whenever a detection is matched with one -- because there are no more real targets available -- it will be assigned a new ID. On the other hand, dummy detections matched with any target -- when there were less detections than targets -- can be ignored.

The problem can be solved optimally in $\mathcal{O}(n^3)$ time with the Hungarian Algorithm \cite{hungarian}. Variants of the method have been applied in many multi-object tracking works. While faster, approximate, ways to solve the problem have also been invented \cite{probabilistic_3d_mot,two_stage_data_association,panopticfusion}, the optimal solution can be found fast enough in our case since only objects in the current camera view have to be considered. Both PanopticFusion \cite{panopticfusion} and Voxblox++ \cite{voxblox++} apply a greedy algorithm to the task, which is fast, but will not guarantee an optimal solution unless the likelihood threshold is greater than $0.5$. \cite{panoptic_segmentation}
