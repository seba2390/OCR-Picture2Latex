% OBSERVATIONS START
%
% Boxed environment with semi-transparent shadow.
% see http://tex.stackexchange.com/questions/127383/fading-shadow-with-mdframed
%
\usepackage[absolute,overlay]{textpos}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{calc}

\newcounter{obsctr}
\newcommand{\obsref}[1]{\emph{O\ref{obs:#1}}}
\newcommand{\observation}[2]{\refstepcounter{obsctr}\emph{O\theobsctr:\label{obs:#1}}}

\newlength{\boxw}
\newlength{\boxh}
\newlength{\shadowsize}
\newlength{\boxroundness}
\newlength{\tmpa}
\newsavebox{\shadowblockbox}

\setlength{\shadowsize}{3pt}
\setlength{\boxroundness}{3pt}

\newenvironment{obs}[1]%
{\vspace{0.2cm}\noindent
\begin{lrbox}{
\shadowblockbox
}
\begin{minipage}{.98\columnwidth}
\observation{#1}~}%
{\end{minipage}\end{lrbox}%
\settowidth{\boxw}{\usebox{\shadowblockbox}}%
\settodepth{\tmpa}{\usebox{\shadowblockbox}}%
\settoheight{\boxh}{\usebox{\shadowblockbox}}%
\addtolength{\boxh}{\tmpa}%
\begin{tikzpicture}
\addtolength{\boxw}{\boxroundness * 2}
\addtolength{\boxh}{\boxroundness * 2}

\foreach \x in {0,.05,...,1}
{
\setlength{\tmpa}{\shadowsize * \real{\x}}
\fill[xshift=\shadowsize - 1pt,yshift=-\shadowsize + 
1pt,black,opacity=.04,rounded corners=\boxroundness] 
(\tmpa, \tmpa) rectangle +(\boxw - \tmpa - \tmpa, \boxh - \tmpa - 
\tmpa);
}

\filldraw[fill=white!50, draw=black!80, rounded corners=\boxroundness] (0, 
0) rectangle (\boxw, \boxh);
\draw node[xshift=\boxroundness,yshift=\boxroundness,inner sep=0pt,outer 
sep=0pt,anchor=south west] (0,0) {\usebox{\shadowblockbox}};
\end{tikzpicture}\vspace{0cm}%
}
% OBSERVATIONS END