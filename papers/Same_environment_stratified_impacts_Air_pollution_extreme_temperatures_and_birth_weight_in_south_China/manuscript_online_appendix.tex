%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Appendix 1, Additional Estimation Results
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\thefigure}{A.\arabic{figure}}
\setcounter{figure}{0}
\renewcommand{\thetable}{A.\arabic{table}}
\setcounter{table}{0}
\renewcommand{\theequation}{A.\arabic{equation}}
\setcounter{equation}{0}
\renewcommand{\thefootnote}{A.\arabic{footnote}}
\setcounter{footnote}{0}

\section{Additional Estimation Results}

\subsection{Composite Pollution Index}
In this Appendix section, we repeat the analyses for \PARPMTEN with the composite index pollution
measure. Results are presented in Appendix Tables \ref{tab:appone}, \ref{tab:apptwo} and \ref{tab:appthree}. Patterns
in the temperature results are robust to choice of pollution measure. The results from the composite index
analysis closely mirror the patterns revealed in the \PARPMTEN analysis.
There is a protective effect of maternal education with regard to
pollution, and the finding persists across conditional quantiles of
birth weight (see the dotted lines in Figure \ref{fig:mainthree} Bottom Row). Further, quantile
regressions show that the negative associations between the pollution
and birth weight, and the protective effects of maternal education with
respect to pollution, are magnified at lower conditional quantiles (see
the solid lines and shaded areas in Figure \ref{fig:mainthree} Bottom Row). See Section \ref{composite-index-analysis} for more discussion.

\input{paper_final_tab/table_app1_fmd.tex}
\pagebreak 
\input{paper_final_tab/table_app2_fmd.tex}
\pagebreak 
\input{paper_final_tab/table_app3_fmd.tex}
\clearpage

\subsection{All City Districts \PARPMTEN Measurements\label{sec:appallcity}}

Rather than using pollution data from monitoring stations in the four contiguous districts located in the center of the city, in this robustness check, we use pollution data from the whole city of Guangzhou, including information from districts that are further away. There are 11 districts in Guangzhou, five districts are located to the north of the center-city districts, and two districts are located to the south. Guangzhou city's total area is 7434 square kilometers. The four center-city districts' total area is 280 square kilometers. 

Given the proximity, it is more likely that mothers who deliver in the center-city district where our data comes from reside in center-city districts. However, it is also possible that some of them come from further-away districts. Additionally, in a metropolitan city with convenient local transport networks, it is likely that Guangzhou residents travel beyond their district borders throughout the city for work, leisure, shopping, and health and other social services. So it is plausible that the appropriate measure for ambient pollution should be based on city-wide data rather than district-specific data. 

Summary statistics in Table \ref{tab:mainone} shows that pollution measurements from all city districts and center-city districts are quiet similar. The mean and standard deviation of the average daily mean potential \PARPMTEN exposure are 73.2 and 7.2 for all city districts and 72.1 and 6.6 for center-city districts. The all city and center-city composite index also have similar means and standard deviations. The similarity in pollution exposure within the confines of Guangzhou is not surprising given that that these pollutants are formed and spread through lower-atmosphere and are usually not highly localized \autocite{he_severe_2019}. 

We present results using all-city district data in Table \ref{tab:mainthreeallcity}, which presents parallel results as in Table \ref{tab:mainthree}, except that center-city districts \PARPMTEN measurements are replaced by all city districts measurements. Table \ref{tab:mainthreeallcity} estimates are almost identical to Table \ref{tab:mainthree} results. Similarly, results from using the two types of measures are also similar for conditional quantile estimations and estimation using the composite index. Given their similarity, those results are not presented. 

\input{paper_final_tab/table_main3_FullPreterm_AllCity_fmd.tex}

\subsection{Sample Truncation Based on Gestational Age at Birth\label{sec:appfullterm}}

Research on the effects of pollution on birth weight often include both pre-term (with gestational age less than 37 weeks) and full-term births \autocite{stieb_ambient_2012, klepac_ambient_2018}. Some studies restrict the analytic sample to full-term births. Full-term sample selection may be important for creating a balanced sample to study the differential effects of pollution during different trimesters \autocite{morello-frosch_ambient_2010} or each month of gestation \autocite{huang_periconceptional_2020}. In this paper, we are interested in the average exposure effects from ambient pollution and extreme temperature throughout the course of pregnancy and do not estimate gestation-specific effects.\footnote{In Equations \eqref{eq:one} and \eqref{eq:two}, we implicitly assume that the effects of pollution and extreme temperature exposures are the same across gestational periods. Given our sample and location constraints, we do not have sufficient power to identify quantile- and gestation-period-specific estimates.} 

In the text, we focus on the distribution of birth weights. Following \textcite{abrevaya_effects_2001, koenker_quantile_2001, firpo_unconditional_2009}, we focus on all live singleton births and do not truncate based on gestational age. Gestational age in our sample ranges from 171 to 319 days. While we believe it is important to analyze the full distributional outcomes without gestational truncation, to facilitate comparisons to papers that do impose gestational truncation, in Table \ref{tab:mainthreefullterm}, we conduct the same estimation with the same variables as in Table \ref{tab:mainthree}, but now restrict our sample to only individuals with gestational age longer than 36 weeks. 

The main results in Table \ref{tab:mainthreefullterm}  are similar in directions but smaller in magnitudes than the results in Table \ref{tab:mainthree}: we continue to find negative associations between pollution and extreme temperatures and birth weight, and find that mothers' college education status is associated with reduced vulnerability to ambient air pollution and extreme heat exposures.\footnote{In both Tables \ref{tab:mainthree} and \ref{tab:mainthreefullterm}, we find a weak negative coefficient for the maternal-college-education and extreme-cold interaction variable. The coefficient is not significant in Table \ref{tab:mainthree} and weakly significant in Table \ref{tab:mainthreefullterm}. As shown in Table \ref{tab:mainfive}, these relationships fluctuate between weakly positive and negative across the quantiles for results without gestational restrictions. Quantile results with gestational restrictions are similar.} In particular, we find a 1 Âµg/m3 increase in average daily \PARPMTEN potential exposure during pregnancy is associated with an 8.85 gram reduction of birth weight (s.e. 1.56) in Table \ref{tab:mainthreefullterm} column 1, but the same increase is associated with a 17.83 gram reduction of birth weight (s.e. 2.27) in Table \ref{tab:mainthree} column 1. Additionally, we find a maternal college education and \PARPMTEN interaction coefficient of 0.72 (s.e. 0.59) in Table \ref{tab:mainthreefullterm} column 2 and of 1.95 (s.e. 0.68) in Table \ref{tab:mainthree} column 2. Corresponding quantile regression results with full-term birth also show similar patterns as in Tables 4 and 5. 

\input{paper_final_tab/table_main3_Fullterm_inner4_fmd.tex}

\subsection{Low Birth Weight, Preterm, and Small for Gestational Age\label{sec:appbinary}}

In the text we focus on a continuous measure of birth weight. But in some cases studies focus on related binary variables:  low birth weight (birth weight  under 2500 grams), preterm (gestational age less than 37 weeks), and small for gestational age (1 is defined as those with birth weight under 10 \% in sex-and gestational-age specific distributions). The three binary outcome division strategies could be interpreted geometrically. With gestational-age along the x-axis and birth-weight along the y-axis, low birth weight cuts the data horizontally, preterm cuts the data vertically, and small-for-gestational-age cuts the data diagonally. While each strategy generates valuable outcomes of interest, these data-reduction strategies eliminate much of the distributional variations in the data and preclude quantile analysis. 

In this section, to facilitate comparison of our results to papers that focus on these binary outcomes, we present regression results for low birth weight, preterm and small for gestational age in Tables \ref{tab:mainthreebimargin} and \ref{tab:mainthreebiodds}. Tables \ref{tab:mainthreebimargin} and \ref{tab:mainthreebiodds} differ from Table \ref{tab:mainthree} by replacing least-squares with logistic regressions and replacing birth weight with binary outcome variables, but the same right-side specifications are used. Table \ref{tab:mainthreebimargin} presents results as marginal effects, and Table \ref{tab:mainthreebiodds} presents results as odds-ratios.\footnote{From the summary statistics in Table \ref{tab:mainone}, 6\% of the analytical sample have low birth weight (7\% for high school educated, and 4\% for college educated), 7\% of the analytical sample are borne preterm (8\% for high school educated, and 5\% for college educated), and 9\% are small for gestational age (10\% for high school educated, and 8\% for college educated).} 

The results from Tables \ref{tab:mainthreebimargin} and \ref{tab:mainthreebiodds} largely match-up with results from Table \ref{tab:mainthree}. First, greater \PARPMTEN, extreme heat, as well as extreme cold exposure are all associated with increased probabilities for low birth weight, preterm, and small for gestational age. \PARPMTEN and and extreme heat have the strongest associations with preterm, extreme cold has the strongest association with low birth weight, and the environmental measures are positively but not significantly associated with higher chance for small for gestational age. Second, maternal college education is significantly inversely associated with all three binary outcomes: its strongest association is with low birth weight and its weakest association is with small for gestational age. Third, we find that mothers' college education status is associated with reduced vulnerability to ambient air pollution and extreme heat exposures. Results are similarly for low birth weight and preterm but weaker for small for gestational age. Associations are greater for the extreme heat exposure interaction and are weakly significant for the \PARPMTEN exposure interaction. Interesting, we also find a protective effect of maternal college education for the association between extreme cold and preterm. 

\input{paper_final_tab/table_main3_binary_margins_fmd.tex}
\input{paper_final_tab/table_main3_binary_odds_fmd.tex}

\pagebreak 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Appendix 2, Data Acquisition
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewcommand{\thefigure}{B.\arabic{figure}}
\setcounter{figure}{0}
\renewcommand{\thetable}{B.\arabic{table}}
\setcounter{table}{0}
\renewcommand{\theequation}{B.\arabic{equation}}
\setcounter{equation}{0}
\renewcommand{\thefootnote}{B.\arabic{footnote}}
\setcounter{footnote}{0}

\section{Acquiring Environmental Data\label{sec:appdata}}

A wide array of environmental data is available at detailed geographical units across the globe from the the European Centre for Medium-Range Weather Forecasts (ECMWF)
at the \href{https://cds.climate.copernicus.eu/}{Copernicus Climate Change Service}. 
Copernicus provides data access via a free and publicly accessible \href{https://cds.climate.copernicus.eu/api-how-to}{API service}. In this appendix section, we describe how we obtained key environmental data used in this paper using Copernicus. 

\subsection{Data Retrieval}

Copernicus offers a range of data in different formats with similar data request structures. In particular, temperature as well as other environmental data based on observations from across the globe (with reanalysis) are available from the \href{https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-pressure-levels?tab=overview}{ERA5 Pressure Level} as well as the \href{https://cds.climate.copernicus.eu/cdsapp#!/dataset/reanalysis-era5-single-levels?tab=overview}{ERA5 Single Level} datasets.

\subsubsection{Single Data Retrieval Request}

To acquire Chinese data for the particular period in which our birth outcome data are available, we need to specify the appropriate time ranges as well as the geographical coordinates. We retrieve hourly data from every day between the year 2007 and 2012 by specifying the appropriate \emph{year}, \emph{month}, \emph{day}, and \emph{time} parameters. We specify our data acquisition geographical area as to the south-east of latitude and longitude coordinates (in decimal degrees) $\left(23.50, 113.00\right)$ and to the north-west of coordinates $\left(22.25, 114.50\right)$, which covers the broad geographical area that is relevant for our paper. Our specification for the \emph{area} parameter is therefore $[23.50, 113.00, 22.25, 114.5]$. 

Given this information and after registering with Copernicus to obtain an  user-specific url and passkey, Source Code \ref{code:codeone} provides a API call to acquire temperature data from Copernicus in \emph{grib} format.

\definecolor{dhscodebg}{rgb}{0.95,0.95,0.95}

\begin{listing}[H]
\caption{Single Data Retrieval Call\label{code:codeone}}
\begin{minted}
[
frame=lines,
xleftmargin=2mm,
framesep=2mm,
baselinestretch=1.2,
bgcolor=dhscodebg,
fontsize=\scriptsize,
linenos
]
{python3}
# Library
import cdsapi
import urllib.request

# download folder
spt_root = "C:/data/"
spn_dl_test_grib = spt_root + "test_china_temp.grib"
# request
c = cdsapi.Client()
res = c.retrieve("reanalysis-era5-pressure-levels",
         {
             'product_type': 'reanalysis',
             'variable': 'temperature',
             'pressure_level': '1000',
             'year': [ '2007', '2008','2009', '2010', '2011', '2012' ]
             'month': [ '01','02','03','04','05','06', '07','08','09','10','11','12'],
             'day': [
                '01','02','03','04','05','06','07','08','09','10','11','12',
                '13','14','15','16','17','18','19','20','21','22','23','24',
                '25','26','27','28','29','30','31'
             ],
             'time': [
                '00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00',
                '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00',
                '18:00', '19:00', '20:00', '21:00', '22:00', '23:00'
             ],
             'area': [23.50, 113.00, 22.25, 114.5],
             'grid': [1.25, 0.25],
             "format": "grib"
         },
         spn_dl_test_grib
         )

\end{minted}
\end{listing}

\subsubsection{Subdivided Data Retrieval Request}

A challenge to taking full advantage of the data is that, given the fine geographical and time units, the resulting data files can become very large. A single call to acquire all relevant data as shown in the example above can only be implemented on a server with access to Terabytes of storage space. 

To deal with this challenge, we divide our API calls into smaller components. We make multiple requests of data at shorter time intervals. Each time we aggregate and process the relevant data before downloading the next set of data. Given the computational resources at our disposal, we download the data at six months intervals, as shown in Source Code \ref{code:codetwo}. Given the computing resources available to the researcher, the time intervals can be further shortened to circumvent computational challenges from using the data.

\begin{listing}[H]
\caption{Sub-Period Data Retrieval Call\label{code:codetwo}}
\begin{minted}
[
frame=lines,
xleftmargin=2mm,
framesep=2mm,
baselinestretch=1.2,
bgcolor=dhscodebg,
fontsize=\scriptsize,
linenos
]
{python3}
# date lists
ar_years = 2001:2019
ar_months_g1 = ['01','02','03','04','05','06']
ar_months_g2 = ['07','08','09','10','11','12']

# Loop over time periods
for it_yr in ar_years:
    for it_mth_group in [1, 2]:
        if it_mth_group == 1:
            ar_months = ar_months_g1
        if it_mth_group == 2:
            ar_months = ar_months_g2

        c = cdsapi.Client()
        res = c.retrieve(
            'reanalysis-era5-pressure-levels',
            {
                'product_type': 'reanalysis',
                'variable': 'temperature',
                'pressure_level': '1000',
                'year': [it_yr],
                'month': ar_months,
                 'day': [
                    '01','02','03','04','05','06','07','08','09','10','11','12',
                    '13','14','15','16','17','18','19','20','21','22','23','24',
                    '25','26','27','28','29','30','31'
                 ],
                'time': [
                    '00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00',
                    '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00',
                    '18:00', '19:00', '20:00', '21:00', '22:00', '23:00'
                ],
                'area': [23.50, 113.00, 22.25, 114.5],
                'grid': [0.25, 0.25],
                'format': 'grib'
            },
            "china_temp.grib")
\end{minted}
\end{listing}

\subsection{Data Processing}

The data we download is at finer detail than required by the statistical analysis. For each sub-period of data downloaded, we process the data using a variety of tools. Data in the \emph{grib} format is processed using the \href{https://xarray.pydata.org/en/stable/}{xarray} package as shown in Source Code \ref{code:codethree}. Data in \emph{netCDF} format is processed using the \href{https://pypi.org/project/netCDF4/}{netCDF4} package as shown in Source Code \ref{code:codefour}. We store the resulting aggregate data as csv files and combine that with the rest of our child birth outcome data to conduct relevant statistical analysis.

\begin{listing}[H]
\caption{Grib Data Processing with xarray\label{code:codethree}}
\begin{minted}
[
frame=lines,
xleftmargin=2mm,
framesep=2mm,
baselinestretch=1.2,
bgcolor=dhscodebg,
fontsize=\scriptsize,
linenos
]
{python3}
# Load Packages
import pandas as pd
import xarray as xr

# Process grid data
snm_data_grib, snm_data_csv = "data.grib", "data.csv"
dsxr = xr.load_dataset(snm_data_grib, engine='cfgrib')
pd.concat([dsxr['u10'].to_series(), dsxr['v10'].to_series(),
           dsxr['d2m'].to_series(), dsxr['t2m'].to_series(),
           dsxr['msl'].to_series(), dsxr['sp'].to_series()],
          axis=1).to_csv(snm_data_csv, index=True)
\end{minted}
\end{listing}

\begin{listing}[H]
\caption{netcdf Data Processing with netCDF4\label{code:codefour}}
\begin{minted}
[
frame=lines,
xleftmargin=2mm,
framesep=2mm,
baselinestretch=1.2,
bgcolor=dhscodebg,
fontsize=\scriptsize,
linenos
]
{python3}
# Load Packages
import pandas as pd
from netCDF4 import Dataset, date2num, num2date

# Process netCDF data
snm_data_nc, snm_data_csv = "data.nc", "data.csv"
ds_src = Dataset(snm_data_nc)
var_tp = ds_src.variables['tp']

# Get the three dimensions, time, lat, and long
time_dim, lat_dim, lon_dim = var_tp.get_dims()
time_var = ds_src.variables[time_dim.name]
times = num2date(time_var[:], time_var.units)

# The flattening at the end converts variables to single column
latitudes = ds_src.variables[lat_dim.name][:]
longitudes = ds_src.variables[lon_dim.name][:]

# Convert to dataframe
[mt_times, mt_lat, mt_long] = np.meshgrid(times, latitudes, longitudes, indexing='ij')
ar_times = np.ravel(mt_times)
ar_lat = np.ravel(mt_lat)
ar_long = np.ravel(mt_long)
df = pd.DataFrame({'time': [t.isoformat() for t in ar_times],
                   'latitude': ar_lat, 'longitude': ar_long, 'tp': var_tp[:].flatten()})

# Get date and hour
df['date'] = pd.to_datetime(df['time']).dt.date
df['hour'] = pd.to_datetime(df['time']).dt.hour

# sort and group, and summ
sr_day_sum = df.groupby(['latitude','longitude','date'])['tp'].sum()
df_day_sum = sr_day_sum.reset_index()

# convert to csv
df_day_sum.to_csv(snm_data_csv, index=False)
\end{minted}
\end{listing}
