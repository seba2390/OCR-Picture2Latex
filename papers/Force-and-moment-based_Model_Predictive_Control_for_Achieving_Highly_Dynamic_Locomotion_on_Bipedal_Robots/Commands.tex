%!TEX root = ../Main.tex
% Defines commands to easily input variables and equations into the paper.

% Matrix commands for simple matrices
\newcommand{\pMat}[1]{\begin{pmatrix}#1\end{pmatrix}}
\newcommand{\bMat}[1]{\begin{bmatrix}#1\end{bmatrix}}
\newcommand{\BMat}[1]{\begin{Bmatrix}#1\end{Bmatrix}}
\newcommand{\aMat}[1]{\begin{Vmatrix}#1\end{Vmatrix}}
\newcommand{\mat}[1]{\begin{matrix}#1\end{matrix}}

% Pat commands
\newcommand{\cross}[1]{ {[#1]}_{\times} }

% Reference Frames
\newcommand{\IFrame}{\mathcal{I}}
\newcommand{\BFrame}{\mathcal{B}}
\newcommand{\COM}{CoM}

% State definitions
\newcommand{\roll}{\theta}
\newcommand{\pitch}{\phi}
\newcommand{\yaw}{\psi}

\newcommand{\rollhat}{\hat{\theta}}
\newcommand{\pitchhat}{\hat{\phi}}
\newcommand{\yawhat}{\hat{\psi}}



\newcommand{\dRoll}{\dot{\roll}}
\newcommand{\dPitch}{\dot{\pitch}}
\newcommand{\dYaw}{\dot{\yaw}}

\newcommand{\omegaX}{\omega_x}
\newcommand{\omegaY}{\omega_y}
\newcommand{\omegaZ}{\omega_z}

\newcommand{\dX}{\dot{x}}
\newcommand{\dY}{\dot{y}}
\newcommand{\dZ}{\dot{z}}

\newcommand{\quat}{\bm{q}}
\newcommand{\pos}{\bm{p}}
\newcommand{\angVel}{\bm{\omega}}
\newcommand{\vel}{\bm{v}}
\newcommand{\posDot}{\bm{\dot{\pos}}}
\newcommand{\posDotDot}{\bm{\ddot{p}}}
\newcommand{\quatDot}{\bm{\dot{\quat}}}
\newcommand{\angVelDot}{\bm{\dot{\angVel}}}

% Desired Variables
\newcommand{\xd}{\bm{x}_d}
\newcommand{\uref}{\bm{u}_{ref}}

% State component vectors
\newcommand{\quatV}{q_0 \\ q_x \\ q_y \\ q_z}
\newcommand{\quatVector}{\BMat{\quatV}}
\newcommand{\posV}{x \\ y \\ z}
\newcommand{\posVector}{\BMat{\posV}}
\newcommand{\angVelV}{\omegaX \\ \omegaY \\ \omegaZ}
\newcommand{\angVelVector}{\BMat{\angVelV}}
\newcommand{\velV}{\dX \\ \dY \\ \dZ}
\newcommand{\velVector}{\BMat{\velV}}

\newcommand{\rpyV}{\roll \\ \pitch \\ \yaw}
\newcommand{\rpyVector}{\BMat{\rpyV}}
\newcommand{\rpyDotV}{\dRoll \\ \dPitch \\ \dYaw}
\newcommand{\rpyDotVector}{\BMat{\rpyDotV}}

% Parameter Estimates
\newcommand{\state}{\bm{x}}
\newcommand{\stateDot}{\bm{\dot{\state}}}
\newcommand{\stateEstimate}{\bm{\hat{x}}}
\newcommand{\rFootEstimate}{\bm{\hat{r}}}
\newcommand{\forceEstimate}{\bm{\hat{F}}}
\newcommand{\rFootEstimatef}{\bm{\hat{r}}_f}
\newcommand{\forceEstimatef}{\bm{\hat{F}}_f}
\newcommand{\inputU}{\bm{u}}
\newcommand{\inputEstimate}{\bm{\hat{u}}}
\newcommand{\outputEstimate}{\bm{\hat{y}}}

% State and Input Vectors
\newcommand{\stateVector}{\BMat{\posV \\ \quatV \\ \velV \\ \angVelV}}
\newcommand{\stateVectorRed}{\BMat{\posV \\ \rpyV \\ \velV \\ \rpyDotV}}
\newcommand{\inputVector}{\BMat{\rFootEstimate_1 \\ \forceEstimate_1 \\ \rFootEstimate_2 \\ \forceEstimate_2 \\ \rFootEstimate_3 \\ \forceEstimate_3 \\ \rFootEstimate_4 \\ \forceEstimate_4}}

% Variable Transformations
\newcommand{\quatToRPY}{\bMat{\tan^{-1}\pMat{\dfrac{2\pMat{q_0q_1+q_2q_3}}{1-2\pMat{q_1^2+q_2^2}}}\\ \sin^{-1}\pMat{2\pMat{q_0q_2+q_3q_1}} \\ \tan^{-1}\pMat{\dfrac{2\pMat{q_0q_3+q_1q_2}}{1-2\pMat{q_2^2+q_3^2}}}}}
\newcommand{\omegaToRPYDot}{\bMat{\dfrac{\cos\pMat{\yaw}}{\cos\pMat{\pitch}} & \dfrac{\sin\pMat{\yaw}}{\cos\pMat{\pitch}} & 0 \\ -\sin\pMat{\yaw} & \cos\pMat{\yaw} & 0 \\ \dfrac{\cos\pMat{\yaw}\sin\pMat{\pitch}}{\cos\pMat{\pitch}} & \dfrac{\sin\pMat{\yaw}\sin\pMat{\pitch}}{\cos\pMat{\pitch}} & 1}}

% Time step definitions
\newcommand{\n}[1]{#1_n}
\renewcommand{\k}[1]{#1_k}
\newcommand{\nk}[1]{#1_{i}}

% Decision Variables Full
\newcommand{\inputVarsV}{\rFootEstimate \\ \forceEstimate}
\newcommand{\inputVarsVectorf}[1]{\BMat{\inputVarsV}_#1}
\newcommand{\decisionVarsVFull}{\inputVarsVectorf{1} \\ \vdots \\ \inputVarsVectorf{4} \\ \stateEstimate}
\newcommand{\decisionVarsVectorFull}[2]{\BMat{\decisionVarsVFull}_{#1,#2}}
\newcommand{\decisionArrayVFull}{\decisionVarsVectorFull{1}{1} & \hdots & \decisionVarsVectorFull{1}{K_1} & \hdots & \decisionVarsVectorFull{N}{1} & \hdots & \decisionVarsVectorFull{N}{K_N}}
\newcommand{\decisionArrayVectorFull}{\bMat{\decisionArrayVFull}}

% Decision Variables 
\newcommand{\decisionVarsV}{\stateEstimate \\ \inputEstimate}
\newcommand{\decisionVarsVector}{\BMat{\decisionVarsV}}
\newcommand{\decisionArrayV}{\decisionVarsVector_{1,1} & \hdots & \decisionVarsVector_{N,K_N}}
\newcommand{\decisionArrayVector}{\bMat{\decisionArrayV}}

% Simple Dynamics
\newcommand{\forces}{\bm{f}}
\newcommand{\torques}{\bm{\tau}}
\newcommand{\forceIEstimate}{\phantom{{}^\IFrame}\bm{\hat{f}}}
\newcommand{\torquesBEstimate}{^\BFrame\bm{\hat{\tau}}}
\newcommand{\RMatItoB}{^\BFrame\mathbf{R}_\IFrame}
\newcommand{\RMatItoBEstimate}{^\BFrame\mathbf{\hat{R}}_\IFrame}
\newcommand{\RMatBtoI}{^\IFrame\mathbf{R}_\BFrame}
\newcommand{\inputForceTorqueFunction}{ \hat{h}\!\pMat{\nk{\stateEstimate}, \nk{\inputEstimate}}}
\newcommand{\inputForceTorque}{\BMat{\phantom{{}^\BFrame}\forces \\ {}^\BFrame\torques}}
\newcommand{\inputForceTorqueMPC}{\BMat{\forceIEstimate \\ \torquesBEstimate}}
\newcommand{\forceTorqueTransform}{\bMat{\mathbf{I} & 0 \\ 0 & {\bm{R}_z^T(\yawhat)}}}
\newcommand{\uToForceTorqueMat}{\bMat{\mat{\mathbf{I} \\ \bMat{\bm{r}_1}_\times} & \hdots & \mat{\mathbf{I} \\ \bMat{\bm{r}_f}_\times}}}
\newcommand{\uToForceTorqueMatEstimate}{\bMat{\mat{\mathbf{I} \\ \bMat{\rFootEstimate_1}_\times} & \hdots & \mat{\mathbf{I} \\ \bMat{\rFootEstimate_f}_\times}}}
% Equation
\newcommand{\AMatnk}{{\bm{A}}_i}
\newcommand{\BMatnk}{{\bm{B}}_i}
\newcommand{\simpleDynamicsEq}{\AMatnk\nk{\stateEstimate}+\BMatnk\inputForceTorqueFunction+\bm{d}_i}
\newcommand{\simpleDynamics}{\stateEstimate_{i+1}=\simpleDynamicsEq}
% Matrix Linear
\newcommand{\AMatFull}{\bMat{\mathbf{I}_6 & \Delta t_i\mathbf{I}_6 \\ 0 & \mathbf{I}_6}}
\newcommand{\BMatFull}{\bMat{\frac{\Delta t_i^2}{2} \,{}^{\BFrame}\!\bm{I}^{-1} \\[.75ex] \Delta t_i\, {}^{\BFrame}\!\bm{I}^{-1} }}

\newcommand{\BMatFcull}{\bMat{\bMat{\frac{dt_n^2}{2}\mathbf{I}_6 \\ dt_n\mathbf{I}_6}\bMat{\frac{1}{m}\mathbf{I}_3 & 0 \\ 0 & ^\BFrame\bm{I}^{-1}}}}
	
	
	
% Full Dynamics
\newcommand{\sumForces}{\sum^\IFrame\bm{F}}
\newcommand{\sumTorques}{\sum^\IFrame\bm{\tau}}
\newcommand{\stateReducedVector}{\BMat{\pos \\ {}^\IFrame\!\bm{R}_{\BFrame} \\ \posDot \\ \angVel}}

\newcommand{\dynamicsReducedVector}{\BMat{
\posDot_c \\[.5ex]
{}^\IFrame\!\bm{R}_{\BFrame} \left[ {}^\BFrame \angVel\right]_\times \\[.5ex] 
\frac{1}{m}\forces - \bm{g} \\[.5ex]  
{}^\BFrame\,\overline{\!\bm{I}}{}^{-1}\pMat{{}^\BFrame\torques - {}^\BFrame \angVel\times {{}^\BFrame\,\overline{\!\bm{I}}}\,\,{\vphantom{\bm{I}}}^\BFrame\angVel}
}}


\newcommand{\stateDotReducedVector}{\BMat{\posDot_c \\ {}^\IFrame\!\dot{\bm{R}}_{\BFrame} \\ \posDotDot_c \\ {}^\BFrame\angVelDot}}

% Reference Input
\newcommand{\KPercent}{K_\%}
\newcommand{\pFootRef}{\bm{p}_{ref,f,xy,k} = \bm{\hat{p}}_{h,xy} + \posDot_{d,xy}T_{s}\pMat{\frac{1}{2}-\KPercent}+\\\pMat{\bm{\dot{\hat{p}}}_{xy} -\posDot_{d,xy}}\sqrt{\frac{\hat{p}_z}{\aMat{\bm{g}}}}\pMat{1 - \KPercent}}
			
% Error definitions
\newcommand{\stateError}{\bm{\tilde{x}}}
\newcommand{\inputError}{\bm{\tilde{u}}}
\newcommand{\stateErrorFull}{\xd-\outputEstimate}
\newcommand{\inputErrorFull}{\uref-\inputEstimate}
			
% Basic Cost Function
\newcommand{\basicArgs}{\stateEstimate, \hat{\bm{u}}}
\newcommand{\basicMin}{\underset{\basicArgs}{\text{min}}}
\newcommand{\basicCost}{J\pMat{\basicArgs}}
\newcommand{\basicCostFunction}{\basicMin\basicCost}
			
% MPC Function
\newcommand{\MPCSum}{\sum\limits_{n=1}^{N}\sum\limits_{k=1}^{\n{K}}}
%\newcommand{\MPCMin}{\underset{\stateEstimate, \inputEstimate}{\text{min}}}
\newcommand{\MPCMin}{\underset{\chi}{\text{min}}}
\newcommand{\stateCost}{\stateError^T\bm{Q}\stateError}
\newcommand{\inputCost}{\inputError^T\bm{R}\inputError}
\newcommand{\MPCCost}{\stateCost+\inputCost}
\newcommand{\MPCCostFunction}{\MPCMin\MPCSum\pMat{\MPCCost}_{n,k}}
			
% MPC Function Full
\newcommand{\MPCMinFull}{\underset{\stateEstimate, \inputEstimate}{\text{min}}}
\newcommand{\stateCostFull}{\pMat{\stateErrorFull}^T\bm{Q}\pMat{\stateErrorFull}}
\newcommand{\inputCostFull}{\pMat{\inputErrorFull}^T\bm{R}\pMat{\inputErrorFull}}
\newcommand{\MPCCostFull}{\stateCostFull+\inputCostFull}
\newcommand{\MPCCostFunctionFull}{\MPCMinFull\MPCSum\pMat{\MPCCostFull}_{n,k}}
			
% Constraints
\newcommand{\dynamicsConstraint}{\stateEstimate_{nk+1}=\simpleDynamicsEq}
\newcommand{\groundConstraint}{p_{z,f}=\hat{z}_g \pMat{p_{x,f}, p_{y,f}}}
\newcommand{\kinematicLegConstraint}{\aMat{\bm{r}_{h \to f}} \leq l_{f,max}}
\newcommand{\slipConstraint}{\bm{p}_{f,k+1} = \bm{p}_{f,k}}
\newcommand{\frictionConstraint}[1]{{-}\mu\bm{F}_{z,f}\leq\bm{F}_{#1,f}\leq\mu\bm{F}_{z,f}}
\newcommand{\frictionConeConstraint}{\frictionConstraint{x} \\ \frictionConstraint{y}}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% CONTACT
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\newcommand{\legState}{s}
\newcommand{\legStateScheduled}{\legState_{\phi}}
\newcommand{\legStateNotScheduled}{\bar{\legState}_{\phi}}
\newcommand{\legStateEstimated}{\hat{\legState}}
\newcommand{\contactState}{c}
\newcommand{\swingState}{\bar{\contactState}}
\newcommand{\contactStateScheduled}{\contactState_{\phi}}
\newcommand{\swingStateScheduled}{\bar{\contactState}_{\phi}}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% Support Polygon
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\newcommand{\phaseGain}{\Phi}
\newcommand{\adjLegP}{^{+}}
\newcommand{\adjLegM}{^{-}}