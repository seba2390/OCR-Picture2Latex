\section{Background and related work}
\label{sec:history}

Content providers on the Web often monetize the content they offer by using advertisements. To increase their effectiveness, the so-called behavioral advertisement leverages users' interests to provide targeted ads. This is possible thanks to Web trackers, i.e., third-party services embedded in the webpages that gather users' browsing history. Trackers are nowadays largely present on websites and reach the majority of web users~\cite{metwalley2015online,pujol2015annoyed}. Trackers exploit cookies and advanced techniques to enable the collection of personal information~\cite{acar2014web,rizzo2021unveiling,papadogiannakis2021}.

%In parallel, many solutions exist for blocking trackers and ads, typically implemented via browser plugins (e.g., AdBlock Plus~\cite{adblock}, Ghostery~\cite{ghostery} or Disconnect~\cite{disconnect}). Their effectiveness has been testified in several studies~\cite{pujol2015annoyed, traverso2017benchmark, mazel2019comparison}, and none of them offers complete protection.

\begin{figure}[t]
    \centering
    \includegraphics[width=0.75\columnwidth]{figures/cookie-example-large.pdf}
    \caption{Example of Consent Banner on \texttt{dailymail.co.uk}. Only upon consent, trackers are contacted and ads displayed.}
    \label{fig:cookie_accept_example}
\end{figure}

\subsection{The Role of Legislators}

In this tangled picture, legislators started to regulate the ecosystem to avoid massive indiscriminate tracking that may threaten users' privacy. In 2013, the European Cookie Law~\cite{directive2009} entered into force, which mandates websites to ask for informed consent before using any profiling technology. Later, in May 2018, the General Data Protection Regulation (GDPR)~\cite{gpdr} entered into force in all European member states. It is an extensive regulation on privacy, aiming at protecting users' privacy by imposing strict rules when handling personal information. Unlike previous regulations, it sets severe fines and infringements that could result in a fine of up to â‚¬10 million, or 2\% of the firm's worldwide annual revenue, whichever amount is higher. Some websites have already been caught to present legal violations in their Consent Banner implementation~\cite{matte2020cookie} and a large fraction have been shown to use tracking technologies before user consent~\cite{trevisan20194, sanchez2019can}. In the US, the California Consumer Privacy Act (CCPA)~\cite{ccpa} enhances privacy rights and consumer protection for California residents by requiring businesses to give consumers notices about their privacy practices.

As a result, most of the websites now provide explicit Consent Banners~\cite{degeling2018we} and many adopt Consent Management toolsets~\cite{hills2020consent}, making the website content difficult to access until visitors accept the privacy policy. For example, Figure~\ref{fig:cookie_accept_example} shows the same news website homepage before and after accepting the privacy policy. Only upon pressing the ``Got it'' button, the website content is fully loaded and visible.
%In some cases, websites use more persistent and sophisticated forms of tracking in order to track users who denied their acceptance of cookies~\cite{papadogiannakis2021user}.



\begin{figure}[t]
    \centering
    \includegraphics[width=0.5\columnwidth]{figures/httparchive_websites_with_trackers_tld.pdf}
    \caption{Percentage of websites containing at least one tracker for five European Top-Level domains (from HTTPArchive). The black vertical line indicates the entry into force of the GDPR. Since then, the apparent pervasiveness of tracking decreased.}
    \label{fig:ha_websites_trackers}
\end{figure}



\subsection{The Effect of Consent Banners on Web Measurements}

Despite cases of misuse, the new regulations had a large impact on the web users and complicate the measurement of the tracking ecosystem. A simple Web crawler visiting the websites without accepting the privacy policies would offer a biased picture, with no tracker and no ad being loaded. Hu~\emph{et al.}~\cite{hu2019characterising} already found that the number of third-parties dropped by more than 10\% after GDPR when visiting websites automatically. Conversely, when using a dataset from 15 real users, they measure no significant reduction in long-term numbers of third-party cookies. Dabrowski~\emph{et al.}~\cite{dabrowski2019measuring} draw similar conclusions, finding an apparent decrease in the use of persistent cookies from 2016 to 2018. Sorensen~\emph{et al.}~\cite{sorensen2019before} testify a decreasing trend in the number of third parties during 2018. We quantify this phenomenon in Figure~\ref{fig:ha_websites_trackers}, using the HTTPArchive open dataset~\cite{httparchive}. The curators of this dataset maintain a list of top websites worldwide that they automatically visit using the Google Chrome browser from a US-based server to store a copy of each visited webpage. Using the tracker list detailed in Section~\ref{sec:metho}, we report the percentage of websites embedding one or more trackers for 5 European countries (simply using the Top-Level Domain to identify the country).\footnote{The Top-Level Domain can sometimes be an inaccurate proxy for a website's country. Here, our goal is only to provide a qualitative picture.} We restrict the analysis on those websites that exist for the whole six years-long periods ($9\,196$ website in total).

Figure~\ref{fig:ha_websites_trackers} could suggest that the introduction of the GDPR (the black vertical line in May 2018) results in an abrupt decrease in the number of tracker-embedding websites, a trend that continues up to the moment we write. However, as we will show, these measurements are an artifact due to the GDPR itself. Indeed, the Web crawler used by HTTPArchive can only capture the behavior of the websites as a ``first-time visitor'', before the user accepts any privacy policy. The crawler thus misses third-party trackers and ads.

Research papers that rely on crawling large portions of the Web for different reasons could be affected by the same bias in their measurements. For instance, this would challenge the automatic measurement of the Web ecosystem on privacy~\cite{acar2014web,falahrastegar2014rise,metwalley2015online,pujol2015annoyed,englehardt2016online,iordanou2018tracing,hu2019characterising,rizzo2021unveiling,vandrevu2019what,papadogiannakis2021,aqeel2020on} and counter-measurements~\cite{pujol2015annoyed, traverso2017benchmark, mazel2019comparison}. Moreover, this will also impact those works that rely on crawlers and headless browsers~\cite{avasarala2014selenium} to quantify the impact in the wild of new technologies like SPDY,  HTTP/2~\cite{wang2014speedy,de2015http,bocchi2016measuring,erman2015towards}, 4G/5G~\cite{alay2017experience,asrese2019measuring}, accelerating proxies~\cite{sivakumar2014parcel,wang2016speeding,ruamviboonsuk2017vroom}, or generic benchmark solutions~\cite{netravali2015mahimahi}. At last, even spiders and mirroring tools like Wayback Machine and HTTPArchive may be affected if the website allows the visitor to access its content only after accepting the privacy policy.

\subsection{Related Work and Tools}
\label{sec:related}
Vallina~\emph{et al.}~\cite{vallina2019tales} are the first to consider the impact of the Consent Banner presence. First, they instruct a custom OpenWPM crawler to identify specific Consent Banners, and then they manually verify the results. Unfortunately, they solely focus on the pornographic ecosystem, which they acknowledge to be rather different from the Web at large, and thus their work can hardly generalize.

Recently, authors of~\cite{aqeel2020on} demonstrated that it is fundamental to consider the complexity of the Web ecosystem and include internal pages in every measurement study. They find a number of recent works that neglect internal pages and, as such, might provide biased results. Yet, they ignore the complications due to Consent Banners. Here, we aim at providing an extensive and thorough study of their impact on the Web. Our goal is to enable the automatic study of webpage characteristics as visitors would experience, assuming that most of them accept the default privacy setting as offered by the Consent Banner. Indeed, it has been shown that most users tend to ignore privacy-related notices~\cite{vila2003we, grossklags2007empirical, coventry2016personality}. Considering GDPR Consent Banners, users tend to accept privacy policies when offered a default button via intrusive banners that nudge users ~\cite{CookieBenchmarkStudy,bauer2021you}, which is often the case~\cite{hausner2021dark} with websites presenting large pop-ups or wall-style banners that cover most of the webpage as seen in Figure~\ref{fig:cookie_accept_example}. 

For completeness, notice that cookies are among the simplest tracking mechanisms. Authors of~\cite{papadogiannakis2021} show how practices like cookie synchronization, cookie leaking, and other profiling techniques like canvas fingerprinting are common in today's Web. Similarly, authors of~\cite{jueckstock2021towards} show how the crawling context, in terms of vantage point and browser configuration, has a significant impact on the results. Our work is orthogonal to these to obtain automatic, realistic, reliable and user-centric measurements of the Web.

Focusing on automatic management of Consent Banners, some browser add-ons try to hide them by using a list of CSS selectors of known Consent Banners. The most popular add-ons of this kind are ``I don't care about cookies''~\cite{idontcare} and ``Remove Cookie Banners''~\cite{remove}. Unfortunately, hiding the Consent Banners has an unpredictable behavior, in some cases falling back to privacy policies acceptance, while, in other cases, triggering an opt-out choice. Other proposals, again in the form of browser add-ons, try to explicitly opt-in or opt-out to cookies. For example, ``Ninja Cookie''~\cite{ninja} approves only cookies strictly needed to proceed on the website. Conversely, Autoconsent~\cite{autoconsent} and Consent-O-Matic~\cite{consentomatic} use a set of predefined rules to either opt-in or opt-out to cookies, according to the user configuration. These two are the most similar solutions to \TOOL. However, they are based on a list of actions the browser automatically runs when finding a set of popular Consent Management Platforms (CMPs), limiting their effectiveness. In Section~\ref{sec:ca_vs_com}, we compare \TOOL with Consent-O-Matic -- the most mature tool -- showing that \TOOL offers a much higher coverage. Indeed, the diversity of the Web ecosystem, the presence of multiple languages and the fully customizable choice of Consent Banner buttons make the engineering of \TOOL not trivial.

