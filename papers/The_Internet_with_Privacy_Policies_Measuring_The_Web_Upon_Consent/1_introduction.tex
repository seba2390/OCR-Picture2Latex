\section{Introduction}
\label{sec:intro}

The Web is a complex ecosystem where websites monetize their audience through advertising and data collection. They use Web trackers, i.e., third-party services that collect the visitors browsing history to build per-user profiles and display targeted ads and personalized content~\cite{acar2014web,rizzo2021unveiling,papadogiannakis2021}.
%This is generally possible through \emph{HTTP cookies}, small pieces of text that contain persistent user identifiers assigned by the trackers, or more advanced tracking techniques
Hundreds of tracking platforms exist, with many of them gathering information from a large base of users and websites~\cite{falahrastegar2014rise,metwalley2015online,pujol2015annoyed,iordanou2018tracing}.

This picture has created tension over online privacy, and regulatory bodies have started governing the scenario. 
%Already in 2002, the European Union (EU) introduced a first set of regulations on the use of online tracking technologies. Amended in 2009, the EU Directive mandated websites to ask for informed consent before using any kind of profiling technology, e.g., cookies. Since 2013, the ePrivacy Directive became mandatory, and most of European websites started embedding a so called "Cookie Banner", the most visible effect of the regulation. However, its effectiveness has been very limited~\cite{trevisan20194}.
Lastly, in May 2018, the EU introduced the General Data Protection Regulation (GDPR)~\cite{gpdr}. It sets strict rules on collecting and storing personal data and mandates firms to ask for informed consent. 
%The less severe infringements could result in a fine of up to â‚¬10 million, or 2\% of the firm's worldwide annual revenue, whichever amount is higher.
Similarly, the California Consumer Privacy Act of 2018 (CCPA)~\cite{ccpa} gives consumers more control over the personal information that businesses collect. All this has changed the Web too. Nowadays, when users visit a website for the first time, a consent management module -- the commonly called Consent Banner -- prompts, asking the visitors whether they accept the website privacy policy and the use of tracking techniques, and eventually which tracking mechanisms to accept or to block. Upon user's acceptance, the browser activates the accepted tracking techniques and updates the webpage to include all ads and third-party objects.

This challenges the commonly accepted approach to automatically crawl websites to measure the Web ecosystem on privacy~\cite{acar2014web,falahrastegar2014rise,metwalley2015online,englehardt2016online,pujol2015annoyed,iordanou2018tracing,hu2019characterising,rizzo2021unveiling,papadogiannakis2021, vandrevu2019what, pujol2015annoyed, traverso2017benchmark, mazel2019comparison} and performance~\cite{wang2014speedy, de2015http, erman2015towards, bocchi2016measuring, alay2017experience, asrese2019measuring, ruamviboonsuk2017vroom, sivakumar2014parcel, netravali2015mahimahi}. These measurements are typically carried out with headless browsers that access webpages and automatize the collection of metadata and statistics. However, today, these measurements could be biased and unrealistic, with the crawler observing possibly very different content than what a user would get after accepting the privacy policies. In fact, the Consent Banners may hide the actual page content, and the browser may load additional content only after the privacy policy acceptance.
%Several studies~\cite{bauer2021you, hausner2021dark, CookieBenchmarkStudy} show that users tend to accept privacy banners. Moreover, nowadays, many Consent Banners cover the integrity or most of the screen, acting as \textit{de facto} Privacy Walls, hence users' behaviour finds are extendable to GDPR-related Privacy Banners. Several mitigating tools exist (and we discuss them in Section~\ref{sec:related}), but their limited spread does not affect the utility of the present work.
While researchers have shown the importance of carefully choosing which webpages to test~\cite{aqeel2020on}, to the best of our knowledge, we are the first to consider the impact of Consent Banners on automatic measurements.

For this, we engineer \TOOL, a tool to automatically handle the privacy acceptance mechanisms the websites put in place. In a nutshell, \TOOL enables the collection of user-like Web measurements. It overcomes the limitations of traditional crawling approaches, allowing the measurement of the tracking ecosystem to which users are exposed and obtain thus realistic figures on performance. The non-standard way of displaying the Consent Banner, the presence of multiple languages, and the freedom to customize the accept button make automatic detection and acceptance not trivial. We base \TOOL on a keyword list that we thoroughly build to accept the privacy policies automatically. Compared to other solutions~\cite{idontcare,remove,ninja,consentomatic}, \TOOL proves the most robust approach, bypassing the Consent Banner in about $90\%$ of cases when present.

Armed with \TOOL, we run an extensive measurement campaign. We focus primarily on European and US websites that we visit from different countries. We demonstrate how different is the picture we observe before and after accepting the website privacy policies. Interestingly, many websites correctly implement the regulations, activating trackers and personalizing ads only after consent is collected. A researcher collecting statistics by crawling the Web without managing consent could erroneously think that tracking is decreasing with respect to the past~\cite{hu2019characterising}. However, the number of trackers websites embed substantially increases upon acceptance of the privacy policy, in some cases up to 70. As such, popular trackers suddenly become much more pervasive than one can measure using traditional Web crawlers. Similarly, after accepting privacy policies, webpages become more complex and heavier since the browser has to load more objects from more third-party servers. Thus, they are slower to load, so that webpages embedding many trackers and ads double or triple the page load time.

Recently, authors of~\cite{aqeel2020on} showed how important it is to extend the crawling to internal pages. Here, we show that it is also fundamental to correctly handle the Consent Banners when running extensive Web measurements. For this, we offer \TOOL as an open-source tool to incentivize other researchers to contribute. Similarly, we offer all the data we collected for this study and the code to generate the figures to the community in an effort to support reproducibility and encourage other studies.\footnote{\TOOL is available as an open-source GitHub project at: \url{https://github.com/marty90/priv-accept}}

After discussing the scenario and related work in Section~\ref{sec:history}, we present and test \TOOL in Section~\ref{sec:metho}. In Section~\ref{sec:tracking}, we report how different the picture results when checking the Web tracking ecosystem before and after the acceptance of the privacy policies. We then show the implications on performance in Section~\ref{sec:performance}. After discussing Ethics in Section~\ref{sec:ethics} and limitation in Section~\ref{sec:limits}, we summarize our findings in Section~\ref{sec:conclu}.