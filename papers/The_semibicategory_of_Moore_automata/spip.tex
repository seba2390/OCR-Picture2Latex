\usetikzlibrary{positioning,decorations.markings,arrows.meta,calc,fit,quotes,cd}
\tikzset{
	oriented WD/.style={
			every to/.style={out=0,in=180,draw},
			label/.style={
					font=\everymath\expandafter{\the\everymath\scriptstyle},
					inner sep=0pt,
					node distance=2pt and -2pt},
			semithick,
			node distance=1 and 1,
			decoration={markings, mark=at position .5 with {\arrow{stealth};}},
			ar/.style={postaction={decorate}},
			execute at begin picture={\tikzset{
						x=\bbx, y=\bby,
						every fit/.style={inner xsep=\bbx, inner ysep=\bby}}}
		},
	bbx/.store in=\bbx,
	bbx = 1.5cm,
	bby/.store in=\bby,
	bby = 1.75ex,
	bb port sep/.store in=\bbportsep,
	bb port sep=2,
	% bb wire sep/.store in=\bbwiresep,
	% bb wire sep=1.75ex,
	bb port length/.store in=\bbportlen,
	bb port length=4pt,
	bb min width/.store in=\bbminwidth,
	bb min width=1cm,
	bb rounded corners/.store in=\bbcorners,
	bb rounded corners=2pt,
	bb small/.style={bb port sep=1, bb port length=2.5pt, bbx=.4cm, bb min width=.4cm, bby=.7ex},
	bb/.code 2 args={
			\pgfmathsetlengthmacro{\bbheight}{\bbportsep * (max(#1,#2)+1) * \bby}
			\pgfkeysalso{draw,minimum height=\bbheight,minimum width=\bbminwidth,outer sep=0pt,
				rounded corners=\bbcorners,thick,
				prefix after command={\pgfextra{\let\fixname\tikzlastnode}},
				append after command={\pgfextra{\draw
							\ifnum #1=0{} \else foreach \i in {1,...,#1} {
								($(\fixname.north west)!{\i/(#1+1)}!(\fixname.south west)$) +(-\bbportlen,0) coordinate (\fixname_in\i) -- +(\bbportlen,0) coordinate (\fixname_in\i')}\fi
							\ifnum #2=0{} \else foreach \i in {1,...,#2} {
								($(\fixname.north east)!{\i/(#2+1)}!(\fixname.south east)$) +(-\bbportlen,0) coordinate (\fixname_out\i') -- +(\bbportlen,0) coordinate (\fixname_out\i)}\fi;
						}}}
		},
	bb name/.style={append after command={\pgfextra{\node[anchor=north] at (\fixname.north) {#1};}}}
}
