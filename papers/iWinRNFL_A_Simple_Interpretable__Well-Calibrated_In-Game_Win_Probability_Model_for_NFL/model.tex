\section{The \MakeLowercase{i}W\MakeLowercase{inr}NFL model}
\label{sec:model}

In this section we are going to present the data we used to develop our in-game probability model as well as the design details of {\method}. 

{\bf Data: }In order to perform our analysis we utilize a dataset collected from NFL's Game Center for all the regular season games between the seasons 2009 and 2016. 
We access the data using the Python {\tt nflgame} API \cite{nflgame}. 
The dataset includes detailed play-by-play information for every game that took place during these seasons. 
This information is used to obtain the state of the game that will drive the design of {\method}. 
In total, we collected information for 2,048 regular season games and a total of 338,294 snaps/plays. 

{\bf Model: }
{\method} is based on a logistic regression model that calculates the probability of the home team winning given the current status of the game as: 

\begin{equation}
\Pr(H=1| \mathbf{x})= \frac{\exp(\mathbf{\weight}^T\cdot\mathbf{x})}{1+\exp(\mathbf{\weight}^T\cdot\mathbf{x})}
\label{eq:reg}
\end{equation}
where $H$ is the dependent random variable of our model representing whether the home team wins or not, $\mathbf{x}$ is the vector with the independent variables, while the coefficient vector $\mathbf{\weight}$ includes the weights for each independent variable and is estimated using the corresponding data.  
For a game of infinite duration a linear model could be a very good approximation.  
However, the boundary effects from the finite duration of a game create several non-linearities \cite{winston2012mathletics}.  
For this reason, we enhance our model - using the same set of features - with a Support Vector Machine classifier with radial kernel for the last three minutes of regulation.  
In order to obtain a probability output from the SVM classifier, we further use Platt's scaling \cite{platt1999probabilistic}: 

\begin{equation}
\Pr(H=1| \mathbf{x})= \frac{1}{1+\exp{(Af(x)+B)}}
\label{eq:platt}
\end{equation}
where $f(x)$ is the uncalibrated value produced by the SVM classifier: 

\begin{equation}
f(x) = \sum_{i} (\alpha_i y_i k(\mathbf{x}_i\cdot\mathbf{x}))+ b
\label{eq:svm}
\end{equation}
where $k(\mathbf{x},\mathbf{x}')$ is the kernel used for the SVM.   
Figure \ref{fig:iwinrNFL} depicts the simple flow chart of {\method}. 


\begin{figure}[t]
\begin{center}
\includegraphics[scale=0.35]{plots/iwinrNFL.pdf}%\vspacecap
 \caption{{\method} includes a linear and a non-linear component.}
 \label{fig:iwinrNFL}
\end{center}
\end{figure}

In order to describe the status of the game we use the following variables:

\begin{enumerate}
\item {\bf Ball Possession Team:} This binary feature captures whether the home or the visiting team has the ball possession
\item {\bf Score Differential:} This feature captures the current score differential (home - visiting)
\item {\bf Timeouts Remaining:} This feature is represented by two independent variables - one for the home and one for the away team - and they capture the number of timeouts remaining for each of the teams
%\item {\bf Quarter:} This feature captures the current quarter of the game
%\item {\bf Time Remaining:} This feature captures the time (in seconds) remaining for the current quarter to end
\item {\bf Time Elapsed: } This feature captures the time elapsed since the beginning of the game
\item {\bf Down:} This feature represents the down of the team in possession
\item {\bf Field Position:} This feature captures the distance covered by the team in possession from their own yard line
\item {\bf Yards-to-go:} This variables represents the number of yards needed for a first down
\item {\bf Ball Possession Time: } This variable captures the time that the offensive unit of the home team is on the field 
\item {\bf Ranking Differential: } This variable represents the difference of the win percentage for the two team (home - visiting)
\end{enumerate}

The last independent variable is representative of the power ranking difference between the two teams. 
Most of the existing models that include such a variable are using the Vegas line spread for each game.  
We choose not to do so for the following reason.  
The objective of the Vegas line is not to predict game outcomes but rather distribute money across the different bets.  
Exactly because of this objective the line is changing during the week before the game.  
While this line can change due to new information for the competing teams (e.g., injury updates), the line is mainly changing when a particular team has accumulated the majority of the bets. 
In this case it will also be hard to choose which line to use (e.g., the opening, the closing or some average of them).  
Therefore, we choose to use the win percentage differential of the two teams as an indicator of their strength (even though this has its own issues given the uneven schedule in NFL).  
However, note that if one would like to use the point spread as a variable this can be easily incorporated in the model. 
Table \ref{tab:iwinrnfl} presents the coefficients of the logistic regression model of {\method} with standardized independent variables for better comparisons. 


\begin{table}[ht]
\begin{center}
\def\sym#1{\ifmmode^{#1}\else\(^{#1}\)\fi}
\begin{tabular}{l*{1}{c}}
\toprule
                    &\multicolumn{1}{c}{(1)}\\
                    &\multicolumn{1}{c}{Winner}\\
\midrule
Possession Team (H)         &      0.41\sym{***}\\
                    &     (49.19)         \\
\addlinespace
Score Differential           &      3.59\sym{***}\\
                    &    (247.34)         \\
\addlinespace
Home Timeouts           &     0.12\sym{***}\\
                    &      (8.74)         \\
\addlinespace
Away Timeouts           &     -0.11\sym{***}\\
                    &    (-12.47)         \\
\addlinespace
Ball Possession Time  &     -0.05.\\
                    &    (-1.66)         \\
\addlinespace
Time Lapsed       &   -0.05.\\
                    &      (-1.66)         \\
\addlinespace
Down                &   -0.01         \\
                    &      (0.04)         \\
\addlinespace
Field Position            &   0.02\sym{**} \\
                    &      (2.71)         \\
\addlinespace
Yards-to-go                &  -0.01         \\
                    &      (0.23)         \\
\addlinespace
Rating differential         &       0.75\sym{***}\\
                    &     (80.47)         \\
\addlinespace
Intercept            &       0.57\sym{*}\\
                    &    (2.09)         \\
\midrule
Observations        &      338,294         \\
\bottomrule
\multicolumn{2}{l}{\footnotesize \textit{t} statistics in parentheses}\\
\multicolumn{2}{l}{\footnotesize \sym{$_.$} \(p<0.1\), \sym{*} \(p<0.05\), \sym{**} \(p<0.01\), \sym{***} \(p<0.001\)}\\
\end{tabular}
\end{center}
\caption{Standardized logisitic regression coefficients for {\method}.}
\label{tab:iwinrnfl}
\end{table}


As we can see, as one might have expected the current scoring differential exhibits the strongest correlation with the in-game win probability.  
The only factors that do not appear to be statistically significant predictors of the dependent variable are the down and the yards-to-go. 
Even though the corresponding coefficients are negative as one might have expected (e.g., being at an earlier down gives you more chances to advance the ball), they are not significant in estimating the win probability. 
On the contrary, all else being equal timeouts appear to be quiet important since they can help a team stop the clock, while teams with better win percentage appear to have an advantage as well, since this can be a sign of a better team. 
In the following section we provide a detailed evaluation of {\method}.