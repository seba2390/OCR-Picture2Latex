\section{Algorithm} \label{sec:algo}

The basic idea of the algorithm is similar to the one given in \cite{sano-sato:2020}: if $F$ is a field, $R$ is a multivariate polynomial ring over $F$, and $C$ is a freely and finitely generated chain complex over $R$ whose differential is homogeneous with respect to the polynomial grading, we may regard $C$ as a chain complex over $F$ and decompose it into (infinitely many) finitely generated subcomplexes. Having proved that these subcomplexes are acyclic except for finitely many ones, it follows that $H(C)$ can be fully computed algorithmically. For the reduced HOMFLY homology, the key to proving the finiteness is the symmetry (\Cref{prop:q-sym}).

Throughout this section, let $D$ be a non-trivial, connected, oriented link diagram with $n$ crossings. 

\subsection{Free variables of the edge ring}

\begin{lemma}[{\cite[Lemma 2.4]{Ras15}}]\label{dimlem}
    The reduced edge ring $R(D) = R'(D)/I(D)$ is isomorphic to a polynomial ring with $n$ variables.
\end{lemma}

\begin{proof}
    $R'(D)$ is generated by $2n$ indeterminates. The ideal $I(D)$ is generated by $1+n$ linear polynomials, and they have a unique linear relation $\sum_p \rho_p = 0$ since we assumed that $D$ is connected.
\end{proof}

\begin{figure}
    \centering
    \input{tikz-picture/tikz-crossing}
    \caption{$X_{p}$ and $X'_{p}$}
    \label{fig:crossing}
\end{figure}

Next we show that a generating set of $R(D)$ can be given by considering a spanning tree of the Seifert graph of $D$.
For each crossing $p$ of $D$, we define $X_{p}, X'_{p} \in R(D)$ by
\begin{align*}
    X_p &= x_b - x_c = -(x_a - x_d), \\
    X'_p &= x_a - x_c = -(x_b - x_d),
\end{align*}
where $a, b$ are outgoing edges at $p$ and $c,d$ are incoming edges at $p$, and $a, c$ are placed to the left of $p$ (see \Cref{complex,fig:crossing}).

\begin{lemma}[\cite{Nak20}]\label{treebasislem}
    Let $T$ be a spanning tree of the Seifert graph of $D$, and $S$ the set of crossings in $D$ corresponding to the edges of $T$.
    Then, $\mathcal{X}_T = \{X_p\}_{p \in S} \cup \{X'_p\}_{p \notin S}$ is an algebraically independent generating set of $R(D)$.
\end{lemma}

\begin{figure}
    \centering
    \input{tikz-picture/tikz-lemma}
    \caption{$D, T$ and $D'$}
    \label{fig:treebasislem}
\end{figure}

\begin{proof}
    Working over $\QQ$ allows us to have the equation
    \[
    \QQ[x_1, \ldots , x_m] = \QQ[x_1-x_2,\ x_2-x_3,\ \ldots,\ x_{m-1}-x_m,\ x_1+\cdots+x_m].
    \]
    Thus it follows that $R(D)$ is generated by elements of the form $x_e - x_f$, where $e, f$ are edges of $G(D)$.
    Since $|\mathcal{X}_T| = n$, it is enough to show that each $x_e - x_f$ can be written as a linear sum of elements in $\mathcal{X}_T$.
    Since $D$ is connected, by resolving all crossings in $D$ which are not in $S$, we obtain a diagram $D'$ of the trivial knot (see \Cref{fig:treebasislem} for an easy case).
    There is a unique oriented path $\gamma$ in $G(D')$ from $f$ to $e$, which may be also regarded as a path in $G(D)$.
    Trace $\gamma$ from $x_f$ to $x_e$, and each time $\gamma$ passes a crossing $p$ in $D$, take a term $\pm X_p$ or $\pm X'_p$ according to how $\gamma$ passes $p$ (see \Cref{fig:crossing}).
    It is obvious that these terms belong to $\mathcal{X}_T$ and that the sum gives $x_e-x_f$.
\end{proof}

\subsection{Reinterpretation as cube complexes} \label{subsec:double-cube-cpx}

Next we reinterpret the chain complex $C(D)$ given in \Cref{sec:prelim} as a ``double cube complex". Precise statement follows.

The \textit{$n$-cube} is a poset $\{0, 1\}^n$ with the product order of $0 < 1$, considered as a category.
An object $v \in \{0, 1\}^n$ is called a \textit{vertex}, and the Manhattan norm of $v$ is denoted by $|v| = v_1 + \cdots + v_n$. A morphism $v \to w$ such that $|v| + 1 = |w|$ is denoted $v \to_1 w$ and called an \textit{edge}. Define vertices $\bar{0} = (0, \ldots, 0)$ and $\bar{1} = (1, \ldots, 1)$.

\begin{figure}
    \centering
    \input{tikz-picture/tikz-cube-complex}
    \caption{A cube complex with factors $(a_1, \ldots, a_n)$.}
    \label{fig:cube-complex}
\end{figure}

Let $\mathcal{A}$ be an additive category.
\begin{definition}
    For $n \geq 0$, an \textit{$n$-cube in $\mathcal{A}$} is a functor $\mathcal{C}\colon \{0, 1\}^n \to \mathcal{A}$.
\end{definition}

Given an $n$-cube $\mathcal{C}$ in $\mathcal{A}$,
one obtains a \textit{cube complex} $(C^*, d^*)$ in $\mathcal{A}$ with 
\[
    C^i = \bigoplus_{|v| = i} \mathcal{C}(v)
\]
and differentials
\[
    d^i = \sum_{\substack{|v| = i,\\ e\colon v \to w}} s(e)\mathcal{C}(e),
\]
by choosing $s(e) \in \{\pm 1\}$ for each edge $e$ of the cube so that for any square consisting of four edges $e_1,\ldots,e_4$, we have $s(e_1) \cdots s(e_4) = -1$.

\begin{remark}
    The isomorphism class of the above cube complex is independent of the choice of $s$.
\end{remark}

Now we put $C(D)$ in this framework. First we will ignore the original homological gradings, and lately relate them with the newly introduced gradings. 
%
We recall that $C(D)$ is a tensor product of (vertical) two-terms complexes of (horizontal) complexes. Hence $C(D)$ can be regarded as a cube complex of complexes. We write 
\[
    C(D) = \bigoplus_{v \in \{0, 1\}^n} C^*_v(D),
\]
where $C^*_v(D)$ is the complex at a vertex $v \in \{0, 1\}^n$, called the \textit{horizontal complex} of $D$ at $v$.
Since $C^*_v(D)$ is also a tensor product of two-terms complex over $R(D)$, it can be regarded as a cube complex again. We write
\[
    C^*_v(D) = \bigoplus_{h \in \{0, 1\}^n} R_{v, h}(D),
\]
where $R_{v, h}(D)$ is the module at a vertex $h \in \{0, 1\}^n$, and it is indeed a shifted copy of $R(D)$. The horizontal differential 
\[
    d_H: C^*_v(D) \rightarrow C^{*+1}_v(D)
\]
has the following form.
For each standard unit vector $e_i$ of $\RR^n$, there exists an element $a_i$ of $R(D)$ such that for any edge $v \to_1 w$ in the direction of $e_i$ in the $n$-cube, the corresponding map $R_{v,h}(D) \to R_{w,h}(D)$ summed in $d_H$ is the multiplication map by $a_i$ as specified by the horizontal arrows of \Cref{complex} according to $v$ (with some appropriate sign assignment). We call $a_1, \ldots, a_n$ the \textit{factors} of $C^*_v(D)$ (see \Cref{fig:cube-complex}).

By taking the homology with respect to $d_H$, we get a cube complex of homologies
\[
    \bigoplus_{v \in \{0, 1\}^n} H^*(C_v(D), d_H)
\]
with differential $(d_V)_*$. Then it is obvious that $\Hhat(D)$ is given by the homology of this complex
\[
    \Hhat(D) = H(\oplus_v (H(C_v(D), d_H), (d_V)_*).
\]

The homological bigrading $(\alpha, \beta)$ of the double cube complex $C(D)$ correspond to the original bigrading $(j, k)$ as
\[
    (\alpha, \beta) = \frac{1}{2}(j - j_0,\ k - k_0)
\]
where $(j_0, k_0)$ is the (original) homological bidegree of the module $R_{\bar{0}, \bar{0}}(D)$ placed at $(v, h) = (\bar{0}, \bar{0})$. For later use, let $i_0$ denote the $q$-grading shift of $R_{\bar{0}, \bar{0}}(D)$. Then from \Cref{complex} we have 
%
\begin{equation} \label{eq:ijk0}
    (i_0, j_0, k_0) = (2n^+, -2n, -2n^+)
\end{equation}
%
where $n_+$ and $n_-$ are the number of positive and negative crossings of $D$ respectively.

\subsection{Slicing by $q$-degrees} 

As described in \Cref{treebasislem}, the ring $R(D)$ can be represented by a multivariate polynomial ring $\QQ[X_i]$ with $n$ variables, so we have a homogeneous decomposition of $R(D)$ as a $\QQ$-vector space
\[
    R(D) \isom \QQ(1) \oplus \QQ(X_i)_{1 \leq i \leq n}  \oplus \QQ(X_i X_j)_{1 \leq i \leq j \leq n} \cdots.
\]
Let $i_{v, h} \in \ZZ$ be the $q$-grading shift of $R_{v, h}(D) = R(D)\{i_{v, h}\}$. Decompose $R_{v, h}(D)$ as 
\[
    R_{v, h}(D) = \bigoplus_{l = -\infty}^\infty V_{l, v, h}(D)
\]
so that each $V_{l, v, h}(D)$ is homogeneous of $q$-degree $2(l + |h|) + i_0$. It is generated by monomials 
% $X_{i_1} \cdots X_{i_e}$ 
of degree (in the usual sense) 
%
\begin{equation} \label{eq:monomial-degree}
    e(l, v, h) = l + |h| + \frac{i_0 - i_{v, h}}{2}.
\end{equation}
%
Now define 
\[
    C_l(D) = \bigoplus_{v, h} V_{l, v, h}(D)
\]
then it is obvious that both $d_H, d_V$ are closed in $C_l(D)$.  Regarding $C(D)$ as a chain complex over $\QQ$, we get a decomposition
\[
    C(D) = \bigoplus_{l = -\infty}^\infty C_l(D).
\]
We call each subcomplex $C_l(D)$ the \textit{level-$l$ slice} of $C(D)$. Note that the decomposition is defined so that $V_{l, \bar{0}, \bar{0}}(D)$ is generated by monomials of degree $e = l$. 

\begin{lemma}
    $C_l(D) = 0$ for $l < -2n$.
\end{lemma}

\begin{proof}
    The claim is clear since $e$ is non-decreasing with respect to $v, h$ and $e(l, \bar{1}, \bar{1}) = l + 2n$.
\end{proof}

From the previous arguments, it is obvious that each $C_l(D)$ may also be regarded as a double cube complex. Define the \textit{level-$l$ slice} $C_{l, v}(D)$ of the horizontal complex $C_v(D)$ at $v \in \{0, 1\}^n$ by
\[
    C_{l, v}(D) = \bigoplus_{h \in \{0, 1\}^n} V_{l, v, h}(D).
\]
Then we get a decomposition
\[
    \Hhat(D) = \bigoplus_{l = -2n}^\infty \Hhat_l(D),
\]
where 
\[
    \Hhat_l(D) = H(\oplus_v (H(C^*_{l, v}(D), d_H), (d_V)_*).
\]

We claim that each $\Hhat_l(D)$ is algorithmically computable. To take the homology twice, we find a basis on each chain group $C^i = C^i_{l, v}(D)$ that gives a decomposition
\[
    C^i = H^i \oplus B^i \oplus (d^i_H)^{-1}(B^{i + 1})
\]
so that we get representative cycles of the generators of $H^i = H^i(C^*_{l, v}(D))$ and that the secondary homology computation can be done on the chain level. This is achieved by standard methods such as the Gaussian elimination. 

\begin{proposition}
    For a link diagram $D$, the homology $\Hhat(D)$ has a decomposition
    \[
        \Hhat(D) = \bigoplus_{l = -2n}^{\infty} \Hhat_l(D)
    \]
    where each summand $\Hhat_l(D)$ can be computed algorithmically. Moreover for each triple degree $(i, j, k)$ we have 
    %
    \begin{equation} \label{eq:Hijk}
        \Hhat^{i, j, k}(D) = H^\beta(\oplus_v (H^\alpha(C^*_{v, l}(D), d_H), (d_V)_*)
    \end{equation}
    %
    where
    %
    \[
        (l, \alpha, \beta) = \frac{1}{2}((i - i_0) - (j - j_0),\ j - j_0,\ k - k_0)
    \]
    and $(i_0, j_0, k_0)$ are given as in \eqref{eq:ijk0}. Similar statement holds for $\Hbar(D)$. \qed
\end{proposition}

Now we restrict to the case where $D$ is a knot diagram, and in particular where it is a braid closure. In such case, it is well-known that $\Hbar(D)$ is finite dimensional \cite{Ras15}. In order to perform the actual calculation, we must specify an actual upper bound for the level $l$.

\begin{proposition} \label{prop:finiteness}
    If $K$ is a knot with braid closure diagram $D$, then
    \[
        \Hbar(K) \isom \bigoplus_{l = -2n}^{-n} \Hbar_l(D).
    \]
    Moreover, $\Hbar(K)$ can be obtained from the computations of $\Hbar^{i, j, k}(D)$ within the following ranges:
    \begin{align*}
        i &\in [-n + s - 1, 0], \tag{1}\\
        j &\in [w - s + 1, w + s - 1], \tag{2}\\
        k,\ k + 2i &\in [-n + s - 1, n - s + 1]. \tag{3}
    \end{align*}
\end{proposition}

\begin{proof}
    From \Cref{prop:MFW-ineq,prop:morton} and equation \eqref{eq:Hbar-def}, it follows that $\Hbar_l(D)$ is supported in 
    \begin{align*}
        2l 
        &= (i - i_0) - (j - j_0) \\ 
        &\leq \{ (n - s + 1) - (-w + s - 1) - 2n^+ \}\\
        &\quad - \{(w - s + 1) - (w + s - 1) - (-2n)\}\\
        &= -2n.
    \end{align*}
    For the latter statement: (1) the lower bound is given by the Morton bound (\Cref{prop:morton}), and from \Cref{prop:q-sym} it suffices to compute $H^{i, *, *}(D)$ within $i \leq 0$.
    (2) This is exactly \Cref{prop:MFW-ineq}.
    (3) The lower bound of $k$ is obvious from the definition of $C(D)$, and from \Cref{prop:duality} we also have the upper bound. From \Cref{prop:q-sym}, $k + 2i$ must also lie in this range.
\end{proof}

\subsection{Exclusion of variables}

As apparent from \eqref{eq:monomial-degree}, the number of generators increases combinatorially as $l$ increases. In order to reduce the computational cost, we use the process called ``exclusion of variables" as described in \cite[Lemma 3.8]{Ras15}. 

Again we assume $D$ is a link diagram. Put $R = R(D)$. Take any $v \in \{0, 1\}^n$ and consider the horizontal cube complex $C = C_v(D)$. Take any factor $f \in R$ of $C$. Note that $f$ is either linear or quadratic.

After choosing an appropriate sign assignment, $C$ may be regarded as the mapping cone of the endomorphism 
\[
    C' \xrightarrow{f} C'
\]
of an $n-1$ dimensional cube complex $C'$. Let $d, d'$ denote the differentials of $C, C'$ respectively. The complex $C$ is isomorphic to $C' \oplus C'$ as an $R$-module, and we can write
\[
    d(x_0, x_1) = (-d'x_0, fx_0 + d'x_1).
\]

Now $f$ is monic with respect to some variable $X_k$. Define
\[
R_0 = \QQ[X_1, \ldots \widehat{X_k}, \ldots, X_n].
\]
Let $\pi \colon R \rightarrow R_1 = R/(f)$ be the quotient map, $\iota \colon R_1 \rightarrow R$ be the map that sends any residue class $[g] \in R_1$ to the remainder of $g$ by $f$ with respect to the variable $X_k$.
We note that $\pi$ and $\iota$ are homomorphisms of modules over $R$ and $R_0$ respectively.
Let $C'' = C' \otimes_R R_1$, and let $d''$ be the differential of $C''$. Two chain maps $\phi \colon C \rightarrow C''$ and $\psi \colon C'' \rightarrow C$ over $R_0$ are given by
\[
    \phi(x_0, x_1) = \pi(x_1),
\]
and
\[
    \psi(y) = \left(\frac{\iota(d''y) - d'\iota(y)}{f},\  \iota(y)\right),
\]
and it is not hard to verify that $\psi \phi \htpy \id_C$ and $\phi \psi = \id_{C''}$.
The complex $C''$ admits the obvious triple grading so that both $\phi, \psi$ are degree preserving. Thus the two maps restrict as chain homotopy equivalences between the two sliced complexes $C_l$ and $C''_l$. The effect is that $H(C_l) \cong H(C''_l)$ can be computed with fewer generators, which is drastic when $l$ becomes large. 

Furthermore, this process of reduction can be repeated for other directions as long as the target variable is algebraically independent in the base ring. When $f$ is linear, we have $R_1 \isom R_0$ and all other variables remain independent. When $f$ is quadratic, then $R_1 \isom R_0 \otimes_\QQ \QQ\{1, X_k\}$ as $\QQ$-vector spaces, and the variables that does not appear in the coefficients of $f$ remains independent.

In particular, when all factors $f$ of $C$ are linear, then the exclusion can be continued until the differential becomes trivial. In general, to exclude the variables as much as possible, it is preferable to perform exclusions on linear polynomials first, and then on the remaining quadratics. 

For the computation of $\Hbar(D)$, we can replace each horizontal complex $C_{l, v}$ with a reduced one, compute those homologies, and replace the differential $(d_V)_*$ on the vertical complex with $(\phi_{v'} \circ d_V \circ \psi_v)_*$ for each edge $v \rightarrow v'$. 

\subsection{Overall procedure}

We summarize the overall procedure for computing (the dimensions of) the reduced HOMFLY homology $h^{i, j, k} = \{\dim \Hbar^{i, j, k}(K)\}_{i, j, k}$ of a knot $K$.

\begin{algorithm}\label{algo:basic}
    Given a braid closure diagram $D$ of a knot $K$, 
    \begin{enumerate}
        \item Compute the Seifert graph $G(D)$ and find a spanning tree $T$ of $G(D)$. 
        
        \item Using $T$, identify the edge ring $R(D)$ as a multivariate polynomial ring, and represent both $d_H$ and $d_V$ as $n$-tuples of polynomials in $R(D)$ as in the proof of \Cref{treebasislem}.
        
        \item For each $(l, \alpha, \beta)$ in $[-2n, -n] \times [0, n] \times [0, n]$:
        \begin{enumerate}
            \item Convert $(l, \alpha, \beta)$ to $(i, j, k)$. Skip to the next iteration if $(i, j, k)$ is not in the range of \Cref{prop:finiteness}.
            
            \item Setup the generators of the level-$l$ horizontal complex $C_l(D)$.
            
            \item Perform exclusion of variables on $C_l(D)$ to get a reduced complex together with the chain homotopy equivalences. 

            \item Compute $h^{i, j, k} = \dim \Hbar^{i, j, k}(D)$ from \eqref{eq:Hijk}, with the horizontal complexes replaced with the reduced ones. 
            
            \item Assign $h^{-i, j, k + 2i} = h^{i, j, k}$ if $i < 0$.
        \end{enumerate}
        \item Return $h$.
    \end{enumerate}
\end{algorithm}

Reusable data should be cached within the iteration. Further improvement can achieved by concerning mirrors of knots. To explain this, assume that $D$ has only one crossing $p$. Recall that the vertex module $V_{l, v, h}(D)$ at $(v, h) \in \{0, 1\}^2$ is spanned by the monomials of degree given  by \eqref{eq:monomial-degree}. From \Cref{complex}, we see that $e(l, 1, 0) = e(l, 0, 1) = e(l, 0, 0) + 1$ if $p$ is positive, and $e(l, 1, 0) = e(l, 0, 1) = e(l, 0, 0)$ if $p$ is negative (in both cases $e(l, 1, 1) = e(l, 0, 0) + 1$). This means that $C_l(D)$ has a smaller generating set when $p$ is negative. In general if $w(D) > 0$, then $C_l(m(D))$ has a smaller generating set than $C_l(D)$. This difference becomes intense as $n$ increases. Thus the improved version is:

\begin{algorithm}\label{algo:mirror}
    Given a braid closure representative $D$ of a knot $K$, \begin{enumerate}
        \item If $w(D) \leq 0$, compute and return $h(D)$ by \Cref{algo:basic}.
        \item Otherwise, compute $h(m(D))$ by \Cref{algo:basic} and return its dual.
    \end{enumerate}
\end{algorithm}