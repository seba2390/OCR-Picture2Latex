% Defining by hand the axis
\begin{tikzpicture}[x={(0cm,-0.5cm)},y={(0cm,0.5cm)},z={(0cm,4cm)}, line join=round, tdplot_main_coords]

% Defining hsb color to have a color scale
\colorlet{highcolorbar}[hsb]{gray} % teal, black
\colorlet{lowcolorbar}[hsb]{white} % lime, white


\definecolor{viridis_yellow}{HTML}{fde725} 
\definecolor{viridis_blue}{HTML}{440154}
\definecolor{highground}{HTML}{e1e697} % black
\definecolor{lowground}{HTML}{44342a} % white
\colorlet{highcolormap}[hsb]{highground}
\colorlet{lowcolormap}[hsb]{lowground}


\ifdefined\SHOWMINIAXES
    % Drawing the system of axes
    \draw[-stealth] (0,0,0) -- (1,0,0) node [black,below left] {$x$};
    \draw[-stealth] (0,0,0) -- (0,1,0) node [black,above left,yshift=-1mm] {$y$};
    \draw[-stealth] (0,0,0) -- (0,0,1) node [black,left] {$p$};
\fi

\node at (3,0,3.5) {\Huge\textsc\algcaption{}};

% Write unit on x and y
\foreach \p in {2,...,\maxX}{ % NOTE: start at 2 not 0 (skip min and max)
    \ifdefined\SHOWLABELS
        \draw {(\p,-\step/2,0)} node[right, gray] {\p}; % x-axis label
    \fi
    \ifdefined\SHOWGRID
        % Draw the grid
        \foreach \q in {2,...,\maxY}{ % NOTE: start at 2 not 0 (skip min and max)
            \draw[lightgray] (\p-\step,\q-\step,0) -- (\p+\step,\q-\step,0) -- (\p+\step,\q+\step,0) -- (\p-\step,\q+\step,0) -- (\p-\step,\q-\step,0);
        }
    \fi
}

\ifdefined\SHOWLABELS
    % y-axis label
    \foreach \p in {2,...,\maxY}{
        \draw {(\maxX+2.5*\step,\p,0)} node[left, gray] {$\p$};
    }
\fi

\ifdefined\SHOWMAP
    % Draw map on the bottom
    \foreach \p in {2,...,\maprows}{ % NOTE: start at 2 not 0 (skip min and max)
        \pgfplotstablegetelem{\p}{[index] 0}\of{\maptable}    % The order in which the bars are drawn is determined by the order of the lines in the data file.
        \pgfmathsetmacro{\x}{\pgfplotsretval/\scale}
        \pgfplotstablegetelem{\p}{[index] 1}\of{\maptable}    % And as the drawings just pile up, the last one just goes on top of the previous drawings.
        \pgfmathsetmacro{\y}{\pgfplotsretval/\scale}
        \pgfplotstablegetelem{\p}{[index] 2}\of{\maptable}    % The order here works with chosen view angle, if you change the angle, you might have to change it.
        \pgfmathsetmacro{\z}{\pgfplotsretval/\scale}

        \pgfmathsetmacro{\w}{\step + 0.05/\scale} % half the width of the bars (plus some padding to cover grid area)

        \pgfmathtruncatemacro{\teinte}{100-(((\z-\minZS)/(\maxZS-\minZS))*100)}
        \colorlet{colour}[rgb]{lowcolormap!\teinte!highcolormap}

        % Bottom heatmap / state (bottom face)
        \fill[colour] (\x-\w,\y-\w,0) -- (\x-\w,\y+\w,0) -- (\x+\w,\y+\w,0) -- (\x+\w,\y-\w,0) -- (\x-\w,\y-\w,0);
    }
\fi


\ifdefined\SHOWOUTSIDEBOX
    \draw[black, line width=0.25mm, line join=round] (\step,\step,0) -- (\maxX+\step,\step,0) -- (\maxX+\step,\maxY+\step,0) -- (\step,\maxY+\step,0) -- (\step,\step,0);
\fi


% Plot vertical probability bars
\foreach \p in {2,...,\rows}{ % NOTE: start at 2 not 0 (skip min and max)
        \pgfplotstablegetelem{\p}{[index] 0}\of{\firsttable}    % The order in which the bars are drawn is determined by the order of the lines in the data file.
        \pgfmathsetmacro{\x}{\pgfplotsretval/\scale}
        \pgfplotstablegetelem{\p}{[index] 1}\of{\firsttable}    % And as the drawings just pile up, the last one just goes on top of the previous drawings.
        \pgfmathsetmacro{\y}{\pgfplotsretval/\scale}
        \pgfplotstablegetelem{\p}{[index] 2}\of{\firsttable}    % The order here works with chosen view angle, if you change the angle, you might have to change it.
        \pgfmathsetmacro{\z}{\Zceiling*(\pgfplotsretval - (\minZ-\epsZ))/(\maxZ - (\minZ-\epsZ))}

        \pgfmathsetmacro{\w}{\step} % half the width of the bars

        % \ifnum0<\z % TODO: Only plot non-zero actions
            \pgfmathtruncatemacro{\teinte}{100*(1 - \z/\Zceiling)}
            \colorlet{colour}[rgb]{lowcolorbar!\teinte!highcolorbar}

            % Unseen faces from orginal view, but if you change the angle ....
            % \fill[colour] (\x-\w,\y-\w,\z) -- (\x-\w,\y+\w,\z) -- (\x-\w,\y+\w,0) -- (\x-\w,\y-\w,0) -- (\x-\w,\y-\w,\z);
            % \draw[black] (\x-\w,\y-\w,\z) -- (\x-\w,\y+\w,\z) -- (\x-\w,\y+\w,0) -- (\x-\w,\y-\w,0) -- (\x-\w,\y-\w,\z);
            % \fill[colour] (\x-\w,\y+\w,\z) -- (\x+\w,\y+\w,\z) -- (\x+\w,\y+\w,0) -- (\x-\w,\y+\w,0) -- (\x-\w,\y+\w,\z);
            % \draw[black](\x-\w,\y+\w,\z) -- (\x+\w,\y+\w,\z) -- (\x+\w,\y+\w,0) -- (\x-\w,\y+\w,0) -- (\x-\w,\y+\w,\z);

            % Visible faces from original view
            \fill[colour] (\x+\w,\y+\w,\z) -- (\x+\w,\y-\w,\z) -- (\x+\w,\y-\w,0) -- (\x+\w,\y+\w,0) -- (\x+\w,\y+\w,\z);
            \draw[black](\x+\w,\y+\w,\z) -- (\x+\w,\y-\w,\z) -- (\x+\w,\y-\w,0) -- (\x+\w,\y+\w,0) -- (\x+\w,\y+\w,\z);

            \fill[colour!60!gray] (\x+\w,\y-\w,\z) -- (\x-\w,\y-\w,\z) -- (\x-\w,\y-\w,0) -- (\x+\w,\y-\w,0) -- (\x+\w,\y-\w,\z);
            \draw[black](\x+\w,\y-\w,\z) -- (\x-\w,\y-\w,\z) -- (\x-\w,\y-\w,0) -- (\x+\w,\y-\w,0) -- (\x+\w,\y-\w,\z);

            % Top face
            \pgfmathparse{\actionx==\x && \actiony==\y}
            % \ifnum\pgfmathresult=1
                % Show action on topface
                % \fill[top color=actioncolor!40!gray, bottom color=actioncolor!80!gray] (\x-\w,\y-\w,\z) -- (\x-\w,\y+\w,\z) -- (\x+\w,\y+\w,\z) -- (\x+\w,\y-\w,\z) -- (\x-\w,\y-\w,\z);
            % \else
                \fill[top color=colour!40!gray, bottom color=colour!80!gray] (\x-\w,\y-\w,\z) -- (\x-\w,\y+\w,\z) -- (\x+\w,\y+\w,\z) -- (\x+\w,\y-\w,\z) -- (\x-\w,\y-\w,\z);
            % \fi

            \draw[black] (\x-\w,\y-\w,\z) -- (\x-\w,\y+\w,\z) -- (\x+\w,\y+\w,\z) -- (\x+\w,\y-\w,\z) -- (\x-\w,\y-\w,\z);
        % \fi
}

\colorlet{defaultbar}{lightgray} % brown


\ifthenelse{\equal{\actioninfo}{abandon}}
{
    \colorlet{nocolor}{red}
    \colorlet{yescolor}{defaultbar}
}{
    \ifthenelse{\equal{\actioninfo}{mine}}
    {
        \colorlet{nocolor}{defaultbar}
        \colorlet{yescolor}{red}    
    }{
        \colorlet{nocolor}{defaultbar}
        \colorlet{yescolor}{defaultbar}    
    }
}


\begin{axis}[
    tuftelike,
    xbar,
    at={(2cm,-2.7cm)}, 
    % at={(2cm,-4cm)}, % When using {65} pitch angle
    y=-0.5cm,
    bar width=0.3cm,
    bar shift=0pt,
    xmin=0,
    enlarge y limits={abs=0.45cm},
    xlabel={probability},
    symbolic y coords={abandon,mine},
    every axis plot/.append style={
        ytick=data,
    },
    x tick label style={
        /pgf/number format/.cd,
            fixed,
            fixed zerofill,
            precision=2,
        /tikz/.cd
    },
    nodes near coords, nodes near coords align={horizontal},
]
\addplot[nocolor!20!black, fill=nocolor!80!white] table[col sep=comma,header=false] {
\nodecision,abandon
};
\addplot[yescolor!20!black, fill=yescolor!80!white] table[col sep=comma,header=false] {
\yesdecision,mine
};
\end{axis}

\end{tikzpicture}