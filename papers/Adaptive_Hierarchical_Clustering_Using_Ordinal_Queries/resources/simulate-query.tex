%\section{The formal specification of the algortihm \SimulateVertexQuery}
%\label{sec:simulate-query}

\InsertAlgorithm{\SimulateVertexQuery $(\Tree, \Vertex, \ElS)$}{alg:simulate}{
\IF{\Vertex is the root of \Tree}
\STATE{Make one ordinal query for \ElS with pivot \Vertex, and return its
  result.}
\STATE{(Since $\Subtree{\Vertex} = \Set{\Vertex}$ in this case, the
  response reveals the root as the proposed answer.)}
\ELSIF{\Vertex is a leaf}
\STATE{Let \VertexP be the parent of \Vertex in \Tree.}
\STATE{Make one ordinal query for \ElS with pivot \VertexP.}
\IF{the response places \ElS at \Vertex}
\RETURN{the vertex \Vertex as a proposed answer.}
\ELSE
\RETURN{the direction towards \VertexP.}
\ENDIF
\ELSE
\STATE{Let \VertexP be the parent of \Vertex in \Tree.}
\STATE{Let $k_p$ be a sufficiently large (odd) constant.}
\STATE{Make $k_p$ ordinal queries for \ElS with pivot \Vertex.}
\IF{a strict majority of responses place \ElS in \Subtree[L]{\Vertex}}
\RETURN{the direction towards the left child of \Vertex}
\ELSIF{a strict majority of responses place \ElS in \Subtree[R]{\Vertex}}
\RETURN{the direction towards the right child of \Vertex}
\ELSIF{a strict majority of responses place \ElS in \Subtree{\Vertex}}
\STATE{Make $k_p$ ordinal queries for \ElS with pivot \VertexP.}
\IF{a strict majority of responses place \ElS in the subtree of
  \VertexP containing \Vertex}
\RETURN{the vertex \Vertex as a proposed answer.}
\ELSIF{a strict majority of responses place \ElS in \Subtree{\VertexP}}
\RETURN{the direction towards \VertexP.}
\ELSIF{a strict majority of responses place \ElS in the other subtree
  of \VertexP}
\RETURN{the direction towards \VertexP.}
\ELSE
\RETURN{an arbitrary response.}
\ENDIF
\ELSE
\RETURN{an arbitrary response.}
\ENDIF
\ENDIF
}
