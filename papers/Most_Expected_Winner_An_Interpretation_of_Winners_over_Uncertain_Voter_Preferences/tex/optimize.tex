\section{Optimization strategies}
\label{sec:optimize}

The algorithms in Section~\ref{sec:algorithms} find the MEW by computing candidate scores for a single voter at a time, and then aggregating the scores across the voting profile.
We now present \rev{two optimization strategies} for a voting profile solver in Algorithm~\ref{alg:pruning}.

\begin{algorithm}[tb!]
  \small 
  \raggedright
  \caption{Solver for voting profiles}
  \label{alg:pruning}
  \textbf{Input}: general voting profile $\probaVP=(\enum[n]{\model})$, voting rule $\vr_m$ \\
  \textbf{Output}: $\mew(\vr_m, \probaVP)$
  
  \begin{algorithmic}[1]
    \STATE \rev{Group identical votes in $\probaVP$, sort them by the group size in descending order, to generate a weighted voting profile $\VP_w$ where each vote $\model_i$ is associated with a weight $w_i$}
    \STATE Obtain candidates $C = \set{\enum{c}}$ from $\VP_w$
    \STATE $\forall c \in C, UB(c) {\defeq} 0, LB(c) {\defeq} 0$ \label{alg:pruning:bounds:1}
    \FOR {\rev{$(\model, w) \in \VP_w$}}
    \FOR {$c \in C$}
    \STATE Compute the best possible rank $a$ of $c$ over $\model$
    \STATE Compute the worst possible rank $b$ of $c$ over $\model$
    \STATE \rev{$UB(c) \pluseq w \cdot \vr_m(a)$, $LB(c) \pluseq w \cdot \vr_m(b)$} \label{alg:pruning:sum}
    \ENDFOR
    \ENDFOR \label{alg:pruning:bounds:2}
    \STATE Compute $max(LB)$, prune any candidate $c$ if $UB(c) < max(LB)$ \label{alg:pruning:prune:1}
    \FOR {\rev{$(\model, w) \in \VP_w$}} \label{alg:pruning:for:1}
    \STATE Let $C_t$ denote the candidates currently tracked by $UB$ and $LB$
    \FOR {$c \in C_t$}
    \STATE Compute the exact score of $c$ over $\model$
    \STATE Refine $UB(c)$ and $LB(c)$ with its exact score \rev{and the weight $w$}
    \ENDFOR
    \STATE Compute $max(LB)$, prune any candidate $c$ if $UB(c) < max(LB)$ \label{alg:pruning:prune:2}
    \IF{Only one candidate remains in $UB$ and $LB$}
    \STATE Let $c'$ denote the only remaining candidate
    \RETURN $\mew(\vr_m, \probaVP) = c'$ \label{alg:pruning:ret:1}
    \ENDIF
    \ENDFOR \label{alg:pruning:for:2}
    \STATE Let $C'$ denote the set of remaining candidates in $UB$ and $LB$
    \RETURN $\mew(\vr_m, \probaVP) = C'$
  \end{algorithmic}
\end{algorithm}

\paragraph{Candidate pruning}
We can save computation by iteratively pruning candidates who cannot be the MEW.
The key idea is to quickly compute score upper- and lower-bounds for all candidates across the voting profile,  progressively refine these scores during per-voter computation, and prune candidates who cannot be the MEW based on the upper- and lower-bounds computed so far.

Algorithm~\ref{alg:pruning} presents the candidate pruning procedure. The first step is to compute $UB(c)$ and $LB(c)$, the upper- and lower-bounds of the score of each candidate $c$ by quickly computing their best possible and worst possible ranks assigned by each voter (lines~\ref{alg:pruning:bounds:1} - \ref{alg:pruning:bounds:2}).  For example, in a given partial order $M$ (voter) in a partial voting profile, the best possible rank of candidate $c$ is bounded by the number of its ancestors in $M$, while its worst possible rank is bounded by the number of its descendants.  Combing this information with the voting rule, we can efficiently obtain score upper- and lower-bounds of each candidate for each voter.

\begin{example}
  Let $\partialOrder=\set{\sigma_3 \succ \sigma_5, \sigma_3 \succ \sigma_8}$ be a partial order, over $m=10$ items, and assume the voting rule is 2-approval.
  Item $\sigma_5$ has 1 ancestor $\sigma_3$ and no descendant in $\partialOrder$.
  So its best possible rank is 2 and its worst possible rank is $m$, which correspond to scores 1 and 0, respectively, under 2-approval.  Thus, 1 is the score upper-bound of $\sigma_5$, and 0 the score lower-bound, for $\partialOrder$.
\end{example}

Per-voter score upper-bounds and lower-bounds can be aggregated (summed up) across all voters in the profile (line~\ref{alg:pruning:sum} of Algorithm~\ref{alg:pruning}).  The pruning strategy can then confidently determine the losing candidates as those whose score upper-bounds are lower than the best observed score lower-bound (line~\ref{alg:pruning:prune:1} of Algorithm~\ref{alg:pruning}).  


Score upper- and lower-bounds are refined as the algorithm iterates over the voters (lines~\ref{alg:pruning:for:1}-~\ref{alg:pruning:for:2}), computing the exact scores of viable (tracked) candidates, refining $UB(c)$ and $LB(c)$, and pruning any candidates that are no longer viable (line~\ref{alg:pruning:prune:2}).

If, at any point during the iteration, only a single tracked candidate $w$ remains, then it is returned as the $\mew$ (line~\ref{alg:pruning:ret:1}).  Once all voters $M$ have been iterated over, return all remaining tracked candidates as the winners.  (Note that if after all voters are iterated, and there are still multiple tracked items, then their upper- and lower-bounds are precisely their exact scores, and they all share the same exact score, otherwise the candidates with lower exact scores would have been pruned during voter iteration.)

\begin{example}
  Assume $UB=\set{\sigma_1 \rightarrow 15, \sigma_2 \rightarrow 6}$ and $LB = \set{\sigma_1 \rightarrow 5, \sigma_2 \rightarrow 2}$ at a time point during refining the $UB$ and $LB$.
  Assume that after computing the exact scores of $\sigma_1$ and $\sigma_2$ over the latest voter, the refined $UB=\set{\sigma_1 \rightarrow 12, \sigma_2 \rightarrow 5}$ and the refined $LB = \set{\sigma_1 \rightarrow 7, \sigma_2 \rightarrow 3}$.
  Now, candidate $\sigma_2$ can be pruned, since $UB(\sigma_2) < LB(\sigma_1)$.
  After pruning $\sigma_2$, only $\sigma_1$ is tracked by $UB$ and $LB$, thus we can confidently declare $\sigma_1$ as the winner.
\end{example}

\paragraph{\rev{Voter grouping}}
\rev{As another optimization, we observe that when multiple voters cast the same vote, we only need to compute the expected candidate scores for this vote once.  When computing the \mew over a voting profile, the first step is to group identical votes and sort them by their frequencies in descending order, which generates a new voting profile that is weighted and sorted.}
