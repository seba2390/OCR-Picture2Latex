\begin{algorithm}[h!]
   \caption{\small{Generalized VAMP for symptom checkers}}
   \label{alg:vamp-algorithm}
\begin{algorithmic}[1]
%\small
\fontsize{7.2}{7.2}\selectfont
\Statex $\mathbf{Input:}$ observed symptom vector $\boldsymbol{s} \in\mathbb{R}^{M}$; medical knowledge matrix $\mathbf{A}$; precision tolerance $\xi=10^{-6}$; number of iterations $T_\textrm{max}$; noise precision $\gamma_w$. %the denoiser $\mathbf{g}_{\mathsf{d}}(\cdot)$ of the disease vector $\bm{d}$;.
\State $\mathbf{Initialize}$ 
\Statex $t\gets 1$
\Statex\LeftCommentNoIntent{initialize posterior and extrinsic means and precisions}
\Statex $\boldsymbol{\widehat{d}}^{-}_{\mathsf{e},0}$, $\gamma_{\bm{\mathsf{d}}_{\mathsf{e}},0}^-$,
$\boldsymbol{\widehat{z}}^{-}_{\mathsf{e},0}$, $\gamma_{\bm{\mathsf{z}}_{\mathsf{e}},0}^-$\vspace{0.1cm}
%\Repeat
\State \textbf{Repeat}\vspace{0.1cm}
%%%%% Denoising X
\Statex \par \LeftCommentNoIntent{denoising $\bm{d}$}
\StateOrange $\widehat{\bm{d}}_{\mathsf{p}, t}^+=\bm{g}_{\bm{\mathsf{d}}}\left(\mathbf{\widehat{d}}^-_{\mathsf{e},t-1}, \gamma_{\bm{\mathsf{d}}_{\mathsf{e}, t-1}}^-\right)$\label{algo:denoising1-d}
\StateOrange $\alpha_{\bm{\mathsf{d}}_\mathsf{p}, t}^+=\left\langle \bm{g}_{\bm{\mathsf{d}}}^{\prime}\left(\mathbf{\widehat{d}}^-_{\mathsf{e},t-1}, \gamma_{\bm{\mathsf{d}}_{\mathsf{e}, t-1}}^-\right)\right\rangle$
\StateOrange $\gamma_{\bm{\mathsf{d}}_{\mathsf{p}}, t}^+=\gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t-1}^- / \alpha_{\bm{\mathsf{d}}_\mathsf{p}, t}^+$, \quad$\gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+=\gamma_{\bm{\mathsf{d}}_{\mathsf{p}}}^+-\gamma_{\bm{\mathsf{d}}_{\mathsf{e}, t-1}}^-$
\StateOrange $\mathbf{\widehat{d}}^+_{\mathsf{e}, t}=\left(\gamma_{\bm{\mathsf{d}}_{\mathsf{p},t}}^+\, \widehat{\bm{d}}_{\mathsf{p}, t}^+-\gamma_{\bm{\mathsf{d}}_{\mathsf{e}, t-1}}^-\, \mathbf{\widehat{d}}^-_{\mathsf{e},t-1}\right) / \gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+$
%%%%% denoising 2 of d
%\Statex\LeftCommentNoIntent{LMMSE estimation of  $\bm{d}$}
\StateBlue $\widehat{\bm{d}}_{\mathsf{p}, t}^-=\bm{f}_{\bm{\mathsf{d}}}\left(\mathbf{\widehat{z}}^-_{\mathsf{e},t-1}, \gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^-, \mathbf{\widehat{d}}^+_{\mathsf{e}, t}, \gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+\right)$
\StateBlue $\alpha_{\bm{\mathsf{d}}_\mathsf{p}, t}^-=\left\langle \bm{f}_{\bm{\mathsf{d}}}\left(\mathbf{\widehat{z}}^-_{\mathsf{e},t-1}, \gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^-, \mathbf{\widehat{d}}^+_{\mathsf{e}, t}, \gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+\right)\right\rangle$
\StateBlue $\gamma_{\bm{\mathsf{d}}_{\mathsf{p}}, t}^-=\gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+ / \alpha_{\bm{\mathsf{d}}_\mathsf{p}, t}^-$, \quad$\gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^-=\gamma_{\bm{\mathsf{d}}_{\mathsf{p}}}^--\gamma_{\bm{\mathsf{d}}_{\mathsf{e}, t}}^+$
\StateBlue $\mathbf{\widehat{d}}^-_{\mathsf{e}, t}=\left(\gamma_{\bm{\mathsf{d}}_{\mathsf{p},t}}^-\, \widehat{\bm{d}}_{\mathsf{p}, t}^--\gamma_{\bm{\mathsf{d}}_{\mathsf{e}, t}}^+\, \mathbf{\widehat{d}}^+_{\mathsf{e},t}\right) / \gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^-$
%%%%% Denoising Z
\Statex\LeftCommentNoIntent{denoising $\bm{z}$}
\StateBlue $\widehat{\bm{z}}_{\mathsf{p}, t}^+=\bm{f}_{\bm{\mathsf{z}}}\left(\mathbf{\widehat{z}}^-_{\mathsf{e},t-1}, \gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^-, \mathbf{\widehat{d}}^+_{\mathsf{e}, t}, \gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+\right)$ \label{algo:denoising-d}
\StateBlue $\alpha_{\bm{\mathsf{z}}_\mathsf{p}, t}^+=\left\langle \bm{f}_{\bm{\mathsf{z}}}^{\prime}\left(\mathbf{\widehat{z}}^-_{\mathsf{e},t-1}, \gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^-,\mathbf{\widehat{d}}^+_{\mathsf{e}, t}, \gamma_{\bm{\mathsf{d}}_{\mathsf{e}},t}^+\right)\right\rangle$
\StateBlue $\gamma_{\bm{\mathsf{z}}_{\mathsf{p}}, t}^+=\gamma_{\bm{\mathsf{z}}_{\mathsf{e}},t-1}^- / \alpha_{\bm{\mathsf{z}}_\mathsf{p}, t}^+$, \quad$\gamma_{\bm{\mathsf{z}}_{\mathsf{e}},t}^+=\gamma_{\bm{\mathsf{z}}_{\mathsf{p}}}^+-\gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^-$
\StateBlue $\mathbf{\widehat{z}}^+_{\mathsf{e}, t}=\left(\gamma_{\bm{\mathsf{z}}_{\mathsf{p},t}}^+\, \widehat{\bm{z}}_{\mathsf{p}, t}^+-\gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^-\, \mathbf{\widehat{z}}^-_{\mathsf{e},t-1}\right) / \gamma_{\bm{\mathsf{z}}_{\mathsf{e}},t}^+$\vspace{0.1cm}
%%%%% LMMSE of z
\Statex\LeftCommentNoIntent{Estimation of  $\bm{z}$ from $\bm{s}$}\vspace{0.1cm}
\StateGreen $\widehat{\bm{z}}_{\mathsf{p}, t}^-=\bm{g}_{\bm{\mathsf{z}}}\left(\mathbf{\widehat{z}}^+_{\mathsf{e},t}, \gamma_{\bm{\mathsf{z}}_{\mathsf{e},t}}^+,\mathbf{s}\right)$
\StateGreen $\alpha_{\bm{\mathsf{z}}_\mathsf{p}, t}^-=\left\langle \bm{g}_{\bm{\mathsf{z}}}^{\prime}\left(\mathbf{\widehat{z}}^+_{\mathsf{e},t}, \gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t}}^+,\mathbf{s}\right)\right\rangle$
\StateGreen $\gamma_{\bm{\mathsf{z}}_{\mathsf{p}}, t}^-=\gamma_{\bm{\mathsf{z}}_{\mathsf{e}},t}^+ / \alpha_{\bm{\mathsf{z}}_\mathsf{p}, t}^-$, \quad$\gamma_{\bm{\mathsf{z}}_{\mathsf{e}},t}^-=\gamma_{\bm{\mathsf{z}}_{\mathsf{p}}}^--\gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t-1}}^+$
\StateGreen $\mathbf{\widehat{z}}^-_{\mathsf{e}, t}=\left(\gamma_{\bm{\mathsf{z}}_{\mathsf{p},t}}^-\, \widehat{\bm{z}}_{\mathsf{p}, t}^--\gamma_{\bm{\mathsf{z}}_{\mathsf{e}, t}}^+\, \mathbf{\widehat{z}}^+_{\mathsf{e},t}\right) / \gamma_{\bm{\mathsf{z}}_{\mathsf{e}},t}^-$
\StateBlack $t \gets t + 1$\vspace{0.1cm}
\State \textbf{Until}\,$\Big(\big|\!\big|\boldsymbol{\widehat{d}}_{ \mathsf{p},t+1}^{+}-\boldsymbol{\widehat{d}}_{ \mathsf{p},t}^{+}\big|\!\big|^2_{\textrm{F}}\Big)$ $\leq\xi\Big( \big|\!\big|\boldsymbol{\widehat{d}}_{ \mathsf{p},t}^{+}\big|\!\big|^2_{\textrm{F}}$\Big)~\text{or}~ \Big($t>T_\textrm{max}\Big)$\vspace{0.1cm}
\State \textbf{return} $\widehat{\bm{d}}_{\mathsf{p}, T_{\textrm{max}}+1}^+$
\end{algorithmic}
\end{algorithm}
