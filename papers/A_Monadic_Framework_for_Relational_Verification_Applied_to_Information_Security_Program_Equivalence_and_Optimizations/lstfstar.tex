\newcommand\function{\sffamily\maybecolor{dkblue}function}

\makeatletter
\lstdefinelanguage{fstar}{%
  basicstyle=\lst@ifdisplaystyle\small\fi,
  morekeywords=[1]{type,and,val,fun,let,in,ref,try,if,then,else,match,with,open,as,module,rec,begin,end,assume,private,when,forall,ghost,assert,function,logic,array,pattern,effect,requires,ensures,decreases,modifies, abstract,total, reifiable, reflectable, new_effect, effect_actions, noeq, sub_effect},
  morekeywords=[2]{WP, Post, Pre, PURE, DIV, STATE, EXN, ALL, TotST, M, GHOST, Ghost, GTot, Lemma, Tot, Memo, READER, STATE_m, Effect, STEXN, RANDOM, ST, St, RAND, Rand},
  morekeywords=[3]{},
  morekeywords=[4]{},
  morestring=[b]",
  sensitive=true,%
  numbersep=4pt,
%  numbers=left,
  columns=[l]fullflexible,
  texcl=true,
  mathescape=true,
%  xleftmargin=10pt,
  identifierstyle={\sffamily},
  keywordstyle=[1]{\sffamily\maybecolor{dkblue}},
  keywordstyle=[2]{\sffamily\maybecolor{dkblue}},
  keywordstyle=[3]{\maybecolor{dkred}},
  keywordstyle=[4]{\rmfamily\itshape},
% Here is the range marker stuff
  rangeprefix=(*---\ ,
  includerangemarker=false,
  stringstyle=\ttfamily,
  showspaces=false,
  morecomment=[n]{(*}{*)},
  commentstyle={\itshape\maybecolor{dkred}},
  literate={->}{$\rightarrow\,$}{1}
           {True}{$\top$}{1}
           {False}{$\bot$}{1}
	   {delta}{$\delta$}{1}
	   {exists}{$\exists$}{1}
	   {forall}{$\forall$}{1}
           {fun}{$\lambda$}{1}
           {function}{{\sffamily\maybecolor{dkblue}function}}{1} % just putting function as a keyword is not enough because of fun
           {~}{$\neg$}{1}           
           {~>}{$\leadsto$}{1}
           {`}{\`{}}{1}
           {'a}{$\alpha$}{1}
           {'b}{$\beta$}{1}
           {'c}{$\gamma$}{1}
           {tau}{$\tau\,$}{1}
           {STATE0}{$\mathsf{ST}^\prime\,$}{1}
	   {/\\}{$\wedge\;$}{1}
	   {\\/}{$\vee\;$}{1}
           {>=}{$\geq\ $}{2}
           {<=}{$\leq\ $}{2}
	   {<==>}{$\Longleftrightarrow \ $}{3}
	   {==>}{$\Longrightarrow \ $}{3}
     {<>}{$\neq$}{1}
     {--}{-}{1}   % Added due to         - not displaying properly.  Weird. ... but may make arrows look bad  {...}{$\ldots$}{3}
     {<<}{$\prec\ $}{1}
           ,
  breaklines=false}
\makeatother
