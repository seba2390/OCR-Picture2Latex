\chapter{Additional Results for Consensus Message Passing}

\section{Additional results on the face problem}

\subsection{Qualitative results}

Figure~\ref{fig:shading-qualitative-multiple-subjects} shows inference results for reflectance maps, normal maps and lights for randomly chosen test images, and Figure~\ref{fig:shading-qualitative-same-subject} shows reflectance estimation results on multiple images of the same subject produced under different illumination conditions. \Method is able to produce reflectance estimates that are closer to the photometric stereo groundtruth across subjects and across different illumination conditions.

\subsection{Quantitative results}

Figure~\ref{fig:shading-quantitative-reflectance} shows quantitative results for both real images from `Yale B' and `Extended Yale B' datasets \citep{Georghiades2001, Lee2005} and synthetic shadowless images. The synthetic shadowless images were created using the same light, reflectance and normal map statistics as that of images in the real dataset (however estimated using photometric stereo~\citep{Queau2013}). Subject recognition results indicate superior performance of \MTD in comparison to other baselines in both real and synthetic image settings.

Figure~\ref{fig:shading-quantitative-light} shows the quantitative results of light inference using the different inference techniques. We use the cosine angle distance between the estimated light and the photometric stereo groundtruth ($\textrm{error} = \cos^{-1}(\hat{\mathbf{l}}_\textrm{est}.\hat{\mathbf{l}}_\textrm{ps})$) as an error metric. Here, $\hat{\mathbf{l}}_\textrm{est}$ is a unit vector in the same direction as the mean of the posterior light estimate of \MTD and $\hat{\mathbf{l}}_\textrm{ps}$ is a unit vector in the same direction as the corresponding photometric stereo groundtruth. Again, these results indicate the superior performance of \MTD in comparison to other baselines in both real and synthetic image settings.


\begin{figure*}[h]
	\centering
	\setlength\fboxsep{0.2mm}
	\setlength\fboxrule{0pt}
	\begin{tikzpicture}

	\node at (-7.3, 2.9) {\small (a) Observed};
	\node at (-4.2, 2.9) {\small (b) Reflectance};
	\node at (-0.58, 2.9) {\small (c) Variance};
	\node at (2.35, 2.9) {\small (d) Light};
	\node at (6.4, 2.9) {\small (e) Normal};

	\node at (-4.15, 2.6) {\tiny $\color{gray}{\overbrace{\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad
														  \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad
														  \quad\quad\quad\quad\quad\quad}}$};

    \node at (2.45, 2.6) {\tiny $\color{gray}{\overbrace{\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad
														 \quad\quad\quad\quad\quad\quad\quad\quad\quad\quad}}$};

	\node at (6.58, 2.6) {\tiny $\color{gray}{\overbrace{\quad\quad\quad\quad\quad\quad\quad\quad\quad\quad
														 \quad\quad\quad\quad\quad\,\,\,}}$};

		\matrix at (0, 0) [matrix of nodes, nodes={anchor=east}, column sep=-0.15cm, row sep=-0.2cm]
		{
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_X.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_R.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_biswasR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_vmpR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_forestR.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_cmpR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_cmpvarR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_L.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_vmpL.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_forestL.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_cmpL.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_N.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_vmpN.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_5_cmpN.png}}  	\\

			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_X.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_R.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_biswasR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_vmpR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_forestR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_cmpR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_cmpvarR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_L.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_vmpL.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_forestL.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_cmpL.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_N.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_vmpN.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_6_cmpN.png}}  \\

			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_X.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_R.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_biswasR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_vmpR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_forestR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_cmpR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_cmpvarR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_L.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_vmpL.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_forestL.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_cmpL.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_N.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_vmpN.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_7_cmpN.png}} \\

			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_X.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_R.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_biswasR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_vmpR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_forestR.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_cmpR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_cmpvarR.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_L.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_vmpL.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_forestL.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_cmpL.png}} & \hspace{0.12cm} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_N.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_vmpN.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_2_8_cmpN.png}}  \\
	     };

	     \node at (-6.4, -2.7) {\small GT};
	     \node at (-5.25, -2.7) {\small BU};
	     \node at (-4.1, -2.7) {\small MP};
	     \node at (-3.0, -2.7) {\small Forest};
	     \node at (-1.87, -2.7) {\small \textbf{CMP}};

	     \node at (-0.55, -2.7) {\small \textbf{CMP}};

	     \node at (0.75, -2.7) {\small GT};
	     \node at (1.9, -2.7) {\small MP};
	     \node at (3, -2.7) {\small Forest};
	     \node at (4.15, -2.7) {\small \textbf{CMP}};

	     \node at (5.5, -2.7) {\small GT};
	     \node at (6.6, -2.7) {\small MP};
	     \node at (7.72, -2.7) {\small \textbf{CMP}};

	\end{tikzpicture}
	\vspace{-0.4cm}
	\mycaption{A visual comparison of inference results}{For 4 randomly chosen test images, we show inference results obtained by competing methods. (a)~Observed images. (b)~Inferred reflectance maps. \textit{GT} is the photometric stereo groundtruth, \textit{BU} is the Biswas \etal (2009) reflectance estimate and \textit{Forest} is the consensus prediction. (c)~The variance of the inferred reflectance estimate produced by \MTD (normalized across rows). High variance regions correlate strongly with cast shadows. (d)~Visualization of inferred light directions. (e)~Inferred normal maps.}
	\label{fig:shading-qualitative-multiple-subjects-supp}
\end{figure*}


\begin{figure*}[H]
	\centering
	\setlength\fboxsep{0.2mm}
	\setlength\fboxrule{0pt}
	\begin{tikzpicture}

		\matrix at (0, 0) [matrix of nodes, nodes={anchor=east}, column sep=-0.15cm, row sep=-0.2cm]
		{
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_X.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_GT.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_BISWAS.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_VMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_FOREST.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_CMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_1_CMPVAR.png}} & \hspace{0.25cm} &

			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_X.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_GT.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_BISWAS.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_VMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_FOREST.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_CMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_4_CMPVAR.png}}
			 \\

			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_X.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_GT.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_BISWAS.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_VMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_FOREST.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_CMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_2_CMPVAR.png}} & \hspace{0.25cm} &

			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_X.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_GT.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_BISWAS.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_VMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_FOREST.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_CMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_5_CMPVAR.png}}
			 \\

			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_X.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_GT.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_BISWAS.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_VMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_FOREST.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_CMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_3_CMPVAR.png}} & \hspace{0.25cm} &

			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_X.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_GT.png}} &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_BISWAS.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_VMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_FOREST.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_CMP.png}}  &
			\fbox{\includegraphics[width=1cm]{figures/sample_3_6_CMPVAR.png}}
			 \\
	     };


	     \node at (-7.47, -2.0) {\small Observed};
	     \node at (-6.33, -2.0) {\small `GT'};
	     \node at (-5.2, -2.0) {\small BU};
	     \node at (-4.1, -2.0) {\small VMP};
	     \node at (-2.95, -2.0) {\small Forest};
	     \node at (-1.87, -2.0) {\small \textbf{CMP}};
	     \node at (-0.75, -2.0) {\small Variance};

	     \node at (0.75, -2.0) {\small Observed};
	     \node at (1.87, -2.0) {\small `GT'};
	     \node at (2.95, -2.0) {\small BU};
	     \node at (4.1, -2.0) {\small VMP};
	     \node at (5.25, -2.0) {\small Forest};
	     \node at (6.35, -2.0) {\small \textbf{CMP}};
	     \node at (7.48, -2.0) {\small Variance};

	\end{tikzpicture}
	\mycaption{Robustness to varying illumination}{Reflectance estimation on two subject images with varying illumination. Left to right: observed image, photometric stereo estimate which is used as a proxy for groundtruth, bottom-up estimate of \cite{Biswas2009}, VMP result, consensus forest estimate, CMP mean, and CMP variance.}
	\label{fig:shading-qualitative-same-subject-supp}
\end{figure*}
