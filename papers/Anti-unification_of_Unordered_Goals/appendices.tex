
	\section{Proof of Proposition~\ref{prop-quasi-order}}
\begin{proof}
	We will prove the result for relation $\sqsubseteq$, the proof for $\preceq$ being similar. We need to prove that $\sqsubseteq$ is reflexive and transitive. For reflexivity, it is obvious that since $G\subseteq G$ for any goal $G$, we have $G\sqsubseteq_\theta G$ for the empty substitution $\theta$. For transitivity, suppose that for goals $G_1$, $G_2$ and $G_3$, it holds that $G_1 \sqsubseteq_{\theta_1} G_2$ and $G_2 \sqsubseteq_{\theta_2} G_3$. Then by Definition~\ref{def-generalization}, there exist sets of atoms $\Delta_1$ and $\Delta_2$ such that $G_1\theta_1 \cup \Delta_1 = G_2$ and $G_2\theta_2\cup\Delta_2 = G_3$. In other words it holds that $(G_1\theta_1\cup\Delta_1)\theta_2\cup\Delta_2 = G_3$ or equivalently, $(G_1\theta_1)\theta_2 \cup (\Delta_1\theta_2 \cup\Delta_2) = G_3$. As the composition of two substitutions is a substitution, by defining $\theta_3 = \theta_2\circ\theta_1$ and $\Delta_3 = \Delta_1\theta_2 \cup\Delta_2$, we have $G_1\theta_3 \cup \Delta_3 = G_3$, so $G_1\sqsubseteq_{\theta_3} G_3$, which concludes the proof.
\end{proof}
	

	\section{Proof of Proposition~\ref{prop-msg-lcg}}
	
		First, observe the following property that holds for both relations, essentially stating that a common generalization that is not a lcg has a direct extension obtained by the addition of one atom. 
		
		\begin{proposition}\label{prop-lcg-extensible}
			Let $G_1, \dots, G_n$ and $G$ be goals such that $G$ is a $\leqslant$-common generalization, but not a $\leqslant$-lcg, of $\{G_1, \dots, G_n\}$. Then there exists an atom $A\notin G$ such that $G\cup\{A\}$ is a $\leqslant$-common generalization of $\{G_1, \dots, G_n\}$.
		\end{proposition} 
	
	
		\begin{proof}
		
		Let us suppose the existence of some goal $G$, a $\leqslant$-common generalization that is not a $\leqslant$-lcg of $\{G_1, \dots, G_n\}$, and let us try and extend $G$ into a $\leqslant$-common generalization $G\cup\{A\}$ with $A\notin G$ an atom. As $G$ is not a lcg, there must exist another goal $G'$ being a $\leqslant$-lcg of $G_1$ and $G_2$ and obviously we have $|G'|>|G|$. As a consequence at this point there are three groups of atoms that can be identified: let us denote by $\hat{A}_1, \dots, \hat{A}_p$ the $p (\ge 0)$ atom(s) that are both in $G$ and in $G'$; by $A_1, \dots, A_m$ the $m (\ge 0)$ atom(s) that are part of $G$ but not of $G'$; and by $B_1, \dots, B_l$ the $l (\ge 1)$ atom(s) that are part of $G'$ but not of $G$. For an element $A$ of any of these sets, we denote by $A^1, \dots, A_n$ the atom in respectively $G_1, \dots, G_n$ whose anti-unification led to having $A$ as part of the generalizations.
		
		From the fact that $|G'|>|G|$ it follows that $l>m$. Now each $A_i (i \in 1..m)$ is such that $\exists  h\in 1..n : A_i^h\in \{B_i^h|i\in 1..l\}$: if not, it would be possible to add an atom generalizing $\{A_i^1, \dots, A_i^n\}$ (such as $A_i$) in $G'$ and get a larger generalization, which is impossible given that $G'$ is a lcg. Also note that for two atoms $B_i$ and $B_j (1\le i < j \le l)$, for $g, h \in 1..n : g\neq h$, if $B_i^g$ is anti-unifiable with an atom $B_j^h$ then $B_j^g$ is also anti-unifiable with $B_i^h$ (as it means that all four base atoms are a call to one and the same predicate (with relation $\sqsubseteq$) or have the exact same inner structure save for variables (with relation $\preceq$)), so that it is possible to switch the atoms $B_i^g$ and $B_j^h$, compute the anti-unification of $\{B_i^g, B_j^h)$ and $(B_j^g, B_i^h)$, and get an equally valid anti-unification. Thanks to this we can, where necessary, perform switches so as to rearrange the atoms $B_i (1\le i \le l)$ into $\{\hat{B}_i|i \in 1..l\}$ in such a way that $\{A_i|i\in 1..m\} \subset \{\hat{B}_i|i \in 1..l\}$ and for each atom $\hat{B}_i$, either $\hat{B}_i \in \{A_k|k\in 1..m\}$ or $\exists g, h \in 1..n : g\neq h \wedge \hat{B}_i^g\notin \{A_k^g|k\in 1..m\}\wedge \hat{B}_i^h\notin \{A_k^h|k\in 1..m\}$. We can now define a new generalization $\hat{G}$ defined as the union of these rearranged atoms and those that are common to $G$ and $G'$, i.e. $\hat{G} = \{\hat{A_i}|i\in 1..p\}\cup\{\hat{B}_i|i\in 1..l\}$. Since $|\hat{G}| = |G'|$ and $G\subset \hat{G}$, it suffices to add one of the atoms $A \in \hat{G}\setminus G$ to $G$ in order to obtain $G\cup\{A\}$, a $\leqslant$-common generalization of $\{G_1, \dots, G_n\}$ by construction.
	\end{proof}


		Next, we prove Proposition~\ref{prop-msg-lcg}.
		
	\begin{proof}
	We prove that any $\leqslant$-msg is a $\leqslant$-lcg by contradiction. Let us suppose that some goal $G$ is both a $\leqslant$-msg and not a $\leqslant$-lcg of the set of $\{G_1, \dots, G_n\}$. According to Proposition~\ref{prop-lcg-extensible} it must then be possible to select an atom $A \notin G$ such that $G\cup\{A\}$ is a $\leqslant$-common generalization of $\{G_1, \dots, G_n\}$. Since $A\notin G$ and any atom has a $\tau$-value of at least 1, it follows that $|\tau(G\cup\{A\})|>|\tau(G)|$. Consequently $G$ cannot be a $\leqslant$-most specific generalization of $G_1$ and $G_2$: a contradiction.
	
	As for the fact that any $\preceq$-lcg is a $\preceq$-msg, we prove this also by contradiction. Let $G$ represent a $\preceq$-lcg of the set of goals $\{G_1, \dots, G_n\}$ and let us suppose that $G$ is not a $\preceq$-msg. Then there must exist another goal that is a $\preceq$-msg of $\{G_1, \dots, G_n\}$, say $G'$, such that $|\tau(G')|>|\tau(G)|$ and, according to the first part of the proposition, $|G'|=|G|$. 
	Now, observe that for a set of atoms $\{A_1, \dots, A_n\}$ to be anti-unified with $\preceq$ into an atom $A$, necessarily all $A_i (1\le i\le n)$ must have the same $\terms$-value. Indeed relation $\preceq$ is defined upon renamings so that only variables (having a $\terms$-value of zero) are impacted by the generalization process. Therefore, the only possibility for the inequality $|\tau(G')|>|\tau(G)|$ to be true is that some atoms $B_1, \dots, B_n$ of respective goals $G_1,\dots,G_n$ appear in a generalized form (say $B$) in $G'$, while these atoms have not been generalized in $G$. This means that it is possible to add a (possibly renamed) version of $B$ in $G$ and obtain $G\cup\{B\}$, also a $\preceq$-common generalization and larger than $G$: a contradiction.
	\end{proof}

	
	\section{Detailed proof of Lemma~\ref{lemma-au-op}}
	\begin{proof}
The lemma will be shown correct by the definition of three anti-unification operators. A first anti-unification operator, based on $\sqsubseteq$ is the following. 

\begin{definition}%[Simple anti-unification operator]
	\label{def-atoms-au}
	Given a variabilization function $\Phi$, let $\au^\Phi_\sqsubseteq$ (or simply $\au_\sqsubseteq$ if $\Phi$ is clear from the context) denote the anti-unification operator such that for any two atoms $A = a(t^A_1, \dots, t^A_n)$ and $B = b(t^B_1, \dots, t^B_m)$, it holds that \[\au^{\Phi}_\sqsubseteq(A,B)=\left\{\begin{array}{l}
		a\big(\Phi(t^A_1, t^B_1), \dots, \Phi(t^A_n, t^B_n)\big) \\ \qquad  \mbox{if } a = b \mbox{ and } n = m\\
		\bot \\
		\qquad \mbox{otherwise}\\
	\end{array}\right. \]
\end{definition} 

\begin{example}\label{ex-au-sq}
	In Table~\ref{table:sqsubseteq}, we show three atomic anti-unification results obtained by the application of $\au_\sqsubseteq^\Phi$ with $\Phi$ a given variabilization function. Note how in the first example, the predicates used in $A_1$ and $A_2$ differ (resp. $p/2$ and $p/3$), leading to an impossible anti-unification.
\end{example}

\begin{table*}
	\caption{Example results for $au_\sqsubseteq^\Phi$}
	\label{table:sqsubseteq}
	\centering
	\begin{tabular}{l|l|l}
		%\hline 
		$\bm{A_1}$ & $\bm{A_2}$ & $\bm{\au_\sqsubseteq^\Phi(A_1, A_2)}$\\\hline 
		$p(X, 5, q(Y,4))$ & $p(W,t(Z))$ & $\bot$\\\hline 
		$p(r(X,3), t(5))$ & $p(W, t(Z))$ & $p(\Phi(r(X,3),W), \Phi(t(5), t(Z)))$\\\hline 
		$p(r(X,3), t(Y))$ & $p(r(W,3),t(Z))$ & $p(\Phi(r(X,3),r(W,3)), \Phi(t(Y),t(Z)))$ %\\\hline 
	\end{tabular} 
\end{table*}

Note that the anti-unification operator defined in Definition~\ref{def-atoms-au} differs from the traditional subsumption operator in the ordered case (i.e. when goals are ordered sequences of atoms). The difference comes from the fact that our goals being sets, all the possible couples of atoms have to be considered, whereas traditional subsumption must handle one atom at the time, making the anti-unification operator more straigtforward.     

Let us now introduce a second anti-unification operator that will allow to compute a $\preceq$-lcg. 
%and to prove Theorem~\ref{thm-preceq-lcg}. 
Since the result of this operator should be a $\preceq$-common generalization, the operator need only to anti-unify the \textit{variables} occurring at the corresponding positions in the atoms under investigation. 
The operator must thus go deeper into the term structure of the atoms than $\au_\sqsubseteq$ does, as it needs to only anti-unify those atoms that harbor the exact same structure at the level of their non-variable terms.
\begin{definition}%[Variable anti-unification operator]
	\label{def-term-au-through-variables}
	Given some variabilization function $\Phi$, let $\au^\Phi_\preceq$ (or simply $\au_\preceq$ if $\Phi$ is clear from the context) denote the function such that for any two terms $T = t(t_1, \dots, t_n)$ and $U = u(u_1, \dots, u_m)$ it holds that
	\[\au^\Phi_\preceq(T,U)=\left\{\begin{array}{l}
		\Phi(T,U) 
		\\ \qquad \mbox{if } T\in\mathcal{V}\mbox{ and } U\in\mathcal{V}
		\\t\big(\au^\Phi_\preceq(t_1,u_1), \dots, \au^\Phi_\preceq(t_n, u_n)\big) 
		\\ \qquad \mbox{if } t = u \mbox{ and } n = m 
		\\ \qquad \mbox{and } \forall i \in 1..n: \au^\Phi_\preceq(t_i,u_i)\neq\bot
		\\ \bot
		\\ \qquad  \mbox{otherwise}
	\end{array}\right.\]
	and for any two atoms $A = a(t^A_1, \dots, t^A_n)$ and $B = b(u^B_1, \dots, u^B_m)$, it holds that
	\[\au^\Phi_\preceq(A,B)=\left\{\begin{array}{l}
		a\big(\au^\Phi_\preceq(t^A_1, u^B_1),\dots, \au^\Phi_\preceq(t^A_n, u^B_n)\big) 
		\\ \qquad \mbox{if } a = b \mbox{ and } n = m 
		\\ \qquad \mbox{and } \forall i \in 1..n: \au^\Phi_\preceq(t^A_i, u^B_i) \neq\bot
		\\ \bot  
		\\ \qquad \mbox{otherwise}
	\end{array}\right.\]
\end{definition}

\begin{example}
	In Table~\ref{table:preceq}, we treat the anti-unification of the same atoms as above, this time with the use of $\au_\preceq^\Phi$ with $\Phi$ a given variabilization function. Note how $\au_\preceq$ behaves differently than $\au_\sqsubseteq$ on the second and third couple of atoms as it requires its arguments to exhibit a similar structure in order to be anti-unifiable.
\end{example}

\begin{table*}
	\caption{Example results for $au_\preceq^\Phi$}
	\label{table:preceq}
	\centering
	\begin{tabular}{l|l|l}
		%\hline
		$\bm{A_1}$ & $\bm{A_2}$ & $\bm{\au_\preceq^\Phi(A_1, A_2)}$\\\hline 
		$p(X, 5, q(Y,4))$ & $p(W,t(Z))$ & $\bot$\\\hline 
		$p(r(X,3), t(5))$ & $p(W, t(Z))$ & $\bot$\\\hline 
		$p(r(X,3), t(Y))$ & $p(r(W,3),t(Z))$ & $p(r(\Phi(X,W),3), t(\Phi(Y,Z)))$ %\\\hline
	\end{tabular}
\end{table*}

Now, in order to compute $\sqsubseteq$-msgs, we need a more precise anti-unification operator: one that goes deeper into detail when comparing atoms so as not to miss their maximal common structure. 
\begin{definition} %[Deep anti-unification operator]\label{def-deep-operator}
	Given some variabilization function $\Phi$, let $\dau^\Phi_\sqsubseteq$ (or simply $\dau_\sqsubseteq$ if $\Phi$ is clear from the context) denote the function such that for any two terms $T = t(t_1, \dots, t_n)$ and $U = u(u_1, \dots, u_m)$ it holds that 
	\[\dau^\Phi_\sqsubseteq(T,U)=\left\{\begin{array}{l}
		
		t\big(\dau^\Phi_\sqsubseteq(t_1,u_1), \dots, \dau^\Phi_\sqsubseteq(t_n, u_n)\big) 
		\\ \qquad \mbox{if } t = u \mbox{ and } n = m 
		\\ \qquad \mbox{and } T \notin \mathcal{V} \mbox{ and } U \notin \mathcal{V}
		\\ \Phi(T,U) 
		\\ \qquad \mbox{otherwise}
	\end{array}\right.\]
	and for any two atoms $A = a(t^A_1, \dots, t^A_n)$ and $B = b(u^B_1, \dots, u^B_m)$, it holds that
	\[\dau^\Phi_\sqsubseteq(A,B)=\left\{\begin{array}{l}
		a\big(\dau^\Phi_\sqsubseteq(t^A_1, u^B_1),\dots, \dau^\Phi_\sqsubseteq(t^A_n, u^B_n)\big) 
		\\ \qquad \mbox{if } a = b \mbox{ and } n = m 
		\\ \bot
		\\ \qquad \mbox{otherwise}
	\end{array}\right.\]
\end{definition}

When applied on atoms, it is easy to see that $\dau_\sqsubseteq$ is an anti-unification operator based on relation $\sqsubseteq$.

\begin{example}
	Let us once more consider the anti-unification of the atoms introduced in Example~\ref{ex-au-sq}. This time we make use of $\dau_\sqsubseteq^\Phi$ with $\Phi$ a given variabilization function, to anti-unify the three pairs of atoms. The result is shown in Table~\ref{table:dau}. Notice how the operator preserves as much non-variable atomic structure as possible in the process.
\end{example}
\begin{table*}
	\caption{Example results for $dau_\sqsubseteq^\Phi$}
	\label{table:dau}
	\centering
	\begin{tabular}{l|l|l}
		%\hline 
		$\bm{A_1}$ & $\bm{A_2}$ & $\bm{\dau_\sqsubseteq^\Phi(A_1, A_2)}$\\\hline 
		$p(X, 5, q(Y,4))$ & $p(W,t(Z))$ & $\bot$\\\hline 
		$p(r(X,3), t(5))$ & $p(W, t(Z))$ & $p(\Phi(r(X,3),W),t(\Phi(5,Z)))$\\\hline 
		$p(r(X,3), t(Y))$ & $p(r(W,3),t(Z))$ & $p(r(\Phi(X,W),3), t(\Phi(Y,Z)))$ %\\\hline 
	\end{tabular} 
\end{table*}
The existence of these operators proves Lemma~\ref{lemma-au-op}.
	\end{proof}
	
	\section{Proof of Theorem~\ref{thm-ausqsubseteq}}
	\begin{proof}
	Obviously the $\au_\sqsubseteq(A_1,A_2)$ operation can be achieved in a time linear with respect to the arity $n$ of $A_1$. In the worst case, the operation needs to be performed for each atom in $G_1$ with respect to each atom in $G_2$. Hence the first result.
	
	
	It is also easy to see that the $\au_\preceq(A_1,A_2)$ operation can be achieved in linear time with respect to the maximum number of function applications in the argument terms of the atom $A_1$ under scrutiny. In the worst case, the operation needs to be performed for each atom in $G_1$ with respect to each atom in $G_2$. Hence the second result.
	\end{proof}
		
%	
%	\section{Maximum Weight Matching of Example~\ref{example-mwm}}
%	See Fig.~\ref{fig:mwm}.
	
	
	\section{Proof of Theorem~\ref{thm-sqsubseteq-msg}}
\begin{proof}
	First note how the atomic anti-unifications and the weights of the associated bipartite graph's edges can be computed simultaneously, by working out $\dau_\sqsubseteq(A_1,A_2)$ for each possible couple $(A_1,A_2)$ in $G_1\times G_2$ and keeping account of the number of non-variable terms encountered during the operation (or $-1$). Given that $\dau_\sqsubseteq(A_1,A_2)$ can obviously operate linearly in the number of terms appearing in $A_1$ (denoted $N$), the computation of all weights is carried out in a time not exceeding $\mathcal{O}(|G_1|.|G_2|.N)$.
	
	Now the obtained assignment problem can be solved by existing algorithms (such as the Hungarian method~\cite{assignment}) that compute a MWM in $\mathcal{O}(n^3)$, where $n$ is the number of vertexes appearing on the side of the bipartite graph that has the most vertexes. In our case, there are $|G_1|$ left vertexes and $|G_2|$ right vertexes so that a MWM algorithm can be ran in $\mathcal{O}(max(|G_1|,|G_2|)^3)$.
\end{proof}
	
	\section{Proof of Theorem~\ref{thm-dataflow-np-complete}}
\begin{proof}
	First, let us consider MSG-MIN. It clearly belongs to NP. Indeed, given an arbitrary generalization $G$, we can verify in polynomial time whether it is a most specific generalization. The procedure is as follows. We can compute at least one $\leqslant$-msg, say $G'$, in polynomial time (see Theorem~\ref{thm-sqsubseteq-msg}). It suffices then to compare the $\tau$-value of $G'$ with that of $G$ in order to decide whether $G$ is a msg. Next, verifying whether the number of variables in $G$ is bounded by a constant is obviously achieved in polynomial time as well.
	
	In order to prove NP-hardness, we will construct a reduction from the well-known set cover problem (known to be NP-complete~\cite{karp}) to MSG-MIN. The set cover problem in its decision-problem version (denoted SCP), can be formulated as follows. Given a constant $p \in \mathbb{N}_0$, a universe $U$ of values and a collection $S$ composed of $n$ sets $\{S_1, \dots, S_n\}$ that cover $U$, i.e. $U = \underset{i=1}{\overset{n}{\cup}}S_i$, the problem is to decide whether there exists $p$ subsets from $S$ that still cover $U$.
	
	We can transform an arbitrary instance of SCP into MSG-MIN as follows. Let us consider without loss of generality a universe $U$ where the elements are lowercase strings and $p \in \mathbb{N}_0$ a constant. Given a collection of sets $S=\{S_1, \dots, S_n\}$ we construct an instance of MSG-MIN as follows. In our construction we use $n+1$ different variables, namely $V$ and $(W_i)_{i\in1..n}$. We use $x_j$ to denote some element of $U$; these elements being strings, we can easily use them as predicate names. The construction of goals $G_1$ and $G_2$ proceeds then as follows:
	
	\begin{algorithmic}
		\State $G_1 = \{\}$ 
		\State $G_2 = \{\}$ 
		\For {each ($S_i \in S$)}
		\For {each ($x_j \in S_i$)}
		\State $G_1 \gets G_1\cup \{x_j(V)\}$				
		\State $G_2 \gets G_2\cup \{x_j(W_i)\}$
		\EndFor
		\EndFor
	\end{algorithmic}
	Note that all the atoms in $G_1$ have the same argument (namely the variable $V$) and there are as many atoms in $G_1$ as there are distinct elements in $S$. In $G_2$, however, there is an atom of the form $x_j(W_i)$ for each element $x_j$ occurring in $S_i$.
	
	The construction is such that any $\leqslant$-msg of $G_1$ and $G_2$ will be a version of $G_1$ where each occurrence of a variable $V$ is replaced by $\Phi(V, W_k)$ for some $W_k\in\vars(G_2)$ (where $\Phi$ is a variabilization function). Now, introducing such a variable $\Phi(V, W_k)$ in the generalization will allow to reuse the same variable for all the atoms $x_j(V)$ in $G_1$ that have a corresponding $x_j(W_k)$ in $G_2$. In other words, choosing to have variable $\Phi(V,W_k)$ in the $\leqslant$-msg is the same as selecting the subset $S_k$ to be part of the solution of the set cover problem. Consequently, using this transformation MSG-MIN can be used to decide SCP. Since the transformation can clearly be done in polynomial time, and since SCP is known to be NP-complete, we conclude that MSG-MIN is NP-complete as well.
	
	Now let us prove the result for LCG-MIN. We know that a $\leqslant$-lcg can be computed in polynomial time, so that a positive instance of LCG-MIN can be verified just like it can be for MSG-MIN. Moreover, the absence of non-variable terms in the transformation from SCP to MSG-MIN above allows us to reuse said transformation as-is to prove that LCG-MIN is NP-hard. Indeed, since the obtained anti-unification problem doesn't harbor terms other than variables, it is both an instance of MSG-MIN and LCG-MIN. LCG-MIN is therefore also NP-complete.
\end{proof}
	
	\section{Proof of Theorem~\ref{thm-inj-np-complete}}
\begin{proof}
	INJ is in NP: given a relation $\leqslant^\iota$, goals $G_1$ and $G_2$ and a substitution (or renaming) $\theta$, it is possible to verify in polynomial time whether the application of $\theta$ on $G_1$ results on a subset of $G_2$ or not.
	As for the proof of NP-hardness, we refer to~\cite{gen} in which the problem ``is $G_1$ a $\preceq^\iota$-lcg of $G_1$ and $G_2$?'' has been proved to be NP-complete using a polynomial reduction from the Induced Subgraph Isomorphism Problem~\cite{SYSLO198291}. The same reduction can be used for the other cases, leading to the conclusion that INJ is NP-complete.
\end{proof}
	