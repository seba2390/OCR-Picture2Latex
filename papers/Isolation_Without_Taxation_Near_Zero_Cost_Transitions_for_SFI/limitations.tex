\section{Limitations}
\label{sec:limitations}
%
Our Wasm SFI scheme is capable of sandboxing any C/\C++-like language (with arbitrary
intra-function control flow, arbitrary type casting, arbitrary pointer aliasing,
arithmetic etc.) that can compile to Wasm, so long as it does not use
features which Wasm must emulate through JavaScript\footnote{See
\url{https://emscripten.org/}}\dash---most prominently \C++-style exceptions,
\texttt{setjmp/longjmp}, and multithreading.
%
These limitations are not inherent to our zero-cost conditions, and Wasm is in
the process of being extended with support for all of the above
features~\cite{10.1145/3360559,wasmeh}.

Our \trsegmentsfi scheme is built as a proof-of-concept, using mostly existing
LLVM passes to sandbox C programs compiled to 32-bit x86, as an approach to understanding the overhead of zero-cost conditions on native code.
%
As such, our \trsegmentsfi implementation does not support, for instance,
\texttt{setjmp/longjmp} or multithreading (similar to Wasm).
%
In addition it does not support user-defined variadic function arguments or position
independent code.
%
However, these are engineering limitations and not fundamental.
%
For example, user-defined variadic function arguments could be supported by extending the SafeStack LLVM pass to move the
variadic argument buffer into the unsafe stack, and position independent code could be supported
through minor generalisations of existing compiler primitives.

Both Wasm and \trsegmentsfi rely on a type-directed forward-edge CFI which requires us to statically infer a limited amount of information about arguments to functions.\footnote{We do not need to infer any information about the heap or unsafe stack. Variadic functions, for example, can pass a dynamic number of arguments on the unsafe stack.}
%
This information includes the number of arguments, their width, and the calling convention.
%
In practice, this information is readily available as part of compilation and
does not require any complex control flow inference (unlike more precise fine
grain CFI schemes), so this is only a limitation when analyzing certain
binary programs.
%
Like most SFI schemes, both Wasm and our \trsegmentsfi do not currently
support JIT code compilation within the isolated component; adding this would
require engineering work, but can be done following the approaches of
\cite{nacl-jit, vahldiek-oberwagner_erim_2019}.
%
Finally, side channels are out of scope for this paper.
