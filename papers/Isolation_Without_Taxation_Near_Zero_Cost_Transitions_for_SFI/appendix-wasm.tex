\section{WebAssembly}
\label{appendix:webassembly}

\begin{mathpar}
  \inferrule
  {
    \currentop{\Psi}{\ccall{}{i}} \step \Psi'
  }
  {\currentcom{\Psi}{\cgatecall{n}{i}}{\trusted} \step \Psi'[p \assign \untrusted]}

  \inferrule
  {
    \currentop{\Psi}{\ccall{I}{i}} \step \Psi'
  }
  {\currentcom{\Psi}{\cgatecall{n}{i}}{\untrusted} \step \Psi'[p \assign \trusted]}

  \inferrule
  {
    \currentop{\Psi}{\cret{}} \step \Psi'
    \\\\ p' = \untrusted \Leftrightarrow p = \trusted
  }
  {\currentcom{\Psi}{\cgateret}{p} \step \Psi'[p \assign \trusted]}
\end{mathpar}
\captionof{figure}{WebAssembly Trampoline and Springboard}
\label{fig:appendix:wasm:operational}

\begin{figure}[t]
  \begin{center}
    \begin{tabular}{>{$} r <{$} | c |}
      \cline{2-2}
      & current block spill slots \\
      & \ldots \\
      \cline{2-2}
      & function locals \\
      & \ldots \\
      \cline{2-2}
      sp \longrightarrow & saved $\mathbb{CSR}$ \\
      & \ldots \\
      \cline{2-2}
      & return address \\
      \cline{2-2}
      & arguments \\
      & \ldots \\
      \cline{2-2}
    \end{tabular}
  \end{center}
  \caption{WebAssembly Stack Frame}
  \label{fig:appendix:wasm:stack-frame}
\end{figure}

\begin{center}
  \begin{tabular}{>{$}r<{$} >{$}r<{$} >{$}c<{$} >{$}l<{$}}
    \textit{WebAssemblyFunction} & \textit{WF} & \bnfdef &
    \begin{array}[t]{lllll}
      \{
      & |args| & \bnftypes & \nats \\
      & |locals| & \bnftypes & \nats \\
      & entry & \bnftypes & \textit{Block} \\
      & exits & \bnftypes & \powerset{\textit{Block}} \\
      & blocks & \bnftypes & \powerset{\textit{Block}} & \}
    \end{array} \\

    \textit{Block} & B & \bnfdef &
    \begin{array}[t]{lllll}
      \{
      & start & \bnftypes & \nats \\
      & end & \bnftypes & \nats \\
      & |slots| & \bnftypes & \nats \\
      & inputs & \bnftypes & \powerset{\nats + \regs} \\
      & indirects & \bnftypes & \powerset{\textit{IB}} & \}
    \end{array} \\

    \textit{Indirect Block} & \textit{IB} & \bnfdef &
    \begin{array}[t]{lllll}
      \{
      & start & \bnftypes & \nats \\
      & end & \bnftypes & \nats \\
      & parent & \bnftypes & \textit{Block} & \}
    \end{array}
  \end{tabular}

  \captionof{figure}{WebAssembly Structure}
  \label{fig:appendix:wasm:structure}
\end{center}


\input{appendix-wasm-lr}
