%\documentclass[review]{elsarticle}

%\documentclass[preprint, 12pt]{elsarticle}
\documentclass[11pt,a4paper]{article}
\usepackage{lineno}
\pdfoutput=1
%\usepackage{hyperref}
%\usepackage{/scratch/Dropbox/Dropbox/FV_FSI/elsarticle/lineno}
%\usepackage{hyperref}

\input{packages.tex}
\input{commands.tex}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{epstopdf}
\usepackage{authblk}


%\modulolinenumbers[5]


\addtolength{\oddsidemargin}{-.5in}
\addtolength{\topmargin}{-.875in}
\addtolength{\textheight}{1in}
%\textwidth=440pt
%\journal{Journal of Computational and Applied Mathematics}

%%%%%%%%%%%%%%%%%%%%%%%
%% Elsevier bibliography styles
%%%%%%%%%%%%%%%%%%%%%%%
%% To change the style, put a % in front of the second line of the current style and
%% remove the % from the second line of the style you would like to use.
%%%%%%%%%%%%%%%%%%%%%%%

%% Numbered
%\bibliographystyle{model1-num-names}

%% Numbered without titles
%\bibliographystyle{model1a-num-names}

%% Harvard
%\bibliographystyle{model2-names.bst}\biboptions{authoryear}

%% Vancouver numbered
%\usepackage{numcompress}\bibliographystyle{model3-num-names}

%% Vancouver name/year
%\usepackage{numcompress}\bibliographystyle{model4-names}\biboptions{authoryear}

%% APA style
%\bibliographystyle{model5-names}\biboptions{authoryear}

%% AMA style
%\usepackage{numcompress}\bibliographystyle{model6-num-names}

%% `Elsevier LaTeX' style
%\bibliographystyle{elsarticle-num}
%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}

%% ELSEVIER %%
%\begin{frontmatter}

\date{}
\title{A novel Large Eddy Simulation model for the Quasi-Geostrophic Equations in a Finite Volume setting}
\author[1]{Michele Girfoglio\thanks{mgirfogl@sissa.it}}
\author[2]{Annalisa Quaini\thanks{quaini@math.uh.edu}}
\author[1]{Gianluigi Rozza\thanks{grozza@sissa.it}}
\affil[1]{SISSA, International School for Advanced Studies, Mathematics Area, mathLab, via Bonomea, Trieste 265 34136, Italy}
\affil[2]{Department of Mathematics, University of Houston, Houston TX 77204, USA}
\maketitle

%\title{A novel Large Eddy Simulation model for the Quasi-Geostrophic Equations in a Finite Volume setting}
%\tnotetext[mytitlenote]{Fully documented templates are available in the elsarticle package on \href{http://www.ctan.org/tex-archive/macros/latex/contrib/elsarticle}{CTAN}.}

%% Group authors per affiliation:
%\author{Elsevier\fnref{myfootnote}}
%\address{Radarweg 29, Amsterdam}
%\fntext[myfootnote]{Since 1880.}

%% or include affiliations in footnotes:
%\author[mymainaddress,mysecondaryaddress]{Elsevier Inc}
%\ead[url]{www.elsevier.com}

%\author[mysecondaryaddress]{Global Customer Service\corref{mycorrespondingauthor}}
%\cortext[mycorrespondingauthor]{Corresponding author}
%\ead{support@elsevier.com}

%\address[mymainaddress]{1600 John F Kennedy Boulevard, Philadelphia}
%\address[mysecondaryaddress]{360 Park Avenue South, New York}

%% or include affiliations in footnotes:
%\author[SISSA]{Michele Girfoglio\corref{mycorrespondingauthor}}
%\ead[url]{www.elsevier.com}
%\ead{mgirfogl@sissa.it}
%\cortext[mycorrespondingauthor]{Corresponding author}

%\author[Houston]{Annalisa Quaini}
%\ead{quaini@math.uh.edu}
%\ead{support@elsevier.com}

%\author[SISSA]{Gianluigi Rozza}
%\ead{grozza@sissa.it}
%\ead[url]{www.elsevier.com}

%\address[SISSA]{SISSA, International School for Advanced Studies, Mathematics Area, mathLab, via Bonomea, Trieste 265 34136, Italy}
%\address[Houston]{Department of Mathematics, University of Houston, Houston TX 77204, USA}

\begin{abstract}
%\textcolor{red}{PROVVISORIO}
We present a Large Eddy Simulation (LES) approach based on a nonlinear differential low-pass 
filter for the simulation of two-dimensional barotropic flows with under-refined meshes. 
For the implementation of such model, we choose a segregated three-step algorithm combined with a
computationally efficient Finite Volume method. 
We assess the performance of our approach on the classical double-gyre wind forcing benchmark. 
The numerical experiments we present demonstrate that our nonlinear filter is an improvement over a linear filter 
since it is able to recover the four-gyre pattern of the time-averaged stream function even with
extremely coarse meshes. In addition, our LES approach provides an average kinetic energy that compares 
well with the one computed with a Direct Numerical Simulation.
\end{abstract}

%\begin{keyword}
%\texttt{elsarticle.cls}\sep \LaTeX\sep Elsevier \sep template
%\MSC[2010] 00-01\sep  99-00
%Finite Volume approximation\sep Large Eddy Simulation\sep BV-$\alpha$ model\sep Quasi-geostrophic equations\sep nonlinear filter sstabilization
%\end{keyword}

%\end{frontmatter}

%\linenumbers

\section{Introduction}


Accurate numerical simulations of geophysical flows are not only an essential tool for ocean and weather forecast,
but they could also provide insights on the mechanisms governing climate change. 
In such simulations, two-dimensional turbulence represents a major challenge.
While in the Kolmogorov three-dimensional turbulence theory \cite{Kolmogorov41-1, Kolmogorov41-2} the kinetic energy 
is transferred from the large scales to the the small scales,  in the Kraichnan-Batchelor-Leith two-dimensional turbulence 
theory \cite{Kraichnan1967, Batchelor1969, Leith1971} %\anna{(mi sembrano tante citazioni per una questione teorica, magari scegliamone 3 o 4 rappresentative)} \textcolor{red}{(ok, ho lasciato le 3 più vecchie :) )} 
%, Chen2003, Danilov2000, Tabeling2002, Chen2003, Vallis2006
average inverse (i.e., from small to large scales) energy and direct (from large to small scales) 
enstrophy cascades are observed. 
%an inverse cascade occurs, i.e.~kinetic energy in transferred also \anna{(assumo che ci sia sia la normale energy cascade che l'inversa, e' giusto?)} from the small to the large scales. Moreover, the enstrophy is involved in a direct cascade it being transferred to the
%smaller scales from larger scales.
%\anna{Non sono sicura di capire: l'energia' cinetica va dalle scale piccole alle grandi ma l'enstrofia dalle grandi alle piccole, e' cosi' 
%che funziona? Ho provato a cercare una referenza online ma non trovo niente di esaustivo. Scone questo paper 
%\url{https://www.researchgate.net/publication/228624822_On_the_double_cascades_of_energy_and_enstrophy_in_two_dimensional_turbulence_Part_1_Theoretical_formulation/figures?lo=1&utm_source=google&utm_medium=organic} c'e' un dual-pure cascade e un dual-double cascade.
%Non voglio essere pedate, ma vorrei evitare che ci tirassimo la zappa sui piedi con un reviewer che magari 
%e' puntiglioso su questa teoria.} \textcolor{red}{A quanto ho capito si, l'energia cinetica va dalle scale piccoli alle grande mentre l'enstrofia dalle grandi alle piccole! Nel paper psi-omega appena sottomesso abbiamo scritto riguardo al vortex merger benchmark (che è di sicuro un concetto che ho estrapolato da altri papers): \emph{One of the reasons why this test has been extensively investigated in
%two-dimensions is that it explains the average inverse energy and direct enstrophy cascades observed in two-dimensional turbulence}} 
 %and is finally dissipated at large wavenumbers.%Additionally, direct cascade of enstrophy to small scales. %For more details the reader is referred, e.g., to \cite{Kraichnan1967, Batchelor1969, Leith1971, Chen2003, Danilov2000, Tabeling2002, Chen2003, Vallis2006}. %In the framework of the Kolmogorov 1941 theory [17, 18], the turbulent
%kinetic energy, which is the kinetic energy associated with eddies in the turbulent
%flow, is injected in the system at the large scales (low wave numbers).

%The most relevant features in the framework of the Kraichnan-Batchelor-Leith two-dimensional turbulence theory is the existence of two quadratic invariant that are involved in a double cascade scenario: an inverse cascade of kinetic energy from small to larges scales and a direct cascade of enstrophy to small scales. For more details the reader is referred, e.g., to \cite{Kraichnan1967, Batchelor1969, Leith1971, Chen2003, Danilov2000, Tabeling2002, Chen2003, Vallis2006}. %The applicability of two-dimensional turbulence theory to geophysical flows has been widely discussed in \cite{Danilov2000, Tabeling2002}. 

One of the simplest models for geophysical flow is given by the Quasi-Geostrophic equations (QGE): see, e.g., \cite{Vallis2006, Cushman-Roisin2011, McWilliams2006} for mathematical and physical fundamentals, \cite{San2012, Carere2021, Strazzullo2017} for some advanced applications and \cite{QGE_review} for a recent review on this model. 
Despite the simplification in the QGE, 
when the Munk scale (a length that depends on two nondimensional quantities, the Rossby number and the
Reynolds number) is small the numerical simulation of the QGE 
becomes computationally challenging since very fine meshes are required.
In addition, often long time intervals have to be simulated, making the computational cost prohibitive. 
%and a long time integration \anna{(cosa intendi: che bisogna simulare
%un lungo intervallo di tempo?)} \textcolor{red}{(yes, esatto!)}  %\rev{referenze}[6, 16, 8, 22]. 
A way to reduce the computational cost is to adopt a Large Eddy Simulation (LES) approach that 
allows to use a coarser mesh by modeling the effect of the small scales that do not get resolved. 
%the small-scale effects by a set of equations to be added to the discrete QGE formulated on under-refined meshes. 


In this paper, we focus on a LES model called BV-$\alpha$ \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014} 
that introduces a filter for the nonlinear term of the QGE model in order to correctly simulate physical flow 
when the mesh size is greater than Munk scale. Two are the main novelties of our work: i) 
the use of a nonlinear indicator function to identify the regions of the domain where the flow needs regularization
and ii) the space discretization with a computationally efficient Finite Volume method. 
Nonlinear filter stabilization has been adopted successfully for simulating two and three-dimensional incompressible flows; see, e.g., 
\cite{layton_CMAME,abigail_CMAME,BQV,Girfoglio2019}. %\textcolor{red}{(Anna vuoi inserire qui qualche lavoro tuo, di Leo o altri? Io per ora ho inserito solo il nostro computers and fluids, per onestà intellettuale ho evitato di citare anche i nostri lavori ROM :)}. 
However, to the best of our knowledge, it is the first time that such a methodology is utilized for 
geophysical flows. The advantage of a Finite Volume method lies in preserving
conservative quantities for the governing equations. For this reason,
Finite Volume approximations have been widely used for LES models of incompressible flows. 
Other authors have chosen to discretize the linear BV-$\alpha$ model with a Finite Difference method 
\cite{Nadiga2001, Holm2003} or a Finite Element method \cite{Monteiro2015, Monteiro2014}.
%Furthermore, FV has been widely used in the LES context.

In order to assess the performance of the proposed LES approach, we consider the classical 
double-gyre wind forcing benchmark \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014, Greathbatch2000, San2014}. We present numerical results for test
cases: i) Rossby number $0.0036$, Reynolds number $450$ 
%\textcolor{red}{(questo caso pero' è stato affrontato anche in \cite{San2012} e in \cite{San2014} ad esempio)} 
and ii) Rossby number $0.008$, Reynolds number  
$Re = 1000$. Most of the works on the double-gyre wind forcing benchmark consider
Rossby number $0.0016$ and Reynolds number $200$ \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014}, 
while flows at Rossby number $0.0036$, Reynolds number $450$ are studied in \cite{San2012,San2014}.
Our test case ii) features higher Rossby and Reynolds numbers than what studied in the literature
and is therefore more challenging.
%We consider a nonlinear variant of the BV-$\alpha$ model %the scales smaller than the alpha length scale are nonlinearly removed by motions at the larger scales.  %that is a regularization of the QGE model proposed in \cite that allows a significant
%reduction of degrees of freedom in simulations. 

The paper is organized as follows. In Sec.~\ref{sec:pbd}, we introduce the QGE and the BV-$\alpha$ models and the associated 
strategy for time and space discretization.
%Additionally, we show how to tune certain model parameters using physical and discretization quantities. 
Numerical results are reported in Sec.~\ref{sec:results}, while conclusions
and future perspectives are presented in Sec.~\ref{sec:conclusions}.


%natural approach. (essentially)
%dissipative techniques such as eddy viscosity parametrizations have been used to
%model the under-resolved scales of the flow.

%when long-time integration is required, as is the case in climate modeling.
%Thus, to further reduce the computational cost of the BVE, large eddy simulation (LES) appears to be a
%natural approach. In LES only the large spatial structures are approximated, whereas the small scales are
%modeled. This allows for much coarser spatial meshes and thus a computational cost that is significantly
%lower than that of a direct numerical simulation (DNS).


%\textcolor{red}{TO BE WRITTEN}

\section{Problem definition}
\label{sec:pbd}

\subsection{Quasi-Geostrophic Equations}
\label{sec:NS Equations}

%The \emph{quasi-geostrophic equations} (QGE), also known as the \emph{barotropic vorticity equations} (BVE), 
We consider the motion of a two-dimensional rotating 
%\anna{(Michele, e' importante sottolineare qui che il flusso e' rotante? Lo chiedo da ignorante di BVE)} \rev{(mmm forse si, giusto per enfatizzare la presenza del termine di Coriolis)}
homogeneous flow in a two-dimensional fixed domain $\Omega$ 
over a time interval of interest $(t_0, T)$. We assume that such flow can be modeled by the 
the quasi-geostrophic equations (QGE) in stream function-potential vorticity formulation, also known as the
barotropic vorticity equation (BVE).
In order to state the BVE, let $\hat{q} =  \hat{\omega} + \beta \hat{y}$ be the dimensional potential vorticity, where 
$\hat{\omega}$ is the dimensional vorticity,  $\hat{y}$ is the dimensional vertical coordinate, and $\beta$
is the gradient of the Coriolis parameter at the basin center. For convenience, we switch to 
non-dimensional variables by introducing a characteristic length $L$ and a characteristic velocity $U$. 
The non-dimensional potential vorticity $q$ is defined as:
\begin{align}
q = Ro~\omega + y, \quad  Ro = \frac{U}{\beta L^2}\label{eq:BV2}
\end{align}
where $\omega$ is the non-dimensional vorticity, $y$ is the non-dimentional vertical coordinate,
%\anna{(preferisco definire tutto perche' si possa capire meglio il signifcato fisico delle equazioni, ho messo questa definiziona
%ma non sono sicura che sia quella giusta, non riesco a trovarla in un paper)} \rev{(La formula dimensionale corretta e' $q = \omega + \beta y$ dove $\beta$ e' il parametro di Coriolis e $y$ e' la coordinata verticale. Il numero di Rossby che ne consegue e' definito come $Ro = U/(\beta L^2)$. Su un paper c'e' scritto "$\beta y$ measures the beta-plane effect from the
%Coriolis force due to rotation". Si puo' anche dire che "$\beta$ is the gradient of the Coriolis parameter at the basin center ($y = 0$)." Direi che abbiamo info a sufficienza :). Ti lascio libera di rielaborare come ritieni piu' chiaro! :) )}
%\anna{(Michele, ho cercato di aggiungere un po' di spiegazione avvalendomi di wikipedia. Per favore correggi se ho sbagliato)} \rev{(Direi che $y$ e' la coordinata laterale adimensionalizzata, forse non vale neanche la pena definirla, il parametro di Coriolis e' "nascosto" nella definizione di $Ro$)}, 
and $Ro$ is the Rossby number, which is the ratio of inertial force to Coriolis force. 
%\anna{Vogliamo dare la definizione o basta descriverlo a parole?} \rev{secondo me puo' andar bene anche a parole forse, come il numero di Reynolds, che ne pensi?}
The BVE in non-dimensional variables reads:
\begin{align}
\dt q+ \div \left(\left(\nabla \times \bm{\psi}\right) q \right) - \dfrac{1}{Re} \Delta q & = F \quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV1}
\end{align}
where $\partial_t$ denotes the time derivative, $Re$ is the Reynolds number (i.e., the ratio of inertial force to viscous force), 
$F$ denotes an external forcing, and $\bm{\psi} = (0, 0, \psi)$ with  $\psi$ being the stream function. 
The kinematic relationship between vorticity $\omega$ and the streamfunction $\psi$
yields the following Poisson equation
\begin{align}
\omega = - \Delta \psi \quad \mbox{ in }\Omega \times (t_0,T). \label{eq:BV3}
\end{align}
Using \eqref{eq:BV2}, eq.~\eqref{eq:BV3} can be rewritten in terms of $q$:
\begin{align}
q = -\text{Ro} \Delta \psi + y \quad \mbox{ in }\Omega \times (t_0,T).  \label{eq:BV4}
\end{align}

To close problem \eqref{eq:BV1}, \eqref{eq:BV4}, proper boundary conditions and initial data should be provided. 
Following \cite{Nadiga2001,Holm2003,Monteiro2015,Monteiro2014,San2012}, we enforce $\psi = \omega = 0$ 
on $\partial \Omega$ and set $\omega(x,y,t_0) = 0$, which in terms of $\psi$ and $q$ become 
\begin{align}
\psi &= 0 \quad \mbox{ on }\partial \Omega \times (t_0,T), \label{eq:BV5_comp} \\
q &= y \quad \mbox{ on }\partial \Omega \times (t_0,T), \label{eq:BV5_comp2} \\
q(x,y,t_0) &= y \quad \mbox{ in }\partial \Omega. \label{eq:BV5_comp3}
\end{align}

%q = y$. %:
%\begin{align*}
%\omega = \psi = 0 \quad \mbox{ on }\partial \Omega \times (t_0,T), %\label{eq:BV5}
%\end{align*}
%that in terms of $q$ could be expressed as $q = y$.

Summarizing, the barotropic vorticity problem
is given by eqs.~\eqref{eq:BV1}, \eqref{eq:BV4} endowed with boundary conditions \eqref{eq:BV5_comp}-\eqref{eq:BV5_comp2} 
and initial data \eqref{eq:BV5_comp3}.
%\begin{align}
%\dt q+ \div \left(\left(\nabla \times \bm{\psi}\right) q \right) - \dfrac{1}{\text{Re}} \Delta q &= F \quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV1_comp}\\
%-\text{Ro} \Delta \psi + y &= q \quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV2_comp}
%\end{align}
%endowed  with the boundary conditions
%\begin{align}
%\psi = 0 \quad \mbox{ on }\partial \Omega \times (t_0,T), \label{eq:BV5_comp} \\
%q = y \quad \mbox{ on }\partial \Omega \times (t_0,T), \label{eq:BV5_comp2} 
%\end{align}
%and initial data $q(x,y,t_0) = q_0$.

\subsection{The BV-$\alpha$ problem}
%The most relevant features in the framework of the Kraichnan-Batchelor-Leith two-dimensional turbulence theory is the existence of two quadratic invariant that are involved in a double cascade scenario: an inverse cascade of kinetic energy from small to larges scales and a direct cascade of enstrophy to small scales. For more details the reader is referred, e.g., to \cite{Kraichnan1967, Batchelor1969, Leith1971, Chen2003, Danilov2000, Tabeling2002, Chen2003, Vallis2006}. %The applicability of two-dimensional turbulence theory to geophysical flows has been widely discussed in \cite{Danilov2000, Tabeling2002}. 

Despite the fact that the QGE model is a toy problem describing the main features of geophysical flows
under certain simplifying assumptions, its Direct Numerical Simulation (DNS) is still hindered by a prohibitive 
computational cost. This is especially true in the case of climate simulations that require long time intervals
(of the order of centuries). 
%long-time simulations are required climate weather forecast. %allows to obtain accurate  for much coarser spatial meshes and thus a computational cost that is significantly
%lower than that of a direct numerical simulation (DNS). 
A DNS for the QGE model requires a mesh with mesh size smaller than the Munk scale:
\begin{align}
\delta_M = L \, \sqrt[3]{\dfrac{\text{Ro}}{\text{Re}}}. \label{eq:munk}
\end{align}
%where $L$ is a characteristic length of the problem. 
When the mesh size fails to resolve the Munk scale, the simulation provides a non-physical solution. 
A possible remedy is to introduce a model for the small (unresolved) scales in order to recover the physical solution
while resolving only the large spatial scales and so containing the computational cost. 


%To achieve the same order of physical accuracy as
%DNS, however, LES needs to correctly treat the closure problem 

%As the Reynolds number increases, DNS leads to a huge number
%85
%of unknowns and prohibitive computational costs. On the other hand, when
%the mesh size h fails to resolve the Kolmogorov scale, the under-diffusion in
%the simulation leads to nonphysical computed velocities. In some cases, this
%is detectable simply looking at the velocity field, which features nonphysical
%oscillations eventually leading to a simulation break down. However, in some
%90
%cases the velocity field does not display oscillations, yet it does not correspond
%to the physical solution. A possible remedy to this issue is to introduce a model
%which filters the nonphysical oscillations in the velocity field and conveys the
%energy lost to resolved scales.




%Despite the fact that the BVE models
%are a simplified version of the full-fledged equations of geophysical flows, their numerical simulation is still
%computationally challenging when long-time integration is required, as is the case in climate modeling.
%Thus, to further reduce the computational cost of the BVE, large eddy simulation (LES) appears to be a
%natural approach. In LES only the large spatial structures are approximated, whereas the small scales are
%modeled. This allows for much coarser spatial meshes and thus a computational cost that is significantly
%lower than that of a direct numerical simulation (DNS). To achieve the same order of physical accuracy as
%DNS, however, LES needs to correctly treat the closure problem (

%Two-dimensional turbulence is a fundamental topic for understanding of geophysical flows and behaves
%in a profoundly different way from the three-dimensional turbulence due to different energy cascade behavior
%(Kraichnan, 1967; Batchelor, 1969; Leith, 1971), which is described in the Kraichnan-Batchelor-Leith twodimensional turbulence theory. In three-dimensional turbulence, energy is transferred forward, from large
%scales to smaller scales, via vortex stretching. In two dimensions that mechanism is absent, and under most
%forcing and dissipation conditions energy is transferred from smaller scales to larger scales, largely because of
%the potential enstrophy, a quadratic invariant defined as the integral of the square of the potential vorticity.

In this paper, we propose a nonlinear variant of the so-called \emph{BV-$\alpha$ model} \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014} that couples the BVE model with a differential filter. Such model reads:

\begin{align}%\label{eq:leray}
\dt q+ \div \left(\left(\nabla \times \bm{\psi}\right) q \right) - \dfrac{1}{\text{Re}} \Delta q &= F \quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV1_comp11}\\
-\alpha^2\div \left(a(q) \nabla\overline{q}\right) +\overline{q} &= q  \quad {\rm in}~\Omega \times
(t_0,T), \label{eq:BV2_comp33} \\
-\text{Ro} \Delta \psi + y &= \overline{q} \quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV2_comp22}
\end{align}
where $\overline{q}$ is the \emph{filtered vorticity}, $\alpha$ can be interpreted as the \emph{filtering radius} 
%(that is, the radius of the neighborhood where the filter extracts information from the unresolved scales) 
and $a(\cdot)$ is a scalar function such that:
\begin{align*}
a(q)\simeq 0 & \mbox{ where the flow field does not need regularization;}\\
a(q)\simeq 1 & \mbox{ where the flow field does need regularization.}
\end{align*}
%The choice of this function, called \emph{indicator function}, will be discussed in Sec.~\ref{sec:indicator}
By setting $a(q)\equiv 1$ in  \eqref{eq:BV1_comp11}-\eqref{eq:BV2_comp22} we retrieve
the classical BV-$\alpha$ model \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014}. 
%Thus, in the following we will refer to eq.~\eqref{eq:filter-ns1}-\eqref{eq:filter-mass} with $a(\u) = 1$ everywhere in 
%$\Omega$ as Leray-$\alpha$ model.
This model has the advantage of making the operator in the filter equations linear and constant in time, 
but we will show that its effectivity is rather limited when very coarse meshes are considered. %since it introduces the same amount of regularization everywhere in the domain, hence causing overdiffusion.


%\subsection{The indicator function}
Function $a$ is called \emph{indicator function} and it plays a key role in the success of the differential filter.
Taking inspiration from the large body of work on the Leray-$\alpha$ model \cite{Borggaard2009,layton_CMAME,O-hunt1988,Vreman2004,Bowers2012}, 
we propose the following indicator function:
\begin{equation}
a(q) = \dfrac{|\nabla q|}{\text{max}\left(1, ||\nabla q||_\infty\right)}. \label{eq:ind_func}
\end{equation}
Function \eqref{eq:ind_func} is mathematically convenient because of its strong monotonicity properties. 

%It was noted in \cite{BQV} that the Van Cittert-Helmholtz deconvolution operator $D_N$ can be conveniently interpreted in a different manner. 
%Following the theory of maximal monotone operators and their Yosida regularized operator (see \cite{B-brezis}, Ch. 7), 
%$F_H$ is the  resolvent $J_{\alpha^2}$ of operator $\mathcal{L} = -\Delta$. Correspondingly, the Yosida 
%approximation of $\mathcal{L}$ reads
%$$
%\regY  \equiv \alpha^{-2} \left(I - J_{\alpha^2} \right) =  \alpha^{-2} \left(I - F_H \right).
%$$
%It follows that
%\begin{equation}
%a_{D_N}(\v) = \alpha^{2N+2} \left|  \regY^{N+1} \v \right|.\label{eq:a_D_N_regY}
%\end{equation}

We will refer to eq.~\eqref{eq:BV1_comp11}-\eqref{eq:BV2_comp22} with indicator function given by 
\eqref{eq:ind_func} as the nonlinear BV-$\alpha$ (or BV-$\alpha$-NL) model.

\subsection{Time and space discretization}
\label{subsec:time-discrete}

Let us start with the time discretization of problem (\ref{eq:BV1_comp11})-(\ref{eq:BV2_comp22}). 
Let $\Delta t \in \mathbb{R}$, $t^n = t_0 + n \Delta t$, with $n = 0, ..., N_T$ and $T = t_0 + N_T \Delta t$. We denote by $f^n$ the approximation of a generic quantity $f$ at the time $t^n$. %In the following we will denote by $\Omega$ the domain of the equations.
To discretize the time derivative in \eqref{eq:BV1_comp11}
we adopt the Backward Differentiation Formula of order 1: given $q^0$, for $n \geq 0$ find the solution $(q^{n+1}, \psi^{n+1},\qbar^{n+1})$ of system: %\textcolor{red}{riscrivere il sistema di cui sotto..}:
\begin{align}
%\rho\, \frac{3}{2\Delta t}\, \u^{n+1} + \rho\, \div \left(\ubar^{n+1} \otimes \u^{n+1}\right) - 2\mu\Delta\u^{n+1} +\nabla p^{n+1} & = \b^{n+1},\label{eq:disc_filter_ns-1}\\
\dfrac{1}{\Delta t} q^{n+1} + \div \left(\left(\nabla \times \bm{\psi}^{n+1}\right) q^{n+1} \right) - \dfrac{1}{Re} \Delta q^{n+1} = b^{n+1}, \label{eq:BV1_comp11_timedisc} \\ %\quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV1_comp11} \\
-\alpha^2\div \left(a^{n+1} \nabla\overline{q}^{n+1}\right) + \overline{q}^{n+1} = q^{n+1}, \label{eq:BV2_comp33_timedisc} \\
-Ro~\Delta \psi^{n+1} + y = \overline{q}^{n+1}, \label{eq:BV2_comp22_timedisc}
\end{align}
where $a^{n+1}  = a(q^{n+1} )$ and $b^{n+1} = F^{n+1} + q^n/\Delta t$. 
%Obviously, other discretization schemes are possible \textcolor{red}{(Facciamo riferimento al paper di Leo??)}. However, for clarity of exposition we will restrict the description of the approach to the case of BDF1.
%In order to contain the computational cost required to approximatethe solution to problem (8)-(9), we opt for a segregated algorithm.  Given the vorticityωn, attn+1such algorithms requires to:

In order to contain the computational cost, we opt for a segregated algorithm to solve coupled problem 
(\ref{eq:BV1_comp11_timedisc})-(\ref{eq:BV2_comp22_timedisc}). A possible algorithm is as follows:
given $q^n$ and $\bm{\psi}^n$, at $t^{n+1}$ perform the following steps
 \begin{itemize}
 \item[i)] Find the vorticity $q^{n+1}$ such that
 \begin{align}
\dfrac{1}{\Delta t} q^{n+1} + \div \left(\left(\nabla \times \bm{\psi}^n \right) q^{n+1} \right) - \dfrac{1}{\text{Re}} \Delta q^{n+1} = b^{n+1}, \label{eq:BV1_comp11_timedisc_bis} %\quad \mbox{ in }\Omega \times (t_0,T), \label{eq:BV1_comp11} \\
     \end{align}
where we have replaced $\bm{\psi}^{n+1}$ in \eqref{eq:BV1_comp11_timedisc} by $\bm{\psi}^n$, i.e.~a linear extrapolation. 
 \item[ii)] Find the filtered vorticity $\overline{q}^{n+1}$ such that
  \begin{align}
 -\alpha^2\div \left(a^{n+1} \nabla\overline{q}^{n+1}\right) + \overline{q}^{n+1} = q^{n+1}. \label{eq:BV2_comp33_timedisc_bis} 
 \end{align}
 \item[iii)] Find the stream function $\psi^{n+1}$ such that
 \begin{align}
 -\text{Ro} \Delta \psi^{n+1} + y = \overline{q}^{n+1}. \label{eq:BV2_comp22_timedisc_bis}
 \end{align}
 \end{itemize}
 
For the space discretization of problem (\ref{eq:BV1_comp11_timedisc_bis})-(\ref{eq:BV2_comp22_timedisc_bis}), 
we partition the computational domain $\Omega$ into cells or control volumes $\Omega_i$,
with $i = 1, \dots, N_{c}$, where $N_{c}$ is the total number of cells in the mesh. 
We adopt a Finite Volume (FV) approximation that is derived directly from the integral form of the governing equations. 

The integral form of eq. \eqref{eq:BV1_comp11_timedisc_bis} for each volume $\Omega_i$ is given by:
\begin{align}%\label{eq:zetaFV}
\frac{1}{\Delta t}\, \int_{\Omega_i} q^{n+1} d\Omega &+ \int_{\Omega_i} \div \left(\left(\nabla \times \bm{\psi}^{n}\right) q^{n+1}\right)  d\Omega \cl
&- \dfrac{1}{Re} \int_{\Omega_i} \Delta q^{n+1} d\Omega 
= \int_{\Omega_i}b^{n+1} d\Omega. \el
\end{align}
By applying the Gauss-divergence theorem, the above equation becomes:
\begin{align}\label{eq:zetFV2}
\frac{1}{\Delta t}\, \int_{\Omega_i} q^{n+1} d\Omega &+  \int_{\partial \Omega_i} \left(\left(\nabla \times \bm{\psi}^{n}\right) q^{n+1}\right) \cdot d\textbf{A} \cl
&- \dfrac{1}{Re}\int_{\partial \Omega_i} \nabla q^{n+1} \cdot d\textbf{A}  = \int_{\Omega_i}b^{n+1} d\Omega, 
\end{align}
where $\textbf{A}$ is the surface vector associated with the boundary 
of $\Omega_i$.
Then, the discretized form of eq.~\eqref{eq:zetFV2}, divided by the control volume 
$\Omega_i$, can be written as:
\begin{align}
\frac{1}{\Delta t}\, q^{n+1}_i &+ \sum_j^{} \varphi^n_j q^{n+1}_{i,j} - \dfrac{1}{Re} \sum_j^{} (\nabla q^{n+1}_i)_j \cdot \textbf{A}_j  = b^{n+1}_i, \label{eq:QGE1}
\end{align}
where $\textbf{A}_j$ is the surface vector of the $j$-th face of the control volume and
$\varphi^n_j = \left(\nabla \times \bm{\psi}_j^{n}\right) \cdot \textbf{A}_j$. 
In \eqref{eq:QGE1}, $q^{n+1}_i$ and $b^{n+1}_i$ denote the average potential vorticity
and discrete source term in control volume $\Omega_i$, while $q^{n+1}_{i,j}$
represents the potential vorticity associated to the centroid of face $j$ normalized by the volume of $\Omega_i$. 
For more details about on the treatment of the convective and diffusive terms, 
the reader is referred to \cite{Girfoglio2019, GirfoglioPSIZETA}

We deal with the space approximations of eq.~\eqref{eq:BV2_comp33_timedisc_bis} and \eqref{eq:BV2_comp22_timedisc_bis}  
in an analogous way and obtain:
\begin{align}%\label{eq:psiFV33}
-\alpha^2 \sum_j a_j^{n+1} \left(\nabla\overline{q}_i^{n+1}\right)_j \cdot \textbf{A}_j + \overline{q}_i^{n+1} = q_i^{n+1}, \label{eq:QGE2}\\
  - Ro \sum_j \left(\nabla\psi_i^{n+1}\right)_j \cdot \textbf{A}_j + y_i = \overline{q}_i^{n+1} \label{eq:QGE3},
\end{align}
%Once we approximate the integrals and divide by the control volume $\Omega_i$,
%eq.~\eqref{eq:psiFV} becomes:
%\begin{align}\label{eq:psiFV2}
%-\sum_j^{} (\nabla\psi^{n+1}_i)_j \cdot \textbf{A}_j  =\omega^{n+1}_i.
%\end{align}
respectively.

%In eq. \eqref{eq:psiFV2}, $(\nabla\psi^{n+1}_i)_j$ is the gradient of $\psi^{n+1}$ at faces $j$ and it is approximated in the same way as $(\nabla\omega^{n+1}_i)_j$.
In summary, the fully discretized form of problem  (\ref{eq:BV1_comp11})-(\ref{eq:BV2_comp22}) is given by system \eqref{eq:QGE1}-\eqref{eq:QGE3}.
For the implementation of the numerical scheme described in this section, we chose the FV C++ library OpenFOAM\textsuperscript{\textregistered} \cite{Weller1998}.


\section{Numerical results} \label{sec:results}

\begin{comment}
LISTA RISULTATI DA METTERE:
\begin{itemize}
\item Ro = 0.0036, Re = 450
\begin{itemize}
\item QGE su 256x512, QGE su 16x32 (da confrontare con Traian), QGE su 4x8, BV L su 4x8 e BV NL su 4x8
\item Energia cinetica su tutti i casi di cui sopra
\item funzione indicatrice media su BV NL 4x8
\end{itemize}
\begin{itemize}
\item QGE su 256x512, QGE su 16x32, QGE su 4x8, BV L su 16x32, BV L su 4x8, BV NL su 16x32, BV NL su 4x8
\item Energia cinetica su tutti i casi di cui sopra
\item funzione indicatrice media su BV NL 16x32 e su BV NL 4x8	
%\item 
\end{itemize}

\end{itemize}
\end{comment}



This section presents several numerical results for the QGE (i.e., no turbulence model), BV-$\alpha$, and BV-NL-$\alpha$ models. 
We consider a benchmark test that has been widely used to analyze new techniques for turbulence in geophysical flows:
the double-gyre wind forcing experiment  \cite{Nadiga2001, Holm2003, Greathbatch2000, San2011, Monteiro2015, Monteiro2014}. 

The computational domain is rectangle $[0,1] \times [-1,1]$ and the forcing is prescribed by setting $F =\sin(\pi y)$. 
We consider two different cases:  
\begin{itemize}
\item[-] Case 1: $Ro = 0.0036$ and $Re = 450$;
\item[-] Case 2: $Ro = 0.008$ and $Re = 1000$. 
\end{itemize}
The BV-$\alpha$ model has been successfully tested for $Ro = 0.0016$ and $Re = 200$ \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014}. 
%\textcolor{red}{(Anna come ricorderai ti dissi che in \cite{San2011} si lascia intendere che in \cite{Holm2003} sia stata analizzato anche il set-up relativo all'exp (i), io pero' non ho trovato riscontro! Se vuoi dare anche tu un'occhiata a quel paper per sicurezza ulteriore fai pure! :)}. \anna{Ho controllato, sembra anche a me che si limitino a $Ro = 0.0016$.} \rev{(Perfetto, allora non dovrebbero esserci dubbi :) )}
We selected higher Rossby and Reynolds numbers because they are more challenging. We chose Case 1 because
it has been studied in \cite{San2011} with an Approximate Deconvolution model discretized with 
a Finite Element (FE) method.
However, to the best of our knowledge it is the first time that larger values of $Ro$ and $Re$ as in Case 2 are considered. 
%The reason why we chose these cases is that at the best of our knowledge the BV-$\alpha$ model has been successfull tested only up to $Ro = 0.0016$ and $Re = 200$ \cite{Nadiga2001, Holm2003, Monteiro2015, Monteiro2014}. % for this case, at the best of our knowledge, it has not been yet investigated with the BV-$\alpha$ model. SCRIVERE QUALCOSA DI PIU'
Although the Munk scale is the same for both cases ($\delta_M/L = 0.02$), we will show that Case 2 is more critical. 
This is in line with what observed in \cite{San2011}: the simulation of a flow with higher values of $Ro$ and $Re$ 
becomes unphysical with finer meshes than the simulation of a flow with lower values of $Ro$ and $Re$ 
and equal Munk scale.
%\rev{(qui si potrebbe far notare che il risultato e' in linea con quanto visto da . Loro mostrano che il caso $Ro = 0.0016$ and $Re = 200$ e' meno critico del Case 1 che trattiamo anche noi, nonostante abbiano cmq la stessa scala di Munk. Sembrerebbe quindi che piu' uno si spinge in avanti con $Ro$ e $Re$ e piu' le cose vanno peggio, nonostante si lavori a parita' di Munk scale)}
In order to validate our approach, we proceed as follows. First, we perform a QGE simulation with 
the high resolution mesh $256 \times 512$ \cite{San2011, San2014}, which has a mesh size ($h = 1/256$) 
almost 20 times smaller than the Munk scale. Then, we run experiments on two coarse meshes, 
$16 \times 32$ ($h = 1/16$) and $4 \times 8$ ($h = 1/4$), with the QGE, BV-$\alpha$, and BV-NL-$\alpha$ models and 
compare the results with the high resolution QGE solution. %a DNS computation on a fine mesh
%we run a high resolution (i.e. by using a mesh with spacing lower than
%the Munk scale) simulation with the QGE model. Then we run several experiments on coarse meshes with QGE, BV-$\alpha$, and BV-NL-$\alpha$ models and compare them with the high resolution QGE solution.
%We consider orthogonal Cartesian meshes of different resolutions with $h = 1/256$ (corresponding to a grid with $256 \times 512$ squares), $h = 1/16$ ($16 \times 32$) and $h = 1/4$ ($4 \times 8$) where $h$ is the mesh size. 
We run all the simulations from $t_0 = 0$ to $T = 100$, with time step $\Delta t = 2.5e-5$ \cite{San2014}
%\anna{(usiamo questo time step per tutte le simulazioni o solo per quella piu' fine?)} 
For all the simulations performed with the BV-$\alpha$ and BV-NL-$\alpha$ models, we  
set $\alpha = h$ following \cite{Holm2003}.

The quantities of interest for this benchmark are the time-averaged stream function $\widetilde{\psi}$
and the time-averaged potential vorticity $\widetilde{q}$ over time interval $[20,100]$, and 
the kinetic energy of the system $E$:
\begin{equation}
E = \dfrac{1}{2}\int_\Omega  \left( \left(\dfrac{\partial \psi}{\partial y}\right)^2 + \left(\dfrac{\partial \psi}{\partial x}\right)^2 \right)d\Omega.
\end{equation}\label{eq:kin_energy}
%. %$rom t = 20 until 100 as in [22]. For
%the double gyre wind forcing experiment we considered two interesting cases: i)δM/L = 0.02 and Ro = 0.0016 (which is presented in [22]) and ii) δM/L = 0.01 and
%Ro = 0.0002.
When we use the BV-NL-$\alpha$ model,
we will also compute the time-averaged indicator function $\widetilde{a}$ over time interval $[20,100]$.
%\anna{(hai usato lo stesso intervallo, giusto?)} \rev{(yes, ho mediato sempre tra 20 e 100!)} 


\subsection{Case 1}

In this section, we present the numerical results for Case 1. 
We report in  Fig.~\ref{fig:psi_first} (a) and \ref{fig:q_first} (a) the time-averaged stream function 
$\widetilde{\psi}$ and potential vorticity $\widetilde{q}$ computed with the QGE model
and high resolution mesh $256 \times 512$.
The time evolution of the kinetic energy $E$ is reported with a black line in Fig.~\ref{fig:Ek_a_first}.
We observe that our solution %\anna{(inclusa l'energia cinetica o solo i plot delle variabili?)}
is in very good agreement with the solution in \cite{San2011, San2014}, which was computed
with a FE method. %has been used, so a DNS is possible with mesh $128 \times 256$. This result is expected because for this mesh we have $h < \delta_M$. 
Hereinafter, we will refer to the solution computed with the QGE model on mesh $256 \times 512$ as the \emph{true} solution.%and we will refer to meshes 200k P and 200k H as DNS meshes.

\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_QGE_256x512_i_exp}
         \caption{\scriptsize{QGE, $256\times512$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_QGE_16x32_i_exp}
         \caption{\scriptsize{QGE, $16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_QGE_4x8_i_exp}
         \caption{\scriptsize{QGE, $4 \times 8$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_BV_4x8_i_exp.png}
         \caption{\scriptsize{BV-$\alpha$, $4 \times 8$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_BV_NL_4x8_i_exp.png}
         \caption{\scriptsize{BV-NL-$\alpha$, $4 \times 8$}}
     \end{subfigure}
\caption{Case 1: $\widetilde{\psi}$ computed with different models and different meshes. 
The specific model and mesh for each panel is reported in the corresponding subcaption.}
\label{fig:psi_first}
\end{figure}


%\begin{figure}
%\centering
%\begin{overpic}[width=0.19\textwidth]{img/psi_QGE_256x512_i_exp}
%        %\put(40,40){FOM}
%        \put(25,105){\small{a)}}
%      \end{overpic}
%\begin{overpic}[width=0.19\textwidth]{img/psi_QGE_16x32_i_exp}
%        %\put(40,40){FOM}
%        \put(25,105){\small{b)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_QGE_4x8_i_exp.png}
%        \put(25,105){\small{c)}}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_BV_4x8_i_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{d)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_BV_NL_4x8_i_exp.png}
%        \put(25,105){\small{e)}}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%\caption{Experiment (i): $\widetilde{\psi}$ computed by a) QGE with mesh $256 \times 512$, b) QGE with mesh $16 \times 32$, c) QGE with mesh $4 \times 8$, d) BV-$\alpha$ with mesh $4 \times 8$, and e) BV-NL-$\alpha$ with mesh $4 \times 8$.}
%\label{fig:psi_first}
%\end{figure}

\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_QGE_256x512_i_exp}
         \caption{\scriptsize{QGE, $256\times512$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_QGE_16x32_i_exp}
         \caption{\scriptsize{QGE, $16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_QGE_4x8_i_exp.png}
         \caption{\scriptsize{QGE, $4 \times 8$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_BV_4x8_i_exp.png}
         \caption{\scriptsize{BV-$\alpha$, $4 \times 8$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_BV_NL_4x8_i_exp.png}
         \caption{\scriptsize{BV-NL-$\alpha$, $4 \times 8$}}
     \end{subfigure}
\caption{Case 1:  $\widetilde{q}$ computed with different models and different meshes. 
The specific model and mesh for each panel is reported in the corresponding subcaption.
%\anna{Ho notato che qui la color bar e' la stessa per tutte le figure, mentre nella foto precedente non lo e'. 
%E' una forzatura o per $\widetilde{q}$ non ci sono overshoot/undershoot com per $\widetilde{\psi}$?}
}
\label{fig:q_first}
\end{figure}

%\begin{figure}
%\centering
%\begin{overpic}[width=0.19\textwidth]{img/q_QGE_256x512_i_exp}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{a)}}
%      \end{overpic}
%\begin{overpic}[width=0.19\textwidth]{img/q_QGE_16x32_i_exp}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}b
%        \put(25,105){\small{b)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_QGE_4x8_i_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{c)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_BV_4x8_i_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{d)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_BV_NL_4x8_i_exp.png}
%        %\put(40,40){FOM}
%        \put(25,105){\small{e)}}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%\caption{Experiment (i): $\widetilde{q}$ computed by a) QGE with mesh $256 \times 512$, b) QGE with mesh $16 \times 32$, c) QGE with mesh $4 \times 8$, d) BV-$\alpha$ with mesh $4 \times 8$, and e) BV-NL-$\alpha$ with mesh $4 \times 8$.}
%\label{fig:q_first}
%\end{figure}

\begin{figure}[htb!]
\centering
 \begin{overpic}[width=0.48\textwidth]{img/E_QGE_exp_1.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
        %\put(25,105){\small{a)}}
      \end{overpic}
 \begin{overpic}[width=0.48\textwidth]{img/E_QGE_exp_1_zoom.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
        %\put(25,105){\small{b)}}
      \end{overpic}\\
 \begin{overpic}[width=0.48\textwidth]{img/E_BV_exp_1.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
        %\put(25,105){\small{a)}}
      \end{overpic}
 \begin{overpic}[width=0.49\textwidth]{img/E_BV_exp_1_zoom.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
        %\put(25,105){\small{b)}}
      \end{overpic}
\caption{Case 1: time evolution of the kinetic energy \eqref{eq:kin_energy}
computed by the QGE model with all the meshes (top, left) and
corresponding zoomed-in view (top, right);  time evolution of the kinetic energy \eqref{eq:kin_energy}
computed by the QGE model on the finest, BV-$\alpha$ and BV-NL-$\alpha$ on the coarsest mesh
(bottom, left) and corresponding zoomed-in view (bottom, right).
%. \textcolor{red}{In un primo momento ho pensato di evitare di mettere l'energia su mesh 16 $\times$ 32 con QGE ma forse, per completezza, la metterei, ti pare Anna? Nella figura di sx. Il commento sarà semplice, e cioe' che cosi' come la psi e la q anche l'energia è molto vicina alla true solution} \anna{Sono d'accordo} \rev{Bene! Allora provvedo quanto prima! :)} 
%\anna{Stavo pensando, riusciamo a mettere uno zoom-in di questa figura? Siccome l'intervallo di tempo e' lungo, e' difficile confrontare bene le oscillazioni.} \rev{fatto!}
}
%given by a) QGE with mesh $256 \times 512$ (black curve) and with mesh $4 \times 8$ (blue curve), and given by b) QGE with mesh $256 \times 512$ (black curve), BV-$\alpha$ with mesh $4 \times 8$ and BV-NL-$\alpha$ with mesh $4 \times 8$.}
\label{fig:Ek_a_first}
\end{figure}

%ields accurate results that are close to the DNS results

In \cite{San2011}, it is shown that the time-averaged stream function given by the QGE model
and computed by a FE method with the mesh $16 \times 32$ (i.e., with a mesh size about 3 times bigger than the Munk scale) 
incorrectly exhibits just two gyres instead of the four gyres seen in Fig.~\ref{fig:psi_first} (a). 
However, we observe that the QGE model approximated with our 
FV method works quite well even with mesh $16 \times 32$: it captures the four gyre pattern and the magnitude is mostly close to 
that of the true solution although some overshoots are seen. Compare Fig.~\ref{fig:psi_first} (b) and (a). 
The time-averaged potential vorticity computed with mesh $16 \times 32$ is also in good agreement
with the true $\widetilde{q}$: compare Fig.~\ref{fig:q_first} (b) and (a). For this quantity, the magnitudes
are even closer and no overshoot is observed. 
A possible reason for the better performance of our FV method with respect to a FE method could be the following:
it yields exact conservation and thus provides acceptable results despite using a
mesh with a mesh size larger than the Munk scale.
%\textcolor{red}{(Credo sia un'argomentazione ragionevole, che ne pensi Anna? Poi se vuoi ci sentiamo un attimo e ti descrivo un dettaglio che qui non ho riportato, ho preferito lasciare la cosa il più di ampio respiro possibile)}. 
%\anna{Si', sono d'accordo che e' una buona spiegazione. Ci possiamo sentire quando vuoi.}

We had to push the coarseness of the mesh to $4 \times 8$ to see that the solution provided by the QGE model 
fails to show the four gyre pattern. See Fig.~\ref{fig:psi_first} (c). Notice how the maximum and minimum values of
$\widetilde{\psi}$ computed mesh $4 \times 8$ are both larger (in absolute value) than the true values. 
Similarly, the $\widetilde{q}$ computed with mesh $4 \times 8$ is not close to the true solution (see Fig.~\ref{fig:q_first} (c))
and the kinetic energy is off (see Fig.~\ref{fig:Ek_a_first}, top panels). In particular, the kinetic energy computed with mesh 
$4 \times 8$ reaches higher values for most of the time interval. 
These poor results are to be expected, since the size of mesh $4 \times 8$ is over 12 times bigger than the Munk scale. 
If we use the BV-$\alpha$ model to represent the unsolved scales with the same mesh, we observe
a slight improvement in the time-averaged potential vorticity. See Figure \ref{fig:q_first} (d). However, 
the time-averaged stream function still exhibits an incorrect pattern and its magnitude is significantly underestimated 
as shown in Figure \ref{fig:psi_first} (d). In addition, the bottom panels of Fig.~\ref{fig:Ek_a_first} show that 
the kinetic energy given by the BV-$\alpha$ model is much smaller than the true kinetic energy
over the entire time interval of interest and the frequency is off.
The BV-NL-$\alpha$ model represents an improvement over the BV-$\alpha$ model
since it is able to recover the four-gyre pattern of the time-averaged stream function (see Fig.~\ref{fig:psi_first} (e))
and it provides an average kinetic energy comparable with the true one (see Fig.~\ref{fig:Ek_a_first}, bottom panels). 
However, the magnitude of the time-averaged stream function is much smaller than it should be, as it is expected
when using a filter with such a coarse mesh, and the time-averaged vorticity is indistinguishable from the
one computed by the BV-$\alpha$ model. 

%In conclusion, we learned that, for Experiment (i) the BV-NL-$\alpha$ model provides the best results and is the only oand on a coarse mesh.  %In conclusion, we learned that the BV-NL-$\alpha$ model is to be preferred to the BV-$\alpha$ model.

\subsection{Case 2}

Let us now turn to Case 2.
Once again we start with the QGE model and mesh $256 \times 512$. 
Fig.~\ref{fig:psi_second_QGE} (a) and \ref{fig:q_second_QGE} (a)
display the time-averaged stream function $\widetilde{\psi}$ and potential vorticity $\widetilde{q}$, 
respectively. We will refer to this solution as the \emph{true} solution.
The corresponding  kinetic energy $E$ \eqref{eq:kin_energy} is shown in Fig.~\ref{fig:Ek_a_second_QGE} 
with a black line. 


\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_QGE_256x512_ii_exp.png}
         \caption{\scriptsize{$256\times512$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_QGE_16x32_ii_exp.png}
         \caption{\scriptsize{$16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_QGE_4x8_ii_exp.png}
         \caption{\scriptsize{$4 \times 8$}}
     \end{subfigure}
\caption{Case 2:  $\widetilde{\psi}$ computed by the QGE model with different meshes.}
\label{fig:psi_second_QGE}
\end{figure}

\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_QGE_256x512_ii_exp.png}
         \caption{\scriptsize{$256\times512$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_QGE_16x32_ii_exp.png}
         \caption{\scriptsize{$16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_QGE_4x8_ii_exp.png}
         \caption{\scriptsize{$4 \times 8$}}
     \end{subfigure}
\caption{Case 2:  $\widetilde{q}$ computed by the QGE model with different meshes.}
\label{fig:q_second_QGE}
\end{figure}

\begin{figure}
\centering
 \begin{overpic}[width=0.48\textwidth]{img/E_QGE_exp_2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
      \end{overpic}
\caption{Case 2: time evolution of the kinetic energy \eqref{eq:kin_energy}
computed by the QGE model with different meshes.}
\label{fig:Ek_a_second_QGE}
\end{figure}

Next, we stick to the QGE model but consider coarser meshes. 
We notice that while in Case 1 the QGE model with mesh $16 \times 32$
provided a physical solution, that is it no more true for Case 2. In fact, by comparing
Fig.~\ref{fig:psi_second_QGE} (b) with Fig.~\ref{fig:psi_second_QGE} (a) 
we see that the time-averaged stream function computed with mesh $16 \times 32$
exhibits an incorrect two gyre pattern and a magnitude almost 70 times larger than the true solution. 
Similarly, the time-averaged potential vorticity shows a different pattern and a much larger magnitude.
Compare Fig.~\ref{fig:q_second_QGE} (b) and (a). In addition, from Fig.~\ref{fig:Ek_a_second_QGE}
we see that the kinetic energy computed with mesh $16 \times 32$ is not oscillatory 
and takes values much larger (up to about two orders of magnitude) than the true kinetic energy.
Poorer results are obtained with mesh $4 \times 8$. 
See Fig.~\ref{fig:psi_second_QGE} (c), \ref{fig:q_second_QGE} (c), and \ref{fig:Ek_a_second_QGE}.


Fig.~\ref{fig:BV_second_filter} shows $\widetilde{\psi}$ and $\widetilde{q}$ computed with the BV-$\alpha$ model
and meshes $16 \times 32$ and  $4 \times 8$.
We observe no improvement over the QGE model with either mesh. 
This is confirmed by the computed kinetic energy reported in Fig.~\ref{fig:Ek_a_second_BVa}.
The solution computed with  the BV-NL-$\alpha$ model and mesh $16 \times 32$ is
shown in Fig.~\ref{fig:BV_NL_second_filter} (a) and (b). It 
does represent a significant improvement: 
the computed $\widetilde{\psi}$ and $\widetilde{q}$  are in very good agreement with the exact solution
both in terms of pattern and magnitude. 
The kinetic energy computed with  the BV-NL-$\alpha$ model and mesh $16 \times 32$ is also in good agreement
with the exact kinetic energy. In fact, Fig.~\ref{fig:Ek_a_second_BVNLa} shows that the amplitudes and frequencies
of oscillation are comparable, although the phases are off. The accurate solution
computed by the BV-NL-$\alpha$ model comes at a fraction of the computational time required
by the exact solution: the total CPU time required by the QGE simulation with mesh $256 \times 512$ is about 95 hours, 
while the BV-NL-$\alpha$ model with mesh $16 \times 32$ takes about 1 hour. %The resulting speed-up is about 95. 
Even with the coarsest mesh under consideration (mesh $4 \times 8$) the BV-NL-$\alpha$ model captures
the solution pattern better than the QGE and BV-$\alpha$ models, although the magnitude of $\widetilde{\psi}$ is reduced
by the nonlinear filter. The average kinetic energy computed with the BV-NL-$\alpha$ model and mesh
$4 \times 8$ is also in good agreement with the true average kinetic energy. See Fig.~\ref{fig:Ek_a_second_BVNLa}.
%\anna{Vediamo se possiamo aggiungere qualcosa quando abbiamo il zoom-in 
%per la Fig.~\ref{fig:Ek_a_second_BVNLa}.} \textcolor{red}{inserita! :)}

%No model is able to recover the proper magnitude of the stream function. %pattern is still very far the \emph{true} one  whilst as for the stream function...  % However, we underline that we obtain a  
  %  such a discrepancy could be the preservation of the essential
%conservative quantities between finite element and finite volume results could be due to the better the different treatment of the convective term of the barotropic vorticity equation. % and \ref{fig:q_first} (b) report the time-averaged stream function $\widetilde{\psi}$ and potential vorticity $\widetilde{q}$ given by QGE model with mesh $16 \times 32$, respectively. %We see that the solution is in very good agreement with that reported in \cite{San2012} \textcolor{red}{mettere piu' references} where a Finite Element method has been used. %has been used, so a DNS is possible with mesh $128 \times 256$. This result is expected because for this mesh we have $h < \delta_M$. 
%Hereinafter, we will refer to the solution computed with the QGE model on mesh $256 \times 512$ as the \emph{true} solution.




%\begin{figure}
%\centering
%      \begin{overpic}[width=0.19\textwidth]{img/psi_QGE_256x512_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{a)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_QGE_16x32_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{b)}}
%      \end{overpic}
%      %\begin{overpic}[width=0.19\textwidth]{img/psi_QGE_8x16_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      %\end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_QGE_4x8_ii_exp.png}
%        \put(25,105){\small{c)}}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%\caption{Experiment (ii), QGE model: a) $\widetilde{\psi}$ with mesh $256 \times 512$, b) with mesh $16 \times 32$, and c) with mesh $4 \times 8$.}
%\label{fig:psi_second_QGE}
%\end{figure}

%\begin{figure}
%\centering
%      \begin{overpic}[width=0.19\textwidth]{img/q_QGE_256x512_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{a)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_QGE_16x32_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{b)}}
%      \end{overpic}
%      %\begin{overpic}[width=0.19\textwidth]{img/q_QGE_8x16_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      %\end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_QGE_4x8_ii_exp.png}
%        \put(25,105){\small{c)}}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%\caption{Experiment (ii), QGE model: a) $\widetilde{q}$ with mesh $256 \times 512$, b) with mesh $16 \times 32$, and c) with mesh $4 \times 8$.}
%\label{fig:q_second_QGE}
%\end{figure}


\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_BV_16x32_ii_exp.png}
         \caption{\scriptsize{$\widetilde{\psi}$, $16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_BV_16x32_ii_exp.png}
         \caption{\scriptsize{$\widetilde{q}$, $16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_BV_4x8_ii_exp.png}
         \caption{\scriptsize{$\widetilde{\psi}$, $4 \times 8$}}
     \end{subfigure}
     \begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_BV_4x8_ii_exp.png}
         \caption{\scriptsize{$\widetilde{q}$, $4 \times 8$}}
     \end{subfigure}
\caption{Case 2: $\widetilde{\psi}$ and $\widetilde{q}$ computed with the BV-$\alpha$ model
and meshes $16 \times 32$ and  $4 \times 8$. }
\label{fig:BV_second_filter}
\end{figure}

%
%\begin{figure}
%\centering
%      \begin{overpic}[width=0.19\textwidth]{img/psi_BV_16x32_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{a)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_BV_16x32_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{b)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_BV_4x8_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{c)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_BV_4x8_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{d)}}
%      \end{overpic}
%\caption{Experiment (ii), BV-$\alpha$ model: a) $\widetilde{\psi}$ with mesh $16 \times 32$, b) $\widetilde{q}$ with mesh $16 \times 32$, c) $\widetilde{\psi}$ with mesh $4 \times 8$ and d) $\widetilde{q}$ with mesh $4 \times 8$.}
%\label{fig:BV_second_filter}
%\end{figure}

\begin{figure}[htb!]
\centering
       \begin{overpic}[width=0.48\textwidth]{img/E_BV_exp_2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
      \end{overpic}
\caption{Case 2: time evolution of the kinetic energy \eqref{eq:kin_energy}
computed by the BV-$\alpha$ model with meshes $16 \times 32$ and  $4 \times 8$ and compared to the
true kinetic energy.} %given by DNS (?? line), QGE with mesh $4 \times 8$ (?? line), BV-$\alpha$ with mesh $4 \times 8$ (?? line) and BV-NL-$\alpha$ with mesh $4 \times 8$ (?? line).}
\label{fig:Ek_a_second_BVa}
\end{figure}


\begin{comment}
\begin{figure}
\centering
 \begin{overpic}[width=0.19\textwidth]{img/todo2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
      \end{overpic}
\begin{overpic}[width=0.19\textwidth]{img/todo2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 4}}
      \end{overpic}
      \begin{overpic}[width=0.19\textwidth]{img/todo2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 4}}
      \end{overpic}
\caption{Time-averaged potential vorticity $q$ for $Ro = 0.008$ and $Re = 1000$: a) BV-$\alpha$ with mesh $16 \times 32$, b) BV-$\alpha$ with mesh $8 \times 16$, c) BV-$\alpha$ with mesh $4 \times 8$}
\label{fig:q_second_filter}
\end{figure}
\end{comment}

\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_BV_NL_16x32_ii_exp.png}
         \caption{\scriptsize{$\widetilde{\psi}$, $16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_BV_NL_16x32_ii_exp.png}
         \caption{\scriptsize{$\widetilde{q}$, $16 \times 32$}}
     \end{subfigure}
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/psi_BV_NL_4x8_ii_exp.png}
         \caption{\scriptsize{$\widetilde{\psi}$, $4 \times 8$}}
     \end{subfigure}
     \begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/q_BV_NL_4x8_ii_exp.png}
         \caption{\scriptsize{$\widetilde{q}$, $4 \times 8$}}
     \end{subfigure}
\caption{Case 2: $\widetilde{\psi}$ and $\widetilde{q}$ computed with the BV-NL-$\alpha$ model
and meshes $16 \times 32$ and  $4 \times 8$. }
\label{fig:BV_NL_second_filter}
\end{figure}


%\begin{figure}
%\centering
%      \begin{overpic}[width=0.19\textwidth]{img/psi_BV_NL_16x32_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{a)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_BV_NL_16x32_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{b)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/psi_BV_NL_4x8_ii_exp.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%        \put(25,105){\small{c)}}
%      \end{overpic}
%      \begin{overpic}[width=0.19\textwidth]{img/q_BV_NL_4x8_ii_exp.png}
%        \put(25,105){\small{d)}}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%\caption{Experiment (ii), BV-NL-$\alpha$ model: a) $\widetilde{\psi}$ with mesh $16 \times 32$, b) $\widetilde{q}$ with mesh $16 \times 32$, c) $\widetilde{\psi}$ with mesh $4 \times 8$, d) $\widetilde{q}$ with mesh $4 \times 8$.}
%\label{fig:BV_NL_second_filter}
%\end{figure}


\begin{comment}
\begin{figure}
\centering
 \begin{overpic}[width=0.19\textwidth]{img/todo2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
      \end{overpic}
\begin{overpic}[width=0.19\textwidth]{img/todo2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 4}}
      \end{overpic}
      \begin{overpic}[width=0.19\textwidth]{img/todo2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 4}}
      \end{overpic}
\caption{Time-averaged potential vorticity $q$ for $Ro = 0.008$ and $Re = 1000$: a) BV-NL-$\alpha$ with mesh $16 \times 32$, b) BV-NL-$\alpha$ with mesh $4 \times 8$}
\label{fig:q_second_filter_NL}
\end{figure}
\end{comment}

\begin{figure}
\centering
       \begin{overpic}[width=0.48\textwidth]{img/E_BV_NL_exp_2.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
      \end{overpic}
\begin{overpic}[width=0.49\textwidth]{img/E_BV_NL_exp_2_zoom.png}
        %\put(40,40){FOM}
        %\put(40,45){\small{t = 1}}
      \end{overpic}
\caption{Case 2: time evolution of the kinetic energy \eqref{eq:kin_energy}
computed by the BV-NL-$\alpha$ model with meshes $16 \times 32$ and  $4 \times 8$ and compared to the
true kinetic energy (left) and corresponding zoomed-in view (right). %\anna{Anche qui aggiungerei uno zoom-in.} \textcolor{red}{fatto!}
} 
\label{fig:Ek_a_second_BVNLa}
\end{figure}


Let us conclude with the visualization of the time-averaged indicator function $\widetilde{a}$ 
computed with the meshes $16 \times 32$ and $4 \times 8$ shown in Fig.~\ref{fig:indicator_func_second}.
We see that $\widetilde{a}$ takes its the largest values in one strip of cells close to the boundary, where
there are the largest gradients of the potential vorticity. Notice also that the maximum and minimum values 
of $\widetilde{a}$ become larger in absolute value when the mesh gets coarser, since more regularization is needed. 
%We see that the largest values occur in the region close to the boundary of the computational domain \textcolor{red}{(Anna, ti viene in mente un motivo che possa giustificare questo pattern?)}.  Moreover, we observe that, as expected, moving from the mesh $4 \times 8$ to $16 \times 32$ the region restricts and the values get down it decreasing the amount of regularization required. %the indicator funtion show greater values on the coarser mesh $4x8$ as expected. %, since coarser meshes need a big amount of regularization. %, as expected. Additionally, local peaks occur inside the channel
%boundary layer. %Thus, function (7) is a suitable indicator function because it correctly selects the regions
%of the domain where the velocity does need regularization.

% which is significantly ?? than the speed-up observed in \cite{}. %.a ROM study for the EF algorithm with a linear indicator function [26, 24].


%COSTO COMPUTAZIONALE:

%simulazione BV NL alpha su mesh 16 per 32 esp. 2 (da 20 a 100s): 4400/4500 secondi
%simulazione QGE su mesh 256x512 esp. 2 (da 20 a 100s): 

\begin{figure}[htb!]
\centering
\begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/a_16x32_exp_2.png}
         \caption{\scriptsize{$\widetilde{\psi}$, $16 \times 32$}}
     \end{subfigure}
     \begin{subfigure}{0.193\textwidth}
         \centering
         \includegraphics[width=\textwidth]{img/a_4x8_exp_2.png}
         \caption{\scriptsize{$\widetilde{q}$, $4 \times 8$}}
     \end{subfigure}
\caption{Case 2: $\widetilde{a}$ computed with the BV-NL-$\alpha$ model and meshes $16 \times 32$ and  $4 \times 8$. }
\label{fig:indicator_func_second}
\end{figure}

%\begin{figure}
%\centering
% \begin{overpic}[width=0.2\textwidth]{img/a_4x8_exp_2.png}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 1}}
%        \put(25,105){\small{a)}}
%      \end{overpic}
% \begin{overpic}[width=0.2\textwidth]{img/a_16x32_exp_2.png}
%        \put(25,105){\small{b)}}
%        %\put(40,40){FOM}
%        %\put(40,45){\small{t = 4}}
%      \end{overpic}
%%\begin{overpic}[width=0.45\textwidth]{img/todo.png}
%        %\put(40,40){ROM}
%%      \end{overpic}
%\caption{Experiment (ii) -  BV-NL-$\alpha$ model: a) $\widetilde{a}$ with mesh $4 \times 8$ and b) mesh $16 \times 32$.}
%\label{fig:indicator_func_second}
%\end{figure}



\section{Conclusions and perspectives}\label{sec:conclusions}

We presented a nonlinear variant of the BV-$\alpha$ model, called BV-NL-$\alpha$, for the simulation of  
barotropic flows with under-refined meshes. %Nonlinear filtering stabilizes marginally resolved scales without over-diffusing, thereby allowing to use less degrees of freedom than required by a DNS. 
To select the regions of the domain where filtering is needed, we employed %for the first time in the framework of the quasi-geostrophic equations 
a nonlinear differential low-pass filter. For the space discretization of the BV-NL-$\alpha$ model, 
we chose a Finite Volume method that has the advantage of enforcing conservation of quantities at the discrete level.

We showed the effectiveness of our approach through a computational study for the double-gyre wind forcing benchmark. 
We considered two different parameters setting: i) $Ro = 0.0036$ and $Re = 450$ and ii) $Ro = 0.008$ and $Re = 1000$. 
In both cases, when coarse meshes are considered the BV-NL-$\alpha$ model provides more accurate results than 
the QGE and BV-$\alpha$ models.

This work could be expanded in different directions. A sensitivity analysis for the filtering radius \cite{Bertagna2019}
would help us understand how to obtain the most accurate results when compared to a direct
numerical simulation. Moreover, it would be interesting to test the performance of a class of deconvolution-based 
indicator functions and to implement an efficient algorithm called Evolve-Filter-Relax, 
which proved to work well for the Leray-$\alpha$ model \cite{BQV, Girfoglio2019, Girfoglio2021a, Girfoglio2021b, Girfoglio2021c, Girfoglio_JCP, Strazzullo2021}. %\textcolor{red}{(Anna, anche qui, vuoi inserire altro di tuo? :))}. 
Thus, we believe they could be successful also for the BV-NL-$\alpha$ model. 
%to implement the BV-$\alpha$ and BV-NL-$\alpha$ models 

%\rev{Anna, noi sappiamo che c'e' anche ROM come perspective, ma non lo metterei, ti pare? Se no e' troppo ricco. Mi sono limitato a descrivere quello che sara' il contenuto del secondo paper FOM in cantiere. Poi ho deciso anche di evitare di dire esplicitamente che si puo' fare un adattativo in tempo, magari lo facciamo ma non mi sembra il caso di annoverarlo tra le perspectives? Se vogliamo inserirlo cmq, lo possiamo mettere quando parliamo della sensitivita' rispetto al filtering radius, che ne pensi?}. %in order to... % we are going to develop a Leray Reduced
%Order Model (ROM) within a Finite Volume framework. We are also interested
%in coupling the Leray model with an elasticity model to simulate fluid-structure
%interaction problems which are ubiquitous in science and engineering.


%\rev{Poi nelle perspectives scrivero' che in futuro si potrebbe adottare pure un approccio adattativo in base a CFL max)}. 

\section{Acknowledgements}\label{sec:acknowledgements}
We acknowledge the support provided by the European Research Council Executive Agency by the Consolidator Grant project AROMA-CFD ``Advanced Reduced Order Methods with Applications in Computational Fluid Dynamics" - GA 681447, H2020-ERC CoG 2015 AROMA-CFD, PI G. Rozza, and INdAM-GNCS 2019-2020 projects.
This work was also partially supported by US National Science Foundation through grant DMS-1953535. 
A.Quaini also acknowledges support from the Radcliffe Institute for Advanced Study at Harvard University where
she has been a 2021-2022 William and Flora Hewlett Foundation Fellow.

%To decouple the Navier-Stokes system (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_ns-2}) from the filter system (\ref{eq:disc_filter_mom})-(\ref{eq:disc_filter_mass}) at the time $t^{n+1}$, %...we have two options:
%\begin{enumerate}[i)]
%\item[1.] {\it Filter-then-solve}: Solve the filter equations (\ref{eq:disc_filter_mom})-(\ref{eq:disc_filter_mass}) first, with $\u^{n+1}$ replaced by a 
%suitable extrapolation $\u^*$ and $a(\u^{n+1})$ replaced by $a(\u^*)$, and then solve equations (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_ns-2}) with advection field given by the filtered velocity previously computed.
%\item[2.] {\it Solve-then-filter}: Solve equations (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_ns-2}) first, replacing  the advection field $\ubar^{n+1}$ with  a suitable extrapolation $\u^*$, and then solve the 
%filter problem (\ref{eq:disc_filter_mom})-(\ref{eq:disc_filter_mass}).
%\end{enumerate}
%In this work, we will focus on approach 2. 
%To keep the computational costs low, we adopt a semi-implicit approach, i.e.~we perform only one iteration per time step.
%In particular, we consider a modified version of approach 2 called Evolve-Filter-Relax (EFR), which was 
%first proposed in \cite{layton_CMAME}. This algorithm reads as follows: given the velocities $\u^{n-1}$ and $\u^{n}$, at $t^{n+1}$:

%\begin{enumerate}[i)]
%\item \textit{evolve}: find intermediate velocity and pressure $(\v^{n+1},q^{n+1})$ such that
%\begin{align}
%\rho\, \frac{3}{2\Delta t}\, \v^{n+1} + \rho\, \div \left(\u^* \otimes \v^{n+1}\right) - 2\mu\Delta\v^{n+1} +\nabla q^{n+1} & = \b^{n+1},\label{eq:evolve-1.1}\\
%\div \v^{n+1} & = 0\label{eq:evolve-1.2},
%\end{align}
%where $\u^* = 2 \u^n-\u^{n-1}$.

%\item \textit{filter}: find $(\vbar^{n+1},\lambda^{n+1})$ such that
%\begin{align}
%-\alpha^2\div \left(a(\v^{n+1}) \nabla\vbar^{n+1}\right) +\vbar^{n+1} +\nabla \lambda^{n+1} & = \v^{n+1}, \label{eq:evolve-2.1}\\
%\div \vbar^{n+1} & = 0 \label{eq:filter-1.2}.
%\end{align}
%\item \textit{relax}: set 
%\begin{align}
%\u^{n+1}&=(1-\chi)\v^{n+1} + \chi\vbar^{n+1}, \label{eq:relax-1} \\
%p^{n+1}&= q^{n+1},  \label{eq:relax-2}
%\end{align}
%where $\chi\in(0,1]$ is a relaxation parameter.
%\end{enumerate}


%\begin{rem}\label{rem:gen_Stokes}
%Filter problem \eqref{eq:evolve-2.1}-\eqref{eq:filter-1.2} can be considered 
%a generalized Stokes problem. In fact, by dividing eq.~\eqref{eq:evolve-2.1}
%by $\Delta t$ and rearranging the terms we obtain:
%\begin{align}
%\frac{\rho}{\Delta t} \vbar^{n+1}  - \div \left( \mubar \nabla\vbar^{n+1}\right) + \nabla \qbar^{n+1} & = \frac{\rho}{\Delta t} \v^{n+1}, \quad \mubar = \rho \frac{\alpha^2}{\Delta t} a(\v^{n+1}), %\label{eq:filter-1.1}
%\end{align}
%where $\qbar^{n+1} = \rho \lambda^{n+1}/\Delta t$. Problem \eqref{eq:filter-1.1},\eqref{eq:filter-1.2} can be
%seen as a time dependent Stokes problem with a non-constant viscosity $\mubar$, discretized
%by the Backward Euler (or BDF1) scheme. 
%A solver for problem \eqref{eq:filter-1.1},\eqref{eq:filter-1.2} can then be obtained 
%by adapting a standard linearized Navier-Stokes solver. 
%Notice that for $\alpha^2/\Delta t \simeq h^2/\Delta t \to 0$ we have that $\mubar \rightarrow 0$ and $\vbarh^{n+1} \to \vh^{n+1}$.
%\anna{Michele, se ti va bene questa riscrittura del problema, 
%aggiorniamo la sez. \ref{subsec:space-discrete-filter}. In questo modo il commento sulla fictitious time derivative
%risulta di compressione immediata.} 
%\textcolor{red}{Perfetta!! :) Dovremmo indicare il rapporto $\lambda^{n+1}/\Delta t$ con un nuovo simbolo visto che $q$ rappresenta la pressione evolve step, o sbaglio? Dobbiamo rivedere anche i richiami alle equazioni del problema filter step, sia qui che nella sezione della numerica. Inoltre ho usato lo stesso trick della fictitious time derivative anche per $F$ nel caso non lineare}
%\end{rem}

%\begin{rem}\label{rem:p_relax}
%In the EFR algorithm proposed in \cite{layton_CMAME} there is no relaxation for the pressure, i.e.~the end-of-step
%pressure is set equal to the pressure of the Evolve step. 
%In \cite{BQV}, two relaxations for the pressure were considered: $p^{n+1} = q^{n+1} + \frac{3}{2} \chi \qbar^{n+1}$ or
%$p^{n+1} =(1-\chi)q^{n+1} + \chi\qbar^{n+1}$. Notice while $\qbar^{n+1}$ has the same dimensional 
%units as $q^{n+1}$, $\lambda^{n+1}$ does not.
%\end{rem}

%In the rest of the paper, we will call EFR algorithm \eqref{eq:evolve-1.1}, \eqref{eq:evolve-1.2}, 
%\eqref{eq:filter-1.1}, \eqref{eq:filter-1.2}-\eqref{eq:relax-2}.
%We will call the algorithm simply Evolve-Filter (EF) when $\chi = 1$, since there is no actual relaxation step.
%In the next subsection, we will consider an indicator function that leads to a nonlinear alternative to the Leray-$\alpha$ model.



%\newpage

%\section{COMMENTI INFORMALI}

%\textcolor{red}{** La seconda si riferisce al fatto che guardando gli andamenti sulle mesh lasche esaedriche di NSE con schema U sembra quasi che la lunghezza del getto si riduca progressivamente all'aumentare del refinement, avvicinandosi ai dati sperimentali. Certo, due mesh sono poche per trarre conclusioni. Ecco perche' ho avviato le DNS sulla mesh 1200k anche con schema U (ricordo che il trend di Nicoud lo otteniamo con CD); mi aspetto che il getto continui a spostarsi verso sinistra. Non solo, ho notato che a parita' di mesh, si ottiene un getto piu' corto man mano che il Reynolds aumenta. Questa cosa mi fa pensare (ma al momento e' una illazione) che a Reynolds maggiori riusciamo ad ottenere risultati migliori a parita' di mesh perche' ci allontaniamo dalla zona di transizione. Non solo...ho provato a lanciare il filtro sulla mesh 140k per Re = 2000 con schema U (prima volta che provo a lanciare il filtro post-bag su una configurazione del genere, finora ho provato a lanciarlo solo su mesh 140k/330k hex con schema CD). Per chi molto piccolo dato da una delle nostre formule (siamo se non erro a circa 0.01) paradossalmente il getto e' piu' corto della DNS mentre per chi = 0.1 si allunga nuovamente. In entrambi i casi la velocita' in gola si amplifica (come previsto direi). Secondo voi il fatto che per uno dei due chi testati il filtro abbia ridotto la lunghezza del getto e' una singolarita'? L'introduzione della viscosita' artificiale (l'ammontare giusto diciamo) deve necessariamente determinare un aumento della lunghezza del getto anche se di fatto la soluzione NSE procede nella direzione opposta come in questa configurazione? Il filtro non dovrebbe a parita' di mesh fornire una soluzione (migliore) che NSE riuscirebbe a dare solo con una mesh piu' fitta? In quest'ottica una riduzione del getto con il giusto chi potrebbe non costituire un accidente. Che ne pensate? Io non ci credo molto sincearamente ma ho ritenuto comunque opportuno sottoporvi la questione :) }%Considerando che il filtro introduce viscosita' artificiale, mi sarei aspettato un getto ancora piu' lungo e invece con grande sorpresa ho ottenuto un getto piu' corto! In gola la velocita' invece si amplifica.}

%\textcolor{red}{*** Comunque ammettendo (come e' piu' probabile che sia direi) che il filtro funzioni correttamente quando fornisce una lunghezza del getto maggiore della corrispondente soluzione NSE le mesh su cui possiamo operare sono:
%\begin{itemize}
%\item mesh esaedriche $<$330k con schema CD
%\item mesh tetraedriche $<=$1200k con schema CD (e intuirei anche piu' fitte in teoria visto che a quanto pare rimangono sempre "sottodiffuse" come succedeva ad Anna con FEM fatto salvo il fatto che la 1200k con FEM ha gia' una risoluzione sufficiente per una DNS; inoltre, NSE su queste mesh fornisce soluzioni rumorose che il filtro potrebbe regolarizzare e rendere piu' smooth)
%\end{itemize}}

%\textcolor{red}{**** Segnalo che i tempi di calcolo sulle mesh tetraedriche sono maggiori, talvolta in maniera abbastanza significativa, rispetto alle mesh esaedriche.}


%\textcolor{red}{***** Sintetizzerei il trend NSE all'aumentare del livello di raffinamento delle mesh cosi':
%\begin{itemize}
%\item mesh esaedriche con schema U: si parte da un getto ben piu' lungo di quanto previsto dagli esperimenti che man mano sembra accorciarsi e avvicinarsi ai dati sperimentali (le prove a 1200k saranno determinanti per confermare o quanto meno rafforzare questa idea)
%\item mesh esaeddriche con schema CD: si parte da un getto piu' corto dei dati sperimentali, che poi attraversa i dati stessi, raggiunge l'outlet e poi (si spera) torna ad accorciarsi (trend di Nicoud)
%\item mesh tetraedriche con schema CD: direi che qui si ottiene un trend conforme alla tua esperienza Anna, che ne dici? Abbiamo sempre soluzioni sottodiffuse e poco smooth almeno fino a 1200k. L'unica cosa come gia' detto e' che tu ottieni una DNS gia' con la 1200k.
%\item mesh tetraedriche con schema U: si parte da un getto piu' corto dei dati sperimentali che poi tende ad allungarsi (un po' come succede con mesh esaedriche e schema CD).
%\end{itemize}
%}

%\textcolor{red}{**** In un certo senso lo schema U al pari del filtro introduce viscosita' artificiale, "regolarizza". Questo e' un fatto certificato (da manuale si sa che lo schema CD e' meno diffusivo di U ad esempio come ho specificato nel paper) e d'altronde era visibile anche sul cilindro (abbiamo abbandonato CD in favore di U perche' NSE con U dava risultati piu' diffusi, ovvero piu' vicini alla vera DNS). Con il filtro pero' abbiamo l'opportuna di avere a disposizione dei gradi di liberta' che possiamo fissare ad hoc per contenere la quantita' di viscosita' artificiale che introduciamo e quindi per ottimizzare la soluzione ($\alpha$, $\chi$); che ne pensate?}


%Ora io penserei una cosa del genere. E' vero che introduciamo viscosita' artificiale con il filtro ma ho provato ad interpretare la cosa da un altro punto di vista.%E' corretto affermare che il filtro sia in grado di fornire, a parita' di mesh, una soluzione migliore di NSE naturalmente. Il che vuol dire che se io ho una mesh di X celle con il filtro io sono in grado di ottenere una soluzione (migliore) che NSE riuscirebbe a darmi solo con una mesh XX piu' fitta di X di una certa percentuale, ti trovi? Noi abbiamo visto che con le mesh minori di 330k con schema CD riuscivamo ad ottenere getti piu' lunghi con il filtro e quindi piu' vicini ai dati sperimentali perche' di fatto partivamo da una soluzione NSE sotto la campana sperimentale. Abbiamo poi escluso le mesh $>=$ 330k dal filtraggio perche' NSE dava getti progressivamente piu' lunghi (almeno fino a 1200k..trend Nicoud..per poi si spera tornare indietro) e con il filtro si allungava ancora di piu' (come verificato proprio sulla 330k). E se in base all'interpretazione proposta il filtro desse un getto piu' lungo perche' si sposta per cosi' dire nella direzione in cui si sposta la soluzione NSE su mesh progressivamente piu' fitte? Non so se sono stato in grado di chiarire il mio pensiero. Perche' se cosi' fosse potrebbe non essere soprendente il fatto che nel caso (**) il filtro anziche' allungare il getto lo accorcia. Se cosi' fosse si potrebbe anche pensare di applicare il filtro solo su mesh esaedriche e schema U perche' sarebbe l'unica configurazione in cui NSE presenta un trend di convergenza monotono (che poi e' la stessa configuarazione usata sul cilindro!). Infatti con le mesh esaedriche e CD prima andiamo avanti e poi torniamo indietro (Nicoud), le mesh tetraedriche a questo punto potrebbero essere escluse perche' molto rumorose. Certo, si potrebbe trattare anche di un semplice accidente o di una singolarita' e quindi va indagata bene la cosa :). Un altro punto di vista potrebbe invece privilegiare le mesh tetraedriche che necessitano di maggiore regolarizzazione essendo la soluzione NSE troppo rumorosa e inoltre sono le uniche che a quanto pare almeno fino a 1200k non vanno mai oltre la campana sperimentale (con schema CD), come succedeva a te con FEM, fatto salvo il fatto che nel tuo caso 1200k e' gia' sufficientemente fitta per una DNS.}

\begin{comment}
\begin{figure}
\centering
{\includegraphics[width=0.45\textwidth]{img/untitled.png}} %p
\caption{\textcolor{red}{mesh $140k_H$ e Re = 2000: NSE zeroGradient BC (curva rossa), NSE convective BC (curva nera), EFR con chi (circa 0.01 a regime) dato da una delle formule che stiamo testando (curva blu), EFR con chi = 0.1 (curva verde)}}
\end{figure}
\end{comment}

%\textcolor{red}{*****Direi che questo test e' rognoso anche perche' NSE (a parte le mesh tetraedriche con CD scheme) da' spesso soluzioni "sovradiffuse" mentre nel caso del cilindro dava sistematicamente soluzioni sottodiffuse (ricordo che sul cilindro abbiamo usato schema U per entrambe le mesh; all'inizio abbiamo testato anche CD che pero' poi abbiamo abbandonato perche' sulle mesh prismatiche lasche dava risultati peggiori, nel senso meno diffusi, ancora piu' ampi di NSE, che comunque di sicuro avrebbe subito miglioramenti con EFR; le mesh esaedriche sono nate dopo e le abbiamo testate direttamente con U) e quindi l'utilizzo del filtro rientrava in una logica piu' lineare (abbiamo soluzioni sottodiffuse, introduciamo viscosita' artificiale per avvicinarci alla soluzione (media) vera.}

%\newpage
\bibliographystyle{plain}
\bibliography{QGE} 

\end{document}

\subsection{Leray model}\label{sec:leray_model}

In the framework of the Kolmogorov 1941 theory \cite{Kolmogorov41-1,Kolmogorov41-2}, the 
turbulent kinetic energy, which is the kinetic energy associated with eddies in the turbulent flow,
 is injected in the system at the large scales (low wave numbers). Since the large scale eddies are unstable, they break down, transferring the energy to smaller eddies. Finally, the turbulent kinetic energy 
 is dissipated by the viscous forces at the small scales (high wave numbers). This process is usually referred to as \emph{energy cascade}. The scale at which the viscous forces dissipate energy is referred to as \emph{Kolmogorov scale}. For a flow in developed turbulent regime and at statistical equilibrium, the Kolmogorov scale can be expressed as
\begin{equation}\label{eq:eta-re}
\eta=Re^{-3/4}L.
\end{equation}

In order to correctly capture the dissipated energy, 
DNS needs a mesh with spacing $h\sim\eta$. As the Reynolds number increases, DNS leads to a huge number of unknowns and prohibitive computational costs.
On the other hand, when the mesh size $h$ fails to resolve the Kolmogorov scale, the under-diffusion in the simulation leads to nonphysical computed velocities.
In some cases, this is detectable simply looking at the velocity field, which features nonphysical oscillations eventually leading to a simulation break down. 
However, in some cases the velocity field does not display oscillations, 
yet it does not correspond to the physical solution. A possible remedy to this issue is to introduce a model which filters the 
nonphysical oscillations in the velocity field and conveys the energy lost to resolved scales. 

The so called \emph{Leray model} couples the Navier-Stokes equations \eqref{eq:ns-lapls-1},\eqref{eq:ns-mass} with a differential filter. The resulting system reads

\begin{align}%\label{eq:leray}
\rho\, \dt \u + \rho\,\div \left(\ubar \otimes \u\right) - 2\mu \Delta\u + \nabla p = \f & \quad {\rm in}~\Omega \times
(t_0,T), \label{eq:filter-ns1}\\
\div \u = 0 & \quad {\rm in}~\Omega \times(t_0,T), \label{eq:filter-ns2} \\
-2 \alpha^2\div \left(a(\u) \nabla\ubar\right) +\ubar +\nabla \lambda = \u & \quad {\rm in}~\Omega \times
(t_0,T),\label{eq:filter-mom}\\
\div \ubar = 0 & \quad {\rm in}~\Omega \times(t_0,T).\label{eq:filter-mass}
\end{align}
Here, $\ubar$ is the \emph{filtered velocity}, $\alpha$ can be interpreted as the \emph{filtering radius} (that is, the radius of the neighborhood where the filter extracts information from the unresolved scales), 
the variable $\lambda$ is a Lagrange multiplier to enforce the incompressibility constraint for $\ubar$
and $a(\cdot)$ is a scalar function such that:
\begin{align*}
a(\u)\simeq 0 & \mbox{ where the velocity $\u$ does not need regularization;}\\
a(\u)\simeq 1 & \mbox{ where the velocity $\u$ does need regularization.}
\end{align*}
This function, called \emph{indicator function}, is crucial for the success of the Leray model. 
%\anna{Sistemare la prossima frase quando abbiamo aggiunto la definizione di $a$.}
In Sec.~\ref{sec:indicator}, we will discuss our choice of $a(\u)$. 
Here, we mention that the choice $a(\u)\equiv 1$ corresponds to the classic Leray-$\alpha$ model \cite{Leray1934}. 
%Thus, in the following we will refer to eq.~\eqref{eq:filter-ns1}-\eqref{eq:filter-mass} with $a(\u) = 1$ everywhere in 
%$\Omega$ as Leray-$\alpha$ model.
This model has the advantage of making the operator in the filter equations linear and constant in time, 
but its effectivity could be rather limited, since it introduces the same amount of regularization everywhere in the domain, hence causing overdiffusion.

%The Leray system (\ref{eq:filter-ns1})-(\ref{eq:filter-mass}) consists then of two coupled saddle point problems, (\ref{eq:filter-ns1})-(\ref{eq:filter-ns2}) and (\ref{eq:filter-mom})-(\ref{eq:filter-mass}). The first one is given by Navier-Stokes equations, where the advection field is equal to the filtered velocity $\ubar$. The second one is the filter problem. 
Equations (\ref{eq:filter-mom})-(\ref{eq:filter-mass}) require suitable boundary conditions. These are chosen to be
\begin{align}
\ubar & = \u_D \mbox{ on } \partial\Omega_D \times(t_0,T),\label{eq:bc-filter-d}\\
(2\alpha^2 a(\u)\nabla\ubar - \lambda\mathbf{I})\n & = \0 \quad\mbox{ on } \partial\Omega_N \times(t_0,T).\label{eq:bc-filter-n}
\end{align}
%while no initial condition is required for $\ubar$, since there is no time derivative in eq.~(\ref{eq:filter-mom})-(\ref{eq:filter-mass}). 

%The Leray system consists then of two coupled saddle point problems. The first one is given by the Navier-Stokes equations, where the convective term is however linearized by setting the convective field equal to $\ubar$. The second one is the filter problem, where the variable $\lambda$ is introduced to ensure that the \emph{filter velocity} $\ubar$ is still divergence free. 

Even though  (\ref{eq:filter-ns1})-(\ref{eq:filter-ns2}) are linear in $(\u,p)$ and the filter problem is linear in $(\ubar,\lambda)$, the coupling is non-linear, due to the term $\div \left(\ubar \otimes \u\right)$ in eq.~(\ref{eq:filter-ns1}) and the term $a(\u)\nabla\ubar$ in eq.~(\ref{eq:filter-mom}) (when $a(\cdot)$ is not constant). 
%In the next section, we will present the \emph{evolve-filter-relax} (EFR) scheme that allows us to deal numerically with these nonlinearities.


\subsection{Time discrete problem}
\label{subsec:time-discrete}

To discretize in time problem (\ref{eq:filter-ns1})-(\ref{eq:filter-mass}), let $\Delta t \in \mathbb{R}$, $t^n = t_0 + n \Delta t$, with $n = 0, ..., N_T$ and $T = t_0 + N_T \Delta t$. Moreover, we denote by $y^n$ the approximation of a generic quantity $y$ at the time $t^n$. %In the following we will denote by $\Omega$ the domain of the equations.

For the time discretization of system (\ref{eq:filter-ns1})-(\ref{eq:filter-mass}), we adopt a Backward Differentiation Formula of order 2 (BDF2), 
see e.g. \cite{quarteroni2007numerical}. The Leray system discretized in time reads: given $\u^0$, for $n \geq 0$ find the solution $(\u^{n+1}, p^{n+1},\ubar^{n+1},\lambda^{n+1})$ of system:
\begin{align}
\rho\, \frac{3}{2\Delta t}\, \u^{n+1} + \rho\, \div \left(\ubar^{n+1} \otimes \u^{n+1}\right) - 2\mu\Delta\u^{n+1} +\nabla p^{n+1} & = \b^{n+1},\label{eq:disc_filter_ns-1}\\
\div \u^{n+1} & = 0, \label{eq:disc_filter_ns-2}\\
-\alpha^2\div \left(a(\u^{n+1}) \nabla\ubar^{n+1}\right) +\ubar^{n+1} +\nabla \lambda^{n+1} & = \u^{n+1},\label{eq:disc_filter_mom}\\
\div \ubar^{n+1} & = 0, \label{eq:disc_filter_mass}
\end{align}
where $\b^{n+1} = \f^{n+1} + (4\u^n - \u^{n-1})/(2\Delta t)$. 
Obviously, other discretization schemes are possible. However, for clarity of exposition we will restrict the description of the approach to the case of BDF2.

A monolithic approach for problem (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_mass}) would lead to high computational costs, making the advantage compared to DNS questionable. 
To decouple the Navier-Stokes system (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_ns-2}) from the filter system (\ref{eq:disc_filter_mom})-(\ref{eq:disc_filter_mass}) at the time $t^{n+1}$, we have two options:
\begin{enumerate}[i)]
\item[1.] {\it Filter-then-solve}: Solve the filter equations (\ref{eq:disc_filter_mom})-(\ref{eq:disc_filter_mass}) first, with $\u^{n+1}$ replaced by a 
suitable extrapolation $\u^*$ and $a(\u^{n+1})$ replaced by $a(\u^*)$, and then solve equations (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_ns-2}) with advection field given by the filtered velocity previously computed.
\item[2.] {\it Solve-then-filter}: Solve equations (\ref{eq:disc_filter_ns-1})-(\ref{eq:disc_filter_ns-2}) first, replacing  the advection field $\ubar^{n+1}$ with  a suitable extrapolation $\u^*$, and then solve the 
filter problem (\ref{eq:disc_filter_mom})-(\ref{eq:disc_filter_mass}).
\end{enumerate}
In this work, we will focus on approach 2. 
To keep the computational costs low, we adopt a semi-implicit approach, i.e.~we perform only one iteration per time step.
In particular, we consider a modified version of approach 2 called Evolve-Filter-Relax (EFR), which was 
first proposed in \cite{layton_CMAME}. This algorithm reads as follows: given the velocities $\u^{n-1}$ and $\u^{n}$, at $t^{n+1}$:

\begin{enumerate}[i)]
\item \textit{evolve}: find intermediate velocity and pressure $(\v^{n+1},q^{n+1})$ such that
\begin{align}
\rho\, \frac{3}{2\Delta t}\, \v^{n+1} + \rho\, \div \left(\u^* \otimes \v^{n+1}\right) - 2\mu\Delta\v^{n+1} +\nabla q^{n+1} & = \b^{n+1},\label{eq:evolve-1.1}\\
\div \v^{n+1} & = 0\label{eq:evolve-1.2},
\end{align}
where $\u^* = 2 \u^n-\u^{n-1}$.

\item \textit{filter}: find $(\vbar^{n+1},\lambda^{n+1})$ such that
\begin{align}
-\alpha^2\div \left(a(\v^{n+1}) \nabla\vbar^{n+1}\right) +\vbar^{n+1} +\nabla \lambda^{n+1} & = \v^{n+1}, \label{eq:evolve-2.1}\\
\div \vbar^{n+1} & = 0 \label{eq:filter-1.2}.
\end{align}
\item \textit{relax}: set 
\begin{align}
\u^{n+1}&=(1-\chi)\v^{n+1} + \chi\vbar^{n+1}, \label{eq:relax-1} \\
p^{n+1}&= q^{n+1},  \label{eq:relax-2}
\end{align}
where $\chi\in(0,1]$ is a relaxation parameter.
\end{enumerate}


%\begin{rem}\label{rem:gen_Stokes}
%Filter problem \eqref{eq:evolve-2.1}-\eqref{eq:filter-1.2} can be considered 
%a generalized Stokes problem. In fact, by dividing eq.~\eqref{eq:evolve-2.1}
%by $\Delta t$ and rearranging the terms we obtain:
%\begin{align}
%\frac{\rho}{\Delta t} \vbar^{n+1}  - \div \left( \mubar \nabla\vbar^{n+1}\right) + \nabla \qbar^{n+1} & = \frac{\rho}{\Delta t} \v^{n+1}, \quad \mubar = \rho \frac{\alpha^2}{\Delta t} a(\v^{n+1}), %\label{eq:filter-1.1}
%\end{align}
%where $\qbar^{n+1} = \rho \lambda^{n+1}/\Delta t$. Problem \eqref{eq:filter-1.1},\eqref{eq:filter-1.2} can be
%seen as a time dependent Stokes problem with a non-constant viscosity $\mubar$, discretized
%by the Backward Euler (or BDF1) scheme. 
%A solver for problem \eqref{eq:filter-1.1},\eqref{eq:filter-1.2} can then be obtained 
%by adapting a standard linearized Navier-Stokes solver. 
%Notice that for $\alpha^2/\Delta t \simeq h^2/\Delta t \to 0$ we have that $\mubar \rightarrow 0$ and $\vbarh^{n+1} \to \vh^{n+1}$.
%\anna{Michele, se ti va bene questa riscrittura del problema, 
%aggiorniamo la sez. \ref{subsec:space-discrete-filter}. In questo modo il commento sulla fictitious time derivative
%risulta di compressione immediata.} 
%\textcolor{red}{Perfetta!! :) Dovremmo indicare il rapporto $\lambda^{n+1}/\Delta t$ con un nuovo simbolo visto che $q$ rappresenta la pressione evolve step, o sbaglio? Dobbiamo rivedere anche i richiami alle equazioni del problema filter step, sia qui che nella sezione della numerica. Inoltre ho usato lo stesso trick della fictitious time derivative anche per $F$ nel caso non lineare}
%\end{rem}

%\begin{rem}\label{rem:p_relax}
%In the EFR algorithm proposed in \cite{layton_CMAME} there is no relaxation for the pressure, i.e.~the end-of-step
%pressure is set equal to the pressure of the Evolve step. 
%In \cite{BQV}, two relaxations for the pressure were considered: $p^{n+1} = q^{n+1} + \frac{3}{2} \chi \qbar^{n+1}$ or
%$p^{n+1} =(1-\chi)q^{n+1} + \chi\qbar^{n+1}$. Notice while $\qbar^{n+1}$ has the same dimensional 
%units as $q^{n+1}$, $\lambda^{n+1}$ does not.
%\end{rem}

In the rest of the paper, we will call EFR algorithm \eqref{eq:evolve-1.1}, \eqref{eq:evolve-1.2}, 
\eqref{eq:filter-1.1}, \eqref{eq:filter-1.2}-\eqref{eq:relax-2}.
We will call the algorithm simply Evolve-Filter (EF) when $\chi = 1$, since there is no actual relaxation step.
In the next subsection, we will consider an indicator function that leads to a nonlinear alternative to the Leray-$\alpha$ model.



 
 \subsection{The indicator function}\label{sec:indicator}

Different choices of $a(\cdot)$ have been proposed and compared in \cite{Borggaard2009,layton_CMAME,O-hunt1988,Vreman2004,Bowers2012} for the Navier-Stokes equations. 
Here, we focus on a class of deconvolution-based indicator functions:
\begin{equation}
a(\v) = a_{D}(\v) = \left|  \v - D (F(\v)) \right|^2, \label{eq:a_deconv}
\end{equation}
where $F$ is a linear filter (an invertible, self-adjoint, compact operator from a Hilbert space to itself)
and $D$ is a bounded regularized approximation of $F^{-1}$.
A popular choice for $D$ is the Van Cittert deconvolution operator $D_N$, defined as
\begin{equation}
D_N = \sum_{n = 0}^N (I - F)^n. \el
\end{equation}
The evaluation of $a_D$ with $D=D_N$ (deconvolution of order $N$) requires then to apply 
the filter $F$ a total of $N+1$ times.
Since $F^{-1}$ is not bounded, in practice $N$ is chosen to be small, 
as the result of a trade-off between accuracy (for a regular solution) and filtering (for a non-regular one).
In this paper  we consider $N = 0$, corresponding to $D_0=I$. For this choice of $N$, the indicator function (\ref{eq:a_deconv}) becomes
\begin{align}
a_{D_0}(\v) = \left|  \v - F(\v) \right|. \label{eq:a_D0_a_D1}
%\quad a_{D_1}(\v) = \left|  \v - 2 F(\v) + F(F(\v)) \right|.
\end{align}


We select $F$ to be the linear Helmholtz filter operator $F_H$ defined by 
%\anna{Qui c'era $\delta$ e ho cambiato con $\alpha$ (come nel BQRV), anche se tecnicamente $\delta = \alpha/\sqrt{2}$.} \textcolor{red}{Di fatto, nei calcoli, io ho usato sempre $\alpha$ sia nel coefficiente moltiplicativo del laplaciano del filtro di Hemholtz, sia nel coefficiente moltiplicativo del laplaciano della U mediata (non ho scalato rispetto a $\sqrt{2}$), questo perche' ho seguito l'impostazione BQRV; non penso sia un problema ma dimmi tu :)}
\begin{equation}
	F=F_H = \left(I - \alpha^2  \Delta \right)^{-1}. \el
\end{equation}
It is possible to prove \cite{Dunca2005} that
\begin{align}
\v - D_N (F_H(\v)) = (-1)^{N+1} \alpha^{2N+2} \Delta^{N+1} F_H^{N+1} \v. \el% \label{eq:duncan_eps}
\end{align}
Therefore, $a_{D_N}(\v)$ is close to zero in the regions of the domain where $\v$ is smooth.
We remark that finding $F_H(\v^{n+1}) = \tilde{\v} ^{n+1}$ is equivalent to finding
$\tilde{\v} ^{n+1}$ such that:
\begin{equation}\label{eq:vtilde}
\tilde{\v} ^{n+1} - \alpha^2  \Delta \tilde{\v} ^{n+1}= \v^{n+1}. 
\end{equation}


\def\resY{J_{\alpha^2}}
\def\regY{\mathcal{L}_{\alpha^2}}

%It was noted in \cite{BQV} that the Van Cittert-Helmholtz deconvolution operator $D_N$ can be conveniently interpreted in a different manner. 
%Following the theory of maximal monotone operators and their Yosida regularized operator (see \cite{B-brezis}, Ch. 7), 
%$F_H$ is the  resolvent $J_{\alpha^2}$ of operator $\mathcal{L} = -\Delta$. Correspondingly, the Yosida 
%approximation of $\mathcal{L}$ reads
%$$
%\regY  \equiv \alpha^{-2} \left(I - J_{\alpha^2} \right) =  \alpha^{-2} \left(I - F_H \right).
%$$
%It follows that
%\begin{equation}
%a_{D_N}(\v) = \alpha^{2N+2} \left|  \regY^{N+1} \v \right|.\label{eq:a_D_N_regY}
%\end{equation}

We will refer to eq.~\eqref{eq:filter-ns1}-\eqref{eq:filter-mass} with indicator function given by 
\eqref{eq:a_D0_a_D1} as Leray-$\alpha$-NL model.



\section{Space discrete problem: the Finite Volume approximation}\label{subsec:space-discrete}

In this section we discuss the space discretization of problems \eqref{eq:evolve-1.1}-\eqref{eq:evolve-1.2}
and \eqref{eq:filter-1.1},\eqref{eq:filter-1.2} for both the classic Leray-$\alpha$ and the Leray-$\alpha$-NL model. 


We adopt the Finite Volume (FV) approximation that is derived
directly from the integral form of the governing equations. 
We have chosen to implement the EFR algorithm within
the finite volume C++ library OpenFOAM\textsuperscript{\textregistered} \cite{Weller1998}.
%When we set $\chi = 1$, we will refer to the algorithm as EF, instead of EFR, since there is no relaxation in practice.
We partition the computational domain $\Omega$ into cells or control volumes $\Omega_i$,
with $i = 1, \dots, N_{c}$, where $N_{c}$ is the total number of cells in the mesh. 
%\textcolor{red}{Ho introdotto il numero di volumi finiti $N$ in cui discretizziamo il dominio computazionale} 
Let  \textbf{A}$_j$ be the surface vector of each face of the control volume, 
with $j = 1, \dots, M$. The value of $M$ depends on the dimension of the domain and the type of mesh 
(hexahedral vs prismatic). 
%In sections \ref{subsec:space-discrete-evolve} and \ref{subsec:space-discrete-filter} we report the fully
%discretized problems \eqref{eq:evolve-1.1}-\eqref{eq:evolve-1.2} and \eqref{eq:evolve-2.1}-\eqref{eq:filter-1.1},
%respectively.
%\anna{Michele, possiamo dare il n. di facce? Scusa
%la pedanteria, ma preferisco dare al lettore tutte le info che posso servire per riprodurre i nostri risultati.
%Inoltre in questo modo le sommatorie su $j$ non sono ambigue.} \textcolor{red}{Fatto!}

\subsection{Numerical discretization for the \emph{evolve} step of the problem} %\eqref{eq:evolve-1.1}-\eqref{eq:evolve-1.2}}
\label{subsec:space-discrete-evolve}

%\textcolor{red}{Forse sarebbe meglio esprimere in tutte le equazioni il termine convettivo come $\nabla \cdot (\v \v)$ che si presta meglio in ambito FV (e' gia' pronto per essere trattato con il teorema di Gauss). Che ne dite?}
%\anna{Intendi dire riscrivere il termine convettivo in forma conservativa, cioe' $\nabla \cdot (\u^*\otimes \v^T)$, 
%invece che $\u^* \cdot \nabla \v$? Se non e' lo standard nella comunita' FV lascerei cosi', altrimenti cambiamo.}

The integral form of eq.~(\ref{eq:evolve-1.1}) for each volume $\Omega_i$ is given by:

\begin{align}\label{eq:evolveFVtemp-1.1}
\rho\, \frac{3}{2\Delta t}\, \int_{\Omega_i} \v^{n+1} d\Omega &+ \rho\, \int_{\Omega_i} \div \left(\u^* \otimes \v^{n+1}\right) d\Omega - 2\mu \int_{\Omega_i} \Delta\v^{n+1} d\Omega \cl
&+ \int_{\Omega_i}\nabla q^{n+1} d\Omega  = \int_{\Omega_i}{\bm b}^{n+1} d\Omega.
\end{align}
By applying the Gauss-divergence theorem, eq.~\eqref{eq:evolveFVtemp-1.1} becomes:

\begin{align}\label{eq:evolveFV-1.1}
\rho\, \frac{3}{2\Delta t}\, \int_{\Omega_i} \v^{n+1} d\Omega &+ \rho\, \int_{\partial \Omega_i} \left(\u^* \otimes \v^{n+1}\right) \cdot d\textbf{A} - 2\mu \int_{\partial \Omega_i} \nabla\v^{n+1} \cdot d\textbf{A} \cl
&+ \int_{\partial \Omega_i}q^{n+1} d\textbf{A}  = \int_{\Omega_i}{\bm b}^{n+1} d\Omega.
\end{align}
Each term in eq.~\eqref{eq:evolveFV-1.1} is approximated as follows: 

\begin{itemize}
\item[-] \textit{Gradient term}: 

\begin{align}\label{eq:grad}
\int_{\partial \Omega_i}q^{n+1} d\textbf{A} \approx \sum_j^{} q^{n+1}_j \textbf{A}_j, %\el
\end{align} 
where $q_j$ is the value of the pressure relative to centroid of the $j^{\text{th}}$ face. In OpenFOAM\textsuperscript{\textregistered} solvers, the face center pressure values $q_j$ are typically obtained from 
the cell center values by means of a linear interpolation scheme. Such scheme is rigorously second-order accurate only on structured meshes \cite{Syrakos2017}.

%\anna{Michele: usiamo $i$ come subindex per
%il control volume e anche per le facce di ciascun volume, non dovremmo usare un indice diverso?} \textcolor{red}{Hai ragione e scusa per la negligenza! Ho modificato usando $j$ come indice di conteggio per le facce di ciascun volumetto di controllo, ho lasciato $i$ come indice di conteggio per $\partial \Omega_i$ che rappresenta l'intera frontiera associata al volumetto di controllo $\Omega_i$ e ho tolto gli indici dai differenziali $d\textbf{A}$ e $d\Omega$}

\item[-] \textit{Convective term}: 
\begin{align}\label{eq:conv}
\int_{\partial \Omega_i} \left(\u^* \otimes \v^{n+1}\right) \cdot d\textbf{A} \approx \sum_j^{} \left(\u^{*}_j \otimes \v^{n+1}_j\right) \cdot \textbf{A}_j = \sum_j^{} \varphi^*_j \v^{n+1}_j, \quad \varphi^*_j = \u^{*}_j \cdot \textbf{A}_j,
\end{align} 
where $\u^{*}_j$ and $\v^{n+1}_j$ are respectively the extrapolated convective velocity and the fluid velocity relative 
to the centroid of each control volume face. In \eqref{eq:conv}, $\varphi^*_j$ is the convective flux associated to $\u^{*}$ through face $j$ of the control volume. In OpenFOAM\textsuperscript{\textregistered} solvers, 
the convective flux at the cell faces is typically a linear interpolation of the values from the adjacent cells. 
Also $\v^{n+1}$ needs to be approximated at cell face $j$ in order to get the face 
value $\v^{n+1}_j$. Different interpolation methods can be applied: central, upwind, second order upwind and blended differencing schemes \cite{jasakphd}.
%\textcolor{red}{Anna, vedi che ho cambiato un po' la descrizione della discretizzazione del termine convettivo. Questo e' il remark sull'interpolazione di cui ti parlavo e inoltre vengono specificati i due schemi convettivi che useremo e il cui confronto diventa cruciale per FDA!}
%As it will seen, the choice of the interpolation schemes could be strongly affect %Both velocities have to be determined from the cell centroid values by making use of appropriate interpolation schemes.
%In this work, we use a limited linear differencing scheme is used for the convective term \cite{OpenFoam2015}.
%\anna{(possiamo dare una referenza?)} 
%\textcolor{red}{(ho messo il riferimento al sito di OpenFOAM (specificando la versione che e' stata usata nel lavoro e l'anno di rilascio); al momento non mi vengono in mente altre referenze!)}. 
%Finally, in eq.~\eqref{eq:conv} $\varphi^*_j = \u^{*}_j \cdot \textbf{A}_j$ is the mass flux related to $\u^{*}$ through each face of the control volume.
\item[-] \textit{Diffusion term}: 
\begin{align}%\label{eq:diff}
\int_{\partial \Omega_i} \nabla\v^{n+1} \cdot d\textbf{A} \approx \sum_j^{} (\nabla\v^{n+1})_j \cdot \textbf{A}_j, \el
\end{align} 
where $(\nabla\v^{n+1})_j$ is the gradient of $\v^{n+1}$ at face $j$. 
% ANNA: HO COMMENTATO LA FRASE SEGUENTE PERCHE' PENSVO CHE NON FOSSE NECESSARIA, SE MI SBAGLIO TOGLI IL %
%In the case the value of the gradient ${\nabla \phi}_i$ of a generic conservative variable $\phi$ in control volume $\Omega_i$ is needed, as in eq. \eqref{eq:diff}, this one can be computed dividing the expression in eq. \eqref{eq:grad} by the volume of the cell $\Omega_i$.
%\anna{(Ho detto giusto che e' la parte simmetrica del gradiente? Vedi definziore in \eqref{eq:grads}. O e' solo il gradiente? Questo e' un punto importante perche' noi abbiamo osservato che se si usa solo il gradiente le simulazioni possono andare in crash.)} \textcolor{red}{Anna, limitatamente al paragrafo della numerica, ho tolto la parte simmetrica del gradiente e ho messo il gradiente perche' di fatto le simulazioni lavorano con il gradiente; poi ci dobbiamo ricordare di farlo anche nei paragrafi precedenti :)} 
We are going to briefly explain how $(\nabla\v^{n+1})_j$ is approximated with
second order accuracy on a structured, orthogonal mesh. Let $P$ and $Q$ be two neighboring control volumes.
%as in Fig.~\ref{fig:gradient_image}. 
%\anna{Siccome stiamo discutendo il caso di griglie strutturate, tolto il riferimento alla figura con la griglia non-strutturata
%per evitare confusione.}
The term $(\nabla\v^{n+1})_j$ is evaluated by subtracting
 the value of velocity at the cell centroid on the $P$-side of the face, denoted with $\v^{n+1}_P$,
 from the value of velocity at the centroid on the $Q$-side, denoted with $\v^{n+1}_Q$,
 and dividing by the magnitude of the distance vector $\textbf{d}_j$ connecting the two cell centroids:
\begin{align}
(\nabla\v^{n+1})_j \cdot \textbf{A}_j = \dfrac{\v^{n+1}_Q - \v^{n+1}_P}{|\textbf{d}_j|} |\textbf{A}_j|. \el
\end{align} 
For non-structured, non-orthogonal meshes
(see Fig.~\ref{fig:gradient_image}), an explicit non-orthogonal correction has to be added to the orthogonal component
in order to preserve second order accuracy. See \cite{jasakphd} for details.
%\anna{Quello che hai appena spiegato vale per una componente della velocita' e una data direzione, giusto? Forse puo' valere la pena di fare una figura per renderlo piu' immediato, temo
%che a parole risulti un po' confuso. } \textcolor{red}{Immagine messa e inserito qualche dettaglio in piu'!} 
\begin{figure}[h!]
\centering
\includegraphics[width=0.5\textwidth]{img/gradient_image.png}
\caption{Close-up view of two non-orthogonal control volumes in a 2D configuration.}
\label{fig:gradient_image}
\end{figure}
\end{itemize}


Let us denote with $\v^{n+1}_i$ and ${\bm b}^{n+1}_i$ the average velocity 
and source term in control volume $\Omega_i$, respectively.
Moreover, we denote with $\v^{n+1}_{i,j}$ and $q^{n+1}_{i,j}$ the velocity and pressure
associated to the centroid of face $j$ normalized by the volume of $\Omega_i$.
Then the discretized form of eq.~\eqref{eq:evolveFV-1.1}, divided by the control volume 
$\Omega_i$, can be written as:
\begin{align}\label{eq:evolveFV-1.1_disc}
\rho\, \frac{3}{2\Delta t}\, \v^{n+1}_i &+ \rho\, \sum_j^{} \varphi^*_j \v^{n+1}_{i,j} - 2\mu \sum_j^{} (\nabla\v^{n+1}_i)_j \cdot \textbf{A}_j + \sum_j^{} q^{n+1}_{i,j} \textbf{A}_j  = {\bm b}^{n+1}_i.
\end{align}
%\anna{Michele, ho leggermente cambiato la notazione qui sopra. Se non ti piace, possiamo rivederla.} \textcolor{red}{Direi che e' molto chiara e quindi perfetta!! :)}

%\textcolor{red}{Anna, di seguito ho cambiato abbastanza perche' prima la formulazione era un po' troppo "ibrida", nel senso che c'era un po' di confusione tra formulazione analitica e numerica dell'equazione di Poisson. Inoltre, ho aggiunto qualche dettaglio in piu' sull'implementazione di PISO in OpenFOAM che non e' esattamente quella standard. Fammi sapere :)}

%It should be noted that each term of the equation \eqref{eq:evolveFV-1.1} is intrinsically divided by the control volume 
%$\Omega_i$.

%\anna{Adesso che abbiamo spiegato ogni termine, possiamo scrivere tutta insieme l'approssimazione dell'eq.~\eqref{eq:evolveFV-1.1}?} \textcolor{red}{Presto fatto! Inoltre ho anche aggiunto una frase per esplicitare il fatto che l'equazione e' mediata sul volume della cella; ho preferito evitare di inserire il /$\Omega_i$ per non affaticare la lettura e, per la stessa ragione, ho lasciato gli stessi simboli anche per le grandezze normalizzate! Se non va bene cambiamo naturalmente!}

%We now take the divergence of eq.~(\ref{eq:evolve-1.1}) and, using eq.~(\ref{eq:evolve-1.2}), we obtain
%\begin{align}\label{eq:q_poissonL_tmp1}%\label{eq:q}
%\Delta q^{n+1} = -\rho \nabla \cdot (\left(\u^* \cdot \nabla\right) \v^{n+1} )
%+ \nabla \cdot \b^{n+1}.
%\end{align}
%Notice that if $\v^{n+1}$ is known, eq.~\eqref{eq:q_poissonL_tmp1} is
%a Poisson equation for the pressure. Therefore, the coupling between velocity and pressure is of elliptic kind. 
Following \cite{Rhie1983}, we now write eq.~\eqref{eq:evolveFV-1.1_disc} in semi-discretized form, i.e.
with the pressure term in continuous form while all the other terms
are in discrete form 
%\anna{E' giusto?} \textcolor{red}{La forma semidiscretizzata contiene tutti i termini in forma discretizzata (convettivo, diffusivo e termini sorgenti che noi abbiamo inglobato in \b) tranne il gradiente di pressione che e' in forma continua. D quindi e' la discretizzazione del termine diffusivo. Ho visto che ho definito C come termine convettivo in forma continua in (\ref{eq:q_poissonL_tmp1}). In realta' poi nella definizione di H rappresenta la discretizzazione del termine convettivo. Quindi c'e' questo "abuso" di notazione. Potremmo magari scrivere direttamente per esteso il termine convettivo analitico in eq.~(\ref{eq:q_poissonL_tmp1}) evitando questo overlap, che ne pensi?} \anna{Si', sono d'accordo. Ho tolto $C$ da eq.~(\ref{eq:q_poissonL_tmp1}), pero' allora lo definirei piu' in basso dove introduciamo $H$.}: %In order to reduce the computational cost, we consider a segregated approach to decouple the computation of velocity and pressure. First, we write in short the eq. \eqref{} in semi discrete form:
\begin{align}\label{eq:semidisc}%\label{eq:q}
\v^{n+1} = \frac{2  \Delta t}{3} \left(\textbf{H}(\v^{n+1}) - \nabla q^{n+1} \right),
\end{align}
with
\begin{align}
\textbf{H}(\v^{n+1}_i) = -\rho \sum_j^{} \varphi^*_j \v^{n+1}_{i,j} + 2\mu \sum_j^{} (\nabla\v^{n+1}_i)_j \cdot \textbf{A}_j + {\bm b}^{n+1}_i. \el
\end{align}
%\textcolor{red}{Anna, ho eliminato la definizione esplicita dei termini convettivo (C) e diffusivo (D) per sintetizzare. Ho inglobato direttamente tutto in H (e in H\_bar nel paragrafo del filter step). Inoltre, in eq. (36) il termine $\rho \beta/\Delta t$ e' implicito. Lo lascerei cosi' se per te va bene ma dovremmo scriverlo nel testo. Che ne pensi?}
Next, we take the divergence of the eq.~(\ref{eq:semidisc}) and make use of eq.~(\ref{eq:evolve-1.2}) to obtain
\begin{align}\label{eq:q_poissonL_tmp}%\label{eq:q}
\Delta q^{n+1} = \nabla \cdot \textbf{H}(\v^{n+1})
\end{align}
By integrating eq.~\eqref{eq:q_poissonL_tmp} over the control volume $\Omega_i$ 
and applying the Gauss-divergence theorem, we get
\begin{align}%\label{eq:q_poissonL_ii}
\int_{\partial \Omega_i} \nabla q^{n+1} d \textbf{A} = \int_{\partial \Omega_i} \textbf{H}(\v^{n+1}) \cdot d \textbf{A}. \el
\end{align}
So, the space discretized eq.~\eqref{eq:q_poissonL_tmp}, divided by the control volume 
$\Omega_i$, can be expressed as:
\begin{align}\label{eq:q_poissonL_iii}%\label{eq:q}
\sum_j^{} (\nabla q^{n+1})_j \cdot \textbf{A}_j = \sum_j^{} (\textbf{H}(\v_i^{n+1}))_j \cdot \textbf{A}_j
\end{align}
In eq.~\eqref{eq:q_poissonL_iii}, $(\nabla q^{n+1})_j$ is the gradient of $q^{n+1}$ at faces $j$ 
and it is approximated in the same way as $(\nabla\v^{n+1})_j$.
%\begin{align}\label{eq:q_poissonL_tmp}%\label{eq:q}
%\Delta q^{n+1} = \nabla \cdot \textbf{H}(\v^{n+1}) + \nabla \cdot \b^{n+1},
%\end{align}
%the algebraic sum of the approximations of convective and diffusion terms.
%Notice that if $\v^{n+1}$ is known, eq.~\eqref{eq:q_poissonL_tmp} is
%a Poisson equation for the pressure.
%where the pressure gradient is
%in continuous form \cite{Rhie1983} and $\textbf{H}(\v^{n+1})$ indicates
%the algebraic sum of the approximations of convective and diffusion terms.
%Notice that if $\v^{n+1}$ is known, eq.~\eqref{eq:q_poissonL_tmp} is
%a Poisson equation for the pressure.
%By integrating eq.~\eqref{eq:q_poissonL_tmp} over the control volume $\Omega_i$ 
%and applying the Gauss-divergence theorem, we obtain
%\begin{align}\label{eq:q_poissonL_ii}%\label{eq:q}
%\int_{\partial \Omega_i} \nabla q^{n+1} d \textbf{A} = \int_{\partial \Omega_i} \textbf{H}(\v^{n+1}) \cdot d \textbf{A} + \int_{\partial \Omega_i} \b^{n+1} d \textbf{A}
%\end{align}
%The space discretized eq.~\eqref{eq:q_poissonL_tmp}, divided by the control volume 
%$\Omega_i$, can be expressed as:
%\begin{align}\label{eq:q_poissonL_iii}%\label{eq:q}
%\sum_j^{} (\nabla q^{n+1})_j \cdot \textbf{A}_j = \sum_j^{} (\textbf{H}(\v_i^{n+1}))_j \cdot \textbf{A}_j + \sum_j^{} \b^{n+1}_j \cdot \textbf{A}_j.
%\end{align}
%In eq.~\eqref{eq:q_poissonL_iii}, $(\nabla q^{n+1})_j$ is the gradient of $q^{n+1}$ at the faces and it is
%approximated in the same way as $(\nabla\u^{n+1})_j$, while $\b^{n+1}_j$ is the value of the forcing term at the faces.

%\anna{Michele, ho leggermente cambiato anche qui sopra. Puoi dare un'occhiata?.}


%\anna{Io riporterei la forma integrale anche di questa equazione e la sua approssimazione, cosi' e'
%chiaro quale problema discreto stiamo considerando.} \textcolor{red}{Fatto anche qui ma non tanto presto :)! Mi sono documentato un po' piu' nel dettaglio sulla discretizzazione dell'ellittica di pressione implementata in OF e ho cercato di spiegarla nel modo piu' chiaro possibile. Qualcuno quando si riferisce alle NS discretizzate ad eccezione del termine di pressione parla di forma "semidiscretizzata"; ho preferito non usare questo termine perche' a quanto ne so si utilizza a rigori quando l'equazione a cui ci si riferisce e' discretizzata nello spazio ma non nel tempo. Che ne pensi? Inoltre forse potrebbe valer la pena di scrivere anche la versione discretizzata della equazione di continuita' sebbene, in base al taglio che ho scelto di dare al discorso, non sia necessario.}
% we start to discretize the continuity equation ~(\ref{eq:evolve-1.2}). By integrating over the control volume $\Omega_i$ and by applying the Gauss-divergence theorem, we obtain
%\begin{align}\label{eq:disc_cont}%\label{eq:q}
%\int_{\Omega_i} \div \v^{n+1} d \Omega = \int_{\partial \Omega_i} \v^{n+1} \cdot d \textbf{A} \approx \sum_j^{} \v^{n+1}_j \cdot %\textbf{A}_j = 0.
%\end{align}

%\begin{align}\label{eq:q_poissonL_i}%\label{eq:q}
%\int_{\Omega_i} \Delta q^{n+1} d \Omega = \int_{\Omega_i} -\nabla \cdot \textbf{H}(\v^{n+1}) d \Omega
%\end{align}

%The integral form of eq.~(\ref{eq:q_poissonL}) for each volume $\Omega_i$ is given by:
%\begin{align}\label{eq:q_poissonL_i}%\label{eq:q}
%\int_{\Omega_i} \Delta q^{n+1} d\Omega = -\rho \int_{\Omega_i} \nabla \cdot ((\u^* \cdot \nabla ) \v^{n+1} + \f^{n+1}) d\Omega%\el
%\end{align}


%The integral form of eq.~(\ref{eq:q_poissonL}) for each volume $\Omega_i$ is given by:
%\begin{align}\label{eq:q_poissonL_i}%\label{eq:q}
%\int_{\Omega_i} \Delta q^{n+1} d\Omega = -\rho \int_{\Omega_i} \nabla \cdot ((\u^* \cdot \nabla ) \v^{n+1} + \f^{n+1}) d\Omega%\el
%\end{align}

%By applying the Gauss-divergence theorem, eq.~\eqref{eq:q_poissonL_i} becomes:
%\begin{align}\label{eq:q_poissonL_i2}%\label{eq:q}
%\int_{\partial \Omega_i} \nabla q^{n+1} \cdot d\textbf{A} = -\rho \int_{\partial \Omega_i} ((\u^* \cdot \nabla ) \v^{n+1} + \f^{n+1}) \cdot d\textbf{A}%\el
%\end{align}

%Each term in eq.~\eqref{eq:q_poissonL_i2} is approximated as follows:
%\begin{itemize}
%\item[-] \textit{pressure term}: 
%\begin{align}
%\int_{\partial \Omega_i} \nabla q^{n+1} \cdot d\textbf{A} \approx \sum_j^{} (\nabla q^{n+1})_j \cdot \textbf{A}_j,
%\end{align} 
%where $(\nabla q^{n+1})_j$ is the gradient of $q^{n+1}$ at the faces. It is approzimated in the same
%way as $(\nabla\u^{n+1})_j$.
%\item[-] \textit{velocity term}: 
%\begin{align}
%\int_{\partial \Omega_i} (\nabla \v^{n+1} \cdot d\textbf{A}) \cdot \u^* \approx \sum_j^{} ((\nabla\v^{n+1})_j\cdot \textbf{A}_j)\cdot \u^{*}_j
%\end{align} 
%where $(\nabla\v^{n+1})_j$ is the symmetrized gradient of $\v^{n+1}$ at the faces. It is approzimated in the same
%way as $(\nabla\u^{n+1})_j$; see sec.~\ref{subsec:space-discrete-evolve}. 
%\item[-] \textit{external forcing term}: 
%\begin{align}
%\int_{\partial \Omega_i} \f^{n+1} \cdot d\textbf{A} \approx \sum_j^{} \f^{n+1}_j \cdot \textbf{A}_j,
%\end{align} 
%where $\f^{n+1}_j$ is the value of the external force at the faces. %It is approzimated in the same
%way as $(\nabla\u^{n+1})_j$; see sec.~\ref{subsec:space-discrete-evolve}. 
%\end{itemize}

%Then, the discretised form of the eq.~\eqref{eq:q_poissonL_i2} related to each control volume $\Omega_i$ can be expressed as 
%\begin{align}\label{eq:q_poissonL_i2_d}
%\sum_j^{} (\nabla q^{n+1})_j \cdot \textbf{A}_j = - \rho \sum_j^{} ((\nabla\v^{n+1})_j\cdot \textbf{A}_j)\cdot \u^{*}_j + %%%5%\sum_j^{} \f^{n+1}_j \cdot \textbf{A}_j
%\end{align} 
Finally, the fully discretized form of problem \eqref{eq:evolve-1.1}-\eqref{eq:evolve-1.2} is given by system~\eqref{eq:evolveFV-1.1_disc},\eqref{eq:q_poissonL_iii}. In this work, we choose 
a partitioned approach to deal with the pressure-velocity coupling. The partitioned algorithms 
available in OpenFOAM\textsuperscript{\textregistered} are SIMPLE \cite{SIMPLE} for steady-state problems, and PISO \cite{PISO} and PIMPLE \cite{PIMPLE} for transient problems. For the results reported in 
Sec.~\ref{sec:num_res}, we used the PISO algorithm. The splitting of operations in the solution of the discretised momentum and pressure equations gives rise to a formal order of accuracy of the order of powers of $\Delta t$ depending on the number of operation-splittings used (see \cite{PISO} for more details).
We remark that in the OpenFOAM\textsuperscript{\textregistered} implementation of the PISO solver the mass flux is modified through an additional term than can cause artificial dissipation and is not a part of the original PISO algorithm in \cite{PISO}. 
%This \emph{extra term} influences the divergence of the face velocity by taking out the difference between the interpolated velocity and the flux. 
See \cite{ddtPhiCorr} for more details.

%\textcolor{red}{Anna, ho aggiunto qualche dettaglio in piu' sull'implementazione di PISO in OpenFOAM che non e' esattamente quella standard}

%System~\eqref{eq:evolveFV-1.1_disc},\eqref{eq:q_poissonL_iii} couples velocity and pressure.
%In order to reduce the computational cost, we consider a segregated approach to decouple
%the computation of velocity and pressure.
%The segregated algorithms available in OpenFOAM\textsuperscript{\textregistered}
%are SIMPLE \cite{SIMPLE}, PISO \cite{PISO} and PIMPLE \cite{PIMPLE}. 
%For this work, we choose the PISO algorithm. \anna{Abbiamo una ragione per scegliere PISO?} \textcolor{red}{PIMPLE e' una fusione tra SIMPLE e PISO, nel senso che l'algoritmo di risoluzione presenta per ogni time step sia cicli di correzione "interni" (sull'equazione di Poisson per la pressione) come PISO sia cicli di correzione "esterni" (sull'intera procedura segregata) come SIMPLE. Mettendo da parte SIMPLE che e' ottimizzato per problemi stazionari, PISO e PIMPLE vengono usati entrambi per problemi time-dependent. Una vera e propria ragione per la quale ho scelto PISO anziche' PIMPLE non te la saprei dare sinceramente. PISO e' quello che uso piu' spesso; anche la DNS che ti feci vedere e che inseriro' nel paragrafo dei risultati e' stata fatta con PISO.} \anna{Ok! E' chiaro che SIMPLE non e' indicato per il nostro problema.
%Se non abbiamo una ragione per scegliere PISO invece di PIMPLE, direi cmq di riportare
%l'errore di splitting introdotto da PISO perche' e' un'informazione importante.}




%FILTER STEP
\subsection{Numerical discretization for the \emph{filter} step of the problem} % \eqref{eq:filter-1.1},\eqref{eq:filter-1.2}
\label{subsec:space-discrete-filter}

%The same approach applied to the \emph{evolve} step let us to obtain 
%\anna{RIPRENDI DA QUI Michele, guarda il nuovo remark 1.1.} \textcolor{red}{Il remark 1.1 e' perfetto! Pero' forse, alla luce dell'osservazione sulla convergenza del filter step, eviterei di sistemare le equazioni con il /$Delta_t$, che ne pensi?} 

In this subsection, we present the discretization of the filter problem \eqref{eq:filter-1.1},\eqref{eq:filter-1.2}.
The integral form of the eq.~(\ref{eq:filter-1.1}) for each volume $\Omega_i$ is given by:
\begin{align}%\label{eq:FV1}
\frac{\rho}{\Delta t}\int_{\Omega_i} \vbar^{n+1} d \Omega - \int_{\Omega_i} \div \left(\mubar \nabla\vbar^{n+1}\right) d \Omega + \int_{\Omega_i} \nabla \qbar^{n+1} d \Omega & = \frac{\rho}{\Delta t} \int_{\Omega_i} \v^{n+1} d \Omega. \label{eq:disc_filter_momFV}
\end{align}
By making use of the Gauss-divergence theorem, eq.~\eqref{eq:disc_filter_momFV} becomes:
\begin{align}\label{eq:FV1}
\frac{\rho}{\Delta t}\int_{\Omega_i} \vbar^{n+1} d \Omega - \int_{\partial \Omega_i} \mubar \nabla\vbar^{n+1} \cdot d\textbf{A}  + \int_{\partial \Omega_i}\qbar^{n+1} d\textbf{A} & = \frac{\rho}{\Delta t} \int_{\Omega_i}{\v}^{n+1} d\Omega.
\end{align}
Like in Sec.~\ref{subsec:space-discrete-evolve}, we proceed with providing the 
approximation of each term in eq.~\eqref{eq:FV1}:

\begin{itemize}
\item[-] \textit{Gradient term}: 
\begin{align}
\int_{\partial \Omega_i}\qbar^{n+1} d\textbf{A} \approx \sum_j^{} \qbar^{n+1}_j \textbf{A}_j,
\end{align} 
where $\qbar_j^{n+1}$ is the value of the auxiliary pressure associated to the centroid of the $j^{\text{th}}$ face.
\item[-] \textit{Diffusion term}: 
\begin{align}
\int_{\partial \Omega_i} \mubar\nabla\vbar^{n+1} \cdot d\textbf{A} \approx \sum_j^{} \mubar_j(\nabla\vbar^{n+1})_j \cdot \textbf{A}_j,
\end{align} 
where $(\nabla\vbar^{n+1})_j$ is the gradient of $\vbar^{n+1}$ at face $j$. It is approximated in the same
way as $(\nabla\v^{n+1})_j$; see Sec.~\ref{subsec:space-discrete-evolve}. 
\end{itemize}

Upon division by the volume of $\Omega_i$, the discretized form of the eq.~\eqref{eq:FV1} can be written as 
\begin{align}\label{eq:evolveFV-2.1_disc}
\frac{\rho}{\Delta t} \vbar^{n+1}_i - \sum_j^{} \mubar_j(\nabla\vbar^{n+1}_i)_j \cdot \textbf{A}_j +  \sum_j^{} \qbar^{n+1}_{i,j} \textbf{A}_j = \frac{\rho}{\Delta t} \v^{n+1}_i.
\end{align}
In eq.~\eqref{eq:evolveFV-2.1_disc}, we denoted with $\vbar^{n+1}_i$ the average filtered velocity 
in control volume $\Omega_i$, while $\qbar^{n+1}_{i,j}$ is the auxiliary pressure
at the centroid of face $j$ normalized by the volume of $\Omega_i$.


%\anna{Anche qui riporterei tutta l'equazione \eqref{eq:FV1} discretizzata. } \textcolor{red}{Fatto!}

%Next, we take the divergence of the eq.~(\ref{eq:evolve-2.1}) and make use of eq.~(\ref{eq:filter-1.2})
%to obtain:
%\begin{align}\label{eq:lambda2}
%\Delta \qbar^{n+1} = -\alpha^2 \div \left(\div \left(a(\v^{n+1}) \nabla\vbar^{n+1}\right)\right).
%\end{align}
%\textcolor{red}{
%Anna, ho preferito togliere tutta la trattazione relativa al caso particolare in cui a = 1 e quindi l'equazione di Poisson si particolarizza in quella di Laplace; penso sia ridondante. Fammi sapere che ne pensi :) 
%Inoltre sei d'accordo che per a variabile non possiamo dire che divergenza di laplaciano = laplaciano di divergenza = 0 per la continuita'? Se si svolgono tutti i calcoli esce fuori un termine in piu' che dipende dal gradiente di a. Confermi?}
%\anna{Si'.}
%Notice that if $\vbar^{n+1}$ is known, eq.~\eqref{eq:lambda2} is a Poisson problem. %In the particular case of the classical Leray-$\alpha$ model, eq.~\eqref{eq:lambda2} becomes a Laplace problem.
%\begin{align}\label{eq:lambda1}
%\Delta \lambda^{n+1} = 0.
%\end{align}


%The space discretization of the equation \eqref{eq:lambda1} is readily obtained by integrating 
%over the control volume $\Omega_i$ and by making use of the Gauss-divergence theorem:
%\begin{align}%\label{eq:q_poisson_ll}%\label{eq:q}
%\int_{\partial \Omega_i} \Delta \lambda^{n+1} d \Omega_i = \int_{\partial \Omega_i} \nabla \lambda^{n+1}\cdot d \textbf{A} = 0.\el
%\end{align}
%Once again, we divide by the volume of $\Omega_i$ to get
%\begin{align}\label{eq:q_poisson_ll}%\label{eq:q}
%\sum_j^{} (\nabla \lambda^{n+1}_i)_j \cdot \textbf{A}_j = 0,
%\end{align}
%where $(\nabla \lambda_i^{n+1})_j$ is the gradient of $\lambda^{n+1}_i$ at the faces and it is
%approximated in the same way as $(\nabla\u^{n+1})_j$. \anna{Attenzione: uno e' la parte 
%simmetrica del gradiente e l'altro e' solo il gradiente.}

%\anna{Ho riformulato il paragrafo seguente, per favore guarda se e' tutto giusto.}
Next, we rewrite eq.~\eqref{eq:evolveFV-2.1_disc} in semi-discretized form, i.e.~with 
the pressure term in continuous form while all the other terms
are in discrete form, take its divergence and use eq.~\eqref{eq:filter-1.2} to get:
\begin{align}\label{eq:q_poissonNL_p1}
\Delta \qbar^{n+1} = \nabla \cdot \overline{\textbf{H}}(\vbar^{n+1}), ~\text{with} \quad\overline{\textbf{H}}(\vbar^{n+1}) =  \sum_j^{} \mubar_j(\nabla\vbar^{n+1}_i)_j \cdot \textbf{A}_j + \dfrac{\rho}{\Delta t}\v^{n+1}.
\end{align}
%with 
%\begin{align}
%\overline{\textbf{H}}(\vbar^{n+1}) = \alpha^2 \sum_j^{} (a(\v^{n+1}_i))_j(\nabla\vbar^{n+1}_i)_j \cdot \textbf{A}_j - \vbar^{n+1}% \quad  \text{with} \quad 
%%\overline{\textbf{D}}(\v^{n+1}) = \anna{dobbiamo definirlo}. \el
%\end{align}
%\anna{Ho messo una barra sopra $\textbf{H}$ e $\textbf{D}$ perche' non sono gli stessi della sezione precedente. }
%the approximation of the equation \eqref{eq:lambda2} is obtained by starting from a reworked version of the equation \eqref{eq:evolveFV-2.1_disc} in which the pressure term is expressed in continuous form. By indicating with $\textbf{H}(\vbar^{n+1})$ the approximation of the diffusion term, we obtain
%
%\begin{align}\label{eq:q_poissonNL_i}%\label{eq:q}
%\vbar^{n+1} - \v^{n+1}= - \nabla \lambda^{n+1} + \textbf{H}(\vbar^{n+1}).
%\end{align}
%Next, by taking the divergence of the equation \eqref{eq:q_poissonNL_i} and using both eq.~(\ref{eq:evolve-1.2}) and eq.~(\ref{eq:filter-1.2}) we have
By integrating eq.~\eqref{eq:q_poissonNL_p1} over the control volume $\Omega_i$ and by applying the Gauss-divergence theorem, we obtain
\begin{align}\label{eq:q_poissonNL_p2}%\label{eq:q}
\int_{\partial \Omega_i} \nabla \qbar^{n+1} \cdot d\textbf{A} = \int_{\partial \Omega_i} \overline{\textbf{H}}(\vbar^{n+1}) \cdot d\textbf{A}.
\end{align}
Finally, we divide by the volume of $\Omega_i$ to get
\begin{align}\label{eq:q_poissonNL_iii}%\label{eq:q}
\sum_j^{} (\nabla \qbar^{n+1}_i)_j \cdot \textbf{A}_j = \sum_j^{} (\overline{\textbf{H}}(\vbar^{n+1}_i))_j \cdot \textbf{A}_j. 
\end{align}
%where $(\nabla \lambda^{n+1})_j$ is the gradient of $\lambda^{n+1}$ at the faces approximated in the same
%way as $(\nabla\u^{n+1})_j$.

%\anna{E riporterei la forma integrale anche di questa equazione e la sua approssimazione.} \textcolor{red}{Fatto!} 

The fully discrete problem associated to the filter is given by \eqref{eq:evolveFV-2.1_disc}, \eqref{eq:q_poissonNL_iii}. 
Also for this problem, we choose a partitioned algorithm:
a slightly modified version of the SIMPLE algorithm, called SIMPLEC algorithm \cite{Doormaal1984},
that features improved and accelerated convergence towards a steady state solution.
We found that the SIMPLEC algorithm is a necessary choice for the filter problem in the Leray-$\alpha$ model,
because the standard SIMPLE algorithm does not converge. On the other hand, 
the SIMPLE algorithm does converge for the filter problem in the Leray-$\alpha$-NL model.  
%As noted in remark \ref{rem:gen_Stokes}, the filter problem can be viewed as a
%generalized Stokes problem. The fictitious time derivative term in eq.~\eqref{eq:evolve-2.1}
%\anna{(usi l'eq. \eqref{eq:evolve-2.1} cosi' com'e' o la dividi per $\Delta t$?)} \textcolor{red}{La divido per $\Delta t$! Quindi utilizzo una doppia strategia per accelerare la convergenza: derivata fittizia in tempo + SIMPLEC! Quindi immagino che l'equazione a cui riferirsi sia la (24)}
%allows to underrelax the SIMPLEC scheme. Consequently, the convergence towards a steady state solution
%is accelerated and improved.

%Notice that this approach is substantially equivalent to local time stepping 
%\cite{simple_modified}.

For the Leray-$\alpha$-NL model, we also need to approximate %$F_H(\v^{n+1}) = \tilde{\v} ^{n+1}$, i.e.
%we need to approximate 
the solution to problem \eqref{eq:vtilde}. 
After using Gauss-divergence theorem, the integral form of eq.~\eqref{eq:vtilde} reads:
\begin{align}\label{eq:Helmholz_int}
\int_{\Omega_i}  \tilde{\v} ^{n+1} d \Omega - \alpha^2\int_{\partial \Omega_i}\nabla \tilde{\v} ^{n+1} \cdot d\textbf{A} = \int_{\Omega_i}\v^{n+1} d \Omega.
\end{align} 
We approximate the diffusion term as:
\begin{align}
\int_{\partial \Omega_i}\nabla \tilde{\v} ^{n+1} \cdot d\textbf{A} \approx \sum_j^{} (\nabla \tilde{\v} ^{n+1})_j \cdot \textbf{A}_j, \el
\end{align} 
where $(\nabla \tilde{\v} ^{n+1})_j$ is treated in the same way as 
$(\nabla\v^{n+1})_j$ and $(\nabla\vbar^{n+1})_j$. Once we divide by the volume of $\Omega_i$, the space
discretized form of eq.~\eqref{eq:Helmholz_int} is 
\begin{align}\label{eq:disc_F}
\tilde{\v} ^{n+1}_i - \alpha^2 \sum_j^{} (\nabla \tilde{\v} ^{n+1}_i)_j \cdot \textbf{A}_j = \v^{n+1}_i,
\end{align} 
where $\tilde{\v} ^{n+1}_i$ is the average value of $\tilde{\v} ^{n+1}$ in control volume $\Omega_i$. 

%in order to improve convergence, the equation is converted to a parabolic form by the addition of a time derivative so to obtain the steady state solution through the method of the false transient \ref{}.%{Journal of Computational Physics
%Volume 12, Issue 4, August 1973, Pages 435-461} 

%the equation \ref{} is solved by making use of the method of the false transient;is solved by making use of the method of the false transient \ref{}; 

%a temporal derivative term is introduced in equation  his term is used to solve steady-state design problems by the method of false transients



\section{Conclusions and Perspectives}\label{sec:conclusions}

We showed the effectiveness of a FV-based EFR algorithm in simulating flow problems at moderately large Reynolds numbers. Nonlinear filtering stabilizes marginally resolved scales without over-diffusing, thereby allowing to use less degrees of freedom than required by a DNS. To select the regions of the domain where filtering is needed, we employ a nonlinear differential low-pass filter.
The interest in the Finite Volume approximation is due to the fact that it has been widely used in the LES context. 
However, the application of the Leray model in a FV framework has been unexplored.
%The numerical implementation of this filtering technique is a three-step algorithm that can be
%realized by a legacy Navier–Stokes solver. In fact, the evolve step is a Navier–Stokes problem that
%can be handled by the existing solver and filter step is a Stokes-like problem and can be handled by
%the same solver without major modification of the code. Such an algorithm can also be interpreted as
%an operator-splitting method for the time discretization of a perturbed version of the Navier–Stokes
%equations. This interpretation outlines the impact of the filter as an extra-diffusion. In addition, it
%allows to identify the impact of non-Dirichlet boundary conditions.

In order to showcase the features of our approach, we presented a computational study related to two benchmarks: 2D flow past a cylinder and a 3D benchmark from the FDA. %We compared our results against numerical data provided in the literature for the 2D test, and against experimental measurements for the 3D test. 
With reference to the FDA benchmark, we performed a complete characterization of the flow at Reynolds numbers starting from 2000 up to 6500. We proposed a new formula based on physical and numerical arguments to tune a value of $\chi$ that leads to very good agreement with the experimental measurements. Several meshes were considered to understand how under-refined the mesh can be while still capturing the physical average quantities. Furthermore, we investigated the impact of the mesh features as well as the discretization of the convective term on the results obtained.

As a follow-up of the present work, we are going to develop a Leray Reduced Order Model (ROM) within a Finite Volume framework. We are also interested in coupling the Leray model with an elasticity model
to simulate fluid-structure interaction problems which are ubiquitous 
in science and engineering.

\section{Acknowledgements}\label{sec:acknowledgements}
We acknowledge the support provided by the European Research Council Executive Agency by the Consolidator Grant project AROMA-CFD ``Advanced Reduced Order Methods with Applications in Computational Fluid Dynamics" - GA 681447, H2020-ERC CoG 2015 AROMA-CFD and INdAM-GNCS projects.
This work was also partially supported by US National Science Foundation through grant  DMS-1620384.

%for $c_{l,max}$ and $c_{d,max}$ at the lowest value of $\alpha$; on the other hand, for $\alpha = \eta$, predictions are less accurate as the mesh is refined. This behaviour could depend on the fact that, for meshes $63k_H$ and $120K_H$, being $h_{min}<\eta$, the Kolmogorov scale is already properly solved; therefore, in these cases, $\alpha \leq h_{min}$ could be a better choice than $\alpha = \eta$ because the region where the filter has a significant effect could include a too much number of cells and ultimately provide more inaccurate results.

%we observe that EF L algorithm with $\alpha = h_{min}$ provides much better maximum drag coefficients than NSE; also EF L alghorithm with $\alpha = \eta$ gives good predictions for $c_{d,max}$ except for mesh $120k_H$ where the error is greater than NSE algorithm (2\% against 0.87\%). On the other hand, the maximum lift coefficient is computed very inaccurately by the linear filter. EF NL algorithm with $\alpha = h_{min}$ provides much better predictions for $c_{l,max}$ than NSE; also EF NL alghorithm with $\alpha = \eta$ gives good predictions for the maximum lift coefficient except for mesh $120k_H$ where the error is greater than NSE (3.43\% against 2.42\%). Concerning $c_{d,max}$, although the computations provided by EF NL are less accurate than EF L and NSE, the error does not exceed 6.32 \% maximum (that is verified only for mesh $120k_H$ and $\alpha = \eta$). Note that, on every mesh, EF NL provides better results for $c_{l,max}$ and $c_{d,max}$ at the lowest value of $\alpha$; on the other hand, for $\alpha = \eta$, predictions are less accurate as the mesh is refined. This behaviour could depend on the fact that, for meshes $63k_H$ and $120K_H$, being $h_{min}<\eta$, the Kolmogorov scale is already properly solved; therefore, in these cases, $\alpha \leq h_{min}$ could be a better choice than $\alpha = \eta$ because the region where the filter has a significanft effect could include a too much number of cells and ultimately provide more inaccurate results. %Overall, it seems that EF NL algorithm with $\alpha = \text{min}\{\eta, h_{min}\}$ provides a good compromise. %of course this issue becomes more critical when the mesh is refined and the number of cells increases.

%Results obtained on prismatic meshes are now discussed. On mesh $16k_P$, EF L alghorithm for both values of $\alpha$ provides inaccurate computations as well as the NL one for $\alpha = h_{min}$. On the contrary, EF NL alghorithm for $\alpha = \eta$ performs well for both $c_{d,max}$ and $c_{l,max}$. On mesh $25k_P$, EF NL for both values of $\alpha$ as well as EF L for $\alpha = h_{min}$ are not able to provide good predictions whilst EF L for $\alpha = \eta$ works fine. The same observations are valid for mesh $63k_P$. The failure of the EF NL algorithm on meshes $25k_P$ and $63k_P$ could depend on the fact that, as discussed previously, the NSE algorithm exhibits higher errors on these meshes than the coarser mesh $16k_P$ and therefore, in order to properly extract right information from unresolved scales, it could be necessary to introduce a uniform amount of diffusion in order to obtain a good regularization in every region of the domain. On mesh $120k_P$, no filter seems to be able to improve results provided by NSE related to $Cd_{max}$ whilst EF NL algorithm for both values of $\alpha$ performs well for $Cl_{max}$.

%This behaviour could depend on the fact that for the coarser meshes ($16k_H$ and $25k_H$), being $h_{min}>\eta$, $\alpha =h_{min}$ represents a filtering radius too b  
%suggests that %set \alpha to be less than $h_min$ the filter performs better when the filtering radius is at the most equal to 
%could depend on the fact that 
%(the error is 1.88\% against 5.64\% by NSE) 
%Results obtained on prismatic meshes are now discussed. On mesh $16k_P$, EF L alghorithm provides inaccurate computations as well as the NL one for $\alpha = h_{min}$. On the contrary, EF NL alghorithm for $\alpha = \eta$ performs well for both $c_{d,max}$ and $c_{l,max}$. On mesh $25k_P$, EF NL for both values of $\alpha$ as well as EF L for $\alpha = h_{min}$ are not able to provide good predictions whilst EF L for $\alpha = \eta$ works fine; the error for $c_{l,max}$ is 6.48\% against 16.73\% by NSE and an error on $c_{d,max}$ of 0.5\% against 2.4\% of NSE. The same observations are valid for mesh $63k_P$, where EF L for $\alpha = h_{min}$ provide errors of 6.27\% against 17.36\% of NSE and of 1.93\% against 1.63\% of NSE, for $c_{l,max}$ and $c_{d,max}$ respectively. The failure of the EF NL algorithm on meshes $25k_P$ and $63k_P$ could depend on the fact that, as discussed previously, the NSE algorithm exhibits higher values of $C_{l,max}$ on these meshes respect to mesh $16k_P$ and therefore could be necessary to introduce a global filter in order to obtain a good regularization in every region of the domain. 

%Results obtained on prismatic meshes are now discussed. On mesh $16k_P$, EF L alghorithm provides inaccurate computations as well as the NL one for $\alpha = h_{min}$. On the contrary, EF NL alghorithm for $\alpha = \eta$ performs well for both $c_{d,max}$ and $c_{l,max}$. On mesh $25k_P$, EF NL for both values of $\alpha$ as well as EF L for $\alpha = h_{min}$ are not able to provide good predictions whilst EF L for $\alpha = \eta$ works fine; the error for $c_{l,max}$ is 6.48\% against 16.73\% by NSE and an error on $c_{d,max}$ of 0.5\% against 2.4\% of NSE. The same observations are valid for mesh $63k_P$, where EF L for $\alpha = h_{min}$ provide errors of 6.27\% against 17.36\% of NSE and of 1.93\% against 1.63\% of NSE, for $c_{l,max}$ and $c_{d,max}$ respectively. The failure of the EF NL algorithm on meshes $25k_P$ and $63k_P$ could depend on the fact that, as discussed previously, the NSE algorithm exhibits higher values of $C_{l,max}$ on these meshes respect to mesh $16k_P$ and therefore could be necessary to introduce a global filter in order to obtain a good regularization in every region of the domain. 

%Ultimately, the EF L algorithm with $alpha = h_{min}$ increases the phase advance of $c_l$ curves on meshes $16k_P$ and $25k_P$ where the spread is 11\% maximum. In all other cases, the error does not exceed 1.5\% being substantially comparable to NSE alghorithm. On the other hand, the uncertainty estimate of the values of $t(cd_{l,max})$ is lower than 1\% except for EF L algorithm on all meshes where is 1.7\% maximum. 

%Therefore, EF NL algorithm provides a good compromise. 
%Note that, for each mesh, EF NL algorithm provide better predictions for both $c_{l,max}$ and $c_{d,max}$ for the lower tested $\alpha$ and it could be worth observing that, for $\alpha = \eta$ (i.e., at fixed $\alpha$), the results became less accurate as the mesh is refined. This behaviour could depend on the fact that if the local filtering radius is too big the region where the filter has a significant effect could include a too much number of cells; of course this issue becomes more critical when the mesh is refined and the number of cells increases.

%The results obtained on prismatic meshes are ...On mesh $16k_P$, EF L alghorithm provides inaccurate results as well as the NL one for $\alpha = h_{min}$. On the contrary, EF NL alghorithm for $\alpha = \eta$ works very well for both $c_{d,max}$ (error of 1.88\% against 5.64\% of NSE algorithm) and $c_{l,max}$ (error of 1.67\% against 2.93\% of NSE algorithm). On mesh $25k_P$, EF NL for both values of $\alpha$ as well as EF L for $\alpha = h_{min}$ are not able to provide good predictions whilst EF L for $\alpha = h_{min}$ works fine; we obtain an error on $c_{l,max}$ of 6.48\% against 16.73\% of NSE and an error on $c_{d,max}$ of 0.5\% against 2.4\% of NSE. The same observations are valid for mesh $63k_P$, where EF L for $\alpha = h_{min}$ provide errors of 6.27\% against 17.36\% of NSE and of 1.93\% against 1.63\% of NSE, for $c_{l,max}$ and $c_{d,max}$ respectively. The failure of the EF NL algorithm on meshes $25k_P$ and $63k_P$ could depend on the fact that, as discussed previously, the NSE algorithm exhibits higher values of $C_{l,max}$ on these meshes respect to mesh $16k_P$ and therefore could be necessary to introduce a global filter in order to obtain a good regularization in every region of the domain. 

%Finally, the EF L algorithm with $alpha = h_{min}$ increases the phase advance of $c_l$ curves on meshes $16k_P$ and $25k_P$ where the spread is 11\% maximum. In all other cases, the error does not exceed 1.5\% being substantially comparable to NSE alghorithm. On the other hand, the uncertainty estimate of the values of $t(cd_{l,max})$ is lower than 1\% except for EF L algorithm on all meshes where is 1.7\% maximum. 
%One observes from Table 3 that rNS-α provides much better max lift and drag coefficients than the
%coarse mesh NSE. The reference values come from upwards of 107 dof simulations, and it is remarkable
%the rNS-α gets this level of accuracy on such a coarse discretization.


%A quanto pare sembra che per ogni mesh il Cdmax peggiore venga fornito dal filtro NON LINEARE (tra l'altro per eccesso), a parte la mesh 16 kp dove e' il filtro lineare a forniro (per difetto). (RIVEDERE QUESTA CONSIDERAZIONE)
%Il filtro NON LINEARE (sia hmin che K) fallisce misearamente sulla mesh 63kp perche', oltre a fornire pessimi valori di cdmax, fornsice anche valori di clmax superiori a quelli forniti dalla DNS (sebbene di poco). CIoe' il filtro non lineare sulla emsh 63kp va buttato! (DA RIVEDERE)


%(for a quantitative comparison see Table \ref{tab:3})
%Although the discrepance both in terms of amplitude and phase significantly reduces for meshes not so far from that one required for performing a DNS (i.e., $120k_P$ and $120k_H$), it is clear that the convergence towards the \emph{true} solution does not result to be monothonic by reducing the refinement degree. 
%especially for meshes $25k$ and $63k$ 

%\begin{table}
%\centering
%\begin{tabular}{cccccccc}
%\firsthline
%\multicolumn{2}{c}{} \\
%\cline{1-8}
%Mesh name & Algorithm   & $t(c_{l,max})$ & $c_{l,max}$ & $t(c_{d,max})$ & $c_{d,max}$ & $E_{c_d}$ & $E_{c_l}$   \\
%\hline
%$16k_H$ & NSE  & 5.79   & 0.574  & 3.947  & 3.074 & 15.95\% & 2.94\%  \\
%$16k_H$ & EF L, $\alpha$ = $h_{min}$ & 5.74   & 0.415   & 4  & 2.965 & -16.16\% & -0.7\%  \\
%$16k_H$ & EF NL, $\alpha$ = $h_{min}$ & 5.789   & 0.502  & 3.939  & 3.136  & 1.41\% & 5.02\% \\
%$16k_H$ & EF L, $\alpha$ = $\eta$  & 5.767  & 0.375  & 3.933 & 2.981  & -24.24\% & -0.16\%\\
%$16k_H$ & EF NL, $\alpha$ = $\eta$  & 5.788   & 0.499  & 3.944 & 3.1  & 0.8\% & 3.81\% \\
%$16k_P$ & NSE & 5.769 & 0.505  & 3.928 & 2.906  & 5.64\% & -2.93\%\\
%$16k_P$ & EF L, $\alpha$ = $h_{min}$  & 6.322  & 0.165  & 3.921   & 2.736 & -65.48\% & -8.61\%  \\
%$16k_P$ & EF NL, $\alpha$ = $h_{min}$ & 5.754   & 0.417  & 3.931 & 3.083  & -12.76\% & 2.97\% \\
%$16k_P$ & EF L, $\alpha$ = $\eta$  & 5.771   & 0.397    & 4 & 2.83  & -16.94\% & -5.47\% \\
%$16k_P$ & EF NL, $\alpha$ = $\eta$  & 5.764   & 0.469  & 3.937 & 2.944  & -1.88\% & -1.67\% \\
%$25k_H$ & NSE  & 5.743   & 0.533  &  3.929 & 3.057  & 7.67\% & 2.37\%\\
%$25k_H$ & EF L, $\alpha$ = $h_{min}$ & 5.796   & 0.371   & 3.962   & 2.98 & -25.05\% & -0.2\%   \\
%$25k_H$ & EF NL, $\alpha$ = $h_{min}$ & 5.74   & 0.501  & 3.964  & 3.119   & 1.21\%  & 4.45\%  \\
%$25k_H$ & EF L, $\alpha$ = $\eta$  &  5.777  & 0.413  & 4  &  2.984 & -16.56\%  & -0.06\% \\
%$25k_H$ & EF NL, $\alpha$ = $\eta$  & 5.739 & 0.501  & 3.959  & 3.106 & 1.21\%  & 4.01\% \\
%$25k_P$ & NSE  & 5.80   & 0.558  & 3.946  & 3.066  & 16.73\% & 2.4\% \\
%$25k_P$ & EF L, $\alpha$ = $h_{min}$  & 6.369  & 0.261   & 4   & 2.909 & -45.39\% & -2.83\%   \\
%$25k_P$ & EF NL, $\alpha$ = $h_{min}$ & 5.803  & 0.514  & 3.938  & 3.33  & 7.53\% & 11.22\% \\
%$25k_P$ & EF L, $\alpha$ = $\eta$  &  5.808  & 0.447  & 3.941 & 3.009 & -6.48\% & 0.5\% \\
%$25k_P$ & EF NL, $\alpha$ = $\eta$  &  5.794  & 0.54  & 3.931 & 3.147 & 12.97\% & 5.11\%  \\
%$63k_H$ & NSE & 5.739 & 0.515 &  3.945 & 3.028  & 4.04\% & 1.4\% \\
%$63k_H$ & EF L, $\alpha$ = $h_{min}$ & 5.738  & 0.463  & 3.927  & 2.978 & -6.46\% & -0.26\%    \\
%$63k_H$ & EF NL, $\alpha$ = $h_{min}$ & 5.733  & 0.508  & 3.96  & 3.057  & 2.62\%  & 2.37\%  \\
%$63k_H$ & EF L, $\alpha$ = $\eta$  &  5.757  & 0.421  & 4 & 3.007 & -14.94\% & 0.7\%  \\
%$63k_H$ & EF NL, $\alpha$ = $\eta$  &  5.74  & 0.511  & 3.894 & 3.148  & 3.23\% & 5.42\% \\
%$63k_P$ & NSE  & 5.737 & 0.561    &  3.943 &  3.043  & 17.36\% & 1.63\% \\
%$63k_P$ & EF L, $\alpha$ = $h_{min}$  & 5.757  & 0.416  & 4   & 2.922  & -12.97\% & -2.4\%  \\
%$63k_P$ & EF NL, $\alpha$ = $h_{min}$  & 5.74   & 0.583  & 3.95  & 3.29  & 21.96\% & 9.88\%  \\
%$63k_P$ & EF L, $\alpha$ = $\eta$  &   5.755 & 0.448  & 4 & 2.936  & -6.27\% & -1.93\% \\
%$63k_P$ & EF NL, $\alpha$ = $\eta$  &  5.739  &  0.568   & 3.933 & 3.217  & 18.82\% & 7.44\% \\
%$120k_H$ & NSE & 5.724 & 0.507 &  3.936 & 3.012   & 2.42\% & 0.87\%\\
%$120k_H$ & EF L, $\alpha$ = $h_{min}$  & 5.721 & 0.469   & 3.922  & 2.973 & -5.25\% & -0.43\%   \\
%$120k_H$ & EF NL, $\alpha$ = $h_{min}$  & 5.722  & 0.497  & 3.944  & 3.024  & 0.4\% & 1.27\%  \\
%$120k_H$ & EF L, $\alpha$ = $\eta$  &  5.726  & 0.408   & 4 & 2.926  & -17.57\% & -2\% \\
%$120k_H$ & EF NL, $\alpha$ = $\eta$  & 5.726  & 0.512  & 3.936 & 3.175  & 3.43\%  & 6.32\%\\
%$120k_P$ & NSE & 5.737 &  0.484  &  3.935 & 3.012  & 1.25\% & 0.6\% \\
%$120k_P$ & EF L, $\alpha$ = $h_{min}$  & 5.734  & 0.412  & 3.931  & 2.914 & -13.8\% & -2.67\%   \\
%$120k_P$ & EF NL, $\alpha$ = $h_{min}$  & 5.739  & 0.474  & 3.998 & 3.225  & -0.83\% & 7.71\%  \\
%$120k_P$ & EF L, $\alpha$ = $\eta$  &  5.743  & 0.388  & 3.931 & 2.899  & -18.82 \% & -3.17\% \\
%$120k_P$ & EF NL, $\alpha$ = $\eta$  &  5.739  & 0.475  & 3.998 & 3.314  & -0.62\% & 10.68\% \\
%$200k_H$ & NSE  &  5.716  & 0.495  &  3.934 & 2.986 & / & /\\
%$200k_P$ & NSE  & 5.726   & 0.478    & 3.939 & 2.994 & / & / \\
%\lasthline
%\hline
%\end{tabular}
%\caption{2D flow past a cylinder: maximum lift and drag coefficients for various meshes, alghoritms and parameters. \textcolor{red}{Anna, vedi che ho segnato $\alpha$ perche' di fatto considero come raggio di filtrazione sqrt(2) * $\delta$ (la formulazione del BQRV per intenderci)...poi vediamo se modificare qui o cambiare nel modello descritto nei paragrafi precedenti}}
%\label{tab:2}
%\end{table}

\section{The Elsevier article class}

\paragraph{Installation} If the document class \emph{elsarticle} is not available on your computer, you can download and install the system package \emph{texlive-publishers} (Linux) or install the \LaTeX\ package \emph{elsarticle} using the package manager of your \TeX\ installation, which is typically \TeX\ Live or Mik\TeX.

\paragraph{Usage} Once the package is properly installed, you can use the document class \emph{elsarticle} to create a manuscript. Please make sure that your manuscript follows the guidelines in the Guide for Authors of the relevant journal. It is not necessary to typeset your manuscript in exactly the same way as an article, unless you are submitting to a camera-ready copy (CRC) journal.

\paragraph{Functionality} The Elsevier article class is based on the standard article class and supports almost all of the functionality of that class. In addition, it features commands and options to format the
\begin{itemize}
\item document style
\item baselineskip
\item front matter
\item keywords and MSC codes
\item theorems, definitions and proofs
\item lables of enumerations
\item citation style and labeling.
\end{itemize}

\section{Front matter}

The author names and affiliations could be formatted in two ways:
\begin{enumerate}[(1)]
\item Group the authors per affiliation.
\item Use footnotes to indicate the affiliations.
\end{enumerate}
See the front matter of this document for examples. You are recommended to conform your choice to the journal you are submitting to.

\section{Bibliography styles}

There are various bibliography styles available. You can select the style of your choice in the preamble of this document. These styles are Elsevier styles based on standard styles like Harvard and Vancouver. Please use Bib\TeX\ to generate your bibliography and include DOIs whenever available.

Here are two sample references: \cite{Feynman1963118,Dirac1953888}.

\section*{References}

\bibliography{mybibfile}

\end{document}
