\section{Collection of \dataset}
\label{section:data_collection}

\dataset is collected in a paraphrase phases as well as a verification phase.
In the paraphrase phase, we use tables extracted from Wikipedia by~\citet{Bhagavatula2013MethodsFE} and remove small tables according to the following criteria:

\begin{itemize}
\item the number of cells in each row is not the same
\item the content in a cell exceed 50 characters
\item a header cell is empty
\item the table has less than 5 rows or 5 columns
\item over 40\% of the cells of a row contain identical content
\end{itemize}


We also remove the last row of a table because a large quantity of HTML tables tend to have summary statistics in the last row, and hence the last row does not adhere to the table schema defined by the header row.

For each of the table that passes the above criteria, we randomly generate 6 SQL queries according to the following rules:

\begin{itemize}
\item the query follows the format \texttt{SELECT agg\_op agg\_col from table where cond1\_col cond1\_op cond1 AND cond2\_col cond2\_op cond2 ...}
\item the aggregation operator \texttt{agg\_op} can be empty or \texttt{COUNT}. In the event that the aggregation column \texttt{agg\_col} is numeric, \texttt{agg\_op} can additionally be one of \texttt{MAX} and \texttt{MIN}
\item the condition operator \texttt{cond\_op} is \texttt{=}. In the event that the corresponding condition column \texttt{cond\_col} is numeric, \texttt{cond\_op} can additionally be one of \texttt{>} and \texttt{<}
\item the condition \texttt{cond} can be any possible value present in the table under the corresponding \texttt{cond\_col}. In the event that \texttt{cond\_col} is numerical, \texttt{cond} can be any numerical value sampled from the range from the minimum value in the column to the maximum value in the column.
\end{itemize}

We only generate queries that produce a non-empty result set.
To enforce succinct queries, we remove conditions from the generated queries if doing so does not change the execution result.

For each query, we generate a crude question using a template and obtain a human paraphrase via crowdsourcing on Amazon Mechanical Turk.
In each Amazon Mechanical Turk HIT, a worker is shown the first 4 rows of the table as well as its generated questions and asked to paraphrase each question.

After obtaining natural language utterances from the paraphrase phase, we give each question-paraphrase pair to two other workers in the verification phase to verify that the paraphrase and the original question contain the same meaning.

We then filter the initial collection of paraphrases using the following criteria:

\begin{itemize}
\item the paraphrase must be deemed correct by at least one worker during the verification phrase
\item the paraphrase must be sufficiently different from the generated question, with a character-level edit distance greater than 10
\end{itemize}


\section{Attentional Seq2Seq Neural Semantic Parser Baseline}
\label{section:baseline}

We employ the attentional sequence to sequence model for the baseline.
This model by~\citet{dong-neural_semantic_parsing} achieves state of the art results on a variety of semantic parsing datasets despite not using hand-engineered grammar.
We implement a variant using OpenNMT and a global attention encoder-decoder architecture (with input feeding) described by Luong et al.

We use the same two-layer, bidirectional, stacked LSTM encoder as described previously.
The decoder is almost identical to that described by Equation 2 of the paper, with the sole difference coming from input feeding.

\begin{equation}
g_s = \lstm{ \left[ \emb{y_{s-1}} ; \kappa\dec_{s-1} \right] }{g_{s-1}}
\end{equation}

where $\kappa\dec_{s}$ is the attentional context over the input sequence during the $s$th decoding step, computed as

\begin{equation}
\alpha\dec_{s, t} = h\dec_s \left( W\dec h\enc_t \right) ^ \intercal
\qquad
\beta\dec_s = \softmax{\alpha\dec_s}
\end{equation}

\begin{equation}
\kappa_s = \sum_t \beta_{s, t} h\enc_t
\end{equation}

To produce the output token during the $s$th decoder step, the concatenation of the decoder state and the attention context is given to a final linear layer to produce a distribution $\alpha\dec$ over words in the target vocabulary

\begin{equation}
\alpha\dec = \softmax{ U\dec [h\dec_s ; \kappa\dec_s] }
\end{equation}

During training, teacher forcing is used.
During inference, a beam size of 5 is used and generated unknown words are replaced by the input words with the highest attention weight.



\section{Predictions by \model}
\label{section:qualitative}

% TODO: can this table include the column names as a row? - james
\begin{table}[ht]
\scriptsize
\centering
\begin{tabular}{ll}
\toprule
Q       & when connecticut \& villanova are the regular season winner how many tournament venues (city) are there?       \\
P   & \texttt{SELECT COUNT tournament player (city) WHERE regular season winner city ) = connecticut \& villanova} \\
S' & \texttt{SELECT COUNT tournament venue (city) WHERE tournament winner = connecticut \& villanova}             \\
S         & \texttt{SELECT COUNT tournament venue (city) WHERE regular season winner = connecticut \& villanova}         \\
G   & \texttt{SELECT COUNT tournament venue (city) WHERE regular season winner = connecticut \& villanova}         \\
\midrule
Q       & what are the aggregate scores of those races where the first leg results are 0-1?                              \\
P   & \texttt{SELECT aggregate WHERE 1st . = 0-1}                                                                  \\
S' & \texttt{SELECT COUNT agg. score WHERE 1st leg = 0-1}                                                         \\
S         & \texttt{SELECT agg. score WHERE 1st leg = 0-1}                                                               \\
G   & \texttt{SELECT agg. score WHERE 1st leg = 0-1}                                                               \\
\midrule
Q       & what is the race name of the 12th round trenton, new jersey race where a.j. foyt had the pole position?        \\
P   & \texttt{SELECT race name WHERE location = 12th AND round position = a.j. foyt, new jersey AND}               \\
S' & \texttt{SELECT race name WHERE rnd = 12 AND track = a.j. foyt AND pole position = a.j. foyt}                 \\
S         & \texttt{SELECT race name WHERE rnd = 12 AND pole position = a.j. foyt}                                       \\
G   & \texttt{SELECT race name WHERE rnd = 12 AND pole position = a.j. foyt}                                       \\
\midrule
Q       & what city is on 89.9?                                                                                          \\
P   & \texttt{SELECT city WHERE frequency = 89.9}                                                                  \\
S' & \texttt{SELECT city of license WHERE frequency = 89.9}                                                       \\
S         & \texttt{SELECT city of license WHERE frequency = 89.9}                                                       \\
G   & \texttt{SELECT city of license WHERE frequency = 89.9}                                                       \\
\midrule
Q       & how many voters from the bronx voted for the socialist party?                                                  \\
P   & \texttt{SELECT MIN \% party = socialist}                                                                     \\
S' & \texttt{SELECT COUNT the bronx where the bronx = socialist}                                                  \\
S         & \texttt{SELECT COUNT the bronx WHERE the bronx = socialist}                                                  \\
G   & \texttt{SELECT the bronx WHERE party = socialist}                                                            \\
\midrule
Q          & in what year did a plymouth vehicle win on february 9 ?                                                        \\
P   & \texttt{SELECT MIN year (km) WHERE date = february 9 AND race time = plymouth 9}                              \\
S' & \texttt{SELECT year (km) WHERE date = plymouth 9 AND race time = february 9}                                      \\
S         & \texttt{SELECT year (km) WHERE date = plymouth 9 AND race time= february 9}                                      \\
G   & \texttt{SELECT year (km) WHERE manufacturer = plymouth AND date = february 9}                                     \\
\bottomrule
\end{tabular}
\caption{
Examples predictions by the models on the dev split.
Q denotes the natural language question and G denotes the corresponding ground truth query.
P, S', and S denote, respectively, the queries produced by the Augmented Pointer Network, \model without reinforcement learning, \model.
We omit the \texttt{FROM table} part of the query for succinctness.
}
\label{table:qualitative}
\end{table}