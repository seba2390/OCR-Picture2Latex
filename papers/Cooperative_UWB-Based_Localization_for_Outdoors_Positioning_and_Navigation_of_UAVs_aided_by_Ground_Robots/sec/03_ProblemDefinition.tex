%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%                                          %%
%%        PROBLEM DEFINITION                %%
%%                                          %%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \section{Ranging-based target-relative localization}

% \newpage

\section{Cooperative UWB-Based Localization}

% \red{Here we present the problem/ system. We have a ground robot, UAV, equipped with multiple UWB transceivers}

We consider the problem of relative localization between a UAV and a UGV based on UWB ranging between transceivers installed onboard both robots. The objective is to leverage this relative localization to improve the accuracy of the UAV navigation outdoors. We are especially interested in improving the navigation performance in urban areas where the accuracy of GNSS sensors is degraded due to the signal being reflected at or occluded by nearby buildings.

Let us denote by $I = \{I_i\}_{i=0,\dots,N-1}$ the set of $N$ transceivers onboard the UAV. These will act as initiators, i.e., will actively transmit messages to initiate ranging measurements between them and the responder transceivers on the ground. We denote the latter ones by the set $R = \{R_0\}_{i=0,\dots,M-1}$. An initial approach, which we implement, is to iteratively range between each initiator and the set of responders. If the number of nodes increases significantly, more scalable approaches can be used where, for example, a single initiator message is answered by several or all responders with different delays~\cite{grobetawindhager2019snaploc}.

We model the UWB ranges between an initiator $i$ and a responder $j$ with
\begin{equation}
    \textbf{z}^{UWB}_{(i,j)} = \lVert \textbf{p}_i(t)-\textbf{q}_j(t) \lVert\:+\: \mathcal{N}\left(0,\:\sigma_{UWB}\right)
\end{equation}
where $\textbf{p}_i$ and $\textbf{q}_j$ represent the positions of the initiator and responder transceivers, respectively. Based on the ranges, different approaches to localization include, e.g., multilateration or a least squares estimator (LE). We implement the latter, and hence the position of each tag can be calculated based on the known anchor positions by
\begin{equation}
    \textbf{p}_{i} = \argmin_{\textbf{p}\in\mathbb{R}^3} \displaystyle\sum_{j=0}^{M} \left(\textbf{z}^{UWB}_{(i,j)} - \lVert \textbf{p} - \textbf{q}_j \lVert \right)^2 
\end{equation}
Alternatively, assuming that the position of initiators in the UAV ($\{\textbf{p}_i\}$) is given based on the UAV's position and orientation ($\textbf{p}$ and $\theta$, respectively) by a set of rigid body transformations $f_i$, i.e., $\textbf{p}_i = f_i\left(\textbf{p}, \theta\right)$, then the estimator can be used to obtain the full pose of the UAV directly with
\begin{equation}
    \textbf{p}, \:\theta = \argmin_{\substack{\textbf{p}\in\mathbb{R}^3\\\:\theta\in(-\pi,\pi]}} \displaystyle\sum_{i=0}^{N}\displaystyle\sum_{j=0}^{M} \left(\textbf{z}^{UWB}_{(i,j)} - \lVert f_i\left(\textbf{p}, \theta\right) - \textbf{q}_j \lVert \right)^2
\end{equation}

% The principle idea here is to collect multiple UWB range measurements to calculate the relative position of UAV. More specifically, there are 4 UWB responder nodes named $R= \{A, B, C, D\}$ are installed on the UGV and 2 UWB initiator mode named $I = \{O, P\}$ are installed on the UAV as Fig. \ref{fig:concept} shows. 
% The initiator node can only range to one of the responder nodes at a time and the ranging scheme is executed in a periodic manner as $0,1,â€¦,N-1,0,1..$. Henceforth, we unitize $d_k^{mp}$ to represent the initiator node $m$ to one responder node $p$ at time period $k$ where $m \in I$ and $p \in R$. We define the $C$ as the origin points OF the UGV coordinate, $\overrightarrow{CD}$ as the x-axis and $\overrightarrow{CB}$ as the y-axis. The distance between responder nodes $d_{CB}, d_{CD}, d_{AB}, d_{AD}$ are manually measured. 
% After one time period $k$, the range measurements between intiator and responder can be obtained e.g. $d_k^{OA}, d_k^{OB}, d_k^{OC}, d_k^{OD}$.Finally, with the information aforementioned, a recursive least square optimzation algorithm will be employed to estimate the UAV position $\hat{p_k}$ correspond to UGV coordinate.

% In order to enable fast and flexible deployments, we are particularly interested in analyzing the performance of relative localization when the



% \subsection{System overview}

% TO DO

% \subsection{YXJ vs. LQQ <- the battle for the crown}


