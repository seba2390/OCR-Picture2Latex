
\subsection{\unistore{} Liveness} \label{ss:unistore-liveness}

\begin{applemma} \label{lemma:migrate-terminate}
  Each client migration \clattach{} to a correct data center
  will eventually terminate, provided that the client managed to
  complete its \fence{} call at its original data center
  just before \clattach.
\end{applemma}

\begin{proof} \label{proof:migrate-terminate}
  Suppose that client $\cl$ in its current data center $d \triangleq \cldc(\cl)$
  issues a \clattach{} event $\attachrange$
  to replica $p^{m}_{\cdrange}$ in correct data center $\cdrange \in \C$.

  Let $e \in C$ be the last commit event
  issued by client $\cl$ before $\attachrange$.
  If $e$ does not exist, then
  \[
    \forall i \in \D.\; \pastVC_{\cl}[i] = 0.
  \]
  Therefore, the wait condition
  \[
    \forall i \in \D \setminus \set{c}.\; \uniformVC^{m}_{c}[i] \ge 0
  \]
  at line~\code{\ref{alg:unistore-replica}}{\ref{line:attach-wait-condition}}
  at replica $p^{m}_{c}$ will eventually hold.
  Thus, the \clattach{} event $\attachrange$ eventually terminates.

  Otherwise, suppose that $e$ is issued to replica $p^{n'}_{d'}$
  in data center $d'$.
  By Lemma~\ref{lemma:pastvc-uniformvc-except-d},
  \begin{align}
    \forall i \in \D \setminus \set{d'}.\;
      (\uniformVC^{n'}_{d'})_{e}[i] \ge (\pastVC_{\cl})_{e}[i].
      \label{eq:attach-dprime}
  \end{align}
  Note that it is possible that $d' \neq d$,
  since there may exist other \clattach{} events between $e$ and $\attachrange$.
  Therefore, we distinguish between the following two cases:
  \begin{itemize}
    \item \textsc{Case I}: $d' = d$. By (\ref{eq:attach-dprime}),
      \begin{align}
        \forall i \in \D \setminus \set{d}.\;
          (\uniformVC^{n'}_{d})_{e}[i] \ge (\pastVC_{\cl})_{e}[i].
          \label{eq:attach-dprime-d}
      \end{align}
    \item \textsc{Case II}: $d' \neq d$.
      Consider the last \clattach{} event, denoted $a'$, before $\attachrange$.
      Suppose that $a'$ is issued to replica $p^{n}_{d}$ in data center $d$.
      By Lemma~\ref{lemma:pastvc-uniformvc-except-d}, when $a'$ terminates,
      \begin{align}
        \forall i \in \D \setminus \set{d}.\;
          &(\uniformVC^{n}_{d})_{a'}[i] \ge (\pastVC_{\cl})_{a'}[i] \nonumber \\
          &\quad = (\pastVC_{\cl})_{e}[i].
          \label{eq:attach-dprime-not-d}
      \end{align}
  \end{itemize}

  Let $\fencerange \in \Fence$ be the \fence{} event issued by client $\cl$
  just before $\attachrange$.
  Suppose that $\fencerange$ is issued to replica $p^{l}_{d}$ in data center $d$.
  By Lemma~\ref{lemma:pastvc-uniformvc-except-d},
  \begin{align}
    (\uniformVC^{l}_{d})_{\fencerange}[d] &\ge (\pastVC_{\cl})_{\fencerange}[d]
      \nonumber\\
      &= (\pastVC_{\cl})_{e}[d].
      \label{eq:barrier-just-before-attach}
  \end{align}

  By (\ref{eq:attach-dprime-d}), (\ref{eq:attach-dprime-not-d}),
  (\ref{eq:barrier-just-before-attach}), and Lemma~\ref{lemma:uniformvc-x},
  eventually for the correct data center $\cdrange$,
  \[
    \forall i \in \D.\;
      \uniformVC^{m}_{\cdrange}[i] \ge (\pastVC_{\cl})_{e}[i].
  \]
  Therefore, the wait condition
  \[
    \forall i \in \D \setminus \set{c}.\;
      \uniformVC^{m}_{c}[i] \ge (\pastVC_{\cl})_{e}[i]
  \]
  at line~\code{\ref{alg:unistore-replica}}{\ref{line:attach-wait-condition}}
  at replica $p^{m}_{c}$ will eventually hold.
  Thus, the \clattach{} event $\attachrange$ eventually terminates.
\end{proof}

\begin{apptheorem} \label{thm:termination}
  Any client event issued at a correct data center
  will eventually terminate.
\end{apptheorem}

\begin{proof} \label{proof:termination}
  Consider any event $e$ issued by client $\cl$
  at a correct data center $c \in \C$.
  It suffices to show that each wait condition in the execution of $e$,
  if any, will eventually hold.
  In the following, we perform a case analysis
  according to the type of event $e$.
  \begin{itemize}
    \item $\textsc{Case I}$: $e \in S$.
      The theorem holds trivially.
    \item $\textsc{Case II}$: $e \in R$.
      If $e \in \intread$, the theorem holds trivially.
      Otherwise, $e \in \extread$.
      By Lemmas~\ref{lemma:knownvc-d-no-bound}
      and \ref{lemma:knownvc-strong-no-bound},
      the wait condition at
      line~\code{\ref{alg:unistore-replica}}{\ref{line:readkey-wait-util-knownvc}}
      for $e$ will eventually hold.
    \item $\textsc{Case III}$: $e \in U$.
      The theorem holds trivially.
    \item $\textsc{Case IV}$: $e \in C_{\causalentry}$.
      Since data center $c$ is correct,
      the wait condition at
      line~\code{\ref{alg:unistore-coord}}{\ref{line:commitcausal-wait-prepareack}}
      will eventually hold.
    \item $\textsc{Case V}$: $e \in C_{\strongentry}$.
      By Lemma~\ref{lemma:uniformvc-c-no-bound},
      the wait condition at
      line~\code{\ref{alg:unistore-replica}}{\ref{line:uniformbarrier-wait-uniformvc-d}}
      will eventually hold.
      Thus, line~\code{\ref{alg:unistore-strong-commit}}{\ref{line:commitstrong-call-uniformbarrier}}
      will eventually terminate.
      Then, by Assumption~\ref{assumption:complete-execution},
      the procedure $\certify$ and thus the event $e$ will eventually terminate.
    \item $\textsc{Case VI}$: $e \in \fence$.
      By Lemma~\ref{lemma:uniformvc-c-no-bound},
      the wait condition at
      line~\code{\ref{alg:unistore-replica}}{\ref{line:uniformbarrier-wait-uniformvc-d}}
      will eventually hold.
    \item $\textsc{Case VII}$: $e \in \clattach$.
      The theorem holds due to \textsc{Case VI} and Lemma~\ref{lemma:migrate-terminate}.
  \end{itemize}
\end{proof}
