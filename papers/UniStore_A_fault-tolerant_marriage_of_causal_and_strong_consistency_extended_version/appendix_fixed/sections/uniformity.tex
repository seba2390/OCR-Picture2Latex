
\subsection{Uniformity} \label{ss:uniformity}

\subsubsection{Uniformity of Causal Transactions Originating at Correct Data Centers}
\label{sss:uniformity-correct-dc}

\begin{applemma} \label{lemma:knownvc-d-no-bound}
  For any replica $p^{m}_{d}$ in any correct data center $d \in \C$,
  $\knownVC^{m}_{d}[d]$ grows without bound.
\end{applemma}

\begin{proof} \label{proof:knownvc-d-no-bound}
  Since data center $d$ is correct, by Assumption~\ref{assumption:fairness},
  \propagate{} of Algorithm~\ref{alg:unistore-replication}
  will be executed infinitely often.
  \begin{itemize}
    \item $\textsc{Case I}$:
      Line~\code{\ref{alg:unistore-replication}}{\ref{line:propagate-knownvc-clock}}
      is executed infinitely often.
      By Assumption~\ref{assumption:clock},
      $\knownVC^{m}_{d}[d]$ grows without bound.
    \item $\textsc{Case II}$:
      Line~\code{\ref{alg:unistore-replication}}{\ref{line:propagate-knownvc-ts}}
      is executed infinitely often.
      That is, it is infinitely often that
      \[
        \preparedcausal^{m}_{d} \neq \emptyset.
      \]
      By Assumption~\ref{assumption:fairness},
      causal transactions in $\preparedcausal^{m}_{d}$
      will eventually be committed and removed from $\preparedcausal^{m}_{d}$
      (line~\code{\ref{alg:unistore-replica}}{\ref{line:commit-preparedcausal}}).
      Thus, it is infinitely often that new causal transactions
      are prepared and added into $\preparedcausal^{m}_{d}$
      (line~\code{\ref{alg:unistore-replica}}{\ref{line:preparecausal-preparedcausal}})
      with larger and larger prepare timestamps
      (line~\code{\ref{alg:unistore-replica}}{\ref{line:preparecausal-ts}}).
      Therefore,
      \[
        \min\set{\tsvar \mid \langle \_, \_, \tsvar \rangle \in \preparedcausal^{m}_{d}}
      \]
      and
      \begin{align*}
        &\knownVC^{m}_{d}[d] \\
          &\quad = \min\set{\tsvar \mid \langle \_, \_, \tsvar \rangle \in \preparedcausal^{m}_{d}} - 1
      \end{align*}
      grow without bound.
    \end{itemize}
\end{proof}

\begin{applemma} \label{lemma:knownvc-x}
  Let $p^{m}_{d}$ be a replica in a correct data center $d \in \C$.
  If for some $j \in \D$ and some value $x \in \mathbb{N}$
  \[
    \knownVC^{m}_{d}[j] \ge x,
  \]
  then eventually
  \[
    \forall \cdrange \in \C.\; \knownVC^{m}_{\cdrange}[j] \ge x.
  \]
\end{applemma}

\begin{proof} \label{proof:knownvc-x}
  Since data center $d$ is correct, by Assumption~\ref{assumption:fairness},
  for each other data center $i \neq d$, replica $p^{m}_{d}$ will keep
  \begin{itemize}
    \item \emph{replicating} to data center $i$ the write sets
      \[
        \langle \_, \wbuffvar, \commitvc, \_ \rangle \in \committedcausal^{m}_{d}[j]
      \]
      that have not been received by $i$ from the perspective of $d$
      ($\commitvc[d] \le \knownVC^{m}_{d}[d]$
      at line~\code{\ref{alg:unistore-replication}}{\ref{line:propagate-txs}}
      and $\commitvc[j] > \globalmatrix^{m}_{d}[i][j]$ at
      line~\code{\ref{alg:unistore-replication}}{\ref{line:forward-txs}});
    \item or sending \emph{heartbeats} with up-to-date
      $\knownVC^{m}_{d}[j]$ to data center $i$
      (lines~\code{\ref{alg:unistore-replication}}{\ref{line:propagate-call-heartbeat}}
      and \code{\ref{alg:unistore-replication}}{\ref{line:forward-call-heartbeat}}).
  \end{itemize}
  By Assumption~\ref{assumption:message},
  $\knownVC^{m}_{\cdrange}[j]$ at replica $p^{m}_{\cdrange}$ of
  each correct data center $\cdrange \in \C$ will eventually be updated
  (lines~\code{\ref{alg:unistore-replication}}{\ref{line:replicate-knownvc}}
  and \code{\ref{alg:unistore-replication}}{\ref{line:heartbeat-knownvc}})
  such that
  \[
    \knownVC^{m}_{\cdrange}[j] \ge \knownVC^{m}_{d}[j] \ge x.
  \]
\end{proof}

\begin{applemma} \label{lemma:uniformvc-c-no-bound}
  Let $d \in \C$ be a correct data center.
  For any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$,
  $\uniformVC^{m}_{\cdrange}[d]$ grows without bound.
\end{applemma}

\begin{proof} \label{proof:uniformvc-c-no-bound}
  By Lemmas~\ref{lemma:knownvc-d-no-bound} and \ref{lemma:knownvc-x},
  for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$,
  $\knownVC^{m}_{\cdrange}[d]$ grows without bound.
  By lines~\code{\ref{alg:unistore-clock}}{\ref{line:bcast-call-knownvclocal}}
  and \code{\ref{alg:unistore-clock}}{\ref{line:knownvclocal-stablevc-causal}},
  for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$,
  $\stableVC^{m}_{\cdrange}[d]$ grows without bound.
  By line~\code{\ref{alg:unistore-clock}}{\ref{line:bcast-call-stablevc}},
  Assumptions~\ref{assumption:message} and \ref{assumption:failure-model},
  and lines~\code{\ref{alg:unistore-clock}}{\ref{line:stablevc-g}}--\code{
    \ref{alg:unistore-clock}}{\ref{line:stablevc-uniformvc}},
  for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$,
  $\uniformVC^{m}_{\cdrange}[d]$ grows without bound.
\end{proof}

\begin{applemma}[\prop{4}] \label{lemma:uniformvc-x}
  Let $p^{m}_{d}$ be any replica in any data center $d$.
  For any time $\realtime$, there exists some time $\realtime'$ such that
  \begin{align*}
    &\forall i \in \D.\; \forall \cdrange \in \C.\; \forall n \in \P. \\
      &\quad \uniformVC^{n}_{\cdrange}(\realtime')[i] \ge \uniformVC^{m}_{d}(\realtime)[i].
  \end{align*}
\end{applemma}

\begin{proof} \label{proof:uniformvc-x}
  By Lemma~\ref{lemma:uniformvc-knownvc-f+1},
  Assumption~\ref{assumption:failure-model}, and the fact that at most
  $f$ data centers may fail,
  \begin{align*}
    &\forall i \in \D.\; \exists \cdrange \in \C.\; \forall n \in \P. \\
      &\quad \uniformVC^{m}_{d}(\realtime)[i] \le \knownVC^{n}_{\cdrange}(\realtime)[i].
  \end{align*}
  By Lemma~\ref{lemma:knownvc-x},
  there exists some time $\realtime''$ such that
  \begin{align*}
    &\forall i \in \D.\; \forall \cdrange \in \C.\; \forall n \in \P. \\
      &\quad \uniformVC^{m}_{d}(\realtime)[i] \le \knownVC^{n}_{\cdrange}(\realtime'')[i].
  \end{align*}
  By Algorithm~\ref{alg:unistore-clock} and Assumption~\ref{assumption:failure-model},
  there exists some time $\realtime'$ such that
  \begin{align*}
    &\forall i \in \D.\; \forall \cdrange \in \C.\; \forall n \le \P. \\
      &\quad \uniformVC^{n}_{\cdrange}(\realtime')[i] \ge \uniformVC^{m}_{d}(\realtime)[i].
  \end{align*}
\end{proof}

\begin{applemma} \label{lemma:uniformity-correct-dc}
  Let $d \in \C$ be a correct data center
  and $\tvar \in \causaltxs$ be a causal transaction
  that originates at $d$.
  Then for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$, eventually
  \[
    \forall i \in \D.\; \timestamp(\tvar)[i] \le \uniformVC^{m}_{\cdrange}[i].
  \]
\end{applemma}

\begin{proof} \label{proof:uniformity-correct-dc}
  Since $d$ is correct, by Lemma~\ref{lemma:uniformvc-c-no-bound},
  there exists some time $\realtime'$ such that
  \[
    \timestamp(\tvar)[d] \le \uniformVC^{m}_{\cdrange}(\realtime')[d].
  \]
  On the other hand,
  by Definition~\ref{def:ts-op} of timestamps
  and Lemma~\ref{lemma:pastvc-uniformvc-except-d}
  (let $n \triangleq \coord(\tvar)$ and $cl \triangleq \client(\tvar)$),
  \begin{align*}
    \forall i \in \D \setminus \set{d}.\;
      \timestamp(\tvar)[i] &= (\pastVC_{\cl})_{\commitoftx(\tvar)}[i] \\
      &\le (\uniformVC^{n}_{d})_{\commitoftx(\tvar)}[i].
  \end{align*}
  By Lemma~\ref{lemma:uniformvc-x},
  there exists some time $\realtime''$ such that
  \[
    \forall i \in \D \setminus \set{d}.\;
      \timestamp(\tvar)[i] \le (\uniformVC^{m}_{\cdrange})(\realtime'')[i].
  \]
  Let
  \[
    \realtime \triangleq \max\set{\realtime', \realtime''}.
  \]
  By Lemma~\ref{lemma:uniformvc-nondecreasing},
  \[
    \forall i \in \D.\; \timestamp(\tvar)[i] \le \uniformVC^{m}_{\cdrange}(\realtime)[i].
  \]
\end{proof}
\subsubsection{Uniformity of Causal Transactions Visible to \fence{} events}
\label{sss:uniformity-fences}

\begin{applemma} \label{lemma:uniformity-causal-fence}
  Let $\tvar \in \causaltxs$ be a causal transaction
  and $\fencerange \in \Fence$ be a \fence{} event.
  If $\tvar \rel{\vis} \fencerange$,
  then for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$, eventually
  \[
    \forall i \in \D.\; \timestamp(\tvar)[i] \le \uniformVC^{m}_{\cdrange}[i].
  \]
\end{applemma}

\begin{proof} \label{proof:uniformity-causal-fence}
  Since $\tvar \rel{\vis} \fencerange$, by Definition~\ref{def:vis-tx} of $\vis$,
  \[
    \timestamp(\tvar) \le \timestamp(\fencerange).
  \]
  Suppose that $\fencerange$ is issued by client $\cl$
  to replica $p^{n}_{d}$ in data center $d$
  and is returned at time $\realtime_{\fencerange}$.
  By Definition~\ref{def:ts-op} of timestamps
  and Lemma~\ref{lemma:pastvc-uniformvc-except-d},
  \[
    \timestamp(\tvar)[d] \le \timestamp(\fencerange)[d] \le (\uniformVC^{n}_{d})_{\fencerange}[d].
  \]
  By Lemma~\ref{lemma:uniformvc-x},
  there exists some time $\realtime'$ such that
  \[
    \timestamp(\tvar)[d] \le (\uniformVC^{m}_{\cdrange})(\realtime')[d].
  \]
  On the other hand, by Definition~\ref{def:ts-op} of timestamps
  and Lemma~\ref{lemma:pastvc-uniformvc},
  \begin{align*}
    \forall i \in \D \setminus \set{d}.\;
      \timestamp(\tvar)[i] &\le \timestamp(\fencerange)[i] \\
      &= (\pastVC_{\cl})_{\fencerange}[i] \\
      &\le \uniformVC^{l}_{d}(\realtime_{\fencerange})[i]
  \end{align*}
  for some replica $p^{l}_{d}$ in data center $d$.
  By Lemma~\ref{lemma:uniformvc-x},
  there exists some time $\realtime''$ such that
  \[
    \forall i \in \D \setminus \set{d}.\;
      \timestamp(\tvar)[i] \le (\uniformVC^{m}_{\cdrange})(\realtime'')[i].
  \]
  Let
  \[
    \realtime \triangleq \max\set{\realtime', \realtime''}.
  \]
  By Lemma~\ref{lemma:uniformvc-nondecreasing},
  \[
    \forall i \in \D.\; \timestamp(\tvar)[i] \le \uniformVC^{m}_{\cdrange}(\realtime)[i].
  \]
\end{proof}
\subsubsection{Uniformity of Strong Transactions}
\label{sss:uniformity-strong}

\begin{applemma} \label{lemma:knownvc-strong-no-bound}
  For any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$,
  $\knownVC^{m}_{\cdrange}[\strongentry]$ grows without bound.
\end{applemma}

\begin{proof} \label{proof:knownvc-strong-no-bound}
  By Assumption~\ref{assumption:fairness}
  and Theorem~\ref{thm:tcs-correctness},
  replica $p^{m}_{\cdrange}$ will either deliver committed strong transactions
  infinitely often (\deliver{} of Algorithm~\ref{alg:unistore-strong-commit})
  or submit dummy strong transactions infinitely often
  (\heartbeatstrong{} of Algorithm~\ref{alg:unistore-strong-commit}).
  Thus, $\knownVC^{m}_{\cdrange}[\strongentry]$ grows without bound.
\end{proof}

\begin{applemma} \label{lemma:uniformity-strong}
  Let $\tvar \in \txs$ be a transaction.
  Then for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$, eventually
  \[
    \timestamp(\tvar)[\strongentry] \le \stableVC^{m}_{\cdrange}[\strongentry].
  \]
\end{applemma}

\begin{proof} \label{proof:uniformity-strong}
  By Lemma~\ref{lemma:knownvc-strong-no-bound}
  and lines~\code{\ref{alg:unistore-clock}}{\ref{line:bcast-call-knownvclocal}}
  and \code{\ref{alg:unistore-clock}}{\ref{line:knownvclocal-stablevc-strong}},
  $\stableVC^{m}_{\cdrange}[\strongentry]$ grows without bound.
  Therefore, there exists some time $\realtime$ such that
  \[
    \timestamp(\tvar)[\strongentry] \le \stableVC^{m}_{\cdrange}(\realtime)[\strongentry].
  \]
\end{proof}

\begin{applemma} \label{lemma:uniformity-strongtx-i}
  Let $\tvar \in \strongtxs$ be a strong transaction.
  Then for any replica $p^{m}_{\cdrange}$
  in any correct data center $\cdrange \in \C$, eventually
  \[
    \forall i \in \D.\; \timestamp(\tvar)[i] \le \uniformVC^{m}_{\cdrange}[i].
  \]
\end{applemma}

\begin{proof} \label{proof:uniformity-strongtx-i}
  Let $d \triangleq \dc(\tvar)$,
  $n \triangleq \coord(\tvar)$, and $cl \triangleq \client(\tvar)$.
  By Definition~\ref{def:ts-op} of timestamps,
  \[
    \timestamp(\tvar) = (\pastVC_{\cl})_{\commitoftx(\tvar)}.
  \]
  On the one hand, by Lemma~\ref{lemma:pastvc-uniformvc-except-d},
  \begin{align*}
    \forall i \in \D \setminus \set{d}.\;
      \timestamp(\tvar)[i] &= (\pastVC_{\cl})_{\commitoftx(\tvar)}[i] \\
      &\le (\uniformVC^{n}_{d})_{\commitoftx(\tvar)}[i].
  \end{align*}
  By Lemma~\ref{lemma:uniformvc-x},
  there exists some time $\realtime'$ such that
  \[
    \forall i \in \D \setminus \set{d}.\;
      \timestamp(\tvar)[i] \le (\uniformVC^{m}_{\cdrange})(\realtime')[i].
  \]
  On the other hand, by Lemma~\ref{lemma:ts-commit},
  \[
    \timestamp(\tvar)[d] = \commitVC(\tvar)[d].
  \]
  By (\ref{eqn:gcf-commitvc}),
  \[
    \commitVC(\tvar)[d] = \snapshotVC(\tvar)[d].
  \]
  By lines~\code{\ref{alg:unistore-strong-commit}}{\ref{line:commitstrong-call-uniformbarrier}}
  and \code{\ref{alg:unistore-replica}}{\ref{line:uniformbarrier-wait-uniformvc-d}},
  \[
    \snapshotVC(\tvar)[d] \le (\uniformVC^{n}_{d})_{\commitoftx(\tvar)}[d].
  \]
  Putting it together yields,
  \[
    \timestamp(\tvar)[d] \le (\uniformVC^{n}_{d})_{\commitoftx(\tvar)}[d].
  \]
  By Lemma~\ref{lemma:uniformvc-x},
  there exists some time $\realtime''$ such that
  \[
    \timestamp(\tvar)[d] \le (\uniformVC^{m}_{\cdrange})(\realtime'')[d].
  \]
  Let
  \[
    \realtime \triangleq \max\set{\realtime', \realtime''}.
  \]
  By Lemma~\ref{lemma:uniformvc-nondecreasing},
  \[
    \forall i \in \D.\; \timestamp(\tvar)[i] \le \uniformVC^{m}_{\cdrange}(\realtime)[i].
  \]
\end{proof}
