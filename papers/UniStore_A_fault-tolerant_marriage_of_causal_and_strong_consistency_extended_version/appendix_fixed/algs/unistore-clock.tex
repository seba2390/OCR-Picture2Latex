
\begin{algorithm*}[t]
  \caption{Updating metadata at $p^m_d$}
  \label{alg:unistore-clock}
  \begin{algorithmic}[1]
    \Function{\bcast}{\null} \Comment{Run periodically}
      \label{line:function-bcast}
      \State \send $\Call{\knownvclocal}{m, \knownVC} \sendto p^{l}_{d}$, $l \in \P$
        \label{line:bcast-call-knownvclocal}
      \State \send $\Call{\stablevcproc}{d, \stableVC} \sendto p^{m}_{i}$, $i \in \D$
        \label{line:bcast-call-stablevc}
      \State \send $\Call{\knownvcglobal}{d, \knownVC} \sendto p^{m}_{i}$, $i \in \D$
        \label{line:bcast-call-knownvcglobal}
    \EndFunction

    \Statex
    \WhenRcv[\knownvclocal($l, \knownvc$)]
      \label{line:function-knownvclocal}
      \State $\localmatrix[l] \gets \knownvc$
        \label{line:knownvclocal-localknownmatrix}
      \For{$i \in \D$}
        \State $\stableVC[i] \gets \min \set{\localmatrix[n][i] \mid n \in \P}$
        \label{line:knownvclocal-stablevc-causal}
      \EndFor
      \State \strongcolor{$\stableVC[\strongentry] \gets
        \min\set{\localmatrix[n][\strongentry] \mid n \in \P}$}
        \label{line:knownvclocal-stablevc-strong}
    \EndWhenRcv

    \Statex
    \WhenRcv[\stablevcproc($i, \stablevc$)]
      \label{line:function-stablevc}
      \State $\stablematrix[i] \gets \stablevc$
        \label{line:stablevc-stablematrix}
      \State $G\gets$ all groups with $f+1$ replicas that include $p^{m}_{d}$
        \label{line:stablevc-g}
      \For{$j \in \D$}
        \State \var $\tsvar \gets \max \set{\min \set{\stablematrix[h][j] \mid h \in g}
          \mid g \in G}$
          \label{line:stablevc-ts}
        \State $\uniformVC[j] \gets \max \set{\uniformVC[j], \tsvar}$
          \label{line:stablevc-uniformvc}
      \EndFor
    \EndWhenRcv

    \Statex
    \WhenRcv[\knownvcglobal($l, \knownvc$)]
      \label{line:function-knownvcglobal}
      \State $\globalmatrix[l] \gets \knownvc$
        \label{line:knownvcglobal-globalmatrix}
    \EndWhenRcv
  \end{algorithmic}
\end{algorithm*}