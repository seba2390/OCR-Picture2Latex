
\begin{algorithm*}[t]
  \caption{Client operations at client $\cl$}
  \label{alg:unistore-client}
  \begin{algorithmic}[1]
    \Function{\start}{\null}
      \label{line:function-starttx}
      \State $\clientcoord \gets$ an arbitrary replica in data center $\clientdc$
        \label{line:starttx-random-partition}
      \State $\ctid \gets \rpc \Call{\starttx}{\pastVC} \at \clientcoord$
        \label{line:starttx-call-start}
        \Comment{\tscolor{$\timestamp(\start) \gets
          \snapVC^{\clientcoord}_{\clientdc}[\ctid]$}}
        \label{line:starttx-ts}
      \State \Return $\ctid$
        \label{line:starttx-return}
    \EndFunction

    \Statex
    \Function{\read}{$k$} \label{line:function-read}
      \State $\langle v, \lccolor{\lcvar} \rangle \gets
        \rpc \Call{\doread}{\ctid, k} \at \clientcoord$
        \label{line:read-call-doread}
      \If{$\lcvar \neq \bot$}
        \label{line:read-is-external}
        \State \lccolor{$\lc \gets \max\set{\lc, \lcvar}$}
          \label{line:read-lc}
      \EndIf
      \State \Return $v$
        \label{line:read-return}
    \EndFunction

    \Statex
    \Function{\updateproc}{$k, v$} \label{line:function-update}
      \State $\rpc \Call{\doupdate}{\ctid, k, v} \at \clientcoord$
        \label{line:update-call-doupdate}
      \State \Return $\ok$
        \label{line:update-return}
    \EndFunction

    \Statex
    \Function{\commitcausaltx}{\null}
      \label{line:function-commitcausaltx}
      \State \lccolor{$\lc \gets \lc + 1$}
        \Comment{\lccolor{$\lclock(\commitcausaltx) \gets \lc$}}
        \label{line:commitcausaltx-lc}
      \State $\vcvar \gets \rpc \Call{\commitcausal}{\ctid, \lccolor{\lc}} \at \clientcoord$
        \label{line:commitcausaltx-call-commitcausal}
      \State $\pastVC \gets \vcvar$
        \label{line:commitcausaltx-pastvc}
        \Comment{\tscolor{$\timestamp(\commitcausaltx) \gets \pastVC$}}
        \label{line:commitcausaltx-ts}
      \State \Return $\ok$
        \label{line:commitcausaltx-return}
    \EndFunction

    \Statex
    \Function{\commitstrongtx}{\null}
      \label{line:function-commitstrongtx}
      \State \lccolor{$\lc \gets \lc + 1$}
        \label{line:commitstrongtx-lc-so}
      \State $\langle \decvar, \vcvar, \lccolor{\lcvar} \rangle \gets \rpc
        \Call{\commitstrong}{\ctid, \lccolor{\lc}} \at \clientcoord$
        \label{line:commitstrongtx-call-commitstrong}
      \If{$\decvar = \commit$}
        \label{line:commitstrongtx-if-commit}
        \State $\pastVC \gets \vcvar$
          \label{line:commitstrongtx-pastvc}
          \Comment{\tscolor{$\timestamp(\commitstrongtx) \gets \pastVC$}}
          \label{line:commitstrongtx-ts}
        \State \lccolor{$\lc \gets \lcvar$}
          \Comment{\lccolor{$\lclock(\commitstrongtx) \gets \lc$}}
          \label{line:commitstrongtx-lc}
      \EndIf
      \State \Return $dec$
        \label{line:commitstrongtx-return}
    \EndFunction

    \Statex
    \Function{\fence}{\null} \label{line:function-fence}
      \State \var $\p \gets$ an arbitrary replica in data center $\clientdc$
        \label{line:fence-partition}
      \State $\rpc \Call{\uniformbarrier}{\pastVC} \at \p$
        \label{line:fence-call-uniformbarrier}
        \Comment{\tscolor{$\timestamp(\fence) \gets \pastVC$}}
        \label{line:fence-ts}
      \State \lccolor{$\lc \gets \lc + 1$}
        \Comment{\lccolor{$\lclock(\fence) \gets \lc$}}
        \label{line:fence-lc}
      \State \Return $\ok$
        \label{line:fence-return}
    \EndFunction

    \Statex
    \Function{\clattach}{$j$} \label{line:function-migrate}
      \State \var $\p \gets$ an arbitrary replica in data center $j$
        \label{line:clattach-partition}
      \State $\rpc \Call{\attach}{\pastVC} \at \p$
        \label{line:clattach-call-attach}
        \Comment{\tscolor{$\timestamp(\clattach) \gets \pastVC$}}
        \label{line:clattach-ts}
      \State \lccolor{$\lc \gets \lc + 1$}
        \Comment{\lccolor{$\lclock(\clattach) \gets \lc$}}
        \label{line:clattach-lc}
      \State $\clientdc \gets j$
        \label{line:clattach-j}
      \State \Return $\ok$
        \label{line:clattach-return}
    \EndFunction
  \end{algorithmic}
\end{algorithm*}