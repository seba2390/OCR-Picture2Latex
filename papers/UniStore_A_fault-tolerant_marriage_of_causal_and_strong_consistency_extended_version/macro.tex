\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{xspace}
\usepackage{tabulary}
\usepackage{graphicx}
\usepackage{setspace}
\usepackage{etoolbox}
\usepackage[shortlabels]{enumitem}
\usepackage{hyphenat}

\hyphenation{uni-store red-blue rubis}


\setlength{\fboxsep}{0pt}

\usepackage[labelfont=bf,skip=10pt,belowskip=0pt,font=small]{caption}
\captionsetup[algorithm]{font=small}

\let\Algorithm\algorithm

\makeatletter
\patchcmd{\ALG@doentity}{\item[]\nointerlineskip}{}{}{}
\makeatother

\setlength{\dbltextfloatsep}{12pt}
\setlength{\textfloatsep}{12pt}

\setlist[enumerate]{topsep=2pt}
\setlist[itemize]{topsep=2pt}
\setlist{noitemsep}


\usepackage{tikz}
\usetikzlibrary{arrows}
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,fill, color=black,draw,inner sep=.5pt] (char) {\small
              {\bf \textcolor{white}{#1}}};}}

\sloppy

\algrenewcommand\algorithmicindent{1em}

\newcommand{\System}{\textsc{UniStore}\xspace}
\newcommand{\RedBlue}{\textsc{RedBlue}\xspace}
\newcommand{\CureFT}{\textsc{CureFT}\xspace}
\newcommand{\Strong}{\textsc{Strong}\xspace}
\newcommand{\Centralised}{\textsc{Centralised}\xspace}
\newcommand{\Uniform}{\textsc{Uniform}\xspace}
\newcommand{\Causal}{\textsc{Causal}\xspace}

\newcommand{\ourmodel}{CausalStrong\xspace}

\newcommand{\SpaceHandler}{\vspace{5pt}}

\definecolor{Background}{gray}{0.85}
\newcommand{\BackColor}{Background}
\newcommand{\StrongColor}{Black}
\newcommand{\CausalTxColor}{NavyBlue}
\newcommand{\StrongTxColor}{BrickRed}


\newcommand{\algline}[2]{line~\ref{#1}:\ref{#2}}
\newcommand{\alglines}[3]{lines~\ref{#1}:\ref{#2}-\ref{#3}}
\newcommand{\algtwolines}[3]{lines~\ref{#1}:\ref{#2} and \ref{#1}:\ref{#3}}


\algblockdefx[upon]{When}{EndWhen}%
  [3][Unknown]{\textbf{when for every} #3 \textbf{received a quorum of} #1(#2)}%
  {\textbf{end}}

\algblockdefx[upon]{WhenRcv}{EndWhenRcv}%
  [1][Unknown]{\textbf{when received} #1}%
  {\textbf{end}}

\algblockdefx[upon]{Upon}{EndUpon}%
  [1][Unknown]{\textbf{upon} #1}%
  {\textbf{end upon}}

\makeatletter
\ifthenelse{\equal{\ALG@noend}{t}}%
  {\algtext*{EndWhenRcv}}
  {}%
\makeatother

\makeatletter
\ifthenelse{\equal{\ALG@noend}{t}}%
  {\algtext*{EndWhen}}
  {}%
\makeatother

\makeatletter
\ifthenelse{\equal{\ALG@noend}{t}}%
  {\algtext*{EndUpon}}
  {}%
\makeatother

\makeatletter
\newcommand\xleftrightarrow[2][]{%
  \ext@arrow 9999{\longleftrightarrowfill@}{#1}{#2}}
\newcommand\longleftrightarrowfill@{%
  \arrowfill@\leftarrow\relbar\rightarrow}
\makeatother

\newcommand{\hhref}[2]{href{#2}{#1}}  %


\newcommand{\DC}{\mathcal{D}}
\newcommand{\Transactions}{\mathcal{T}}
\newcommand{\Keys}{\mathcal{K}}
\newcommand{\Partitions}{\mathcal{P}}


\newcommand{\colored}[1]{\textcolor{BrickRed}{#1}}
\newcommand{\coloredblue}[1]{\textcolor{NavyBlue}{#1}}

\newcommand{\lastdelivered}{{\sf lastDelivered}}
\newcommand{\vaggrvector}{\ensuremath{\mathit{prepareVec}}}
\newcommand{\preparedred}{{\sf preparedStrong}}
\newcommand{\vpreparedred}{\ensuremath{\mathit{preparedStrong}}}
\newcommand{\committedred}{{\sf decidedStrong}}
\newcommand{\vcommittedred}{\ensuremath{\mathit{decidedStrong}}}
\newcommand{\status}{{\sf status}}
\newcommand{\leader}{{\sf leader}}
\newcommand{\txn}{{\sf txn}}
\newcommand{\vote}{{\sf vote}}
\newcommand{\phase}{{\sf phase}}
\newcommand{\dec}{{\sf dec}}
\newcommand{\ballot}{{\sf ballot}}
\newcommand{\aballot}{{\sf cballot}}
\newcommand{\vaballot}{\mathit{cballot}}
\newcommand{\nextv}{{\sf next}}
\newcommand{\tid}{{\sf tid}}
\newcommand{\LEADER}{\textsc{leader}}
\newcommand{\FOLLOWER}{\textsc{follower}}
\newcommand{\RECOVER}{\textsc{recover}}
\newcommand{\RECOVERING}{\textsc{recovering}}
\newcommand{\COMMIT}{\textsc{commit}}
\newcommand{\TRUE}{\textsc{true}}
\newcommand{\FALSE}{\textsc{false}}
\newcommand{\ABORT}{\textsc{abort}}
\newcommand{\START}{\textsc{start}}
\newcommand{\BLUEPREPARED}{\textsc{prepare\_ack}}
\newcommand{\DECIDED}{\textsc{already\_decided}}
\newcommand{\ACCEPT}{\textsc{accept}}
\newcommand{\ACCEPTACK}{\textsc{accept\_ack}}
\newcommand{\REPLICAS}{\textsc{replicas}}
\newcommand{\trusted}{{{\sf trusted}}}
\newcommand{\NACK}{\textsc{nack}}
\newcommand{\NEWLEADER}{\textsc{new\_leader}}
\newcommand{\NEWLEADERACK}{\textsc{new\_leader\_ack}}
\newcommand{\NEWSTATE}{\textsc{new\_state}}
\newcommand{\NEWSTATEACK}{\textsc{new\_state\_ack}}
\newcommand{\CERTIFY}{\textsc{certify}}
\newcommand{\CERTIFYTX}{\textsc{certification\_check}}

\newcommand{\newtxid}{\mathtt{generate\_tid}}
\newcommand{\partitionof}{\mathtt{partition}}
\newcommand{\rbpartition}{{\sf redblue}}
\newcommand{\MAKEUNIFORM}{\textsc{uniform\_barrier}}
\newcommand{\ATTACH}{\textsc{attach}}
\newcommand{\STARTTX}{\textsc{start\_tx}}
\newcommand{\UPDATETX}{\textsc{do\_op}}
\newcommand{\COMMITBLUE}{\textsc{commit\_causal}}
\newcommand{\EXECOP}{\textsc{get\_version}}
\newcommand{\APPLY}{\textsc{apply\_effect}}
\newcommand{\OPRET}{\textsc{version}}
\newcommand{\BLUEPREPARE}{\textsc{prepare}}
\newcommand{\REDPREPARE}{\textsc{prepare\_strong}}
\newcommand{\PROPAGATE}{\textsc{propagate\_txs}}
\newcommand{\PROPAGATELOCAL}{\textsc{propagate\_local\_txs}}
\newcommand{\PROPAGATEREMOTE}{\textsc{forward\_remote\_txs}}
\newcommand{\REPLICATE}{\textsc{replicate}}
\newcommand{\BHEARTBEAT}{\textsc{heartbeat}}
\newcommand{\RHEARTBEAT}{\textsc{heartbeat\_strong}}
\newcommand{\CLEANCOMM}{\textsc{clean\_committed}}
\newcommand{\UPDRCV}{\textsc{knownvec\_global}}
\newcommand{\UPDCSS}{\textsc{knownvec\_local}}
\newcommand{\UPDUSS}{\textsc{stablevec}}
\newcommand{\CASTVC}{\textsc{broadcast\_vecs}}
\newcommand{\COMMITRED}{\textsc{commit\_strong}}
\newcommand{\LEADERS}{\textsc{get\_leaders}}
\newcommand{\DECISION}{\textsc{decision}}
\newcommand{\LEARNDECISION}{\textsc{learn\_decision}}
\newcommand{\DELIVER}{\textsc{deliver}}
\newcommand{\DELIVERUPD}{\textsc{deliver\_updates}}
\newcommand{\RETRY}{\textsc{retry}}

\newcommand{\partition}{\ensuremath{p}}
\newcommand{\partitions}{{\sf partitions}}
\newcommand{\clock}{{\sf clock}}
\newcommand{\aggregate}{{\sf aggregate}}
\newcommand{\cuvc}{{\sf clientUniformVC}}
\newcommand{\past}{{\sf pastVec}}
\newcommand{\blue}{\textsl{causal}}
\newcommand{\red}{\textsl{strong}}
\newcommand{\proposed}{{\sf proposed}}
\newcommand{\SYSTEM}{Cure} %
\newcommand{\WEAKTCC}{TCC-S} %
\newcommand{\PROTOCOL}{\emph{ExtClockSI}} %
\newcommand{\replicavectorclock}{{\sf knownVec}}
\newcommand{\areplicavectorclock}{\ensuremath{\mathit{knownVec}}}
\newcommand{\avecsnapshottime}{\ensuremath{\mathit{snapVec}}}
\newcommand{\vecsnapshottime}{\ensuremath{\mathsf{snapVec}}}
\newcommand{\val}{\ensuremath{\mathit{value}}}
\newcommand{\cstate}{\ensuremath{\mathit{state}}}
\newcommand{\update}{\ensuremath{f}}
\newcommand{\effval}[2]{\ensuremath{{\sf retval}(#1, #2)}}
\newcommand{\effeff}[2]{\ensuremath{{\sf effector}(#1, #2)}}
\newcommand{\apply}{\ensuremath{{\sf apply}}}
\newcommand{\op}{\ensuremath{\mathit{op}}}
\newcommand{\ts}{\ensuremath{\mathit{ts}}}
\newcommand{\cvector}{\ensuremath{\mathit{vector}}}
\newcommand{\delivered}{{\sf delivered}}
\newcommand{\rvc}{{\sf globalMatrix}}
\newcommand{\pmc}{{\sf localMatrix}}
\newcommand{\gmc}{{\sf stableMatrix}}
\newcommand{\commitvector}{\ensuremath{\mathit{commitVec}}}
\newcommand{\committed}{\ensuremath{commTx}}
\newcommand{\stablesnapshot}{{\sf stableVec}}
\newcommand{\astablesnapshot}{\ensuremath{\mathit{stableVec}}}
\newcommand{\uniformsnapshot}{{\sf uniformVec}}
\newcommand{\physicalclock}{\ensuremath{c}}
\newcommand{\commitdc}{\ensuremath{dc}}
\newcommand{\snapshot}{\ensuremath{s}}
\newcommand{\numDC}{\ensuremath{D}}
\newcommand{\numPart}{\ensuremath{P}}
\newcommand{\tx}{\ensuremath{\mathit{tid}}}
\newcommand{\prt}{\ensuremath{p}}
\newcommand{\transaction}[1]{\ensuremath{T_{#1}}}
\newcommand{\replica}{\ensuremath{r}}
\newcommand{\readsnapshot}[1]{\ensuremath{\Snapshot _{r}(#1)}}
\newcommand{\Snapshot}{\ensuremath{\mathcal{S}}}
\newcommand{\orderbefore}{\leadsto}
\newcommand{\uorderbefore}{\mapstochar\mathrel{\mspace{0.45mu}}\leadsto}
\newcommand{\snapshotset}{\Sigma}
\newcommand{\timeset}{\mathcal{T}}
\newcommand{\timeid}{t}
\newcommand{\prectime}{\preceq}
\newcommand{\conssnapshot}{\Sigma_{\textsc{cons}}}
\newcommand{\partialsnapshot}[2]{\replica #1 (#2)}
\newcommand{\setofupdates}{\mathcal{U}}
\newcommand{\setofobjects}{\mathcal{O}}

\newcommand{\setdecisions}{\mathcal{D}}
\newcommand{\numpartitions}{N}

\newcommand{\preparedblue}{{\sf preparedCausal}}
\newcommand{\committedset}{{\sf committedCausal}}
\newcommand{\store}{{\sf opLog}}
\newcommand{\ars}{\ensuremath{\mathit{rset}}}
\newcommand{\aws}{\ensuremath{\mathit{wbuff}}}
\newcommand{\updates}{\ensuremath{\mathit{updates}}}
\newcommand{\readset}{{\sf rset}}
\newcommand{\writeset}{{\sf wbuff}}
\newcommand{\atxeffects}{\ensuremath{\mathit{effects}}}
\newcommand{\aleaders}{\ensuremath{\mathit{leaders}}}
\newcommand{\version}{\ensuremath{\mathit{strongTs}}}
\newcommand{\avote}{\ensuremath{\mathit{vote}}}
\newcommand{\adecision}{\ensuremath{\mathit{decision}}}
\newcommand{\atxs}{\ensuremath{\mathit{txs}}}
\newcommand{\atx}{\ensuremath{\mathit{tx}}}
\newcommand{\avc}{\ensuremath{V}}
\newcommand{\preparedtime}{{\sf preparedTime}}
\newcommand{\areplica}{l}
\newcommand{\asecondreplica}{n}
\newcommand{\athirddc}{h}


\let\ensuremathorig=\ensuremath
\renewcommand{\ensuremath}[1]{\ensuremathorig{#1}\xspace}

\newcommand{\NNset}{\ensuremath{\mathbb{N}}}
\renewcommand{\emptyset}{\varnothing}

\newcommand{\union}{\cup}
\newcommand{\inter}{\cap}
\newcommand{\bigunion}{\ensuremath{\bigcup}}
\newcommand{\biginter}{\bigcap}
\newcommand{\true}{\ensuremath{\mathit{true}}}
\newcommand{\false}{\ensuremath{\mathit{false}}}
\newcommand{\xor}{\oplus}

\newcommand{\equals}{\ensuremath{=}}
\newcommand{\equaldef}{\ensuremath{\stackrel{\mathrm{def}}{=}}}
\newcommand{\equivdef}{\stackrel{\mathrm{def}}{\equiv}}
\newcommand{\iftxt}{~{\mathrm{if}}~}
\newcommand{\ifftxt}{~{\mathrm{iff}}~}
\let\longimplies=\implies
\renewcommand{\implies}{\ensuremath{\Rightarrow}}
\newcommand{\notimplies}{\ensuremath{\not \implies}}
\let\longiff=\iff
\renewcommand{\iff}{\Leftrightarrow}

\newcommand{\lub}{\ensuremath{\sqcup}}
\newcommand{\glb}{\ensuremath{\sqcap}}

\newcommand{\Henceforth}{\ensuremath{\Box}}
\newcommand{\Eventually}{\ensuremath{\Diamond}}

\newcommand{\tlGlobally}{\ensuremath{\square}}
\newcommand{\tlFuture}{\ensuremath{\lozenge}}
\newcommand{\tlNext}{\ensuremath{\circ}}
\newcommand{\nextOf}[1]{\ensuremath{{#1}{'}}}

\newcommand{\bottom}{\ensuremath{\bot}}
\newcommand{\pp}[1]{{\sf #1}}

\newcommand{\happensbefore}{\ensuremath{\rightarrow}}

\newtheoremstyle{mytheorem}
  {5pt} %
  {5pt} %
  {} %
  {} %
  {\bfseries} %
  {.} %
  {.4em} %
  {} %

\theoremstyle{mytheorem}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}
\newtheorem{definition}{\sc Definition}
\newtheorem{property}{\sc Property}

\newboolean{showcomments}
\setboolean{showcomments}{true}
\ifthenelse{\boolean{showcomments}}
{ \newcommand{\mynote}[2][fromWhom?]{%
    {\color{red}\small%
      $\blacktriangleright$%
      \fbox{\bfseries\sffamily\scriptsize#1}%
      \textsf{\em #2}%
      $\blacktriangleleft$%
}}}
{ \newcommand{\mynote}[2][fromWhom?]{}}

\newcommand{\todo}[1]{{\bf TODO: #1}}

\newcommand{\liveness}{Eventual Visibility}



\makeatletter







\def\section{\@startsection {section}{1}{\z@}
  {-3ex plus-1ex minus -.2ex}{2ex plus.2ex}{\reset@font\large\bf}}

\renewcommand\subsection{\@startsection{subsection}{2}{\z@}%
  {-.75\baselineskip \@plus -2\p@ \@minus -.2\p@}%
  {.3\baselineskip}%
  {\reset@font\bf}}

\renewcommand\paragraph{\@startsection{subparagraph}{5}{\z@}%
  {-.5\baselineskip \@plus -1\p@ \@minus -.2\p@}%
  {-3.5\p@}%
  {\normalsize\bfseries}}



\makeatother


\renewcommand\floatpagefraction{.9}
\renewcommand\topfraction{.9}
\renewcommand\bottomfraction{.9}
\renewcommand\textfraction{.1}   

\renewcommand{\ttdefault}{cmtt}

\newcommand{\tr}[2]{\iflong{}\S#1\else{}\cite[\S#2]{ext}\fi}
\newcommand{\tra}[2]{\iflong{}(\S#1)\else{}\cite[\S#2]{ext}\fi}

\newcommand{\nappfull}{A}
\newcommand{\nappconsistency}{B}
\newcommand{\napptcs}{C}
\newcommand{\nappproof}{D}


