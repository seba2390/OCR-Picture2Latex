
\section{Introduction}
%\vspace{-1mm}
%The increase in mobile data traffic of emerging applications with diverse requirements has driven the efforts to re-design the radio access networks (RANs). There have been systematic works in standardization bodies to adopt the concept of \textit{softwarization} and \textit{virtualization} to the RAN architecture \cite{smallcell, split_3gpp,split_3gpp_rel16}. Cloud/Centralized-RAN (C-RAN) has become a favourable solution to enable the low-cost deployment and high-performance systems by pooling the baseband functions of the base station (BS) to a central server which is also known as Cloud/Central Unit (CU). Through \secrev{centralized} control, such \secrev{an} approach can offer cost-efficient \secrev{solutions} and high-performance network \secrev{managements} simultaneously in RANs. 

The increase in mobile data trafﬁc of emerging applications with diverse requirements has driven the efforts to re-design the radio access networks (RANs). Cloud/Centralized-RAN (C-RAN) has become a favourable solution to enable the low-cost deployment and high-performance systems by pooling the baseband functions of the base station (BS) to a central server which is also known as Cloud/Central unit (CU). \thirdrev{This idea is motivated by the growth of network densification, enabled by the concept of \textit{softwarization}, to offer cost-efﬁcient solutions and high-performance network operations through centralized control \cite{cost_vm}.} However, a fully centralized RAN \thirdrev{is typically not implementable for many reasons \cite{vran_murti2}}. For instance, it requires a low-latency and high-capacity fronthaul, \thirdrev{which is frequently absent in current RANs and prohibitively expensive to develop from scratch. This challenge motivates the transition from} rigid C-RAN designs to flexible architectures, where only a subset of BS functions is centralized at the CU, and the other functions are hosted at the distributed units (DUs) \thirdrev{and radio units (RUs)}\footnote{\thirdrev{RUs are the radio hardware units to run the RF functions.}}. Further, the term virtualized RAN (vRAN) \thirdrev{is coined to describe these architectures \cite{openvran_nec}.}
%
%
%O-RAN Alliance (https://www.o-ran.org/) also defines the term O-CU, O-DU and O-RU for the respective entities.
%However, a fully centralized RAN faces many challenging issues. For instance, it requires a low-latency and high capacity fronthaul, \thirdrev{but this is} often unavailable in current RANs and costly to build from scratch. Such challenges motivate the shift of rigid C-RAN to ﬂexible architectures, where a subset of BS functions is hosted at the CU, and the other functions are at the distributed units (DUs). Further, the term \textit{virtualized RAN} (vRAN)\footnote{Each CU and DU to be run as a virtualized software, e.g, \secrev{virtualized DU (vDU) and virtualized CU (vCU)}. \secrev{A vDU is typically deployed in a far-edge server while a vCU is in a more centralized server (e.g., edge server)}. O-RAN Alliance (https://www.o-ran.org/) also defines the term O-CU and O-DU for the respective entities.} \thirdrev{is coined to describe these architectures} \cite{openvran_nec}. 
%
%Such challenges motivate the shift of rigid C-RAN to ﬂexible architectures \thirdrev{in which the BS functions are decomposed and turn into virtualized components (except RF unit), then select the functional splits to decide which functions to be centralized at the CU and which to be kept at the distributed units (DUs).} Further, the term \textit{virtualized RANs} (vRANs)\footnote{Each CU and DU to be run as a virtualized software, e.g, \secrev{virtualized DU (vDU) and virtualized CU (vCU)}. \secrev{A vDU is typically deployed in a far-edge server while a vCU is in a more centralized server (e.g., edge server)}. O-RAN Alliance (https://www.o-ran.org/) also defines the term O-CU and O-DU for the respective entities.} \thirdrev{is coined to describe these architectures.}
%
%For instance, the higher level splits (higher centralization) can be deployed for high capacity use cases in dense urban areas, while the lower level splits are suited for coverage use cases.\ 

\thirdrev{In vRANs, the BS functions (except RF functions) can be decomposed into virtualized components and executed on commodity hardware across a geo-distributed edge cloud system\footnote{Each CU and DU \thirdrev{is} to run as virtualized software, e.g., virtualized CU (vCU) and virtualized DU (vDU). A DU is typically executed at the far-edge server (co-located or close to the RU), while a CU is \thirdrev{at the edge server (a more centralized server)}.} \cite{nokia_cran_edge}.
 Then, the operators can uniquely select the \textit{functional splits} suited to their needs by deciding which functions will be centralized at the CU and which will be kept at the DUs. This paradigm brings flexibility to the RAN operations, potentially offers a cost-saving, and accommodates diverse use cases and applications in 5G+ systems \cite{function_split_survey, nokia_anyhaul}.} 
%
%
%For instance, more centralized functions are preferred for high capacity, ideal fronthaul and dense urban use cases, while more distributed functions are for coverage and non-ideal fronthaul use cases \cite{function_split_survey, nokia_anyhaul}.} 
%
%
%
%
%
However, selecting the functional splits of all the BSs is challenging. Each split \secrev{has a different delay requirement, initiates a different computing load to the CU and DUs, and induces a different data flow}. The initial design of vRAN fronthaul using point-to-point Common Public Radio Interface (CPRI) \thirdrev{is also suggested to be updated with the new} Crosshaul/xHaul \thirdrev{architecture} based on an open interface and packet-switch (shared) network \thirdrev{such as the enhanced CPRI} \cite{function_split_survey, nokia_anyhaul, xhaul}.
\thirdrev{As a result, in addition to sharing the same computing nodes, each BS has to share the same network links, \thirdrev{which leads to complex interdependence between split decisions.} 
Therefore, it is important to optimize the splits carefully to ensure that the deployment is beneficial; otherwise, it can lead to high operating costs and performance degradation. } 

%across diverse commodity servers in shared networks
%ver an edge cloud system
%having a different data load, computing load and delay requirement for each split
\secrev{On the other hand, optimizing the functional splits produces a high degree of complexity. In addition to \thirdrev{the mentioned challenges, unlike legacy RANs, the behaviour of vRAN system performance such as computing utilization \cite{vranai_journal} and power consumption \cite{jose_bayesian} is highly non-trivial. This non-triviality is also reinforced by vRAN deployment over the same platform with other workloads such as video analytics \cite{concordia_vran}.} As a result, it is \thirdrev{complex and difficult }to model the underlying system precisely. Meanwhile, traditional mathematical optimization approaches rely on complete knowledge of the system behaviour to define the models and solve the problems; \thirdrev{and this }can be unfeasible in practice. These challenges motivate us to shift to machine learning (ML)-based approaches, which can be best to address our vRAN splitting problem amidst minimal assumptions about the underlying system.} %without full knowledge of the system performance and problem expertise.}  

\vspace{-1mm}
\subsection{Related Works}
%\vspace{-1mm}

\secrev{\textbf{Optimization-based approaches.}} 3GPP \cite{split_3gpp,split_3gpp_rel16} and a seminal white paper \cite{smallcell} have defined the detail vRAN split specifications. Although the authors in  \cite{function_split_survey} have discussed the gains and requirements for each split, there are still few works on the optimization issues. Energy consumption for various splits has been evaluated in \cite{apt-ran}.
%, then the authors have proposed an optimization model over different splits. 
The authors in \cite{wizhaul_andres} have studied optimizing the function centralization of vRANs over xHaul. Follow-up works, \cite{fluidran_andres} and \cite{vranmec_andres} offered an optimal solution of minimizing total cost for integration vRANs with Mobile Edge Computing (MEC). Then, the work in \cite{vran_murti1} has proposed an optimized multi-cloud vRAN framework with balancing its centralization \cite{vran_murti2}. The authors in \cite{placeran} have proposed the PlaceRAN framework to minimize the computing resources while maximizing the radio function aggregations \secrev{using the IBM CPLEX solver}. These mentioned works \cite{apt-ran,wizhaul_andres,fluidran_andres,vranmec_andres,vran_murti1,vran_murti2,placeran} have addressed various optimization problems in vRANs. \secrev{However, their frameworks require assuming complete models of the underlying system to deﬁne their problem structures and solve the problems. We argue that such strong assumptions can be inaccurate as the underlying vRAN system is complex and difficult to model precisely.} Additionally, those \secrev{frameworks} need heavy mathematical solutions \thirdrev{with} exponential complexity and slow execution time, \thirdrev{which typically are unsuitable} for large networks and online \thirdrev{execution}. The above problems are \thirdrev{also} often complex combinatorial and difficult to solve \secrev{optimally}. \secrev{Therefore}, we opt out to use optimization-based approaches to \secrev{formulate and solve our vRAN splitting problem}.

%and intuitive heuristic algorithm
%\secrev{However, such approaches requires complete knowledge of system performance and problem expertise.}

%Such approaches require prior knowledge of problem expertise (e.g., formulating each problem mathematically) that may not be possible in practice \cite{mlcombi_yoshua}.  Additionally, it needs heavy mathematical solutions that often have exponential complexity and slow execution time particularly in large networks. The above problems are also often complex combinatorial and difficult to solve. Hence, we opt out to use optimization-based approaches to tackle the functional split problem in vRAN.

\secrev{\textbf{ML-based approaches.} ML techniques recently have been spurred to address complex optimization and control problems in wireless networks \cite{ali20206g, ali2020ml}. The authors in \cite{vranai_journal} have proposed a learning framework that successfully solves a contextual bandit problem of dynamic computing and radio resource controls in vRANs using a deep reinforcement learning (RL) paradigm. Further, they leveraged Bayesian learning for energy efficient-based resource orchestrator in \cite{jose_bayesian}. ML-based predictor also has been developed in \cite{concordia_vran} that learns to share the CPU resources between a vRAN workflow and other workflows in the same server. Although the authors in \cite{vranai_journal,jose_bayesian,concordia_vran} have shown the non-triviality of vRAN performance  and the importance of learning based-framework to manage the vRAN resources, they still did not discuss how to design a framework that learns to optimize the functional splits. 
}
Recent work in \cite{vran_dl} has studied user-centric slicing and split optimization problems using a deep learning \secrev{method}. The authors modelled their problem as supervised learning, which relies on high-quality labelled datasets (e.g., optimal labels) to assess the quality of the decisions. 
%In this case, the problem is defined mathematically as integer linear programming (ILP). Then, multiple instances of the problem are solved using a commercial solver (e.g., IBM CPLEX) to generate the datasets. 
Once trained, the model can be used quickly in an online manner, offering a real-time solution \secrev{for assigning the split for each user slice}. However, in vRANs, obtaining such high-quality labels is expensive. \thirdrev{To construct the labelled datasets, we still need} complete knowledge of the system performance to model the problem mathematically \thirdrev{and} solve multiple instances of the problem. 
%
\secrev{The work in \cite{green_oran} has addressed the functional split problem for green Open RANs using Q-learning and SARSA; however, they assumed each DU/CU as an independent agent that focuses on its own utility. We argue that every split decision in vRANs is interdependent as the BSs share the same network links and computing nodes with limited capacity. Besides, \cite{vran_dl} focused on the split assignment for the users, and \cite{green_oran} studied the effectiveness of energy sources, but we aim for a different goal.} 


\vspace{-1mm}
\subsection{Methodology \& Contributions}
%\vspace{-2mm}

Our goal is to develop a zero-touch optimization framework that optimizes the functional \secrev{splits} \thirdrev{of} \secrev{the BSs to minimize the total network cost} in the vRAN system. First, we formulate and present the functional split problem mathematically to provide a better understanding of its objective and constraints. Our formulation yields a combinatorial and NP-hard problem. Therefore, it is computationally expensive to solve optimally, especially for large-scale networks and real-time execution. Moreover, solving such a problem often relies on \secrev{the assumptions of the underlying system to define and model the problem structure (e.g., mathematical optimization). However, in practice, the behaviour of vRAN performance and resources is highly non-trivial, which is complex and can be unfeasible to model the system precisely. }   
 
Motivated by the above challenges, we formulate the functional split problem with {constrained neural combinatorial RL}. We use neural networks \secrev{to approximate the policy that} maps the state observations to the actions. Then, the idea is to estimate the neural network model's parameters iteratively by taking instances from the problem spaces using a constrained deep RL paradigm. For every interaction with the environment (vRAN system), we expect to receive a reward (the induced total network cost) and penalty (constraint violation) as feedback signals and the output returned by the neural network to learn and improve the model. \thirdrev{This paradigm} considers the vRAN system as a black-box environment, \thirdrev{making} minimal assumptions about the underlying system. It also does not need the optimal labelled datasets, which are highly expensive to obtain in vRANs. 
 

\thirdrev{Further, we propose a novel constrained deep reinforcement-based functional split optimization framework (CDRS) to solve the problem. Due to the combinatorial nature of the problem finding the optimal splits, the action space of our RL problem becomes enormously large. Therefore, we develop CDRS using a chain rule-based stochastic policy \cite{neural_bello} in which policy network architecture using a long short-term memory (LSTM) network-based sequence-to-sequence model is applied to estimate the policy \cite{seq2seq,attention_bahdanau}. However, this policy is still limited to an unconstrained problem, which is not directly applicable to our vRAN splitting problem. Therefore, we leverage a constrained policy gradient method to train and guide the policy toward constraint satisfaction. Then, CDRS can be tailored into {CDRS-Fixed} and {CDRS-Ada}. CDRS-Fixed uses a fixed penalty coefficient \cite{solozabal_constrained, vnf_drl_solozabal} while {CDRS-Ada} updates the penalty coefficient adaptively \cite{reward_constraint,pdo_risk}. A self-competing baseline is also utilized with an auxiliary network to improve the policy further. Once the model is trained, finding the solution for the problem is computationally efficient as it only requires a forward pass through the trained neural network. Therefore, we provide a search strategy to improve the optimality performance at the test time. Following the search strategy, CDRS can be further tailored into {CDRS-Fixed-G}, {CDRS-Ada-G}, {CDRS-Fixed-T} and  {CDRS-Ada-T}. CDRS-Fixed-G and CDRS-Ada-G utilize greedy decoding while CDRS-Fixed-T and CDRS-Ada-T use temperature sampling.}

\thirdrev{CDRS is evaluated} in terms of training behaviour, optimality performance, the impact of altering the traffic load and routing cost and the computational time. The evaluations are performed using a synthetic network generated by the Waxman algorithm \cite{waxman} and a real network dataset \cite{sndlib}. The used system parameters are from a measurement-based 3GPP-compliant system model. To assess the effectiveness of our approach, we compare it to the optimal value obtained from a Phyton-MIP solver\footnote{We use a solution obtained from a mixed-integer programming solver (https://www.python-mip.com/) as an optimal baseline comparison. It offers an exact solution through a well-known method, Branch-\&-Cut algorithm. }. Following our evaluations, CDRS successfully learns the optimal \secrev{functional splits} and solves the problem with $0.05\%$ of the optimality gap\footnote{We use the term \emph{optimality gap} to define our solution's error compared to the optimal value obtained from the MIP solver.} (e.g., CDRS-Fixed-T).  Our results also show that CDRS is the most cost-effective compared to two extreme cases: fully C-RAN and D-RAN. All of our CDRS settings are \thirdrev{also} faster than the MIP solver, where CDRS-Ada-G can attain as high as 22.82 times faster. Our contributions can be summarized:
%
\begin{itemize}
	\item  We formulate the vRAN split problem to constrained neural combinatorial RL, which takes minimal assumptions about the underlying system and does not require the optimal labelled datasets to solve the problem. We also consider the interdependence between split decisions capturing the network links and computing resources sharing among the BSs.
	
	%\item We propose CDRS \thirdrev{as our solution framework}. \secrev{ CDRS utilizes a chain rule-based stochastic policy to select the splits for the BSs, which can deal with the interdependence between split decisions and a curse dimensionality of large action spaces.} CDRS \thirdrev{leverages} a constrained policy gradient method with a self-competing baseline \secrev{to train the policy} and utilizes LSTM networks\thirdrev{-based sequence-to-sequence model} for the policy network architecture. \thirdrev{Following the penalty coefficient and search strategy settings, CDRS can be tailored into} CDRS-Fixed-G, CDRS-Fixed-T, CDRS-Ada-G and CDRS-Ada-T.
	
	\item We propose CDRS as \thirdrev{a novel solution framework}. CDRS adopts a chain rule-based stochastic policy \thirdrev{to} deal with the interdependence between split decisions and the combinatorially large discrete action space of the problem in which an LSTM networks\thirdrev{-based sequence-to-sequence model} is applied to estimate the policy. \thirdrev{We utilize} a constrained policy gradient method with a self-competing baseline \thirdrev{to train and guide the policy toward constraint satisfaction.} Following the penalty coefﬁcient and search strategy settings, \thirdrev{CDRS can be tailored} into CDRS-Fixed-G, CDRS-Fixed-T, CDRS-Ada-G and CDRS-Ada-T.
	
	
	\item We conduct a series of evaluations using synthetic and real network datasets. We investigate the training behaviour, the accuracy of the solution, the impact of routing cost and traffic load and the computational time.  
\end{itemize}

%To the best of our knowledge, this work is ﬁrst to optimize the splits of the BSs to minimize the total network cost in the vRAN system using a constrained deep RL paradigm, which takes minimal assumptions about the underlying system and adopts a chain rule-based stochastic policy to deal with the large action spaces and interdependence between decisions.

To the best of our knowledge, this work is ﬁrst to optimize the functional splits of the BSs to minimize the total network cost in the vRAN system using a constrained deep RL paradigm, which takes minimal assumptions about the underlying system and adopts a chain rule-based stochastic policy to deal with the large action space and interdependence between decisions.


% Following our evalutions, CDRS framework successfully learns the optimal function split decision, solves the problem with only $0.05\%$ optimality gap\footnote{We use the term \emph{optimality gap} to define our solution's error compared to the optimal value obtained from MIP Solver.}, 




%and saves the total network cost to $320\%$ of D-RAN. Additionally, altering the traffic load and routing cost does not significantly degrade the optimality performance.
%Comparison to state of the art:  for simplicity
%\begin{itemize}
%	\item First work that use Machine Learning and Reinforcement Learning to optimize function split in vRAN (timely topic flexible functional split, 3GPP Rel. 16 for 5G and beyond)
%	\item Suitable for large network (suppose to be stable computational time in large problem), less  engineering and heuristic design. 
%	\item To tackle large network (action spaces, and constraints), we formulate Constrained Neural Combinatorial Reinforcement Learning. 1) use Policy gradient to learn the parameters of stochastic policy. Lagrangian relaxation to handle the constraints (convert to dual problem RL) and define penalty for unfeasible solution. NN architecture: LSTM with Attention mechanism. To tackle the drawback of PG from local convergence, we use sampling with temperature hyperparameter for searching algorithm. 
%\end{itemize}

%Section \ref{sec:related_work} discuss the related works.

The rest of this paper is organized as follows. The background and system model of vRAN are presented in Section \ref{sec:model}. The functional split problem is formalized mathematically in Section \ref{sec:problem}. Our proposed framework is described in Section \ref{sec:solution}. Our simulation and experiment results are discussed in Section \ref{sec:results}. Finally, our work is concluded in Section \ref{sec:conclusion}.