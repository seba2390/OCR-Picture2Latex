\section{SIMULATION RESULTS}
\label{sec:examples}
This section presents simulation results of the proposed method implemented on the unicycle model example.
Each semidefinite program was prepared using a custom software toolbox and the modeling tool YALMIP \cite{lofberg2004yalmip}.
The programs are run with commercial solver MOSEK on a machine with $1$ TB availabe memory. 

\subsection{FRS Computation}
We computed the FRS for a 3$^\text{rd}$ order Taylor-expanded Dubins car as the low-fidelity model $f_s$.
Trajectories produced by this model were tracked by the unicycle model from Equation \eqref{eq:big_dyn} as the high-fidelity model $f$.
The vehicle's representation as an initial distribution $X_0 \subset X_s$, was a rectangle of length $0.2$ [m] in $x$ and width $0.1$ [m] in $y$, at $0^\circ$ initial heading, and centered at $x=-0.75$ and $y=0$.
This is the same vehicle representation shown in all previous figures.

% The error function $g$, illustrated in Figure \ref{fig:error_dynamics}, was given by:
% \begin{equation}
% \label{eq:g_definition}
% g(t,x_s) = \begin{bmatrix}
% v_\text{err}\cdot(1 - \frac{1}{2}\theta^2)  \\
% v_\text{err}\cdot(\theta - \frac{1}{6}\theta^3) \\
% \dot{\theta}_\text{err}
% \end{bmatrix}
% \end{equation}
% where $v_\text{err} = (t-1)^2$ and $\dot{\theta}_\text{err} = (t-1)^4$.
We chose $\tau_\text{stop} = \tau_\text{plan} = 0.5$ [s], so $T = 1$ [s].
The stopping time can be seen in Figure \ref{fig:error_dynamics}. 
The FRS computation took 79 hours and used a maximum of 150 GB of memory 
%on a server with 1 TB of available memory and 18 processors each running at 1.2 GHz.

\subsection{Set Intersection and Trajectory Planning}

We used the precomputed FRS for safe trajectory planning in $1000$ simulated trials in MATLAB on the aforementioned machine.
For each trial, the vehicle began at the same initial location and heading, surrounded by $1-10$ randomized obstacles and a randomly-located goal to reach.
%If the planning time took more than $\tau_\text{plan}$, the simulation paused until the computation was complete. 
%In practice, if $\tau_\text{plan}$ was exceeded the vehicle could begin braking to ensure safety.
The vehicle's initial speed, and the desired speed to maintain for the duration of the trial, were randomly chosen between $0.25$ and $0.75$ [m/s].
% The trials ran in 12.7 hours.
% Prior to running these trials, several example trials were run on a laptop with a 2.3 GHz processor and 16 GB of RAM.
% The trials run on the server were individually no faster than running on the laptop, because the set intersection optimization is a single-core process that uses very little memory. 
% Therefore, the server did not provide any significant decrease in the implemented planning time.


Obstacles were represented as line segments between $0.1$ and $0.2$[m] in length, with random location and orientation.
The obstacles were always placed between the vehicle and the goal.
We checked for crashes conservatively for each trial, by inspecting if any obstacle was within a circle circumscribing the rectangular vehicle at any point of the vehicle's trajectory. 
Using this method, \emph{no crashes were detected in any trial}.
Out of all the trials, $82\%$ reached the goal, and $15\%$ performed an emergency braking maneuver (by setting $v_\text{des} = 0$). 
The remaining 3\% hit a simulation iteration limit.
Examples of the vehicle's path from a randomly-generated trial and from two constructed emergency braking cases are shown in Figure \ref{fig:example_trial}.


\begin{figure}
\centering
\includegraphics[width=1\columnwidth]{running_examples.pdf}
\caption{The top subplot shows an example result out of the $1000$ trials.
This trial used eight randomly-generated obstacles.
The vehicle begins on the left at $x = -0.75$ and reaches a randomly-generated goal near $(2.5, 0.5)$, plotted as a blue circle.
Every $\tau_\text{plan} = 0.5$[s], the vehicle replans its trajectory, shown by an asterisk plotted on the global trajectory in blue.
The bounding box of the vehicle at each planning step is shown as a grey rectangle. In the bottom-left subplot, an obstacle was constructed between the vehicle and the goal, forcing an emergency braking maneuver. In the bottom-right subplot, an obstacle was constructed with a hole that would allow the vehicle to pass, but the set intersection result is overly conservative, resulting in a braking maneuver.}
\label{fig:example_trial}
\end{figure}

Currently, our implementation cannot consistently achieve $\tau_\text{plan} = 0.5$ [s].
Consequently, instead of replanning and driving simultaneously, we pause time every 0.5 [s] of the simulation to guarantee that the vehicle can finish replanning.
In a physical implementation, if $\tau_\text{plan}$ is exceeded, then the vehicle must emergency brake; recall that a safe braking trajectory is always available.
As shown in Figure \ref{fig:planning_time_vs_Nobs}, $\tau_\text{plan}$ scales linearly with the number of obstacles.
%Methods for reducing the set intersection to meet $\tau_\text{plan}$ will be presented in future work.

\begin{figure}
\centering
\includegraphics[scale=0.45,trim={1cm 6cm 1cm 7cm},clip]{planning_time_vs_Nobs.pdf}
\caption{The mean set intersection time (top) and trajectory optimization time (bottom) versus the number of obstacles. Over the $1000$ trials, each number of obstacles from $1$ to $10$ was used for $100$ trials. Notice that set intersection takes up to $3$[s], and scales with the number of obstacles. On the other hand, the trajectory optimization takes around $80$ [ms] and has low correlation with number of obstacles.}
\label{fig:planning_time_vs_Nobs}
\end{figure}

% \begin{figure}
% \centering
% \includegraphics[scale=0.5,trim={1cm 8cm 1cm 8cm},clip]{example_trial_bluecar.pdf}
% \caption{An example result out of the 1000 trials.
% This trial used eight randomly-generated obstacles.
% The vehicle begins on the left at $x = -0.75$ and reaches a randomly-generated goal near $(2.5, 0.5)$, plotted as a blue circle.
% Every $\tau_\text{plan} = 0.5$ [s], the vehicle replans its trajectory, shown by an asterisk plotted on the global trajectory in blue.
% The bounding box of the vehicle at each planning step is shown as a grey rectangle.}
% \label{fig:example_trial}
% \end{figure}

% \begin{figure}
% \centering
% \includegraphics[scale=0.4,trim={1cm 7cm 1cm 7cm},clip]{example_emergency_brake.pdf}
% \caption{An example of a forced emergency braking situation. The vehicle cannot find a path to the desired location (plotted as a blue circle), so it brakes.}
% \label{fig:example_emergency_brake}
% \end{figure}

% \begin{figure}
% \centering
% \includegraphics[scale=0.4,trim={1cm 7cm 1cm 7cm},clip]{example_overly_conservative.pdf}
% \caption{An example of an unnecessary emergency braking situation. The vehicle cannot find a path to the desired location despite an obviously-safe path existing, because the FRS is overly conservative.}
% \label{fig:example_overly_conservative}
% \end{figure}
