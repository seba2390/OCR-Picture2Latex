%%%%%%%% ICML 2021 EXAMPLE LATEX SUBMISSION FILE %%%%%%%%%%%%%%%%%

\documentclass{article}

% Recommended, but optional, packages for figures and better typesetting:
\usepackage{microtype}
\usepackage{graphicx}
% \usepackage{subfigure} % has conflict with subfig/subcaption
\usepackage{booktabs} % for professional tables

% hyperref makes hyperlinks in the resulting PDF.
% If your build breaks (sometimes temporarily if a hyperlink spans a page)
% please comment out the following usepackage line and replace
\usepackage{hyperref}

% -------- Custom packages 


\usepackage{url}            % simple URL typesetting
\usepackage{amsfonts}       % blackboard math symbols
\usepackage{amsthm}
\usepackage{mathrsfs}
\usepackage{nicefrac}       % compact symbols 
\usepackage{microtype}      % microtypography
\usepackage{booktabs} % for professional tables

\usepackage[utf8]{inputenc} % allow utf-8 input
\usepackage[T1]{fontenc}    % use 8-bit T1 fonts

\usepackage{tikz}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{tabularx}
\usepackage{mathtools}
\usepackage{tcolorbox}
\usepackage{cancel}
\usepackage{pifont} % for checkmarks and cross

% Use the give algorithmic style files isntead?
%\usepackage{algorithm2e}
% \usepackage[linesnumbered,lined,algoruled,boxed,commentsnumbered]{algorithm2e}
% \usepackage{algpseudocode,algorithm,algorithmicx}

\usepackage{multirow}
\usepackage{color}
\usepackage{mathtools}
% \usepackage{todonotes}
\usepackage{wrapfig}
\usepackage{caption}
\usepackage{bbm}
\usepackage{bm}
\usepackage{esvect}
\usepackage[normalem]{ulem}
% \usepackage{subcaption}

% \usepackage[lite]{mtpro2}


\usepackage{xcolor} %
\usepackage{xargs}
\usepackage{rotating}
\usepackage{longtable}
\usepackage{adjustbox}

\usepackage{cleveref}
% \usepackage{subfig}
\usepackage{subcaption}
\usepackage{enumitem}

% \captionsetup[subfigure]{subrefformat=simple,labelformat=simple}
% \renewcommand\thesubfigure{(\alph{subfigure})}

% overwrite cref name for section for saving space, format: crefname{content-type}{singlur}{plural}
% \crefname{section}{Sec.}{Sec.}
% \crefname{equation}{Eq.}{Eq.}
% \crefname{figure}{Fig.}{Fig.}


\newcolumntype{Y}{>{\raggedright\arraybackslash}p}
	
\usepackage{contour}
\usepackage{ulem}

\contourlength{1pt}

\renewcommand{\ULdepth}{1.8pt}
\contourlength{0.8pt}

\newcommand{\myuline}[1]{%
  \uline{\phantom{#1}}%
  \llap{\contour{white}{#1}}%
}


% footnotes
\newcommand\rlf[1]{{\color{red}\footnote{{\color{red}From Romain: #1}}}}

% inline commands for notes
\newcommand\rli[1]{{\color{red} #1}}
\newcommand\romain[1]{{\color{red} #1}}
\newcommand\joelle[1]{{\color{green} #1}}
\newcommand\phil[1]{{\color{cyan} #1}}

\newcommand\harsh[1]{{\color{blue} #1}}
\newcommand\htodo[1]{{\color{blue} TODO: #1\\}}
\newcommand\hnote[1]{{\color{blue} NOTE: #1\\}}


% Attempt to make hyperref and algorithmic work together better:
\newcommand{\theHalgorithm}{\arabic{algorithm}}


%SLJ: standard prettier hypersetup:
\hypersetup{
	plainpages=false,
	%pdfpagelabels=true,          % Prevents duplicate labels
	colorlinks=true,              % Use link colors
	linkcolor=blue,               % Color for normal internal links
	anchorcolor=blue,             % Color for anchor text
	citecolor=blue,               % Color for bibliographical citations in text
	filecolor=blue,               % Color for URLs which open local files
	pagecolor=blue,               % Color for links to other pages
	urlcolor=blue,                % Color for linked URLs
	pdfview=FitH,                 % Fit the width of the document
	pdfstartview=FitH,            % Fit the width of the document
	pdfpagelayout=SinglePage      % Page-down goes to next page
}


\input{doc/math_commands.tex}


% ----------------------------------------------------------------
%               Conference specific packages 
% ----------------------------------------------------------------

% Use the following line for the initial blind version submitted for review:
\usepackage[final]{doc/neurips_2021}

\title{Multi-Objective SPIBB: Seldonian Offline Policy Improvement with Safety Constraints in Finite MDPs}

% ------ update running title also


\author{%
  Harsh Satija\\
  McGill University, Mila \\
  \texttt{harsh.satija@mail.mcgill.ca} \\
  % examples of more authors
   \And
  Philip S. Thomas \\ 
  University of Massachusetts \\ 
  \texttt{pthomas@cs.umass.edu} \\
   \AND
   Joelle Pineau \\
   McGill University, Mila, Facebook AI Research \\
   \texttt{jpineau@cs.mcgill.ca} \\
   \And
   Romain Laroche \\ 
   Microsoft Research \\
   \texttt{romain.laroche@microsoft.com}
  % \And
  % Coauthor \\
  % Affiliation \\
  % Address \\
  % \texttt{email} \\
}


\begin{document}

\maketitle

% ------------------------------------------------------------
%               Abstract
% ------------------------------------------------------------


\begin{abstract}
We study the problem of Safe Policy Improvement (SPI) under constraints in the offline Reinforcement Learning (RL) setting. We consider the scenario where: (i) we have a dataset collected under a known baseline policy, (ii) multiple reward signals are received from the environment inducing as many objectives to optimize. 
We present an SPI formulation for this RL setting that takes into account the preferences of the algorithm's user for handling the trade-offs for different reward signals while ensuring that the new policy performs at least as well as the baseline policy along each individual objective. 
We build on traditional SPI algorithms and propose a novel method based on Safe Policy Iteration with Baseline Bootstrapping~\citep[SPIBB,][]{laroche2017safe} 
that provides high probability guarantees on the performance of the agent in the true environment.
We show the effectiveness of our method on a synthetic grid-world safety task as well as in a real-world critical care context to learn a policy for the administration of IV fluids and vasopressors to treat sepsis.

\end{abstract}



% ------------------------------------------------------------
%               MAIN BODY  
% ------------------------------------------------------------
% INTRODUCTION
\input{doc/sections/introduction}

% RELATED WORK       
\input{doc/sections/related_work}

% BACKGROUND and METHODOLOGY
\input{doc/sections/background}
% \input{doc/sections/methodology}

% SYNTHETIC EXPERIMENTS
\input{doc/sections/tabular_experiments}

% HEALTHCARE EXPERIMENTS
\input{doc/sections/real_world_experiments}

% CONCLUSION
\input{doc/sections/discussion}

% ACKNOWLEDGEMENTS
\input{doc/sections/acknowledgements}

% ------------------------------------------------------------
%               BIBLIOGRAPHY 
% ------------------------------------------------------------

% \bibliographystyle{plainnat}
\bibliographystyle{apalike}
\bibliography{doc/lib}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section*{Checklist}

\begin{enumerate}

\item For all authors...
\begin{enumerate}
  \item Do the main claims made in the abstract and introduction accurately reflect the paper's contributions and scope?
    \answerYes{See \Cref{sec:spibb-w-constraints,sec:hcpi-w-constraints} for the methodology and theoretical claims, and \Cref{sec:synthetic-experiments,sec:sepsis-experiments} for the empirical results.}
  
  \item Did you describe the limitations of your work?
    \answerYes{See \Cref{sec:introduction} for the limitations and scope of this work.}
  
  \item Did you discuss any potential negative societal impacts of your work?
    \answerYes{
    % In this work, we propose methodology and algorithms for \textit{safe} policy improvement of RL agents in the multi-objective setting.
    As we mentioned in \Cref{sec:introduction,sec:problem-formulation}, our goal is to maximize the objective specified by the user while ensuring that the solution policy avoids causing harmful effects after deployment in the true environment in comparison to the existing baseline policy. 
    % This allows the algorithm practitioner to experiment with different reward design strategies in safety-critical settings without worrying about the risks of ill-defined scalarizations. 
    % As with other Seldonian algorithms, we do not address any safety risks concerning data privacy or security, and additional caution should be exercised related to these topics.  
    We aim to bridge the gap between traditional RL methods and high-stake real-world applications, but, as with any general technology, we acknowledge that some RL applications can have the potential of misuse, and our methods do not prevent that.
    }

    
  \item Have you read the ethics review guidelines and ensured that your paper conforms to them?
    \answerYes{We discuss the societal impacts in the point above. We use pre-existing publicly available data and libraries and give more details about them in the Point 4 below.}
\end{enumerate}

\item If you are including theoretical results...
\begin{enumerate}
  \item Did you state the full set of assumptions of all theoretical results?
    \answerYes{See \Cref{sec:setting} for the assumption regarding access to baseline policy.}
	\item Did you include complete proofs of all theoretical results?
    \answerYes{The complete proofs are provided in the  \Cref{app:spibb-additional-details} and \Cref{app:hcpi-details}.}
\end{enumerate}

\item If you ran experiments...
\begin{enumerate}
  \item Did you include the code, data, and instructions needed to reproduce the main experimental results (either in the supplemental material or as a URL)?
    \answerYes{The code required to produce the results is provided in the supplementary material.}
    
  \item Did you specify all the training details (e.g., data splits, hyperparameters, how they were chosen)?
    \answerYes{The training details are mentioned in  \Cref{sec:synthetic-experiments,sec:sepsis-experiments} in the main text, and  \Cref{app:additional-details-for-synthetic-exp,app:sepsis-details}.}
    
	\item Did you report error bars (e.g., with respect to the random seed after running experiments multiple times)?
    \answerYes{The details about the error bars are provided in \Cref{sec:synthetic-experiments,sec:sepsis-experiments}.}
    
	\item Did you include the total amount of compute and the type of resources used (e.g., type of GPUs, internal cluster, or cloud provider)?
    \answerYes{Details about the compute and resources can be found in \cref{app:additional-details-for-synthetic-exp,app:sepsis-details}.
    }
\end{enumerate}

\item If you are using existing assets (e.g., code, data, models) or curating/releasing new assets...
\begin{enumerate}
  \item If your work uses existing assets, did you cite the creators?
    \answerYes{See \Cref{sec:synthetic-experiments,sec:sepsis-experiments} for the appropriate references.}
  
  \item Did you mention the license of the assets?
    \answerYes{We use the \citep[MIMIC-III,][]{johnson2016mimic} dataset and provide the appropriate reference. The explicit link to the license is here: \url{https://physionet.org/content/mimiciii/view-license/1.4/}. }
  
  \item Did you include any new assets either in the supplemental material or as a URL?
    \answerYes{We provide the accompanying code for running the experiments in the supplemental material.}
    
  \item Did you discuss whether and how consent was obtained from people whose data you're using/curating?
    \answerNA{We are using publicly available libraries and dataset.}
    
  \item Did you discuss whether the data you are using/curating contains personally identifiable information or offensive content?
    \answerNA{We are using the publicly available dataset  \citep[MIMIC-III,][]{johnson2016mimic} that already deidentifies the data in accordance with Health Insurance Portability and Accountability Act (HIPAA) standards using structured data cleansing and date shifting. We refer to the original text for more details on the deidentification process.
    }
\end{enumerate}

\item If you used crowdsourcing or conducted research with human subjects...
\begin{enumerate}
  \item Did you include the full text of instructions given to participants and screenshots, if applicable?
    \answerNA{}
  \item Did you describe any potential participant risks, with links to Institutional Review Board (IRB) approvals, if applicable?
    \answerNA{}
  \item Did you include the estimated hourly wage paid to participants and the total amount spent on participant compensation?
    \answerNA{}
\end{enumerate}

\end{enumerate}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \appendix



% ------------------------------------------------------------
%               APPENDIX 
% ------------------------------------------------------------
\clearpage
\onecolumn
\appendix

% Naive construction
\input{doc/appendix/naive_obj_construction}

% % Error bounds
% \input{doc/appendix/error_bounds}

% % SPIBB-details
% \input{doc/appendix/spibb_extra_details}

% SPIBB-theorems
\input{doc/appendix/spibb_theorems}

% HCPI-details
\input{doc/appendix/hcpi_details}

% CMDP experiments extra details 
\input{doc/appendix/cmdp_extra_details}

% Sepsis extra details
\input{doc/appendix/sepsis_additional_details}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\end{document}

