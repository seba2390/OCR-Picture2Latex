\section{Scalable Representations for Communication Patterns}
\label{sec:design}

Using the lessons learned in our preliminary studies, along with existing case studies~\cite{isaacs2014combing, Isaacs2016} using idealized unit time, we design a set of strategies for representing communication patterns when there are too many PEs to draw distinct communication lines in Gantt charts. We first describe our design goals. Then, we present our designs. Finally, we discuss initial feedback from experts familiar trace analysis in HPC.


\subsection{Design Goals}

Our goal is to design a representation of communication in execution traces that (1) aids users in recognizing and understanding what communication is occurring in that temporal and logical position in the Gantt chart and (2) is agnostic to the number of processing elements, thereby scaling to larger traces. These goals are derived from usage and scalability limitations noted in prior work~\cite{isaacs2014combing}. 

We limit our focus to scaling in PEs (y-axis) rather than time. Traces are typically explored using a time window, so we focus on that case. Adapting a design or creating a new one for compressed time settings we leave for future work.

Based on our preliminary study (\autoref{sec:prelim}), we chose to focus on offset, ring, and exchange pattern types as stencils require more design consideration even at small scales. 

\subsection{Visualization Design}

Our design process began with open brainstorming on paper, which we include in the supplemental material. We tried a variety of strategies, including linked views and added channels to the traditional Gantt chart encoding rules. However, most of these retained scaling problems, leading us to focus on designs centering on glyphs.

In designing the representation, we considered the saliency of what was to be encoded (e.g., temporal range, pattern type, grouping, stride) and efficacy of available channels, taking into account that the design needs to be incorporated in a Gantt chart. For example, temporal range is set to a horizontal position matching where a pattern would be drawn in a full chart. See supplemental materials for a table containing discussion of channel considerations.

We prioritize the type of pattern before the grouping factor or stride. The rationale is that the pattern type is fixed by the source code while the grouping and stride are often computed from the problem size and number of resources. Therefore, a user will recognize pattern type first before considering other factors. \autoref{fig:abstract_designs} shows the resulting designs.


\begin{figure*}
    \centering
    \begin{subfigure}{0.18\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/new-basic-offset.png}
         \caption{Continuous offset pattern}
         \label{fig:noc}
    \end{subfigure}
    \begin{subfigure}{0.18\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/new-basic-offset-grouped.png}
         \caption{Grouped offset pattern}
         \label{fig:nog}
    \end{subfigure}
    \begin{subfigure}{0.18\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/new-basic-ring.png}
         \caption{Continuous ring pattern}
         \label{fig:nrc}
    \end{subfigure}
    \begin{subfigure}{0.18\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/new-basic-ring-grouped.png}
         \caption{Grouped ring pattern}
         \label{fig:nrg}
    \end{subfigure}
    \begin{subfigure}{0.18\textwidth}
         \centering
         \includegraphics[width=\textwidth]{figures/new-basic-exchange.png}
         \caption{Exchange pattern}
         \label{fig:neg}
    \end{subfigure}
    \caption{Examples of our designs for five communication patterns. They are reminiscent of the underlying communication pattern encoding, but not aligned to the underlying chart and agnostic to the number of rows the underlying pattern repeats over. 
    %Note that the angle for our ring pattern is slightly shallower than the angle for offset, this reflects the difference in stride between the two patterns. 
    Grouped representations fill the vertical space to indicate that the repetition continues from the top of row to the bottom.}
    \label{fig:abstract_designs}
\end{figure*}

\vspace{1ex}

\textbf{Encoding Pattern Type.} To encode the pattern type, we started with the overall shape of of the pattern when drawn at small scale with a small stride. Offsets are drawn with angled repeating lines forming a rhombus-like shape. We use a fixed distance between lines and draw as many will fit in the relevant area.

Rings add indicators of the ``wrap-around'' communication. However, unlike fully drawn rings, we only render the protruding segments at the ends of the shape. There are two main rationales for only drawing protruding segments: (1) we want to indicate this is an abstraction and (2) participants in our interviews found the crossing lines difficult to disambiguate. The number of protruding segments is proportional to the stride of a ring. 
%For a ring with a small stride, one segment is added. This increases to a max of four for a very large stride.

Exchange patterns are drawn as a series of symmetrical ``x'' shapes and avoid direct crossings for the same reason as rings. The number of lines in each cross is proportional to stride of the exchange. Short stride exchanges will exchange between only a few PEs, a long stride exchange spans many PEs. Our glyphs approximate this by increasing the number of crossing lines as stride increases.

\vspace{1ex}

\textbf{Encoding Grouping Factor.} To represent grouping, we partition the available area vertically and repeat the pattern type drawing in those partitions. More formally, the encoding rule to show ``grouping" is repetition and alignment on a non-common scale. The number of partitions is determined by the available vertical space in a chart.


\vspace{1ex}

\textbf{Encoding Stride.} We express the notion of stride through the angle of lines used in our pattern types. As people had difficulty with steeply angled lines in our preliminary study, we limit the angles to a range of 15 degrees to 60 degrees. Therefore, these do not match the encoding of a full view. Instead, they hint at the magnitude of distance over which communication is occurring. This allows users to see that there are differences in stride between glyphs, but not necessarily calculate the exact stride visually.

\vspace{1ex}

\textbf{Temporal range.} Rather than show the exact range, we place the glyphs on the x-axis so they are centered in their range. If two structures overlap, they are placed alongside one another. 

\vspace{1ex}

\textbf{Incorporation in Gantt Charts.} These are designed to be used in Gantt charts when exact lines would be too dense to be interpreted. The underlying interval rectangles will still be drawn. The color encoding of these intervals was shown to be a secondary indicator in our preliminary study, so we preserve them. We add a slight blur effect to the background as another signifier that the glyphs are an abstraction and should not be confused for exact lines.



\subsection{Expert Feedback}
\label{sec:expertfeedback}

We sent our designs to two HPC experts for feedback regarding both the designs themselves and the overall approach. Both experts were familiar with idealized unit time representations of traces. The first expert, E1, had previously collaborated on this strategy with the authors but was not involved in any of the work presented here. The second expert, E2, had managed an integration of the strategy into an HPC center's performance tools, referencing the open-source research code~\cite{isaacs2014combing} but using an alternate calculation method and front-end technology.

We sent both experts a short email with a PDF describing the visualizations with comparisons to fully drawn traces and showing how they might be applied in practice, including a few complicated examples such as zoomed-out time and idle processes. (See supplemental materials.) We asked if and how the strategy would be useful and if there were any suggestions or concerns. E1 responded the designs ``definitely look helpful,'' noted the trade off in exactness, and then pointed out figures which led to ambiguities in his view. He also identified a error where the mock-up did not match the underlying trace. E2 noted that stride is less important and wondered how the translation from data to glyph would be calculated. He suggested the strategy might also be helpful for collective communications (e.g., broadcasts, all-to-all, reductions), a set of patterns we did not consider in this work.

We interpreted these responses to suggest the designs were worth further study, particularly E1's ability to interpret well enough to detect an error and E2's interest in further patterns. However, there are design decisions in applying these glyphs in some scenarios, particularly in zoomed-out time, that require refinement. We leave these cases for future iterations and instead focus on how the base designs could be interpreted by a wider range of users in a controlled study.