\usepackage{etex,etoolbox,environ,amsthm}

\makeatletter
\newenvironment{xproof}[1][\proofname]{\par
  \begin{proof}%
}{%
  \end{proof}%
}

\providecommand{\@fourthoffour}[4]{#4}
\def\fixstatement#1{%
  \AtEndEnvironment{#1}{%
    \xdef\pat@label{\expandafter\expandafter\expandafter
      \@fourthoffour\csname#1\endcsname\space\@currentlabel}}}

\globtoksblk\prooftoks{1000}
\newcounter{proofcount}

\long\def\proofatend#1\endproofatend{%
  \refstepcounter{proofcount}%
  \begin{xproof} See Appendix, p.~\pageref{proof:\roman{proofcount}} \end{xproof}%
  \edef\next{\noexpand\begin{proof}[Proof of \pat@label]\noexpand\label{proof:\roman{proofcount}}}%
  \toks\numexpr\prooftoks+\value{proofcount}\relax=\expandafter{\next#1\end{proof}}}

\long\def\xproofatend#1\xendproofatend{%
  \refstepcounter{proofcount}%
  \edef\next{\noexpand\begin{proof}[Proof of \pat@label]}%
  \toks\numexpr\prooftoks+\value{proofcount}\relax=\expandafter{\next#1\end{proof}}}

\def\printproofs{%
  \count@=\z@
  \loop
    \the\toks\numexpr\prooftoks+\count@\relax
    \ifnum\count@<\value{proofcount}%
    \advance\count@\@ne
  \repeat}
\makeatother

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
