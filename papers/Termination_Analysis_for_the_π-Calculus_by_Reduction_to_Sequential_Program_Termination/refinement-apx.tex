\section{Complete Definition of the Refinement Type System}
\label{sec:refinement-apx}
This section shows the complete definition of the refinement type system we discussed in Section~\ref{sec:refinement}.

First, we define the well-formedness conditions for types and type environments.
We write \(\FV(\pred)\) (\(\FV(\predenv)\), resp.)
for the set of variables occurring in \(\pred\) (\(\predenv\), resp.),
and \(\dom(\env)\) for the domain of \(\env\), i.e.,
\(\set{x \mid x\COL\ty\in\env}\).
The relations \(\tyok{\env}{\chty}\)
and \(\tyenvok{\env}{\predenv}{\chenv}\)
are defined by:

\infrule{\FV(\pred)\subseteq \dom(\env)\cup \set{\seq{x}}\\
  \tyok{\env, \seq{x}\COL\seq{\ty}}{\chty_i}\mbox{ for each $i\in\set{1,\ldots,k}$}}
{\tyok{\env}{\rch{\reg}{\seq{x}}{\pred}{\chty_1,\ldots,\chty_k}}}

\infrule{\tyok{\env}{\chty} \mbox{ for every $x\COL\chty\in\chenv$}\\
   \FV(\predenv) \subseteq \dom(\env)}
{\tyenvok{\env}{\predenv}{\chenv}}
  For example, \(x\COL \ty \p \rch{\reg}{y}{y<x}{\epsilon}:\OK\)
  holds but
  \(\emptyset \p \rch{\reg}{y}{y<x}{\epsilon}:\OK\) does not.

For every type judgment of the form \(\env;\predenv;\chenv \p P\),
we implicitly require that \(\tyenvok{\env}{\predenv}{\chenv}\) holds.
Similarly,  for $\env;\predenv;\chenv \p v\COL\chty$,
we require
that \(\tyenvok{\env}{\predenv}{\chenv}\) and \(\tyok{\env}{\chty}\) hold.

The complete list of typing rules is given in Figure~\ref{fig:refinement_type_system-complete}.

\begin{figure}[tb]
    \centering
    \small
    \begin{minipage}{0.4\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{}
            \RightLabel{\textsc{(RT-Nil)}}
            \UnaryInfC{$\env;\predenv;\chenv\p \textbf{0}$}
        \end{prooftree}
    \end{minipage}
    \begin{minipage}{0.55\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$\env;\predenv;\chenv\p P_1$}
            \AxiomC{$\env;\predenv;\chenv\p P_2$}
            \RightLabel{\textsc{(RT-Par)}}
            \BinaryInfC{$\env;\predenv;\chenv\p P_1 \PAR P_2$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$\env;\predenv;\chenv\p x\COL\rch{\reg}{\seq{y}}{\pred}{\seq{\chty}}$}
            \AxiomC{$\env,\seq{y}\COL\seq{\ty}; \predenv,\pred; \chenv,\seq{z}\COL\seq{\chty} \p P$}
            \RightLabel{\textsc{(RT-In)}}
            \BinaryInfC{$\env;\predenv;\chenv\p \inexp{x}{\seq{y}}{\seq{z}}P$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{0.93\linewidth}
        \centering
        \infrule[RT-Out]
        {\env;\predenv;\chenv\p x\COL\rch{\reg}{\seq{y}}{\pred}{\seq{\chty}}\andalso
        \env;\predenv;\chenv\p \seq{v}\COL\seq{\ty}\andalso
        \predenv \vDash [\seq{v}/\seq{y}]\pred\\
        \env;\predenv;\chenv\p \seq{w}\COL[\seq{v}/\seq{y}]\seq{\chty}\andalso
        \env;\predenv;\chenv\p P}
        {\env;\predenv;\chenv \vdash \outexp{x}{\seq{v}}{\seq{w}}P}
    \end{minipage}
    \\
    \begin{minipage}{\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$\env;\predenv;\chenv,x\COL\chty \p P$}
            \RightLabel{\textsc{(RT-Nu)}}
            \UnaryInfC{$\env;\predenv;\chenv \p (\nu x\COL\chty)P$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$\env;\predenv;\chenv\p x\COL\rch{\reg}{\seq{y}}{\pred}{\seq{\chty}}$}
            \AxiomC{$\env,\seq{y}\COL\seq{\ty}; \predenv,\pred; \chenv,\seq{z}\COL\seq{\chty} \p P$}
            \RightLabel{\textsc{(RT-RIn)}}
            \BinaryInfC{$\env;\predenv;\chenv\p \rinexp{x}{\seq{y}}{\seq{z}}P$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$\env; \predenv; \chenv \p v\COL\ty$}
            \AxiomC{$\env; \predenv, v \neq 0; \chenv \p P_1$}
            \AxiomC{$\env; \predenv, v =    0; \chenv \p P_2$}
            \RightLabel{\textsc{(RT-If)}}
            \TrinaryInfC{$\env;\predenv;\chenv\p \ifexp{v}{P_1}{P_2}$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{\linewidth}
        \begin{prooftree}
            \AxiomC{$\env,\seq{x}\COL\seq{\ty}; \predenv; \chenv \vdash P$}
            \RightLabel{\textsc{(RT-LetND)}}
            \UnaryInfC{$\env; \predenv; \chenv \vdash \ndlet{x}{P}$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{0.45\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$x \COL \ty \in \env$}
            \RightLabel{\textsc{(RT-Var-Int)}}
            \UnaryInfC{$\env;\predenv;\chenv \p x\COL\ty$}
        \end{prooftree}
    \end{minipage}
    \begin{minipage}{0.45\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$x \COL \chty \in \chenv$}
            \RightLabel{\textsc{(RT-Var-Ch)}}
            \UnaryInfC{$\env;\predenv;\chenv \p x\COL\chty$}
        \end{prooftree}
    \end{minipage}
    \\
    \begin{minipage}{0.45\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{}
            \RightLabel{\textsc{(RT-Int)}}
            \UnaryInfC{$\env;\predenv;\chenv \p i\COL\ty$}
        \end{prooftree}
    \end{minipage}
    \begin{minipage}{0.45\linewidth}
        \centering
        \begin{prooftree}
            \AxiomC{$\env;\predenv;\chenv \p \seq{v}\COL\seq{\ty}$}
            \RightLabel{\textsc{(RT-Op)}}
            \UnaryInfC{$\env;\predenv;\chenv \p \op(\seq{v})\COL\ty$}
        \end{prooftree}
    \end{minipage}
    \normalsize
    \caption{Typing rules of the refinement type system for the $\pi$-calculus}
    \label{fig:refinement_type_system-complete}
\end{figure}
