\usepackage{ifthen}
% needs \usepackage[table]{color}
%
% =========================================================================================
%
\newcommand{\PBefore}{ P_{\mathrm{before}} }
\newcommand{\PAfter} { P_{\mathrm{after}}  }
\newcommand{\PPost}  { P_{\mathrm{post}}   }
\newcommand{\PPre}   { P_{\mathrm{pre}}    }
\newcommand{\PInv}   { P_{\mathrm{inv}}    }
%
\newcommand{\EInv}   { E_{\mathrm{inv}}    }
\newcommand{\EBefore}{ E_{\mathrm{before}} }
\newcommand{\EAfter} { E_{\mathrm{after}}  }
%
%
%------------------------------------------------------------------
%


\newcommand{\WSoperation}{
  $[ D, E, F, \ldots ] = {\mathrm{op}}( A, B, C, D, \ldots )$ 
}

\newcommand{\WSpreprocessing}{
  Preprocessing
}

\newcommand{\WSpostprocessing}{
  Postprocessing
}

\newcommand{\WSprecondition}{
  $\PPre$
}

\newcommand{\WSpartition}{
%  $ S_{\mathrm{Init}} $
}

\newcommand{\WSpartitionsizes}{
  $\dots$
}

\newcommand{\WSinvariant}{
  $\PInv$
}

\newcommand{\WSguard}{ 
  $ G $
}

\newcommand{\WStopofloop}{
  $ \left\{ \left( \mbox{\WSinvariant} \right) \wedge 
    \left( \mbox{\WSguard} \right) \right\} $
}

\newcommand{\WSrepartition}{
  \begin{minipage}[t]{1in}
    \ \\
  \end{minipage}
}

\newcommand{\WSrepartitionsizes}{
  $\dots$
}

\newcommand{\WSbeforeupdate}{
  $\PBefore$ 
}

\newcommand{\WSupdate}{
  \begin{minipage}[t]{.5in}
    $ S_U $
  \end{minipage}
}

\newcommand{\WSafterupdate}{
  $\PAfter$
}

\newcommand{\WSmoveboundary}{
}

\newcommand{\WSafterloop}{
  $\left\{ \left( \mbox{\WSinvariant} \right) \wedge 
   \neg \left( \mbox{\WSguard} \right) \right\} $
}

\newcommand{\WSpostcondition}{
  $\PPost$
}


% ------------------------------------------------------

\newcommand{\Eoperation}{
}

\newcommand{\Einvariant}{
  $\EInv$
}

\newcommand{\Epartition}{
  $ S_{\mathrm{ErrInit}} $
}

\newcommand{\Eguard}{
}

\newcommand{\Ebeforeupdate}{
  $\EBefore$ 
}

\newcommand{\Eafterupdate}{
  $\EAfter$ 
}

\newcommand{\Erepartition}{
  $\dots$
}

\newcommand{\Eupdate}{
}

\newcommand{\Eanalysis}{
}

\newcommand{\Emoveboundary}{
}



\newlength{\tabwidth}
\setlength{\tabwidth}{444pt}

\newlength{\tabmargin}
\setlength{\tabmargin}{-44pt}


% -----------------------------------------------------

\newcommand{\ALGroutinename}{}

\newboolean{BlockedAlgQ}
\setboolean{BlockedAlgQ}{true}

% -----------------------------------------------------






% needs \usepackage[table]{color}
\newcommand{\worksheetGrayNoNumbersEmpty}{
\begin{center}
\begin{tabular}{| l |} \hline
    %\footnotesize Step &
    Algorithm: \WSoperation \\ \hline \hline
    \rowcolor[gray]{0.83}
    %1a &
    $\left\{ \mbox{\WSprecondition } \right\}$ \\
    %3 & \hspace*{-3mm}
    {\textbf{Partition}} \\
    \rowcolor[gray]{0.83}
    %2 & 
    $\left\{ \mbox{\WSinvariant} \right\}$ \\
    %4 & 
    {\textbf{While}} \WSguard { \textbf{do}} \\
    \rowcolor[gray]{0.83}
    %2,4 &
    \hspace*{0.18in} \WStopofloop \\
    %5a & 
    \hspace*{0.15in} 
    {\textbf{Repartition}} \\
    \rowcolor[gray]{0.83}
    %6 &
    \hspace*{0.15in} 
    \ $ \left\{ \mbox{\WSbeforeupdate} \right\}$ \\
    %8 & 
    \hspace*{0.15in} \WSupdate \\
    \rowcolor[gray]{0.83}
    %7 &
    \hspace*{0.15in} 
    \ $ \left\{ \mbox{\WSafterupdate} \right\}$ \\
    %5b &
    \hspace*{0.15in} 
    {\textbf{Continue with}} \\
    \rowcolor[gray]{0.83}
    %2 &
    \hspace*{0.21in} 
    $\left\{ \mbox{\WSinvariant} \right\}$ \\
    %&
    {\textbf{endwhile}} \\
    \rowcolor[gray]{0.83}
    %2,4 &
    \WSafterloop \\
    \rowcolor[gray]{0.83}
    %1b &
    $ \left\{ \mbox{\WSpostcondition } \right\} $ \\ \hline
\end{tabular}
\end{center}
}

% needs \usepackage[table]{color}
% Same as \worksheetGrayNoNumbersEmpty
% PLUS
% - preprocessing
\newcommand{\worksheetGrayNoNumbersEmptyP}{
\begin{center}
\begin{tabular}{| l |} \hline
    %\footnotesize Step &
    Algorithm: \WSoperation \\ \hline \hline
    \rowcolor[gray]{0.83}
    %1a &
    $\left\{ \mbox{\WSprecondition } \right\}$ \\
    %3 & \hspace*{-3mm}
    {\textbf{Partition}} \\
    \WSpreprocessing \\
    \rowcolor[gray]{0.83}
    %2 & 
    $\left\{ \mbox{\WSinvariant} \right\}$ \\
    %4 & 
    {\textbf{While}} \WSguard { \textbf{do}} \\
    \rowcolor[gray]{0.83}
    %2,4 &
    \hspace*{0.18in} \WStopofloop \\
    %5a & 
    \hspace*{0.15in} 
    {\textbf{Repartition}} \\
    \rowcolor[gray]{0.83}
    %6 &
    \hspace*{0.15in} 
    \ $ \left\{ \mbox{\WSbeforeupdate} \right\}$ \\
    %8 & 
    \hspace*{0.15in} \WSupdate \\
    \rowcolor[gray]{0.83}
    %7 &
    \hspace*{0.15in} 
    \ $ \left\{ \mbox{\WSafterupdate} \right\}$ \\
    %5b &
    \hspace*{0.15in} 
    {\textbf{Continue with}} \\
    \rowcolor[gray]{0.83}
    %2 &
    \hspace*{0.21in} 
    $\left\{ \mbox{\WSinvariant} \right\}$ \\
    %&
    {\textbf{endwhile}} \\
    \rowcolor[gray]{0.83}
    %2,4 &
    \WSafterloop \\
    \rowcolor[gray]{0.83}
    %1b &
    $ \left\{ \mbox{\WSpostcondition } \right\} $ \\ \hline
\end{tabular}
\end{center}
}


% needs \usepackage[table]{color}
% Same as \worksheetGrayNoNumbersEmpty
% PLUS
% - preprocessing
% - postprocessing
\newcommand{\worksheetGrayNoNumbersEmptyPP}{
\begin{center}
\begin{tabular}{| l |} \hline
    %\footnotesize Step &
    Algorithm: \WSoperation \\ \hline \hline
    \rowcolor[gray]{0.83}
    %1a &
    $\left\{ \mbox{\WSprecondition } \right\}$ \\
    %3 & \hspace*{-3mm}
    {\textbf{Partition}} \\
    \WSpreprocessing \\
    \rowcolor[gray]{0.83}
    %2 & 
    $\left\{ \mbox{\WSinvariant} \right\}$ \\
    %4 & 
    {\textbf{While}} \WSguard {\textbf{do}} \\
    \rowcolor[gray]{0.83}
    %2,4 &
    \hspace*{0.18in} \WStopofloop \\
    %5a & 
    \hspace*{0.15in} 
    {\textbf{Repartition}} \\
    \rowcolor[gray]{0.83}
    %6 &
    \hspace*{0.15in} 
    \ $ \left\{ \mbox{\WSbeforeupdate} \right\}$ \\
    %8 & 
    \hspace*{0.15in} \WSupdate \\
    \rowcolor[gray]{0.83}
    %7 &
    \hspace*{0.15in} 
    \ $ \left\{ \mbox{\WSafterupdate} \right\}$ \\
    %5b &
    \hspace*{0.15in} 
    {\textbf{Continue with}} \\
    \rowcolor[gray]{0.83}
    %2 &
    \hspace*{0.21in} 
    $\left\{ \mbox{\WSinvariant} \right\}$ \\
    %&
    {\textbf{endwhile}} \\
    \rowcolor[gray]{0.83}
    %2,4 &
    \WSafterloop \\
    \WSpostprocessing \\
    \rowcolor[gray]{0.83}
    %1b &
    $ \left\{ \mbox{\WSpostcondition } \right\} $ \\ \hline
\end{tabular}
\end{center}
}





\newcommand{\resetsteps}{
\renewcommand{\ALGroutinename}{}
\renewcommand{\WSoperation}
  { $[ D, E, F, \ldots ] = {\mathrm{op}}( A, B, C, D, \ldots )$ }
\renewcommand{\WSprecondition}{ $\PPre$ }
\renewcommand{\WSpartition}{ }
\renewcommand{\WSpartitionsizes}{}
\renewcommand{\WSinvariant}{ $\PInv$ }
\renewcommand{\WSguard}{ $ G $ }
\setboolean{BlockedAlgQ}{true}
\renewcommand{\WStopofloop}{
  $ \left\{ \left( \mbox{\WSinvariant} \right) \wedge 
    \left( \mbox{\WSguard} \right) \right\} $ }
\renewcommand{\WSrepartition}{
  \begin{minipage}[t]{1in}
    \ \\
  \end{minipage} }
\renewcommand{\WSrepartitionsizes}{}
\renewcommand{\WSbeforeupdate}{ $\PBefore$ }
\renewcommand{\WSupdate}{
  \begin{minipage}[t]{1in}
    $ S_U $
  \end{minipage} }
\renewcommand{\WSafterupdate}{ $\PAfter$ }
\renewcommand{\WSmoveboundary}{}
\renewcommand{\WSafterloop}{
  $\left\{ \left( \mbox{\WSinvariant} \right) \wedge 
   \neg \left( \mbox{\WSguard} \right) \right\} $ }
\renewcommand{\WSpostcondition}{ $\PPost$ }
}


\newcommand{\resetEsteps}{
  \renewcommand{\Eoperation}{}
  \renewcommand{\Einvariant}{$\EInv$}
  \renewcommand{\Eguard}{}
  \renewcommand{\Epartition}{$ S_{\mathrm{ErrInit}} $}
  \renewcommand{\Ebeforeupdate}{$\EBefore$}
  \renewcommand{\Eafterupdate}{$\EAfter$}
  \renewcommand{\Erepartition}{$\dots$}
  \renewcommand{\Eupdate}{}
  \renewcommand{\Eanalysis}{}
  \renewcommand{\Emoveboundary}{}
  \setlength{\tabwidth}{444pt}
  \setlength{\tabmargin}{-44pt}
}





\newcommand{\FlaAlgorithmIter}{
  \begin{center}
    \begin{tabular}{|l|} \hline
      {\textsc Algorithm:} \ALGroutinename \\ \hline
      \hspace*{-3mm}
      \begin{tabular}{ p{5mm} @{\hspace*{0pt}} l }\\[-3mm]
        \multicolumn{2}{l}{\small \textbf{Partition}} \WSpartition  \\
        & {\small \textbf{where}} \WSpartitionsizes  \\[2pt]
      \end{tabular} \\[1mm]
      \WSpreprocessing \\
      {\small \textbf{While}} \WSguard {\small \textbf{do}} \\[1pt] 
      \hspace*{1.9mm}
      \begin{tabular}{ p{3mm} @{\hspace*{0pt}} l}
%           \multicolumn{2}{l}{\small 
%               \ifthenelse{\boolean{BlockedAlgQ}}
%               {\bf Determine block size $b$}
%               {}
%             } \\[1pt]
        \multicolumn{2}{l}{\small \textbf{Repartition}} \\[-1pt]
        & \WSrepartition  \\
        \multicolumn{2}{l}{\rule{5.5cm}{1.2pt}}\\
        & \WSupdate \\[-1mm] 
        \multicolumn{2}{l}{\rule{5.5cm}{1.2pt}}\\
        \multicolumn{2}{l}{\textbf{\small Continue with}} \\[-1pt]
        & \WSmoveboundary \\
      \end{tabular} \\
      {\textbf{endwhile}} \\ 
      \hline
    \end{tabular}
  \end{center}
}



\newcommand{\FlaAlgorithm}{
  \begin{center}
    \begin{tabular}{|l|} \hline
      {\textsc Algorithm:} \ALGroutinename \\ \hline
      \hspace*{-3mm}
      \begin{tabular}{ p{5mm} @{\hspace*{0pt}} l }\\[-3mm]
        \multicolumn{2}{l}{\small \textbf{Partition}} \WSpartition  \\
        & {\small \textbf{where}} \WSpartitionsizes  \\[2pt]
      \end{tabular} \\[1mm]
      {\small \textbf{While}} \WSguard {\small \textbf{do}} \\[1pt] 
      \hspace*{1.9mm}
      \begin{tabular}{ p{3mm} @{\hspace*{0pt}} l}
        \multicolumn{2}{l}{\small 
            \ifthenelse{\boolean{BlockedAlgQ}}
            {\textbf{Determine block size} $b$}
            {}
          } \\[1pt]
        \multicolumn{2}{l}{\small \textbf{Repartition}} \\[-1pt]
        & \WSrepartition  \\
        & {\small \textbf{where}} \WSrepartitionsizes \\[-2mm]
        \multicolumn{2}{l}{\rule{5.5cm}{1.2pt}}\\
        & \WSupdate \\[-1mm] 
        \multicolumn{2}{l}{\rule{5.5cm}{1.2pt}}\\
        \multicolumn{2}{l}{\textbf{\small Continue with}} \\[-1pt]
        & \WSmoveboundary \\
      \end{tabular} \\
      {\textbf{endwhile}} \\ 
      \hline
    \end{tabular}
  \end{center}
}

