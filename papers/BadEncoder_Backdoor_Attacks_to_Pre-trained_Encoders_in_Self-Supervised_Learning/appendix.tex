\appendices


\begin{algorithm}[tb]
   \caption{BadEncoder}
   \label{alg:example}
\begin{algorithmic}
   \STATE {\bfseries Input:} $\theta$ (model parameters of $f$), $max\_epoch$, $lr$ (learning rate), $bs$ (batch size), $\mathcal{D}_{s}$, $\{\mathcal{R}_i\}_{i=1}^t$, and $\{\mathbf{e}_i\}_{i=1}^t$.
   \STATE {\bfseries Output:}  $\theta'$ (model parameters of $f'$). \\
   $\theta' \gets \theta$ \\
   $epoch \gets 1$ \\
   \WHILE  {$epoch \leq max\_epoch$}
   \STATE $iter \gets 1$ \\
   \WHILE{$iter \leq \lfloor |\mathcal{D}_s|/bs \rfloor$}
   \STATE  $\text{batch} \gets \textsc{MiniBatch}(\mathcal{D}_s, bs, step)$ \\
   \STATE $\theta' = \theta' - lr \cdot \nabla_{\theta'} L(\theta',\text{batch},\{\mathcal{R}_i\}_{i=1}^t, \{\mathbf{e}_i\}_{i=1}^t)$\\
   \STATE $iter \gets iter +1$ \\
   \ENDWHILE
   \STATE $epoch \gets epoch+1$ \\
   \ENDWHILE 
   \STATE \textbf{return} $\theta'$

   
\end{algorithmic}
\end{algorithm}



\begin{figure}[!t]
	 \centering
	\vspace{-2mm}
{\includegraphics[width=0.25\textwidth]{figs/cdf_clean_backdoored_image_encoder.pdf}}
\vspace{-2mm}
\caption{The cumulative distribution functions (CDFs) of the cosine similarity scores between the feature vector of the reference input and those of the trigger-embedded inputs produced  by  the  clean image encoder and backdoored image encoder.} 
\label{compare_similarity_of_clean_backdoor}
\end{figure}



\begin{table}[!t]\renewcommand{\arraystretch}{1.2}
  \centering
  \caption{Comparing BadEncoder with LBA~\cite{yao2019latent}.} 
  \begin{tabular}{|c|c|c|c|}
    \hline
    \multirow{3}{*}{\makecell{Target Downs-\\tream Dataset}} &
      \multicolumn{2}{c|}{LBA} & 
      BadEncoder \cr\cline{2-4}
    & \makecell{ Fraction of Tes-\\ting Images (\%) } & ASR (\%) & ASR (\%) \\
    \hline
    \multirow{2}{*}{GTSRB} 
    & 10 & 7.14 & 98.73 \\ \cline{2-4}
    & 50 & 12.63 & 98.81 \\ \hline
    \multirow{2}{*}{SVHN}
    & 10 & 0.19 & 99.15 \\ \cline{2-4}
    & 50 & 24.16 & 99.09 \\ \hline
    \multirow{2}{*}{STL10}
    & 10 & 9.63 & 99.39 \\ \cline{2-4}
    & 50 & 12.77 & 99.59 \\ \hline
  \end{tabular}
  \label{compare_with_LBA}
  %\vspace{-5mm}
\end{table}

\begin{table}[tp]\renewcommand{\arraystretch}{1.2} 
	\centering
	\caption{Results of using different parameter settings to pre-train an image encoder, craft a backdoored image encoder, and train a downstream classifier.}
	\setlength{\tabcolsep}{0.6mm}
	{
	\begin{tabular}{|c|c|c|c|c|c|}
		\hline
	\makecell{Stage} & \makecell{Parameter} & \makecell{Value} & CA (\%) & BA (\%) & ASR (\%)  \\ \hline
	\multirow{6}{*}{\makecell{Pre-training \\ an image \\encoder}}
	&	\multirow{3}{*}{\#epochs} 
	    & 500 & 74.61 & 75.11 & 99.66 \\ \cline{3-6} 
	    && 1,000 & 76.14 & 76.18 & 99.73  \\ \cline{3-6} 
	    && 1,500 & 75.95 & 76.65 & 99.86  \\ \cline{2-6} 
	&	\multirow{3}{*}{Learning rate} 
	    & $1\times 10^{-3}$ & 76.14 & 76.18 & 99.73  \\ \cline{3-6}
	    && $5\times 10^{-4}$ & 73.41 & 75.90 & 99.93  \\ \cline{3-6}  
	    &&	$1 \times 10^{-4}$ & 74.58 & 75.74 & 99.89 \\ \hline

	    
	\multirow{8}{*}{\makecell{Crafting a \\backdoored \\image \\encoder}}
	&	\multirow{3}{*}{\#epochs} 
		&	100 & 76.14 & 76.43 & 99.79  \\ \cline{3-6} 
	    && 150 & 76.14 & 76.45 & 99.84  \\ \cline{3-6} 
	    && 200 & 76.14 & 76.18 & 99.73  \\ \cline{2-6} 
	&	\multirow{3}{*}{Learning rate} 
	    & $1\times 10^{-3}$ & 76.14 & 76.18 & 99.73  \\ \cline{3-6} 
	    &&	$5\times 10^{-4}$ & 76.14 & 76.54 & 99.80 \\ \cline{3-6} 
	    && $1\times 10^{-4}$ & 76.14 & 75.53 & 97.76 \\ \cline{2-6}   
	&	\multirow{2}{*}{ Trigger} 
	    & A white square & 76.14 & 76.18 & 99.73  \\ \cline{3-6}  
	    &&	A random trigger & 76.14 & 75.83 & 100.0  \\ \hline
	    
	\multirow{9}{*}{\makecell{Training a \\ downstream \\classifier}}
	&	\multirow{3}{*}{ \#epochs} 
	    & 100 & 77.39 & 77.55 & 99.96 \\ \cline{3-6} 
	    && 300 & 76.14 & 76.39 & 99.80  \\ \cline{3-6} 
	    && 500 & 76.14 & 76.18 & 99.73  \\ \cline{2-6} 
	&	\multirow{3}{*}{Learning rate} 
	    & $1 \times 10^{-3}$ & 76.96 & 76.66 & 93.96 \\ \cline{3-6} 
	    && $5 \times 10^{-4}$ & 76.73 & 76.60 & 99.74  \\ \cline{3-6}  
	    &&	$1 \times 10^{-4}$ & 76.14 & 76.18 & 99.73 \\ \cline{2-6} 
 
	&	\multirow{3}{*}{\makecell{\#neurons \\in the two \\hidden layers} }
	    & [128,64] & 76.51 & 76.98 & 99.90  \\ \cline{3-6}  
	    && [256,128] & 76.13 & 76.64 & 99.90  \\ \cline{3-6} 
	    &&	[512,256] & 76.14 & 76.18 & 99.73 \\ \hline
	\end{tabular}
	}
	\label{result_of_different_parameters}
\vspace{-5mm}
\end{table}



\begin{figure}[!htbp]
	 \centering
\subfloat[CIFAR10]{\includegraphics[width=0.12\textwidth]{figs/airplane_orig.jpg}}
\subfloat[SVHN]{\includegraphics[width=0.12\textwidth]{figs/one_1.jpg}}
\subfloat[GTSRB]{\includegraphics[width=0.12\textwidth]{figs/priority.jpg}}
\subfloat[STL10]{\includegraphics[width=0.12\textwidth]{figs/truck.jpg}}
\caption{The default reference inputs for CIFAR10, SVHN, GTSRB, and STL10.}
\label{four_attack_inputs}
\vspace{-5mm}
\end{figure}


\begin{figure}[!htbp]
	 \centering
\subfloat[Truck 0]{\includegraphics[width=0.15\textwidth]{figs/truck.jpg}}
\subfloat[Truck 1]{\includegraphics[width=0.15\textwidth]{figs/truck_1.jpg}}
\subfloat[Truck 2]{\includegraphics[width=0.15\textwidth]{figs/truck_2.jpg}}
\caption{The reference inputs for STL10 used in Table~\ref{multiple_attack_inputs}. Truck 0 is the default reference input.}
\label{multiple_classes_attack_inputs}
\end{figure}



\begin{figure}[!htbp]
	 \centering
\subfloat[GTSRB]{\includegraphics[width=0.24\textwidth]{figs/fraction_cifar10_gtsrb.pdf}}
{\includegraphics[width=0.24\textwidth]{figs/fraction_cifar10_svhn.pdf}}
\caption{The impact of the shadow dataset size on our BadEncoder when the target downstream datasets  are GTSRB  (left) and SVHN (right). The shadow dataset is a subset of the pre-training dataset, which is CIFAR10.}
\label{impact_of_attack_dataset_size_svhn_stl10}
\vspace{-3mm}
\end{figure}








\begin{figure*}[!htbp]
	 \centering
\subfloat[GTSRB]{\includegraphics[width=0.32\textwidth]{figs/trigger_size_stl10_gtsrb.pdf}}
\subfloat[SVHN]{\includegraphics[width=0.32\textwidth]{figs/trigger_size_stl10_svhn.pdf}}
\subfloat[CIFAR10]{\includegraphics[width=0.32\textwidth]{figs/trigger_size_stl10_cifar10.pdf}}
\caption{The impact of the trigger size on our BadEncoder for different target downstream datasets when the pre-training dataset is STL10.}
\label{impact_of_trigger_size_stl10}
\end{figure*}

\begin{figure}[!htbp]
	 \centering
\subfloat[Airplane]{\includegraphics[width=0.15\textwidth]{figs/airplane_orig.jpg}}
\subfloat[Truck]{\includegraphics[width=0.15\textwidth]{figs/truck.jpg}}
\subfloat[Horse]{\includegraphics[width=0.15\textwidth]{figs/horse.jpg}}
\caption{The reference inputs for attacking three target classes in STL10 simultaneously, which are used in Table~\ref{multiple_target_classes}.}
\label{multiple_downstream_inputs}
\end{figure}

\begin{figure}[!htbp]
	 \centering
\subfloat[SVHN]{\includegraphics[width=0.15\textwidth]{figs/one_1_224.jpg}}
\subfloat[GTSRB]{\includegraphics[width=0.15\textwidth]{figs/prio_1_224.jpg}}
\subfloat[STL10]{\includegraphics[width=0.15\textwidth]{figs/truck_224.jpg}}
\caption{The reference inputs for attacking the image encoder pre-trained on ImageNet  by Google, which are used in Table~\ref{case_study_resnet50_google}.}
\label{resnet50_google_attack_input}
\end{figure}


\begin{figure}[!htbp]
	 \centering
\subfloat[SVHN]{\includegraphics[width=0.15\textwidth]{figs/one_1_224.jpg}}
\subfloat[GTSRB]{\includegraphics[width=0.15\textwidth]{figs/priority_224.jpg}}
\subfloat[STL10]{\includegraphics[width=0.15\textwidth]{figs/truck_224.jpg}}
\caption{The reference inputs for attacking  OpenAI's CLIP  in the multi-shot classifier scenario, which are used in Table~\ref{case_study_clip_st_1}.}
\label{resnet50_clip_attack_input}
\end{figure}

\begin{figure}[!t]
	 \centering
\subfloat[SVHN]{\includegraphics[width=0.15\textwidth]{figs/zero_224.jpg}}
\subfloat[GTSRB]{\includegraphics[width=0.15\textwidth]{figs/stop_224.jpg}}
\subfloat[STL10]{\includegraphics[width=0.15\textwidth]{figs/truck_224.jpg}}
\caption{The reference inputs for attacking  OpenAI's CLIP in the zero-shot classifier scenario, which are used in Table~\ref{case_study_clip_zs}.}
\label{clip_zero_shot_attack_input}
\end{figure}


\begin{figure}[!t]
	 \centering
\subfloat[SVHN]{\includegraphics[width=0.24\textwidth]{figs/trigger_size_cifar10_svhn.pdf}}
\subfloat[STL10]{\includegraphics[width=0.24\textwidth]{figs/trigger_size_cifar10_stl10.pdf}} 
\caption{The impact of the trigger size for SVHN and STL10. The pre-training dataset is CIFAR10.}
\label{impact_of_trigger_size_cifar10}
\vspace{-2mm}
\end{figure}



