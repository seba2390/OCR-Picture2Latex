\section{\vlmini{} Proofs}
\label{appendix:vlmini_safety}

\begin{definition}[Solution of Algorithmic Type Synthesis]
Suppose that $\Sigma;\Gamma \vdash t \Rightarrow A;\Sigma'; \Delta; \Theta; \mathcal{C}$. A solution for this judgement is a pair $(\theta, \eta, B)$ such that $\theta$ satisfies $\Theta$, $\eta$ satisfies $\mathcal{C}$, and $\theta \eta A$ = $B$.
\end{definition}

\begin{definition}[Solution of Pattern Type Synthesis]
Suppose that $\Sigma; R\vdash p : A \rhd \Gamma; \Sigma'; \Theta; \mathcal{C}$. A solution for this judgement is a pair $(\eta, \theta, B)$ such that $\theta$ satisfies $\Theta$, $\eta$ satisfies $\mathcal{C}$, and $\theta \eta A$ = $B$.
\end{definition}

\begin{lemma}[Relation of Resource Well-formedness]
\label{lemma:rel_res_wf}
\begin{align*}
% \begin{aligned}
\vdash \Sigma\;\land\;
\Sigma \vdash \eta\;\land\;%\\
FTV(r) \subseteq \mathrm{dom}(\eta)\;\land\;
\Sigma \vdash r:\labelskind
% \end{aligned}
\quad\Longrightarrow\quad
\vdash \eta r
\end{align*}
\end{lemma}
\begin{proof}
Straightforward by induction on the derivation of $\Sigma \vdash r:\labelskind$.
\end{proof}

\begin{lemma}[Relation of Type Well-formedness]
\label{lemma:rel_ty_wf}
\begin{align*}
\begin{aligned}
\vdash \Sigma\;\land\;
\Sigma \vdash \theta\;\land\;
\Sigma \vdash \eta\;\land\;\\
FTV(A) \subseteq \mathrm{dom}(\theta)\cup\mathrm{dom}(\eta)\;\land\;
\Sigma \vdash A:\typekind
\end{aligned}
\quad\Longrightarrow\quad
\vdash \eta \theta A
\end{align*}
\end{lemma}
\begin{proof}
Straightforward by induction on the derivation of $\Sigma \vdash A:\typekind$. The proof uses Lemma \ref{lemma:rel_res_wf}.
\end{proof}

\begin{lemma}[Relation of Type Environment Well-formedness]
\label{lemma:rel_te_wf}
\begin{align*}
\begin{aligned}
\vdash \Sigma\;\land\;
\Sigma \vdash \theta\;\land\;
\Sigma \vdash \eta\;\land\;\\
FTV(\Gamma) \subseteq \mathrm{dom}(\theta)\cup\mathrm{dom}(\eta)\;\land\;
\Sigma \vdash \Gamma
\end{aligned}
\quad\Longrightarrow\quad
\vdash \eta\theta\Gamma
\end{align*}
\end{lemma}
\begin{proof}
Straightforward by induction on the derivation of $\Sigma \vdash \Gamma$. The proof uses Lemmas \ref{lemma:rel_res_wf} and \ref{lemma:rel_ty_wf}.
\end{proof}

\begin{lemma}[Relation of Resource Environment Well-formedness]
\label{lemma:rel_re_wf}
\begin{align*}
% \begin{aligned}
\vdash \Sigma\;\land\;
\Sigma \vdash \eta\;\land\;
FTV(R) \subseteq \mathrm{dom}(\eta)\;\land\;
\Sigma \vdash R
% \end{aligned}
\quad\Longrightarrow\quad
\vdash \eta R
\end{align*}
\end{lemma}
\begin{proof}
Straightforward by induction on the derivation of $\Sigma \vdash R$. The proof uses Lemma \ref{lemma:rel_res_wf}.
\end{proof}

\begin{lemma}[Soundness of Pattern Type Synthesis]
\label{lemma:sound_p_inf}
\begin{align*}
\left.
\begin{aligned}
    \Sigma; R\vdash p : A \rhd \Gamma; \Sigma'; \Theta; \mathcal{C}\\
    (\theta, \eta, \eta \theta A) \textnormal{ is its solution}
\end{aligned}
\right\}
\quad\Longrightarrow\quad
\eta R\vdash p : \eta\theta A \rhd \eta\theta\Gamma
\end{align*}
\end{lemma}
\begin{proof}
By induction on the derivation of $\Sigma; R\vdash p : A \rhd \Gamma; \Sigma'; \Theta; \mathcal{C}$.
We perform case analysis on the rule applied last to derive $\Sigma; R\vdash p : A \rhd \Gamma; \Sigma'; \Theta; \mathcal{C}$.

\begin{itemize}
\item Case (\textsc{pInt}):
\begin{align*}
    \begin{minipage}{.55\linewidth}
      \infrule[pInt]{
        \vdash \Sigma
        \andalso
        \Sigma \vdash R
        \andalso
        \Sigma \vdash A:\typekind
      }{
        \Sigma; R \vdash n : A \rhd \emptyset; \Sigma; \{A\sim\inttype\}; \top
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
p = n,\quad
\Gamma = \emptyset,\quad
\Theta = \{A \sim \inttype\},\quad
\mathcal{C} = \top
~.
\end{gather*}
Hence, we have $\theta A = \inttype$ and $\eta = \emptyset$, therefore,
\begin{gather*}
\eta \theta A = \inttype, \quad
\eta \theta \Gamma = \emptyset
~.
\end{gather*}
By Lemma \ref{lemma:rel_re_wf},
\begin{gather*}
\vdash \eta R
~.
\end{gather*}
Therefore, by \textsc{pInt},
\begin{align*}
    \begin{minipage}{.55\linewidth}
      \infrule[pInt]{
        \vdash \eta R
      }{
        \eta R \vdash n : \inttype \rhd \emptyset
      }
    \end{minipage}
\end{align*}

\item Case (\textsc{pVar}), and (\textsc{[pVar]})%, (\textsc{p\_})
:\\
Similarly to the case (\textsc{pInt}).
We use 
% lemmas \ref{lemma:rel_ty_wf} and \ref{lemma:rel_re_wf} for the case (\textsc{p\_}), 
lemma \ref{lemma:rel_ty_wf} for the case (\textsc{pVar}), and lemmas \ref{lemma:rel_res_wf} and \ref{lemma:rel_ty_wf} for the case (\textsc{[pVar]}).

\item Case (\textsc{p$\square$}):
\begin{align*}
    \begin{minipage}{.85\linewidth}
      \vspace{0.75\baselineskip}
      \infrule[p$\square$]{
        \Sigma, \alpha:\textsf{Labels}, \beta:\textsf{Type}; \alpha \vdash p' : \beta \rhd \Gamma; \Sigma'; \Theta'; \mathcal{C}
      }{
        \Sigma; - \vdash [p'] : A \rhd \Gamma; \Sigma'; \Theta' \land \{A \sim \vertype{\alpha}{\beta}\}; \mathcal{C}
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
R = -,\quad
p = [p'],\quad
\Theta = \Theta' \land \{A \sim \vertype{\alpha}{\beta}\}
~.
\end{gather*}
Hence, we have $\theta$ unify $\Theta'$, $\theta A = \theta (\vertype{\alpha}{\beta})$, and $\eta \theta A = \eta \theta (\vertype{\alpha}{\beta})$, therefore,
\begin{gather*}
\eta \theta A = \eta \theta (\vertype{\alpha}{\beta}) = \eta \theta A, \quad
\eta R = -
~.
\end{gather*}
Hence, by the induction hypothesis,
\begin{align*}
\eta \alpha \vdash p' : \eta \theta \beta \rhd \eta \theta \Gamma
\end{align*}
Therefore, by \textsc{p$\square$},
\begin{align*}
    \begin{minipage}{.85\linewidth}
      \vspace{0.75\baselineskip}
      \infrule[p$\square$]{
        \eta \alpha \vdash p' : \eta \theta \beta \rhd \eta \theta \Gamma
      }{
        - \vdash [p'] : \vertype{\eta \alpha}{\eta \theta \beta} \rhd \eta \theta \Gamma
      }
    \end{minipage}
\end{align*}
Since $\theta$ does not include type substituions for resource variables, $\eta \alpha = \eta \theta \alpha$, hence $\vertype{\eta \alpha}{\eta \theta \beta} = \eta \theta (\vertype{\alpha}{\beta}) = \eta \theta A$. Therefore, we get the conclusion for this case.

% \item Case (\textsc{[p$\square$]}):\\
% Similarly to the case ([p$\square$]).
\end{itemize}


\end{proof}

\begin{theorem}[Soundness of Algorithmic Type Synthesis]
\label{lemma:sound_ty_inf}
\begin{align*}
\left.
\begin{aligned}
    \Sigma;\Gamma \vdash t \Rightarrow A;\Sigma'; \Delta; \Theta; \mathcal{C}\\
    (\theta, \eta, \eta \theta A) \textnormal{ is its solution}
\end{aligned}
\right\}
\quad\Longrightarrow\quad
\eta\theta\Delta \vdash t : \eta\theta A
\end{align*}
\end{theorem}

\begin{proof}
By induction on the derivation of $\Sigma;\Gamma \vdash t \Rightarrow A;\Sigma'; \Delta; \Theta; \mathcal{C}$.
We perform case analysis on the rule applied last to derive $\Sigma;\Gamma \vdash t \Rightarrow A;\Sigma'; \Delta; \Theta; \mathcal{C}$.

\begin{itemize}
\item Case (\textsc{$\Rightarrow_{\textsc{int}}$}):
\begin{align*}
    \begin{minipage}{.45\linewidth}
      \infrule[$\Rightarrow_{\textsc{int}}$]{
        \vdash \Sigma
        \andalso
        \Sigma \vdash \Gamma
      }{
        \Sigma; \Gamma \vdash n \Rightarrow \inttype; \Sigma; \emptyset; \top; \top
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
t = n,\quad
A = \inttype,\quad
\Delta = \emptyset,\quad
\Theta = \top,\quad
\mathcal{C} = \top
~.
\end{gather*}
Hence, we have $\theta = \emptyset$ and $\eta = \emptyset$, therefore,
\begin{gather*}
\eta \theta \Delta = \emptyset, \quad
\eta \theta A = \inttype
~.
\end{gather*}
% Furthermore, by Lemmas 
Therefore, by (\textsc{int}),
\begin{align*}
    \begin{minipage}{.30\linewidth}
      \infrule[int]{
        \\
      }{
        \emptyset \vdash n : \inttype
      }
    \end{minipage}
\end{align*}

\item Case (\textsc{$\Rightarrow_{\textsc{lin}}$}):
\begin{align*}
    \begin{minipage}{.5\linewidth}
      \infrule[$\Rightarrow_{\textsc{lin}}$]{
        \vdash \Sigma
        \andalso
        \Sigma \vdash \Gamma
        \andalso
        x:A\in\Gamma
      }{
        \Sigma; \Gamma \vdash x \Rightarrow A; \Sigma; x:A; \top; \top
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
t = x,\quad
% A = \inttype,\quad
\Delta = x:A,\quad
\Theta = \top,\quad
\mathcal{C} = \top
~.
\end{gather*}
Hence, we have $\theta = \emptyset$ and $\eta = \emptyset$, therefore,
\begin{gather*}
\eta \theta \Delta = x:A, \quad
\eta \theta A = A
~.
\end{gather*}
Furthermore, by Lemma \ref{lemma:rel_ty_wf}, we have
\begin{align*}
\vdash \eta \theta A~(= A)
~.
\end{align*}
Therefore, by (\textsc{var}),
\begin{align*}
    \begin{minipage}{.30\linewidth}
      \infrule[var]{
        \vdash A\\
      }{
        x:A \vdash x:A
      }
    \end{minipage}
\end{align*}

\item Case (\textsc{$\Rightarrow_{\textsc{gr}}$}):
\begin{align*}
    \begin{minipage}{.55\linewidth}
      \infrule[$\Rightarrow_{\textsc{gr}}$]{
        \vdash \Sigma
        \andalso
        \Sigma \vdash \Gamma
        \andalso
        x:\verctype{A}{r}\in\Gamma
      }{
        \Sigma; \Gamma \vdash x \Rightarrow A; \Sigma; x:\verctype{A}{1}; \top; \top
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
t = x,\quad
% A = \inttype,\quad
\Delta = x:\verctype{A}{1},\quad
\Theta = \top,\quad
\mathcal{C} = \top
~.
\end{gather*}
Hence, we have $\theta = \emptyset$ and $\eta = \emptyset$, therefore,
\begin{gather*}
\eta \theta \Delta = x:\verctype{A}{1}, \quad
\eta \theta A = A
~.
\end{gather*}
Furthermore, by Lemma \ref{lemma:rel_ty_wf}, we have
\begin{align*}
\vdash \eta \theta A~(= A)
~.
\end{align*}
Therefore, we conclude the case by the following derivation.
\begin{center}
\begin{prooftree}
\AxiomC{$ $}
\RightLabel{(\textsc{var})}
\UnaryInfC{$ x:A \vdash x : A$}
\RightLabel{(\textsc{der})}
\UnaryInfC{$ x:\verctype{A}{1} \vdash x:A$}
\end{prooftree}
\end{center}

\item Case (\textsc{$\Rightarrow_{\textsc{abs}}$}):
\begin{align*}
    \begin{minipage}{.95\linewidth}
      \infrule[$\Rightarrow_{\textsc{abs}}$]{
        \Sigma_1, \alpha:\textsf{Type};- \vdash p:\alpha \rhd \Gamma'; \Sigma_2; \Theta_1
        \andalso\\
        \Sigma_2;\Gamma,\Gamma' \vdash t \Rightarrow B;\Sigma_3;\Delta'; \Theta_2; \mathcal{C}
      }{
        \Sigma_1;\Gamma \vdash \lam{p}{t} \Rightarrow \ftype{\alpha}{B};\Sigma_3;\Delta'\backslash\Gamma' ; \Theta_1\land\Theta_2; \mathcal{C}
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
t = \ftype{\alpha}{B},\quad
% A = \inttype,\quad
\Delta = \Delta'\backslash\Gamma',\quad
\Theta = \Theta_1\land\Theta_2,
~.
\end{gather*}
Hence, we have $\theta$ unifies $\Theta_1$ and $\Theta_2$, $\eta$ unifies $\mathcal{C}$. Therefore, we have
\begin{gather*}
\eta \theta \Delta = \eta \theta (\Delta'\backslash\Gamma'), \quad
\eta \theta A = \eta \theta (\ftype{\alpha}{B})
~.
\end{gather*}
Furthermore, by Lemma \ref{lemma:sound_p_inf} and the induction hypothesis, we have
\begin{align*}
- \vdash p:\eta\theta\alpha \rhd \eta\theta\Gamma',\quad
\eta\theta \Delta' \vdash t : \eta \theta B
~.
\end{align*}
Therefore, by (\textsc{abs}),
\begin{align*}
    \begin{minipage}{.60\linewidth}
      \infrule[abs]{
        - \vdash p:\eta\theta\alpha \rhd \eta\theta\Gamma'
        \andalso
        \eta\theta \Delta' \vdash t : \eta \theta B
      }{
        \eta\theta\Delta' \backslash \eta\theta \Gamma' \vdash \lam{p}{t}:\ftype{\eta\theta\alpha}{\eta \theta B}
      }
    \end{minipage}
\end{align*}
Since $\eta\theta\Delta' \backslash \eta\theta \Gamma' = \eta\theta(\Delta' \backslash \Gamma')$ and $\ftype{\eta\theta\alpha}{\eta \theta B} = \eta\theta(\ftype{\alpha}{B})$, we have the conclusion of the case.

\item Case (\textsc{$\Rightarrow_{\textsc{app}}$}):
\begin{align*}
    \begin{minipage}{.95\linewidth}
      \vspace{0.5\baselineskip}
      \infrule[$\Rightarrow_{\textsc{app}}$]{
        \Sigma_1; \Gamma \vdash t_1 \Rightarrow A_1 ; \Sigma_2; \Delta_1; \Theta_1; \mathcal{C}_1
        \andalso\\
        \Sigma_2; \Gamma \vdash t_2 \Rightarrow A_2; \Sigma_3; \Delta_2; \Theta_2; \mathcal{C}_2
      }{
        \Sigma_1;\Gamma \vdash \app{t_1}{t_2} \Rightarrow \beta; \Sigma_3, \beta:\typekind; \Delta_1+\Delta_2; \\\hspace{11em}\Theta_1\land\Theta_2\land\{A_1\sim \ftype{A_2}{\beta}\}; \mathcal{C}_1 \land \mathcal{C}_2
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
t = \app{t_1}{t_2},\quad
A = \beta,\quad
\Delta = \Delta_2+\Delta_2,\\
\Theta = \Theta_1\land\Theta_2\land\{A_1\sim \ftype{A_2}{\beta}\},\quad
\mathcal{C} = \mathcal{C}_1 \land\mathcal{C}_2
~.
\end{gather*}
Hence, we have $\theta$ unifies $\Theta_1$ and $\Theta_2$, and $\theta A_1 = \theta (\ftype{A_2}{\beta})$.
Also, $\eta$ unifies $\mathcal{C}_1$ and $\mathcal{C}_2$, and then we have $\eta \theta A_1 = \eta \theta (\ftype{A_2}{\beta}) = \ftype{\eta \theta A_2}{\eta \theta\beta}$.
Therefore, we have
\begin{gather*}
\eta \theta \Delta = \eta\theta(\Delta_2+\Delta_2),\quad
\eta \theta A = \eta \theta \beta
~.
\end{gather*}
Furthermore, by the induction hypothesises,
\begin{gather*}
\eta \theta \Gamma \vdash t_1 : \eta \theta A_1~(=\ftype{\eta \theta A_2}{\eta \theta\beta}), \quad
\eta \theta \Gamma \vdash t_2 : \eta \theta A_2
~.
\end{gather*}
Therefore, by (\textsc{app}),
\begin{align*}
    \begin{minipage}{.70\linewidth}
      \infrule[app]{
        \eta \theta \Gamma \vdash t_1 : \ftype{\eta \theta A_2}{\eta \theta\beta}
        \andalso
        \eta \theta \Gamma \vdash t_2 : \eta \theta A_2
      }{
        \eta \theta \Gamma \vdash \app{t_1}{t_2} : \eta \theta \beta
      }
    \end{minipage}
\end{align*}

\item Case (\textsc{$\Rightarrow_{\textsc{pr}}$}):
\begin{align*}
    \begin{minipage}{.95\linewidth}
      \vspace{0.5\baselineskip}
      \infrule[$\Rightarrow_{\textsc{pr}}$]{
        \Sigma_1 \vdash [\Gamma\cap\textsf{FV}(t)]_{\textsf{Labels}} \rhd \Gamma'
        \andalso
        \Sigma_1; \Gamma' \vdash t \Rightarrow A'; \Sigma_2; \Delta'; \Theta; \mathcal{C}_1
        \andalso\\
        \Sigma_3 = \Sigma_2, \alpha:\textsf{Labels}
        \andalso
        \Sigma_3 \vdash \alpha \sqsubseteq_c \Gamma' \rhd \mathcal{C}_2
      }{
        \Sigma_1;\Gamma \vdash [t] \Rightarrow \vertype{\alpha}{A'}; \Sigma_3; \alpha \cdot \Delta' ;\Theta; \mathcal{C}_1 \land \mathcal{C}_2
      }
    \end{minipage}
\end{align*}
We are given
\begin{gather*}
t = \pr{t},\quad
A = \vertype{\alpha}{A'},\quad
\Delta = \alpha \cdot \Delta',\quad
\mathcal{C} = \mathcal{C}_1\land\mathcal{C}_2,
~.
\end{gather*}
Hence, $\theta$ unifies $\Theta$ and $\eta$ unifies $\mathcal{C}_1$ and $\mathcal{C}_2$. Therefore, we have
\begin{gather*}
\eta \theta \Delta = \eta \theta (\alpha \cdot \Delta') = (\eta \theta\alpha) \cdot (\eta \theta\Delta'), \quad
\eta\theta A = \eta \theta (\vertype{\alpha}{A'}) = \vertype{\eta \theta\alpha}{\eta \theta A'}
~.
\end{gather*}
Furthermore, by %Lemma \ref{lemma:sound_p_inf} and 
the induction hypothesis, we have
\begin{align*}
\eta \theta \Delta' \vdash t : \eta \theta A'
~.
\end{align*}
Therefore, by (\textsc{pr}),
\begin{align*}
    \begin{minipage}{.55\linewidth}
        \infrule[pr]{
            \eta \theta \Delta' \vdash t : \eta \theta A'
            \andalso
            \vdash \eta \theta \alpha
        }{
            (\eta \theta \alpha)\cdot(\eta \theta \Delta') \vdash \pr{t} : \vertype{\eta \theta \alpha}{\eta \theta A'} 
        }
    \end{minipage}
\end{align*}
\end{itemize}
\end{proof}