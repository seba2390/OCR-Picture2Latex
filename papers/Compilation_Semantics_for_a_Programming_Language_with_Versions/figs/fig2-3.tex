\begin{figure}[tb]
\centering
% \begin{minipage}[t]{0.49\textwidth}
\begin{tikzpicture}[thick, node distance=0.5cm and 1cm]
\tikzset{codeblock/.style={
    % inner xsep=20pt,
    outer xsep=-5pt,
    outer ysep=-7pt,
    rectangle,
    % fill=gray!10,
    % text width=3cm,
    text centered,
    rounded corners,
    % minimum height=1.5cm,
    minimum width=5.7cm
}};


\node[codeblock] (app1) {
\begin{minipage}{.50\linewidth}
% \begin{lstlisting}[style=haskell]
% \begin{minted}[linenos,numbersep=2pt,highlightcolor=white,highlightlines={7,9}]{haskell}
% module App where
% import Dir
% import Hash
% main () =
%   let s = getArg ()
%       digest = mkHash s
%       d = @\vlkey{ver}@ [@\textcolor{blue}{\textbf{Hash}}@=1.0.0] of
%            digest in
%   if @\vlkey{unversion}@ (exists d)
%     then print "Found"
%     else error "Not found"
% \end{minted}
\begin{minted}[linenos,numbersep=2pt,highlightcolor=white,highlightlines={7}]{haskell}
module App where
import Dir
import Hash
main () =
  let s = getArg ()
      digest = mkHash s in
  if exists digest
    then print "Found"
    else error "Not found"
\end{minted}
% \end{lstlisting}
% \hspace*{5pt}
\end{minipage}
};

\node[codeblock, right=of app1] (dir1) {
\begin{minipage}{.42\linewidth}
% \begin{lstlisting}[style=haskell]
\begin{minted}{haskell}
module Dir where
-- version 1.0.0
import Hash
exists hash = 
  let fs = getFiles () in
  foldLeft
    (\(acc, f) ->
      acc || match f hash)
    false fs
\end{minted}
% \end{lstlisting}
\end{minipage}
% \hspace*{-15pt}
};

\node[codeblock, below right=of app1, yshift=-5] (hash1) {
\begin{minipage}{.42\linewidth}
% \begin{lstlisting}[style=haskell]
\begin{minted}{haskell}
module Hash where
-- version 1.0.0
mkHash s = {- MD5 hash -}
match s hash =
    mkHash s == hash
\end{minted}
% \end{lstlisting}
\end{minipage}
% \hspace*{10pt}
};

\node[codeblock, below=of app1, yshift=-5] (hash2) {
\begin{minipage}{.44\linewidth}
% \begin{lstlisting}[style=haskell]
\begin{minted}{haskell}
module Hash where
-- version 2.0.0
mkHash s = {- SHA-3 hash -}
match s hash =
    mkHash s == hash
\end{minted}
% \end{lstlisting}
\end{minipage}
% \hspace*{10pt}
};

\node[draw, fit=(dir1), label={above:Bundled \mn{Dir}}] (Dir) {};
\node[draw, fit=(hash1) (hash2), label={above:Bundled \mn{Hash}}] (Hash) {};

\draw[->] ([xshift=2]app1.east)  -- node[midway,below] {} (Dir.west);
\draw[->] ([yshift=5]app1.south) -- node[midway,above] {} ([yshift=5]hash2.north);
\draw[->] ([yshift=5]dir1.south) -- node[midway,right] {} ([yshift=5]hash1.north);

\end{tikzpicture}
\parbox[t]{.9\linewidth}{\small The versions of each external module are bundled. Programs using a bundled module can refer to the definitions of all versions of the bundled module.}

\caption{The programs in Figure \ref{fig2-1} in \mylang{}.}
\label{fig2-3}
% \end{minipage}
\end{figure}