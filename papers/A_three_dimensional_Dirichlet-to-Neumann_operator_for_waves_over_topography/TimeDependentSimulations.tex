%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%
\section{Water wave simulations}

We now present numerical results for the time evolution of surface water waves propagating over
highly variable topographies.  
The time evolution has been performed with the fourth-order Runge-Kutta method. 

We use the following initial data along the free surface $z=0$:
\begin{equation}
\phi(x,0,0)  = e^{-({(x-x_0)}/{\sigma})^2},
\label{phi0}
\end{equation}
is the initial velocity potential. We use $\sigma = 1/6$ so that the pulse is approximately of unit width,
centered at $x=x_0$; the initial wave elevation is 
\begin{equation}
 \eta(x,0) = F^{-1}\left[\frac{k tanh(\mu k)}{\mu}F[\phi]\right].
 \label{eta0}
 \end{equation}
 By $F$ we indicate the use of an FFT and its inverse $F^{-1}$ accordingly. %The initial data is normalized so that the initial wave height is 1. 
 
 In the three dimensional simulations we have a plane wave with the above profile.
%Onde F Ž a transformada de Fourier.
%Finalmente normalizo \varphi e \eta para fazer que a onda inicial tenha amplitude 1.
 
\subsection{Two dimensional results}
%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%

%Throughout this section we assume that the fluid domain has two dimensions, and we use the two dimensional version of the equations as shown in the appendix.
 We start with two-dimensional simulations where results are known and we can further compare with the conformal mapping 
technique.

 
%%%%%%%%%%%%%%%%%%
\subsection{Waves over a submerged structure}
%%%%%%%%%%%%%%%%%%
We again consider a non-smooth topography, now in the form of a large submerged trapezoidal structure. 
 In the  conformal mapping technique the Jacobian is a 
 smooth function along the free surface and therefore the corners of the submerged structure have been regularized.  In the
 present method the topography comes into the formulation in its original form.
 
 A Gaussian pulse of unit width for $\phi$, (similar to that of figure \ref{Fig01}) propagates from the left ($x<10$) towards the submerged
 structure located at $11<x<15$ (see inset of figure \ref{Fig02}). 
%Our first simulation concerns the evolution of a Gaussian pulse that moves to right, over a region of constant depth, and then it interacts with a submerged trapezoid. The topography under consideration lets us benchmark the time integration method, by comparing it with the 
The conformal mapping method follows the work presented in  \citet{NachbinArtiles}.
  A snapshot of the wave elevation at time $t=12$ is shown in figure \ref{Fig02}. The agreement
between the two methods is very good, regarding both the dispersive wave profile as well as phase speed. 
The solid line depicts the solution with the present method while the crosses depict  results with the conformal mapping
technique. 
Also the two 
reflected waves (due to climbing and descending from the structure) are accordingly captured by the methods.
For both simulations we used $2^{10}$ points in physical space, and we considered all the Fourier modes available in our computational grid. 

%%%%%%%%%%%%%%%%%%
\begin{figure}
\centerline{\includegraphics[width = \textwidth]{FigureTrapezoidWavePaper.eps}}
\caption{Evolution of the wave  elevation after $12$ units of time. 
The solution with the present DtN method is displayed by a solid line while with crosses  for the conformal mapping technique. 
For a better visualization, only a subset of the crosses were depicted.
The wave regime corresponds to $\mu = 0.05$. The inset shows the topography at $11<x<15$ with an amplitude of 0.5, half the depth.}
\label{Fig02}
\end{figure}
%%%%%%%%%%%%%%%%%
%There is a great deal of qualitative properties of wave propagation worth mentioning. First by looking at the head of the wave train we see that, where there was a pulse, now we have a train of smaller waves. This is the effect of dispersion. Notice that the smaller waves appear behind the wave front, because shorter waves have a smaller speed of propagation and also have a smaller amplitude in this case. 
%
%The head of the train has stopped, in our reference frame, between $18$ and $19$. However, over a flat horizontal bottom, the speed at the head of the train was nearly $1$ and it moved for $12$ unit of time thus having enough time to reach the right end of the domain, so it is clear that the obstacle has slowed down the wave. 
%
%Notice the two smaller bumps, one positive and one negative. The positive one is near the left end of the domain and the negative one is over the obstacle. This bumps are reflected waves that appear when the wave passes over the left and right edges of the obstacle, respectively. 
%In figure \ref{Fig02} the solid line corresponds to the simulation performed with our algorithm whereas the red crosses correspond to the simulation carried out with the equations in curvilinear coordinates. 
We should also mention that we found a  maximum relative error of $6.275\times10^{-4}$ confirming the 
very good agreement between the two methods in this example. 
%less than $0.06\%$, successfully benchmarks our numerical method for the Drichlet-to-Neumann operator and the time integration.

%%%%%%%%%%%%%%%%%%
\subsection{Periodic topographies}
%%%%%%%%%%%%%%%%%%

In this section we study  a wave moving from a region of constant depth towards a periodic patch of
large amplitude depth variations. 
This is a problem with known mathematical results and is a good test for our DtN formulation, in particular the calculation of its topographic
coefficients with our Galerkin approach. 
We consider mean-zero  periodic depth variations with an amplitude as high as half of the channel depth. 
The wave-topography interaction is considered in two different regimes.
First the topographic variations are on the same scale as the wave field. Then we allow for large amplitude, rapidly varying depth variations,
a nontrivial test for the present DtN formulation. In this regime the bottom slope is large, while the wave feels the topography in 
an averaged form, as reported by  \cite{RosalesPapanicolaou}.

From now on only our numerical solution will be presented.

%%%%%%%%%%%%%%%%%%
\subsubsection{Bragg resonance}
%%%%%%%%%%%%%%%%%%

In the context of water waves Bragg resonance arises when the wavelength is twice as long as the topography's period.
The reflection is maximum in this regime. 
This is a known problem in water waves and to provide a few references we mention the work of \cite{Mei1985}, regarding linear waves, and 
 the more recent work of \cite{choiMilewski}, regarding nonlinear waves. 
%When the wave field passes over the topography, each obstacle transmits and reflects part of the wave. As the newly created transmitted and reflected waves encounters a new obstacle it undergoes this splitting process again. The overall scattering mechanism is characterised by having a wavelength twice as large as the wavelength of the underwater sequence of obstacles.
%Instead of approaching this problem from a theoretical point of view, we test our Dirichlet-to-Neumann operator in this framework. We stress out is that 
The setting for our  simulations differs from the theoretical work of \citet{Mei1985} and \citet{choiMilewski}. 
The topographies considered in the theoretical investigations had small amplitudes of order of $\mathcal{O}(\mu^2)$. 
In the present simulations the channel's depth oscillates from $0.5$ to $1.5$.

%%%%%%%%%%%%%%%
\begin{figure}
\centerline{\includegraphics[width = \textwidth]{FigureBraggWavePaper.eps}}
\caption{Evolution of the wave elevation after $4.5$ units of time. Notice the nearly monochromatic structure of the reflected wave. The wave regime corresponds to $\mu = 0.1$. The inset shows the underwater sinusoidal topography. The numerical method used $2^{10}$ Fourier modes
and the Galerkin method used $M=250$ for the topographic component of the DtN operator.}
\label{Fig03}
\end{figure}
%%%%%%%%%%%%%%%%%

In the figure \ref{Fig03} we present a snapshot of the solution at time $t=4.5$. A  pulse propagates to the right, from the constant
depth region located at $x<0$ (see figure \ref{Fig03}). As the wave propagates over the periodic patch a 
(nearly) monochromatic reflected wave
is observed (moving to the left) with a wavelength twice as long as the topography's period. 
The observed reflected wavelength is $0.667$ (for $-2<x<0$),  where the  sinusoidal
topography has period  $0.333$.

%%%%%%%%%%%%%%%%%%
\subsubsection{Homogenization with a rapidly varying topography}
%%%%%%%%%%%%%%%%%%

Now we investigate rapidly varying periodic topographies. This is an important test to see if our DtN formulation
accurately captures fine features of the topography.  The topography has large slopes and we want to observe numerically
the impact of our Galerkin approximation in handling the  topographic component of the DtN operator.

Through a multiscale analysis \citet{RosalesPapanicolaou} showed that a long wave feels the fine features 
of the topography in an averaged form. Namely a homogenization effect takes place to leading order. 
The wave behaves as if propagating over an ``effectively flat" region:  no reflection is observed and the wave speed
is smaller than the (dimensionless) unit speed. The periodic topography is mean-zero but the wave behaves as
if there was an effective depth smaller than 1. 
%Instead of a spatially dependent speed of propagation and dispersion, the interaction of the wave field with the higher wave numbers of the topography average out, yielding an effective speed of propagation and a constant dispersion.
%One of the notable features of the homogenised wave field is that the speed of propagation is reduced. 
This was found by \citet{RosalesPapanicolaou} in the weakly nonlinear, weakly dispersive case. 
The same result holds  in the linear case, as reported in \citet{Nachbin1993}.
The non-local formulation has been used in theoretical investigations of this phenomena. \cite{CSNG} derived an asymptotically valid KdV equation from the non-local equations. Their KdV equation also has a smaller effective speed of propagation.
Our simulations consider a large amplitude, rapidly varying topography. 
As before, our topography varies from $0.5$ to $1.5$ and the sinusoidal bottom oscillates $12$ times per (unit) pulse width.

%%%%%%%%%%%%%%%%
\begin{figure}
\centerline{\includegraphics[width = \textwidth]{FigureHomogWavePaper.eps}}
\caption{Solid line: Homogenised wave field. Dashed dotted line: Simulation without the topography. Dotted line: Simulation over the envelope of the bottom. All the simulations correspond to the regime $\mu = 0.1$.
The numerical method used $2^{11}$ Fourier modes
and the Galerkin method used $M=250$ for the topographic component of the DtN operator.}
\label{Fig04}
\end{figure}
%%%%%%%%%%%%%%%%%%%%

In figure \ref{Fig04} we superimpose three simulations: (a) a flat bottom case; (b) a large amplitude, zero-mean, rapidly varying
periodic topography; (c) a step obtained as the envelope of the rapidly varying topography. The dispersion parameter is
taken as $\mu=0.1$. We should recall  that the Galerkin parameter $M$ depends on $\mu$. The shallow water regime is easier to solve than a dispersive regime. The tests reported below were also done for a (nearly) traveling pulse in a very shallow
channel, but we only report the more demanding dispersive case.
 
The (green) dotted line corresponds  to the flat bottom case. No reflected wave is observed. At the wavefront we
notice the dispersive oscillatory tail.
We focus on the speed at the wave front, which in this case is $0.94$ due the initial wave profile and
dispersion.
The (red) dashed-dotted line corresponds to the envelope of the bottom topography, namely a step. 
The wave front appears behind the flat bottom case because over the step the speed of propagation is smaller, about $0.68$.
Finally the (blue) solid line is the solution in the presence of the rapidly varying topography.
The effective speed is smaller than the flat bottom case but larger than the step. This is our numerically
homogenized wave field. 
No reflection is produced over the rapidly varying periodic topography.
The bottom's fine features where captured accordingly along the free surface through the
DtN operator. The solution is free from numerical noise indicating that the Galerkin approximation for the 
topographic coefficients of the non-local operator performed well.  
The numerically observed  (effective) wave speed is of $0.82$. 
In the shallow water case we clearly see a (nearly) traveling wave over the topography, with no reflected wave observed. 
The only reflected signal comes from the transition from flat to periodic.

%{\bf Andr{\'e}: A onda tem media $0$, a velocidade de fase que corresponderia a maior frequencia em Fourier, eh $0.95$ em fundo plano $1$. As velocidades medidas corresponderiam a velocidades de fase ja que foram medidas no primeiro maximo do potencial que corresponde com o primeiro zero da onda (de direita para ezquerda). Isto pode ser visto tambem olhando para a velocidade do degrau (profundidade 0.5) temos que $0.68\times \sqrt{2} = 0.96$ aproximadamente.}




%We did not pursued further investigations on this subject because we believe that we met our objective, to show that the non-local method, together with the Galerkin approximation, provide a robust numerical method that handled complex situations well. Moreover it was able to capture some subtle features of the wave-topography interaction that suggest that the range of validy of the existing theories can be extended much more. 
%


