%---------------------------------------------------------------------------------------------------------------
% TikZ: schematic representation of the proposed linear physical model by a linear signal processing chain
%---------------------------------------------------------------------------------------------------------------
\begin{tikzpicture}

%---------------------------------------------------------------------------------------------------------------
% define size of linear signal processing chain
%---------------------------------------------------------------------------------------------------------------
\pgfmathsetmacro{\Width}{14.5}
\pgfmathsetmacro{\Height}{3.25}

%---------------------------------------------------------------------------------------------------------------
% calculation of coordinates
%---------------------------------------------------------------------------------------------------------------
% set sizes of the basic units
\pgfmathsetmacro{\FractionWidthBase}{29}
\pgfmathsetmacro{\FractionHeightBase}{13}

% position of multiplication (incident acoustic pressure field)
\pgfmathsetmacro{\FractionsWidthACenter}{4.5}
\pgfmathsetmacro{\FractionsWidthARadius}{0.5}
\pgfmathsetmacro{\FractionsHeightACenter}{6.5}
\pgfmathsetmacro{\FractionsHeightAArrow}{4}

% position of multiplication (apodized spatial receive function)
\pgfmathsetmacro{\FractionsWidthBCenter}{9.5}
\pgfmathsetmacro{\FractionsWidthBRadius}{0.5}
\pgfmathsetmacro{\FractionsHeightBCenter}{6.5}
\pgfmathsetmacro{\FractionsHeightBArrow}{2}

% position of system C (volume integral)
\pgfmathsetmacro{\FractionsWidthCStart}{14}
\pgfmathsetmacro{\FractionsWidthCStop}{20}
\pgfmathsetmacro{\FractionsHeightCStart}{3}
\pgfmathsetmacro{\FractionsHeightCStop}{10}

% position of multiplication (receiver electromechanical transfer function)
\pgfmathsetmacro{\FractionsWidthDCenter}{24.5}
\pgfmathsetmacro{\FractionsWidthDRadius}{0.5}
\pgfmathsetmacro{\FractionsHeightDCenter}{6.5}
\pgfmathsetmacro{\FractionsHeightDArrow}{2}

% position of system E (observation operator)
\pgfmathsetmacro{\FractionsWidthEStart}{3}
\pgfmathsetmacro{\FractionsWidthEStop}{26}
\pgfmathsetmacro{\FractionsHeightEStart}{0}
\pgfmathsetmacro{\FractionsHeightEStop}{13}

% multiplication (incident acoustic pressure field)
\pgfmathsetmacro{\FractionsWidthAStart}{\FractionsWidthACenter - \FractionsWidthARadius}
\pgfmathsetmacro{\FractionsWidthAStop}{\FractionsWidthACenter + \FractionsWidthARadius}
\pgfmathsetmacro{\AHorizStart}{\FractionsWidthAStart * \Width / \FractionWidthBase}
\pgfmathsetmacro{\AHorizStop}{\FractionsWidthAStop * \Width / \FractionWidthBase}

\pgfmathsetmacro{\FractionsHeightAStart}{\FractionsHeightACenter - \FractionsWidthARadius * \FractionHeightBase / \FractionWidthBase * \Width / \Height}
\pgfmathsetmacro{\FractionsHeightAStop}{\FractionsHeightACenter + \FractionsWidthARadius * \FractionHeightBase / \FractionWidthBase * \Width / \Height}
\pgfmathsetmacro{\AVertStart}{\FractionsHeightAStart * \Height / \FractionHeightBase}
\pgfmathsetmacro{\AVertStop}{\FractionsHeightAStop * \Height / \FractionHeightBase}

\pgfmathsetmacro{\ARadius}{\FractionsWidthARadius * \Width / \FractionWidthBase}

\pgfmathsetmacro{\AWidth}{\AHorizStop - \AHorizStart}
\pgfmathsetmacro{\AHeight}{\AVertStop - \AVertStart}

\pgfmathsetmacro{\AHorizCenter}{\AHorizStart + \AWidth / 2}
\pgfmathsetmacro{\AVertCenter}{\AVertStart + \AHeight / 2}

\pgfmathsetmacro{\AVertArrowStart}{\AVertStart - \FractionsHeightAArrow * \Height / \FractionHeightBase}

% multiplication (apodized spatial receive function)
\pgfmathsetmacro{\FractionsWidthBStart}{\FractionsWidthBCenter - \FractionsWidthBRadius}
\pgfmathsetmacro{\FractionsWidthBStop}{\FractionsWidthBCenter + \FractionsWidthBRadius}
\pgfmathsetmacro{\BHorizStart}{\FractionsWidthBStart * \Width / \FractionWidthBase}
\pgfmathsetmacro{\BHorizStop}{\FractionsWidthBStop * \Width / \FractionWidthBase}

\pgfmathsetmacro{\FractionsHeightBStart}{\FractionsHeightBCenter - \FractionsWidthBRadius * \FractionHeightBase / \FractionWidthBase * \Width / \Height}
\pgfmathsetmacro{\FractionsHeightBStop}{\FractionsHeightBCenter + \FractionsWidthBRadius * \FractionHeightBase / \FractionWidthBase * \Width / \Height}
\pgfmathsetmacro{\BVertStart}{\FractionsHeightBStart * \Height / \FractionHeightBase}
\pgfmathsetmacro{\BVertStop}{\FractionsHeightBStop * \Height / \FractionHeightBase}

\pgfmathsetmacro{\BRadius}{\FractionsWidthBRadius * \Width / \FractionWidthBase}

\pgfmathsetmacro{\BWidth}{\BHorizStop - \BHorizStart}
\pgfmathsetmacro{\BHeight}{\BVertStop - \BVertStart}

\pgfmathsetmacro{\BHorizCenter}{\BHorizStart + \BWidth / 2}
\pgfmathsetmacro{\BVertCenter}{\BVertStart + \BHeight / 2}

\pgfmathsetmacro{\BVertArrowStart}{\BVertStart - \FractionsHeightBArrow * \Height / \FractionHeightBase}

% system C (volume integral)
\pgfmathsetmacro{\CHorizStart}{\FractionsWidthCStart * \Width / \FractionWidthBase}
\pgfmathsetmacro{\CHorizStop}{\FractionsWidthCStop * \Width / \FractionWidthBase}

\pgfmathsetmacro{\CVertStart}{\FractionsHeightCStart * \Height / \FractionHeightBase}
\pgfmathsetmacro{\CVertStop}{\FractionsHeightCStop * \Height / \FractionHeightBase}

\pgfmathsetmacro{\CWidth}{\CHorizStop - \CHorizStart}
\pgfmathsetmacro{\CHeight}{\CVertStop - \CVertStart}

\pgfmathsetmacro{\CHorizCenter}{\CHorizStart + \CWidth / 2}
\pgfmathsetmacro{\CVertCenter}{\CVertStart + \CHeight / 2}

% multiplication (receiver electromechanical transfer function)
\pgfmathsetmacro{\FractionsWidthDStart}{\FractionsWidthDCenter - \FractionsWidthDRadius}
\pgfmathsetmacro{\FractionsWidthDStop}{\FractionsWidthDCenter + \FractionsWidthDRadius}
\pgfmathsetmacro{\DHorizStart}{\FractionsWidthDStart * \Width / \FractionWidthBase}
\pgfmathsetmacro{\DHorizStop}{\FractionsWidthDStop * \Width / \FractionWidthBase}

\pgfmathsetmacro{\FractionsHeightDStart}{\FractionsHeightDCenter - \FractionsWidthDRadius * \FractionHeightBase / \FractionWidthBase * \Width / \Height}
\pgfmathsetmacro{\FractionsHeightDStop}{\FractionsHeightDCenter + \FractionsWidthDRadius * \FractionHeightBase / \FractionWidthBase * \Width / \Height}
\pgfmathsetmacro{\DVertStart}{\FractionsHeightDStart * \Height / \FractionHeightBase}
\pgfmathsetmacro{\DVertStop}{\FractionsHeightDStop * \Height / \FractionHeightBase}

\pgfmathsetmacro{\DRadius}{\FractionsWidthDRadius * \Width / \FractionWidthBase}

\pgfmathsetmacro{\DWidth}{\DHorizStop - \DHorizStart}
\pgfmathsetmacro{\DHeight}{\DVertStop - \DVertStart}

\pgfmathsetmacro{\DHorizCenter}{\DHorizStart + \DWidth / 2}
\pgfmathsetmacro{\DVertCenter}{\DVertStart + \DHeight / 2}

\pgfmathsetmacro{\DVertArrowStart}{\DVertStart - \FractionsHeightDArrow * \Height / \FractionHeightBase}

% system E (observation operator)
\pgfmathsetmacro{\EHorizStart}{\FractionsWidthEStart * \Width / \FractionWidthBase}
\pgfmathsetmacro{\EHorizStop}{\FractionsWidthEStop * \Width / \FractionWidthBase}

\pgfmathsetmacro{\EVertStart}{\FractionsHeightEStart * \Height / \FractionHeightBase}
\pgfmathsetmacro{\EVertStop}{\FractionsHeightEStop * \Height / \FractionHeightBase}

\pgfmathsetmacro{\EWidth}{\EHorizStop - \EHorizStart}
\pgfmathsetmacro{\EHeight}{\EVertStop - \EVertStart}

\pgfmathsetmacro{\EHorizCenter}{\EHorizStart + \EWidth / 2}
\pgfmathsetmacro{\EVertCenter}{\EVertStart + \EHeight / 2}

% system A <-> system B
\pgfmathsetmacro{\ABHorizCenter}{(\AHorizStop + \BHorizStart) / 2}
\pgfmathsetmacro{\ABVertCenter}{(\AVertCenter + \BVertCenter) / 2}

% system B <-> system C
\pgfmathsetmacro{\BCHorizCenter}{(\BHorizStop + \CHorizStart) / 2}
\pgfmathsetmacro{\BCVertCenter}{(\BVertCenter + \CVertCenter) / 2}

% system C <-> system D
\pgfmathsetmacro{\CDHorizCenter}{(\CHorizStop + \DHorizStart) / 2}
\pgfmathsetmacro{\CDVertCenter}{(\CVertCenter + \DVertCenter) / 2}

%---------------------------------------------------------------------------------------------------------------
% define coordinates
%---------------------------------------------------------------------------------------------------------------
% coordinates for the multiplication (incident acoustic pressure field)
\coordinate (AC) at (\AHorizCenter, \AVertCenter);

% coordinates for the multiplication (apodized spatial receive function)
\coordinate (BC) at (\BHorizCenter, \BVertCenter);

% system C (volume integral)
\coordinate (CLB) at (\CHorizStart, \CVertStart);
\coordinate (CRU) at (\CHorizStop, \CVertStop);

% coordinates for the multiplication (receiver electromechanical transfer function)
\coordinate (DC) at (\DHorizCenter, \DVertCenter);

% coordinates for system E (observation operator)
\coordinate (ELB) at (\EHorizStart, \EVertStart);
\coordinate (ERU) at (\EHorizStop, \EVertStop);

% coordinates for arrows
\coordinate (X) at (0, \AVertCenter);
\coordinate (XL) at (0, \AVertArrowStart);
\coordinate (AL) at (\AHorizStart, \AVertCenter);

\coordinate (AB) at (\AHorizCenter, \AVertStart);
\coordinate (ABS) at (\AHorizCenter, \AVertArrowStart);

\coordinate (AR) at (\AHorizStop, \AVertCenter);
\coordinate (ARBLC) at (\ABHorizCenter, \ABVertCenter);
\coordinate (BL) at (\BHorizStart, \BVertCenter);

\coordinate (BB) at (\BHorizCenter, \BVertStart);
\coordinate (BBS) at (\BHorizCenter, \BVertArrowStart);

\coordinate (BR) at (\BHorizStop, \BVertCenter);
\coordinate (BRCLC) at (\BCHorizCenter, \BCVertCenter);
\coordinate (CL) at (\CHorizStart, \CVertCenter);

\coordinate (CR) at (\CHorizStop, \CVertCenter);
\coordinate (CRDLC) at (\CDHorizCenter, \CDVertCenter);
\coordinate (DL) at (\DHorizStart, \DVertCenter);

\coordinate (DB) at (\DHorizCenter, \DVertStart);
\coordinate (DBS) at (\DHorizCenter, \DVertArrowStart);

\coordinate (DR) at (\DHorizStop, \DVertCenter);
\coordinate (Z) at (\Width, \CVertCenter);

% coordinates for labels for operators
\coordinate (LC) at (\CHorizCenter, \CVertCenter);
\coordinate (LE) at (\EHorizStart, \EVertStop);

%---------------------------------------------------------------------------------------------------------------
% draw systems
%---------------------------------------------------------------------------------------------------------------
% system E (observation operator)
\draw [fill = gray05, fill opacity = 1, draw = black, draw opacity = 1, rounded corners = 5, thick, text opacity = 1, dashed] (ELB) rectangle (ERU);

% multiplication (incident acoustic pressure field)
\draw [draw = black, draw opacity = 1, thick, text opacity = 1] (AC) circle (\ARadius);

% multiplication (apodized spatial receive function)
\draw [draw = black, draw opacity = 1, thick, text opacity = 1] (BC) circle (\BRadius);

% system C (volume integral)
\draw [fill = gray10, fill opacity = 1, draw = black, draw opacity = 1, rounded corners = 5, thick, text opacity = 1] (CLB) rectangle (CRU);

% multiplication (receiver electromechanical transfer function)
\draw [draw = black, draw opacity = 1, thick, text opacity = 1] (DC) circle (\DRadius);

%---------------------------------------------------------------------------------------------------------------
% draw signals
%---------------------------------------------------------------------------------------------------------------
% input signals to the scattering operator
\draw [->, >=stealth, thick] (X) -- (AL);
\draw [->, >=stealth, thick] (ABS) -- (AB);
\draw [thick] (XL) -- (ABS);
\draw [->, >=stealth, thick] (AR) -- (BL);
\draw [->, >=stealth, thick] (BBS) -- (BB);
\draw [->, >=stealth, thick] (BR) -- (CL);
\draw [->, >=stealth, thick] (CR) -- (DL);
\draw [->, >=stealth, thick] (DBS) -- (DB);
\draw [->, >=stealth, thick] (DR) -- (Z);

%---------------------------------------------------------------------------------------------------------------
% labels
%---------------------------------------------------------------------------------------------------------------
% systems
\node [align=center] at (AC) {$\displaystyle \times$};
\node [align=center] at (BC) {$\displaystyle \times$};
\node [align=center] at (LC) {$\displaystyle \int_{ \Omega } f_{m, l}^{(\text{B}, n)}( \vect{r} ) \text{d} \vect{r}$};
\node [align=center] at (DC) {$\displaystyle \times$};
\node [below right] at (LE) {\sffamily Pulse-echo measurement process};

% signals
\node [above] at (X) {$\gamma^{(\kappa)}( \vect{r} )$};
\node [above] at (XL) {$p_{l}^{(\text{in}, n)}( \vect{r} )$};
\node [above] at (ARBLC) {$\phi_{l}^{(\text{B}, n)}( \vect{r} )$};
\node [above] at (BRCLC) {$f_{m, l}^{(\text{B}, n)}( \vect{r} )$};
\node [below] at (BBS) {$- {\munderbar{k}_{l}}^{2} \varUpsilon_{m, l}^{(\text{rx})}( \vect{r} )$};
\node [above] at (CRDLC) {$F_{m, l}^{(\text{B}, n)}$};
\node [below] at (DBS) {$h_{m, l}^{(\text{rx})}$};
\node [above] at (Z) {$u_{m, l}^{(\text{B}, n)}$};

\end{tikzpicture}
