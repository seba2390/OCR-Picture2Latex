\documentclass{article}
%\usepackage[utf8]{amsmath,inputenc}
\usepackage{amsmath,inputenc}

\input{tex/preamble_Arxiv}
\input{tex/macros}

% the following two macros define an arxiv environment
\newif\ifarxiv   % Toggle appendix
\arxivtrue %set true for arxiv version

% useage:
\ifarxiv
% ...text that appears only on arxiv
\else
% ...text that appears only on EAAMO version. 
\fi

\title{Balancing Fairness and Efficiency in Traffic Routing via Interpolated Traffic Assignment}
%Who Gets What and Why? A Fast Method to Balance Fairness and Efficiency in Traffic Routing


\author{Devansh Jalota$^1$, Kiril Solovey$^2$, Matthew Tsao$^1$, Stephen Zoepf$^3$, and Marco Pavone$^1$%
\thanks{$^1$ Stanford University, USA; {\tt \{djalota, kirilsol, mwtsao, pavone\}@stanford.edu}.}%
\thanks{$^3$ Technion - Israel Institute of Technology, Israel;
{\tt kirilsol@stanford.edu}.}
\thanks{$^2$ Lacuna AI, USA; {\tt stephen.zoepf@lacuna.ai}.}%
}

\date{}

\begin{document}

\maketitle


\begin{abstract}
    System optimum (SO) routing, wherein the total travel time of all users is minimized, is a holy grail for transportation authorities. However, SO routing may discriminate against users who incur much larger travel times than others to achieve high system efficiency, i.e., low total travel times. To address the inherent unfairness of SO routing, we study the ${\beta}$-fair SO problem whose goal is to minimize the total travel time while guaranteeing a ${\beta\geq 1}$ level of unfairness, which specifies the maximum possible ratio between the travel times of different users with shared origins and destinations. 

    To obtain feasible solutions to the ${\beta}$-fair SO problem while achieving high system efficiency, we develop a new convex program, the Interpolated Traffic Assignment Problem (I-TAP), which interpolates between a fairness-promoting and an efficiency-promoting traffic-assignment objective. We evaluate the efficacy of I-TAP through theoretical bounds on the total system travel time and level of unfairness in terms of its interpolation parameter, as well as present a numerical comparison between I-TAP and a state-of-the-art algorithm on a range of transportation networks. The numerical results indicate that our approach is faster by several orders of magnitude as compared to the benchmark algorithm, while achieving higher system efficiency for all desirable levels of unfairness. We further leverage the structure of I-TAP to develop two pricing mechanisms to collectively enforce the I-TAP solution in the presence of selfish homogeneous and heterogeneous users, respectively, that independently choose routes to minimize their own travel costs. We mention that this is the first study of pricing in the context of fair routing for general road networks (as opposed to, e.g., parallel road networks).
\end{abstract}

\begin{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}
System optimum (SO) routing, wherein the total travel time of all users is minimized, is a holy grail for transportation authorities. However, SO routing may discriminate against users who incur much larger travel times than others to achieve high system efficiency, i.e., low total travel times. To address the inherent unfairness of SO routing, we study the $\beta$-fair SO problem whose goal is to minimize the total travel time while guaranteeing a $\beta\geq 1$ level of unfairness, which specifies the maximum possible ratio between the travel times of different users with shared origins and destinations. To obtain feasible solutions to the $\beta$-fair SO problem while achieving high system efficiency, we develop a new convex program, the Interpolated Traffic Assignment Problem (I-TAP), which interpolates between a fair and an efficient traffic-assignment objective. We then leverage the structure of I-TAP to develop two pricing mechanisms to collectively enforce the I-TAP solution in the presence of selfish homogeneous and heterogeneous users, respectively, that independently choose routes to minimize their own travel costs. We mention that this is the first study of pricing in the context of fair routing. Finally, we use origin-destination demand data for a range of transportation networks to numerically evaluate the performance of I-TAP as compared to a state-of-the-art algorithm. The numerical results indicate that our approach is faster by several orders of magnitude, while achieving higher system efficiency for most levels of unfairness. 
\end{abstract}
\end{comment}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

Traffic congestion has soared in major urban centres across the world, leading to widespread environmental pollution and huge economic losses. In the US alone, almost 90 billion US dollars of \ifarxiv economic \fi losses are incurred every year, with commuters losing hundreds of hours due to traffic congestion~\cite{us-congestion-costs}. A contributing factor to increasing road traffic \ifarxiv levels \fi is the often sub-optimal route selection by users due to the lack of centralized \ifarxiv traffic \fi control \cite{how-bad-is-selfish,ROUGHGARDEN2004389}. In particular, \textit{selfish routing}, wherein users choose routes to minimize their travel times, results in a user equilibrium (UE) traffic pattern that is often far from the system optimum (SO) \cite{Sheffi1985,boston-large-poa}. To cope with the efficiency loss due to the selfishness of users, several methods including the control of a fraction of compliant users~\cite{Sharon2018TrafficOF} and marginal cost tolls, where users pay for the externalities they impose on others, have been used to enforce the SO solution as a UE \cite{pigou,wardrop-ue}. 

%A common approach to cope with selfishness, and the resulting efficiency loss, is marginal cost pricing of roads, where users pay for the externalities they impose on others, to enforce the SO solution as a UE \cite{pigou,wardrop-ue}. 

While determining SO tolls is of fundamental theoretical importance, it is of limited practical interest \cite{METRP} since SO traffic patterns are often unfair with some users incurring much larger travel times than others. This discrepancy among user travel times is referred to as \textit{unfairness}, which, more formally, is the maximum possible ratio across all origin-destination (O-D) pairs of the experienced travel time of a given user to the travel time of the fastest user between the same O-D pair. The unfairness of the SO solution can be quite high in real-world transportation networks, since users may spend nearly twice as much time as others travelling between the same O-D pair \cite{so-routing-seminal}. Moreover, a theoretical analysis established that the SO solution can even have unbounded unfairness~\cite{Roughgarden2002HowUI}.

%The distribution of unfairness of the SO solution for six transportation networks studied in this work is depicted in Figure~\ref{fig:prob_v_unfairness}, which shows that some users may spend nearly twice as much time as others travelling between the same O-D pair. Moreover, a theoretical analysis established that the SO solution can even have unbounded unfairness~\cite{Roughgarden2002HowUI}.
\begin{comment}
\begin{figure}[t]
      \centering
      \include{Fig/probability_of_so_unfairness}
      \vspace{-15pt}
      \caption{Cumulative fraction of users keeping within a certain bound of unfairness with respect to the SO solution for six transportation networks (see Table~\ref{tab:problem-instances}).}
      \label{fig:prob_v_unfairness} \vspace{-18pt}
   \end{figure}
\end{comment}


%The tension between system optimal routing and user's selfish objectives


The lack of consideration of user-specific travel times in the \ifarxiv global \fi SO problem has led to the design of methods that aim to achieve a balance between the total travel time of a traffic assignment and the level of fairness that it provides. In a seminal work, Jahn et al. \cite{so-routing-seminal} introduced the Constrained System Optimum (CSO) to reduce the unfairness of traffic flows by bounding the ratio of the normal length of a path of a given user to the normal length of the shortest path for the same O-D pair. Here, \textit{normal length} is any metric for an edge that is fixed \emph{a priori} and is independent of the traffic flow, e.g., edge length or free-flow travel time. While many approaches to solve the CSO problem have been developed~\cite{ANGELELLI20161,ANGELELLI2020,ANGELELLI2018234}, they suffer from the \ifarxiv inherent \fi limitation that the level of experienced unfairness in terms of user travel times can be much higher than the bound on the ratio of normal lengths that the CSO is guaranteed to satisfy. In addition to this drawback, the algorithmic approaches to solve the CSO problem are often computationally prohibitive and do not provide theoretical guarantees in terms of the resulting solution fairness and efficiency. Furthermore, it is unclear how to develop a pricing scheme to enforce such proposed traffic assignments in practice.


%As a result, there has been recent interest in directly incorporating constraints that bound the ratio of user's travel times~\cite{ANGELELLI2020105016}. However, algorithmic approaches to solve the aforementioned unfairness constrained problems are often computationally prohibitive and lack theoretical guarantees. Furthermore, it is unclear how to develop a pricing scheme to enforce their proposed traffic assignments in practice.

%these approaches, as with many of the methods to solve the CSO problem, are often computationally prohibitive and the efficacy of these methods lack theoretical guarantees. Furthermore, it is unclear how to develop a pricing scheme to enforce their proposed traffic assignments in practice.

%While several notions of fairness have been proposed



%Most notably, Jahn et al. \cite{so-routing-seminal} introduced the notion of Constrained System Optimum (CSO), which involves minimizing the total travel time of a traffic assignment while maintaining a bound on the ratio of the normal length of a path of a given user to the normal length of the shortest path for the same O-D pair. Here, \textit{normal length} is any metric for an edge that is fixed \emph{a priori} and is independent of the traffic flow, e.g., edge length or free-flow travel time.


\begin{comment}
The lack of consideration of user-specific travel times in the global SO problem led Jahn et al. \cite{so-routing-seminal} to introduce the notion of Constrained System Optimum (CSO), which aims to achieve a balance between the total travel time of a traffic assignment and the level of fairness that it provides. In particular, the CSO problem imposes a bound on the ratio of the normal length of a path of a given user to the normal length of the shortest path for the same O-D pair. Here, \textit{normal length} is any metric for an edge that is fixed \emph{a priori} and is independent of the traffic flow, e.g., edge length or free-flow travel time. %on the edge. %While bounding the ratio of normal lengths serves as a proxy for user unfairness, 
However, the level of experienced unfairness in terms of user travel times can be much higher than the bound on the ratio of normal lengths that the CSO is guaranteed to satisfy. In addition to this drawback, the algorithmic approach of \cite{so-routing-seminal} to solve the NP-hard CSO problem suffers from three primary limitations. First, the runtime of their approach is prohibitively large, since it relies on the exact computation of numerous NP-hard constrained shortest-path 
problems. Second, even when their approach outputs a feasible solution to the CSO problem, it can yield prohibitively-large total travel times for certain levels of unfairness, since CSO only bounds the ratio of the normal lengths of paths, which is a fixed quantity. Finally, it is unclear how to develop a pricing scheme to enforce such proposed traffic assignments in practice.
\end{comment}


In this work, we study a problem analogous to CSO that differs in the problem's unfairness constraints. In particular, we explicitly consider the experienced unfairness in terms of user travel times as in \cite{ANGELELLI2020105016}, which, arguably, is a more accurate representation of user constraints as it accounts for costs that vary according to a traffic assignment. Our work further addresses the algorithmic concerns of existing approaches to solve fairness-constrained traffic routing problems by developing (i) a computationally-efficient approach that trades off efficiency and fairness in traffic routing, (ii) theoretical bounds to quantify the performance of our algorithm, and (iii) a pricing mechanism to enforce the resulting traffic assignment.

\begin{comment}
\ifarxiv In this work, we study a problem analogous to CSO that differs in the problem's unfairness constraints. In particular, we explicitly consider the experienced unfairness in terms of user travel times as in \cite{ANGELELLI2020105016}, which, arguably, is a more accurate representation of user constraints as it accounts for user costs that vary according to a traffic assignment. We further address the aforementioned algorithmic concerns by developing (i) a computationally-efficient approach that trades off efficiency and fairness in traffic routing, (ii) theoretical bounds to quantify the performance of our algorithm and (iii) a pricing mechanism to enforce the resulting traffic assignment.
\else 
In this work, we study a problem analogous to CSO that differs in the unfairness constraints, and address the aforementioned concerns by developing (i) a computationally-efficient approach that trades off efficiency and fairness in traffic routing, (ii) theoretical bounds to quantify the performance of our algorithm, and (iii) a pricing mechanism to enforce the resulting traffic assignment.
\fi
\end{comment}

%However, the algorithmic approach developed in \cite{so-routing-seminal} to compute an optimal solution to the NP-hard CSO problem suffers from three primary limitations. First, the running time of their approach is prohibitively large, since it relies on the exact computation of numerous NP-hard constrained shortest-path problems. Second, even when their algorithm outputs a feasible solution to the CSO problem, the level of experienced unfairness in terms of user travel times can be much higher than the bound on the ratio of normal lengths that the CSO is guaranteed to satisfy. As a result, their approach can yield for certain levels of unfairness prohibitively-large total travel times. Finally, it is unclear how to develop a pricing scheme to enforce their proposed traffic assignments in practice. In this work, we study a problem analogous to CSO that differs in the problem's unfairness constraints since we explicitly consider the experienced unfairness in terms of user travel times. We further address the aforementioned algorithmic concerns by developing (i) a computationally efficient algorithm that trades off system efficiency and user fairness in traffic routing, and (ii) a pricing mechanism to enforce the resulting traffic assignment.

\fakeparagraph{Contributions.}
We study the $\beta$-fair System Optimum (\fso) problem, which involves minimizing the total travel time of users subject to unfairness constraints, where a $\beta\geq 1$ bound on unfairness specifies the maximum allowable ratio between the travel times of different users with shared origins and destinations. 

We develop a simple yet effective %algorithmic 
%approach which allows us to maintain a desired level of unfairness while achieving a low total travel time.
approach for \fso that involves solving a new convex program, the interpolated traffic assignment problem (I-TAP). I-TAP interpolates between the fair UE and efficient SO objectives to achieve a solution that is simultaneously fair and efficient. This allows us to approximate the \fso problem as an unconstrained traffic assignment problem, which can be solved quickly. We further present theoretical bounds on the total system travel time and unfairness level in terms of the interpolation parameter of I-TAP.

%Our algorithmic approach for \fso leverages the observation that the UE objective for the traffic assignment problem achieves a high level of fairness, whereas the SO objective often achieves a low level of fairness with high system efficiency. In particular, our approach interpolates between these two objectives, within a new convex program which we term the interpolated traffic assignment problem (I-TAP), to achieve a solution that is simultaneously fair and efficient. This allows us to approximate the \fso problem as an unconstrained traffic assignment problem, which can be solved quickly.

We then exploit the structure of I-TAP to develop two pricing schemes which enforce users to selfishly select the flows satisfying the $\beta$ bound on unfairness computed through our approach. \ifarxiv In particular, for \else For \fi homogeneous users with the same value of time we develop a natural marginal-cost pricing scheme. For heterogeneous users, we exploit a linear-programming method \cite{multicommodity-extension} \ifarxiv to derive prices that enforce the optimal flows computed through I-TAP\else\fi. We mention that our work is the first to study road pricing in connection with fair routing for general road networks as opposed to, e.g., parallel networks.

Finally, we evaluate the performance of our approach on real-world transportation networks for the above (Section~\ref{sec:numerical-experiments}) and other valid notions of unfairness \ifarxiv (Appendix~\ref{apdx:general-unfairness}) \else (Appendix F) \fi. The numerical results indicate significant computational savings as well as superior performance for all desirable levels of unfairness~$\beta$, as compared to the algorithm in~\cite{so-routing-seminal}. Moreover, our results demonstrate that our approach can reduce \ifarxiv the level of \fi unfairness by 50\% while increasing the total travel time by at most 2\%, which indicates that a huge gain in user fairness can be achieved for a small loss in %system
efficiency, making our approach a desirable option for use in route guidance systems.

This paper is organized as follows. Section~\ref{sec:related-lit} reviews related literature. We introduce in Section~\ref{sec:model} the \fso problem and metrics to evaluate the fairness and efficiency of a \ifarxiv feasible \fi traffic assignment. We introduce the I-TAP method and discuss its properties in Section~\ref{sec:itap-main}, and develop pricing schemes \ifarxiv to enforce the computed traffic assignments as a UE \fi in Section~\ref{sec:main-pricing}. We evaluate the performance of the I-TAP method %as compared to a state-of-the-art algorithm 
through numerical experiments in Section~\ref{sec:numerical-experiments} and provide directions for future work in Section~\ref{sec:future-work}. \ifarxiv Furthermore, in the appendix we also present an extension of our work to additional fairness notions beyond the one considered in the main text.

\ifarxiv
\else

In the appendix, we provide proofs that were omitted from the main text and discuss additional results on the sensitivity analysis as well as numerical implementation details of our developed approach. Furthermore, we elaborate on some additional observations on our pricing results and present an extension of our work to additional fairness notions beyond the one considered in the main text.

%\paragraph{A Note on Appendices} We summarize here the contributions of our work presented in the supplemental material. Appendix A presents proofs of Lemmas~\ref{lem:itap-optimal-pigou} and~\ref{lem:pricing-homogeneous}. Then, in Appendix B, we develop continuity results for the solution $\x(\alpha)$ of I-TAP$_{\alpha}$ and the travel time function $\objso(\x(\alpha))$ in $\alpha$. We then elaborate on some additional observations on our pricing results noted in Section~\ref{sec:main-pricing} in Appendix C. Next, we present the numerical implementation details of I-TAP, including the computation of the unfairness measure, and the choice convex combination parameter increments in Appendices D and E, respectively. Finally, we elaborate on the extension of our work to path based fairness notions in Appendix F.

\fi

\section{Related Work} \label{sec:related-lit}

The trade-off between system efficiency and user fairness has been widely studied in applications including resource allocation, reducing the bias of machine-learning algorithms, and influence maximization. While different notions of fairness have been proposed, %in these applications,
the level of fairness is typically controlled through the problem's objective or constraints. For instance, fairness parameters that trade-off the level of fairness in the objective can be tuned to investigate the loss in system efficiency in the context of influence maximization \cite{Rahmattalabi2020FairIM} and resource allocation~\cite{Bertsimas-Eff-Fairness} problems. On the other hand, fairness parameters that bound the degree of allowable inequality between different user groups through the problem's constraints have been proposed to reduce bias towards disadvantaged groups \cite{stoica-seeding}\ifarxiv. For example, group-based fairness notions \cite{yiling-fair-classification} have been studied to reduce the bias of machine-learning algorithms, and diversity constraints have been introduced to ensure that the benefits of social interventions are fairly distributed \cite{Tsang2019GroupFairnessII}. \else, e.g., through group-based or diversity constraints~\cite{yiling-fair-classification,Tsang2019GroupFairnessII}. \fi

In the context of traffic routing, several traffic assignment formulations have been proposed to achieve a balance between multiple performance criteria~\cite{DIAL1996,DIAL1997357}, with a particular focus on fairness considerations in traffic routing~\cite{so-routing-seminal}. Since Jahn et al. \cite{so-routing-seminal} introduced the CSO problem, there have been both theoretical studies~\cite{so-routing-user-constraints} as well as the development of heuristic approaches to solve the NP-hard CSO problem. For instance,~\cite{so-routing-seminal} proposed a Frank-Wolfe based heuristic, \ifarxiv wherein the solution to the linearized CSO problem is obtained by solving a constrained shortest-path problem, \fi \ifarxiv while another work~\cite{BAYRAM2015146} developed a second-order cone programming technique. Several subsequent approaches for CSO have considered linear relaxations of the original problem~\cite{ANGELELLI20161,ANGELELLI2020,ANGELELLI2018234}. \else while others have considered linear relaxations of the original problem~\cite{ANGELELLI20161,ANGELELLI2018234,ANGELELLI2020}. \fi Each of these approaches bounds the level of unfairness in terms of normal lengths of paths by restricting the set of eligible paths on which users can travel to those that meet a specified level of normal unfairness. However, the experienced unfairness in terms of the travel times \ifarxiv on the restricted path set \fi may be much higher than the \ifarxiv specified \fi level of normal unfairness, which is an \emph{a priori} fixed quantity. 

This inherent drawback of the CSO problem in limiting the experienced unfairness in terms of user travel times was overcome by~\cite{ANGELELLI2020105016}, which proposed two Mixed Integer Non-Linear Programming models to capture traffic-dependent notions of unfairness. Their approach to solve these models relies on a linearization heuristic for the edge travel-time functions, which are in general \emph{non-linear}. Achieving a high level of accuracy of the linear relaxations in approximating the true travel-time functions, however, requires solving a large MILP which is computationally \emph{expensive}. Unlike~\cite{ANGELELLI2020105016}, our I-TAP method is computationally \emph{inexpensive}, while directly accounting for non-linear travel-time functions.


A further limitation of the existing methods for fair traffic routing is that there are limited results in providing pricing schemes to induce selfish users to collectively form the proposed traffic patterns, e.g., those satisfying a certain bound on unfairness. For instance,~\cite{marden-parallel} provides tolling mechanisms to enforce fairness constrained flows which applies only \ifarxiv to the simplified model of a parallel network\else to parallel networks\fi. In more general networks,~\cite{lujak-ue-so} proposes an auction-based bidding mechanism for users to be assigned to precomputed paths. However, this approach cannot be applied as-is to our setting as users are unconstrained with respect to a specific path set. \ifarxiv Thus, we develop road tolling mechanisms to induce selfish users to collectively form traffic assignments guaranteeing a specified level of unfairness. \fi


\section{Model and Problem Definition} \label{sec:model}
We model the road network as a directed graph $G = (V, E)$, with the vertex and edge sets $V$ and $E$, respectively. Each edge $e \in E$ has a normal length $\eta_e$, 
\ifarxiv 
which represents a fixed quantity such as the physical length of the corresponding road segment, \fi 
and a flow-dependent travel-time function $t_e: \mathbb{R}_{\geq 0} \rightarrow \mathbb{R}_{> 0}$, which maps $x_e$, the rate of traffic on edge $e$, to the travel time $t_e(x_e)$. 
%\ifarxiv 
As is standard in the traffic routing literature, we
%\else
%We 
%\fi  
assume that the function~$t_e$, for each $e \in E$, is differentiable, convex, locally Lipschitz continuous, and monotonically increasing.

Users make trips between a set of O-D pairs, and we model users with the same origin and destination as one commodity, where $K$ is the set of all commodities. Each commodity $k \in K$ has a demand rate $d_k>0$, which represents the amount of flow to be routed on a set of directed paths $\mathcal{P}_k$ between its origin and destination. 
\ifarxiv 
Here $\mathcal{P}_k$ is the set of all possible paths between the origin and destination corresponding to commodity $k$. 
\fi 
The edge flow of each commodity $k$ is given by $\x^k = \{x_e^k\}_{e\in E}$, while the aggregate edge flow of all commodities is denoted as $\mathbf{x}:=\{x_e\}_{e\in E}$. For an edge flow $\mathbf{x}:=\{x_e\}_{e\in E}$ and a path $P \in \P = \cup_{k \in K} \mathcal{P}_k$, the amount of flow routed on the path is denoted as $\mathbf{x}_P$, where the vector of path flows $\f = \{\mathbf{x}_P: P \in \P \}$. Then, the travel time on path $P$ is $t_P(\mathbf{x}) = \sum_{e \in P} t_e(x_e)$, while $\eta_P = \sum_{e \in P} \eta_e$ is its normal length. 

%Since the collection of possible path decompositions of the edge flows may be non-unique, we let the collection of all possible path decompositions of commodity $k$ be $\mathbb{P}_k(\x)$.

%For a flow $\mathbf{x}:=\{x_e\}_{e\in E}$  let the collection of all possible path decompositions of commodity $k$ be $\mathbb{P}_k(\x)$, and for a given path decomposition $\{P_k(\x)\}_{k \in K} \in \{\mathbb{P}_k(\x)\}_{k \in K}$ let $\mathbf{x}_P$ be the realized flow on a path $P \in \cup_{k \in K} \mathcal{P}_k$. The travel time on the path is path $P$ is $t_P(\mathbf{x}) = \sum_{e \in P} t_e(x_e)$, while $\eta_P = \sum_{e \in P} \eta_e$ is its normal length.

%and a path $P \in \cup_{k \in K} \mathcal{P}_k$, the amount of flow routed on the path is denoted as $\mathbf{x}_P$ and the travel time on the path is $t_P(\mathbf{x}) = \sum_{e \in P} t_e(x_e)$, while $\eta_P = \sum_{e \in P} \eta_e$ is its normal length.

We assume users are selfish and thus choose paths that minimize their total travel cost that is a linear function of tolls and travel time. For a value of time parameter $v>0$, and a vector of edge prices (or tolls) $\boldsymbol{\tau} = \{\tau_e\}_{e \in E}$, the travel cost on a given path $P$ under the traffic assignment $\x$ is given by $C_{P}(\x, \boldsymbol{\tau}) = v t_P(\mathbf{x}) + \sum_{e \in P} \tau_e$.

\subsection{Traffic Assignment}
%\ifarxiv
In this work we will consider several variants of the traffic assignment problem (TAP). The goal of the SO traffic assignment problem (SO-TAP) is to route users to minimize the total system travel time. This behavior is captured in the following convex program:

\begin{definition}[Program for SO-TAP \cite{Sheffi1985}] \label{def:so-tap}
\begin{mini!}|s|[2]<b>
	{\f }{\objso(\mathbf{x}):=\sum_{e \in E} x_e t_e(x_e), \label{eq:so-obj}} %\substack{x_{P}, \forall P \in \mathcal{P}_k, \\ \forall k \in K}}
	{}
	{}
	\addConstraint{\sum_{k \in K} \sum_{P \in \mathcal{P}_k: e \in P} \mathbf{x}_P}{= x_e, \quad \forall e \in E \label{eq:edge-constraint},}
	\addConstraint{\sum_{P \in \mathcal{P}_k} \mathbf{x}_P}{= d_k, \quad \forall k \in K \label{eq:demand-constraint},}
	\addConstraint{\mathbf{x}_P}{ \geq 0, \quad \forall P \in \P \label{eq:nonnegativity-constraints},}
\end{mini!}
with edge flow Constraints~\eqref{eq:edge-constraint}, demand Constraints~\eqref{eq:demand-constraint}, and non-negativity
Constraints~\eqref{eq:nonnegativity-constraints}.
\end{definition}
%\else
\begin{comment}
In this work we will consider several variants of the traffic assignment problem (TAP). The goal of the SO traffic assignment problem (SO-TAP) is to route users to minimize the total system travel time. This behavior is captured in the following convex program:
\begin{definition}[Program for SO-TAP \cite{Sheffi1985}] \label{def:so-tap}
\begin{mini!}|s|[2]<b>
	{\f \in \Omega}{\objso(\mathbf{x}):=\sum_{e \in E} x_e t_e(x_e), \label{eq:so-obj}} %\substack{x_{P}, \forall P \in \mathcal{P}_k, \\ \forall k \in K}}
	{}
	{}
\end{mini!}
where $\f = \{\mathbf{x}_P: P \in \cup_{k \in K} \mathcal{P}_k  \}$ and $\Omega$ is the set of non-negative flows satisfying edge flow constraints, i.e., $\sum_{k \in K} \sum_{P \in \mathcal{P}_k: e \in P} \mathbf{x}_P = x_e$ for all $e \in E$, and demand constraints, i.e., $\sum_{P \in \mathcal{P}_k} \mathbf{x}_P = d_k$ for all $k \in K$.
\end{definition}
\end{comment}
We mention that the total travel time objective is only a function of the aggregate edge flow $\x$, which is related to the path flow $\f$ through Constraint~\eqref{eq:edge-constraint}. Note for any given path flow $\f$ that both the edge flow $\x$ and the commodity-specific edge flows $\x^k$ for each commodity $k \in K$ are uniquely defined.

%\fi

\ifarxiv
Closely related to SO-TAP is the UE traffic assignment problem (UE-TAP) that emerges from the selfish behavior of users, where each user strives to minimize its own travel time, without regard to the effect that it has on the overall travel time of all the users in the system. This behavior is captured through the following convex program:
\else
Closely related is the UE traffic assignment problem (UE-TAP) that emerges from the selfish behavior of users that minimize their own travel time, and is described by the following convex program:
\fi
%\ifarxiv
\begin{definition}[Program for UE-TAP \cite{Sheffi1985}]
\begin{mini!}|s|[2]<b>
	{\f}{\objue(\mathbf{x}):=\sum_{e\in E}\int_{0}^{x_e} t_e(y) \dd{y}, \label{eq:ue-obj}}
	{}
	{}
	\addConstraint{~\eqref{eq:edge-constraint}}{-\eqref{eq:nonnegativity-constraints}.}
\end{mini!}
\end{definition}
%\else
\begin{comment}
\begin{definition}[Program for UE-TAP \cite{Sheffi1985}]
\begin{mini!}|s|[2]<b>
	{\f \in \Omega}{\objue(\mathbf{x}):=\sum_{e\in E}\int_{0}^{x_e} t_e(y) \dd{y}, \label{eq:ue-obj}}
	{}
	{}
\end{mini!}
\end{definition}
\end{comment}

%\fi
While the integral objective used to define UE-TAP has not found a clear economic or behavioral interpretation within the transportation and game-theory communities~\cite{Sheffi1985}, the optimal solution of UE-TAP corresponds to an equilibrium, which can be seen through the KKT conditions of this optimization problem. That is, UE-TAP provides a polynomial time computable method to determine the user equilibrium flows. A defining property of the UE solution is that it is fair for all users since the travel time of all the flow that is routed between the same O-D pair is equal. In contrast, at the SO solution the sum of the travel time and marginal cost of travel is the same for all users travelling between the same O-D pair. Thus, marginal cost pricing is used to induce selfish users to collectively form the SO traffic pattern. While the number of constraints, which depend on the path sets $\mathcal{P}_k$, can be exponential in the size of the transportation network, both SO-TAP and UE-TAP are efficiently computable since they can be formulated without explicitly enumerating all the path level flows and constraints~\cite{Sheffi1985}.

\subsection{Fairness and Efficiency Metrics} \label{sec:fair-eff-metric}
\ifarxiv
We evaluate the quality of any given traffic assignment $\x$, which satisfies Constraints~\eqref{eq:edge-constraint}-\eqref{eq:nonnegativity-constraints}, using two metrics, namely: (i) efficiency, which is of importance to a traffic authority as well as all users collectively, and (ii) fairness, which is of direct importance to each user.
\else
We evaluate the quality of any traffic assignment $\x$ using two metrics, namely: (i) efficiency and (ii) fairness.
\fi

We evaluate the efficiency of a traffic assignment by comparing its total travel time to that of the SO edge flow $\mathbf{x}^{SO}$. Recalling that $\objso(\mathbf{x})$ denotes the total travel time of the edge flow $\mathbf{x}$, %. Then, letting $\mathbf{x}^{SO}$ be the SO solution, 
the \textit{inefficiency ratio} of $\mathbf{x}$ is
\ifarxiv 
\begin{equation}
    \rho(\mathbf{x}) := \frac{\objso(\mathbf{x})}{\objso(\mathbf{x}^{SO})}.
\end{equation}
\else
$\rho(\mathbf{x}) := \frac{\objso(\mathbf{x})}{\objso(\mathbf{x}^{SO})}$.
\fi 
Note that for the UE solution $\mathbf{x}^{UE}$, the inefficiency ratio is the Price of Anarchy  
\ifarxiv 
(PoA)~\cite{worst-case-equilibria}, which we denote as~$\Bar{\rho}$.
\else
(PoA)~\cite{worst-case-equilibria}.
\fi  




To evaluate the fairness of a traffic assignment, we first introduce the notion of a \textit{positive path} from \cite{basu2017reconciling}.
\begin{definition} [Positive Path]
For any path flow $\f$ with corresponding commodity-specific edge flows $\x^k$, a path $P \in \mathcal{P}_k$ is positive for a commodity $k \in K$ if for all edges $e \in P$, $x_e^k$ is strictly positive. The set of all positive paths for a flow $\f$ and commodity $k$ is denoted as $\mathcal{P}_{k}^{+}(\f) = \{P:P \in \mathcal{P}_k, x_e^k>0, \text{ for all } e \in P \}$.
\end{definition}
The importance of the notion of a positive path is that the path decomposition of the commodity-specific edge flows $\x^k$ may be non-unique; however the set of positive paths is always uniquely defined for such edge flows. That is, for commodity specific edge flows $\x^k$ the set of positive paths for any two path decompositions $\f_1$ and $\f_2$ are equal, i.e., $\mathcal{P}_{k}^{+}(\f_1) = \mathcal{P}_{k}^{+}(\f_2)$.

We evaluate the fairness of a traffic flow $\f$ with an edge decomposition $\x$ %traffic assignment $\x$ 
through its corresponding unfairness $U$, which is defined as the maximum ratio across all O-D pairs of (i) the %experienced 
travel time on the slowest, i.e., highest travel time, positive path to (ii) the travel time on the fastest positive path between the same O-D pair\ifarxiv:
\begin{align*}
    U(\f) := \max_{k \in K} \max_{Q, R \in \P_k^{+}} \frac{t_Q(\x)}{t_R(\x)}%\!:\! Q, R\! \in\! \P_k^{+} 
    .
\end{align*}
\else
, i.e., $U(\f) := \max_{k \in K}  \max_{Q, R \in \P_k^{+}} \frac{t_Q(\x)}{t_R(\x)}$.
\fi
That is, $U(\f)$ returns the maximum possible ratio of travel times on positive paths across all commodities with respect to the path flow $\f$. As a result, the unfairness $U$ is a number between one and infinity, and a traffic assignment has a high level of fairness if its unfairness is close to one while it has a low level of fairness if the corresponding unfairness is much larger than one. \ifarxiv A discussion on numerically computing the above defined notion of unfairness is presented in Section~\ref{sec:numerical-experiments}. In contrast, other valid notions of unfairness %that depend on the specific path flows of users 
could also be considered. For instance, for a given path flow decomposition $\f$ with a corresponding edge flow $\x$, the unfairness $\Tilde{U}(\cdot)$ of the path flows can be evaluated as the maximum ratio between the travel times of any two users travelling between the same O-D pair, i.e., $\Tilde{U}(\f) = \max_{k \in K}  \max_{Q, R \in \P_k: \x_Q, \x_R>0} \frac{t_Q(\x)}{t_R(\x)} $. Note here that we only consider a ratio of travel times on paths with strictly positive flow for the path decomposition $\f$ rather than the ratio of travel times for all positive paths. We defer a detailed treatment of path-based unfairness measures to \ifarxiv Appendix~\ref{apdx:general-unfairness} \else Appendix F \fi and highlight here some key features of the positive path based unfairness measure $U$. 

%\fi Note that this notion of unfairness is an upper bound on the ratio of travel times for any two users travelling between the same O-D pair under any possible path decomposition of the flow $\x$. \ifarxiv The advantage of an approach that aims to compute the ratio of travel times for all positive paths is that it is agnostic to the specific path decomposition of the flow $\x$. Thus, the level of unfairness is defined to be a property of the unique edge flow rather than its numerous possible path decompositions. \fi In contrast, other valid notions of unfairness that depend on the specific path flows of users could also be considered. For instance, for a given path flow decomposition $\f$ of an edge flow $\x$, the unfairness $\Tilde{U}(\cdot)$ of the path flows can be evaluated as the maximum ratio between the travel times of any two users travelling between the same O-D pair, i.e., $\Tilde{U}(\f) = \max_{k \in K}  \max_{Q, R \in \P_k: \x_Q, \x_R>0} \frac{t_Q(\x)}{t_R(\x)} $. Note here that we only consider a ratio of travel times on paths with strictly positive flow for the path decomposition $\f$ rather than the ratio of travel times for all positive paths. We defer a detailed treatment of path-based unfairness measures to \ifarxiv Appendix~\ref{apdx:general-unfairness} \else Appendix F \fi and highlight here some key differences between edge and path-based unfairness measures. 

The unfairness measure $U(\f)$ can be efficiently computed and has the benefit that it applies to all possible path decompositions of the commodity specific edge flows $\x^k$. As a result, in the context of a single O-D pair travel demand, the unfairness measure $U(\f)$ has the benefit that it is a property of the unique edge flow $\x$ and is relevant when users are not constrained to a specific path decomposition, as happens in practice. In contrast, path decomposition specific unfairness measures, e.g., $\Tilde{U}(\f)$, are likely to be more sensitive to the method used to compute the path decomposition. Furthermore, we note that the positive path based unfairness notion serves as an upper bound on the ratio of travel times for any two users travelling between the same O-D pair for the path flow $\f$, i.e., $\Tilde{U}(\f) \leq U(\f)$ for all $\f$. As a result, our theoretical bounds on unfairness obtained for the positive path-based unfairness notion will naturally extend to path decomposition specific unfairness measures such as $\Tilde{U}(\f)$. Thus, in the rest of this paper we focus on the positive path-based unfairness measure and, for numerical comparison, we present other path decomposition specific unfairness measures, e.g., $\Tilde{U}(\f)$, in Appendix~\ref{apdx:general-unfairness}.

%First, the edge-based unfairness measure ($U(\x)$) can be efficiently computed (see Section~\ref{sec:numerical-experiments}) and has the benefit that it applies to any path decomposition, i.e., it is a property of the unique edge flow. As a result, this unfairness measure is relevant when users are not constrained to a specific path decomposition, as happens in practice. Furthermore, since this unfairness notion only depends on edge flows, tolls that induce edge flows satisfying a given bound on unfairness will be guaranteed to result in a path decomposition with a maximum ratio of travel times that is no more than the above level of unfairness. In contrast, path-based unfairness measures are relevant when users are guaranteed to use a specific path set, e.g., those dictated by a traffic navigational system. Unlike the edge-based unfairness measure that upper bounds the ratio of user travel times, path-based measures exactly characterize the unfairness for the realized path flow. However, in general, one cannot make strict theoretical claims on the efficacy of an algorithm for path-based measures, since these unfairness notions are likely to be very sensitive to the method used to compute the path decomposition. 

%Having noted the merits and limitations of both edge and path based unfairness metrics, in the rest of this paper we focus on the edge-based unfairness notion introduced above. We do so since we consider the setting when users are not restricted to use a specified path set and instead tolls serve as the mechanism to steer selfish users towards collectively enforcing flows that guarantee a specified level of unfairness. However, for numerical comparison, we present path decomposition based unfairness measures \ifarxiv and evaluate the trade-off between efficiency and fairness for a given path decomposition \fi in \ifarxiv Appendix~\ref{apdx:general-unfairness}\else Appendix F\fi. 

%From the above discussion, we observe that both edge and path based unfairness metrics have their own merits and limitations. In the rest of this paper, we focus on the edge based unfairness notion introduced above since we consider the setting when users are not restricted to use a specified path set and instead tolls serve as the mechanism to steer selfish users towards collectively enforcing flows that guarantee a specified level of unfairness. However, for numerical comparison, we present path decomposition based unfairness measures \ifarxiv and evaluate the trade-off between efficiency and fairness for a given path decomposition \fi in \ifarxiv Appendix~\ref{apdx:general-unfairness}\else Appendix F\fi. 

%We finally note that since the unfairness notion only depends on the edge flows, rather than the path flows, tolls that induce the edge flows satisfying a given bound on unfairness will be guaranteed to result in a path decomposition with a maximum ratio of travel times between two users that is no more than the above level of unfairness.


%\begin{definition} (Used Path)
%For any flow $\x$, a path $P \in \mathcal{P}$ is said to be used for commodity $k \in K$ if for all edges $e \in P$, $x_e>0$. The set of all positive paths for a flow $\x$ and commodity $k$ is denoted as $\mathcal{P}_{k}^{+}(\x) = \{P:P \in \mathcal{P}_k, x_e>0 \forall e \in P \}$.
%\end{definition}



\subsection{Toy Network Example} \label{sec:toy-network}

To illustrate the fairness and efficiency properties of the two optimization problems, SO-TAP and UE-TAP, studied in this work, we present a toy example of a two-edge Pigou network, as depicted in Figure~\ref{fig:toy}. In particular, consider a demand of one that needs to be routed from the origin $v_1$ to the destination $v_2$, with two edges ($e_1$ and $e_2$) connecting the origin to the destination. Observe that if the travel time functions on the two edges are given by $t_1(x_1) = 1$ and $t_2(x_2) = x_2$, then under the UE-TAP solution all users will be routed on edge two, while the SO-TAP solution that minimizes the total travel time will route $0.5$ units of flow on both edges. The level of unfairness and the total travel time of the two traffic assignments are presented in the following table, which indicates that the UE-TAP solution is fair but inefficient while the SO-TAP solution is efficient but unfair.

%This results in an unfairness of two for the SO-TAP solution as compared to an unfairness of one for the UE-TAP solution.


\begin{figure}[!h] 
    \begin{minipage}{0.4\linewidth}
		\centering
		\includegraphics[width=60mm]{Fig/toyExample2.png}
		%\captionof{figure}{2-D scatterplot of the Student Database}
		%\label{ }
	\end{minipage} \hspace{15pt}
	\begin{minipage}{0.5\linewidth}
		%\caption{To}
		\small
		\label{table:student}
		\centering
		\begin{tabular}[b]{lcc}\hline
      & UE-TAP & SO-TAP  \\ \hline
      Total Travel Time & 1 & $3/4$ \\
      Unfairness & 1 & 2 \\ \hline
    \end{tabular}
	\end{minipage}\hfill
	%\vspace{-15pt}
	%\captionsetup{labelformat=andfigure}
	%\captionsetup{labelformat=andtable}
	\caption{A two-edge Pigou network example to illustrate the fairness and efficiency properties of the SO-TAP and UE-TAP optimization problems. For a demand of one, the UE-TAP solution routes all the flow on edge $e_2$ resulting in a fair solution but a total travel time of one. On the other hand, the SO-TAP solution routes $0.5$ units of flow on both edges, resulting in an efficient solution with the minimum total travel time, but an unfair solution with an unfairness of two.} 
	\label{fig:toy}
  \end{figure}




\subsection{$\beta$-Fair System Optimum} \label{sec:beta-so}

\ifarxiv
Our focus in this work is in solving the following problem where we impose an upper bound on the maximum allowable level of unfairness in the network. In particular, for an unfairness parameter $\beta \in [1, \infty)$, any feasible path flow $\f$ must satisfy $U(\f) \leq \beta$. To trade-off between user fairness and system efficiency, we consider the following $\beta$-fair System Optimum (\fso) problem.
\else
To trade-off between user fairness and system efficiency, we consider the following $\beta$-fair System Optimum (\fso) problem, wherein we impose an upper bound $\beta \in [1, \infty)$ on the maximum allowable unfairness in the network, i.e., $U(\mathbf{x}) \leq \beta$ for a traffic assignment $\x$.
\fi

%\ifarxiv
\begin{definition}[Program for $\beta$-Fair System Optimum]
\begin{mini!}|s|[2]<b>
	{\f }{\sum_{e \in E} x_e t_e(x_e), \label{eq:efficient-Obj}}
	{\label{eq:Example3}}
	{}
	\addConstraint{~\eqref{eq:edge-constraint}}{-\eqref{eq:nonnegativity-constraints},}
	\addConstraint{U(\f)}{ \leq \beta \label{eq:unfairness-constraints}.}
\end{mini!}
\end{definition}
%\else
\begin{comment}
\begin{definition}[Program for $\beta$-Fair System Optimum]
\begin{mini!}|s|[2]<b>
	{\f \in \Omega}{\sum_{e \in E} x_e t_e(x_e), \label{eq:efficient-Obj}}
	{\label{eq:Example3}}
	{}
	\addConstraint{U(\mathbf{x})}{ \leq \beta \label{eq:unfairness-constraints}.}
\end{mini!}
\end{definition}
\end{comment}

%\fi

Note that without the unfairness Constraints~\eqref{eq:unfairness-constraints} (or when $\beta=\infty$), the above problem exactly coincides with SO-TAP. Furthermore, the \fso problem is always feasible for any $\beta \in [1, \infty)$, since a solution to UE-TAP exists and achieves an unfairness of $\beta = 1$.

We also note that the difference between the \fso and CSO problems is in the unfairness Constraints~\eqref{eq:unfairness-constraints}. While the \fso problem explicitly imposes an upper limit on the ratio of travel times on positive paths, the CSO problem imposes normal unfairness constraints for each path $P \in \mathcal{P}_k$ and any commodity $k \in K$ of the form $\eta_P \leq \phi \min_{P^* \in \mathcal{P}_k} \eta_{P^*}$ for some normal unfairness parameter $\phi\geq 1$. That is, the CSO problem minimizes the total travel time subject to flow conservation constraints over the set of paths with a normal unfairness level of at most~$\phi$. \ifarxiv The authors of \cite{so-routing-seminal} use normal unfairness, which is a fixed quantity, as a proxy to limit the maximum possible ratio of user travel times. Note that the experienced user travel times accounts for costs that vary according to a traffic assignment unlike normal unfairness. \else The authors of \cite{so-routing-seminal} use normal unfairness, which is a fixed quantity, as a proxy to limit the ratio of user travel times, which vary according to a traffic assignment. \fi

The optimal solution of the \fso problem corresponds to the highest achievable system efficiency whilst meeting unfairness constraints. However, solving \fso directly is generally intractable as the unfairness Constraints~\eqref{eq:unfairness-constraints} are non-convex if the travel time function is non-linear. Moreover, since the unfairness metric studied in this work accounts for user costs that vary according to a traffic assignment, unlike normal unfairness that is an apriori fixed quantity, the NP-hardness of the CSO problem \cite{so-routing-seminal} suggests the computational hardness of \fso \cite{basu2017reconciling,ANGELELLI2020105016}.

Finally, we mention that we consider a setting wherein the travel demand is time invariant and fractional user flows are allowed, as is standard in the traffic routing literature. Also, for notational simplicity, we consider for now a model where all users are homogeneous, i.e., they have an identical value of time $v$, and present an extension of our pricing result to the setting of heterogeneous users in Section~\ref{sec:pricing-heterogeneous}. %\color{blue}
%We note that other notions of unfairness of a traffic assignment could also be used that are based on the realized path decomposition. In general, one cannot make strict theoretical claims on the efficacy of an algorithm for such unfairness measures, since these unfairness notions are likely to be very sensitive to the methodology used to compute the path decomposition. However, for numerical comparison, we present some other unfairness measures \ifarxiv and evaluate the trade-off between efficiency and fairness for a given path decomposition \fi in \ifarxiv Appendix~\ref{apdx:general-unfairness}\else Appendix G\fi. 
%\color{black}


\section{A Method for $\beta$-Fair System Optimum} \label{sec:itap-main}
In this section, we develop a computationally-efficient method for solving \fso with edge-based unfairness constraints, to achieve a traffic assignment with a low total travel time, whose level of unfairness is at most $\beta$. In particular, we propose a new formulation of TAP, which we term interpolated TAP (or I-TAP), wherein the objective function linearly interpolates between the objectives of UE-TAP and SO-TAP. Our main insight is that the UE solution achieves a high level of fairness, whereas the SO solution achieves a low total travel time, and we wish to get the best of both worlds---high level of fairness at a low total travel time. 


%Furthermore, there is a key aspect of the above defined unfairness measures that makes the I-TAP a particularly natural approach for balancing efficiency and fairness. In particular, for each of the above defined unfairness notions, the user equilibrium achieves the highest possible level of fairness, while the system optimum achieves the lowest total travel times. Thus, interpolating between the UE and SO objectives can potentially achieve the best of both worlds, i.e., a low total travel time with a high level of fairness.

In this section, we describe the I-TAP method and evaluate its efficacy for the \fso problem by addressing three key concerns regarding the solution efficiency, feasibility and computational tractability. In particular, we establish a relationship between I-TAP and \fso through theoretical bounds on the inefficiency ratio (Section~\ref{sec:eff-properties}) and its optimality for two-edge Pigou networks (Section~\ref{sec:optimality}). We also establish the feasibility of I-TAP for \fso by finding the range of values of the interpolation parameter such that the unfairness of the optimal I-TAP solution is guaranteed to be less than $\beta$ (Section~\ref{sec:eff-properties}). Finally, we present an equivalence between I-TAP and UE-TAP to show that I-TAP can be computed efficiently (Section~\ref{sec:compTractability}). These results indicate that we can approximate \fso as an unconstrained traffic assignment problem that can be solved quickly. We also mention that we perform a sensitivity analysis to establish the continuity of the optimal traffic assignment and its total travel time in the interpolation parameter of I-TAP in \ifarxiv Section~\ref{sec:solution-properties}\else Appendix B\fi.

%In the remainder of this section we describe the I-TAP method, \ifarxiv discuss its solution properties,  including computational tractability and solution continuity, \fi develop \ifarxiv theoretical \fi bounds on the inefficiency ratio and unfairness level in terms of the convex combination parameter of I-TAP and establish I-TAP's optimality for a two edge Pigou network. 

%We evaluate the efficacy of the solution~$\x(\alpha)$ for the \fso problem by addressing three key concerns regarding the solution efficiency, feasibility and computational tractability. In particular, we establish a relationship between I-TAP and \fso through theoretical bounds on the inefficiency ratio (Section~\ref{sec:eff-properties}) and its optimality for two edge Pigou networks (Section~\ref{sec:optimality}). We also establish the feasibility of I-TAP for \fso by finding the range of values of the convex combination parameter such that the unfairness of the flow~$\x(\alpha)$ is guaranteed to be less than $\beta$ (Section~\ref{sec:eff-properties}). Finally, we present an equivalence between I-TAP and UE-TAP to show that I-TAP can be computed efficiently for any $\alpha \in [0, 1]$ (Section~\ref{sec:compTractability}). These results indicate that we can approximate \fso as an unconstrained traffic assignment problem that can be solved quickly.

%solution properties, including computational tractability and an upper bound on the inefficiency ratio.

\subsection{Interpolated Traffic Assignment} \label{sec:algos}

We provide a formal definition of interpolated TAP:

\begin{definition} [I-TAP] \label{def:interpolated-TAP}
For a convex combination parameter $\alpha \in [0, 1]$, the interpolated traffic assignment problem, denoted as I-TAP$_{\alpha}$, is given by:
%\ifarxiv
\begin{mini!}|s|[2]<b>
	{\f}{\objitap(\x) := \alpha \objso(\x) + (1-\alpha) \objue(\x), \label{eq:interpolated-TAP-Obj}}
	%\substack{x_{P}, \forall P \in \mathcal{P}_k, \\ \forall k \in K}}{\alpha \objso(\x) + (1-\alpha) \objue(\x) \label{eq:interpolated-TAP-Obj}}
	{}
	{}
	\addConstraint{~\eqref{eq:edge-constraint}}{-\eqref{eq:nonnegativity-constraints}. \label{eq:interpolated-TAP-all-constraints}}
\end{mini!}
%\else
\begin{comment}
\begin{mini!}|s|[2]<b>
	{\f \in \Omega}{\objitap(\x) := \alpha \objso(\x) + (1-\alpha) \objue(\x), \label{eq:interpolated-TAP-Obj}}
	%\substack{x_{P}, \forall P \in \mathcal{P}_k, \\ \forall k \in K}}{\alpha \objso(\x) + (1-\alpha) \objue(\x) \label{eq:interpolated-TAP-Obj}}
	{}
	{}
\end{mini!}
\end{comment}
%\fi
\end{definition}

A few comments are in order. First, it is clear that I-TAP$_0$ and I-TAP$_1$ correspond to UE-TAP and SO-TAP, respectively. Next, under the assumption that the travel time functions are strictly convex, we observe that for any $\alpha\in [0,1]$ the program I-TAP$_\alpha$ 
\ifarxiv 
has a strictly convex objective with linear constraints, and so I-TAP$_\alpha$ 
\fi 
is a convex optimization problem with a unique edge flow solution~$\x(\alpha)$.



For numerical implementation purposes, we propose a \emph{dense sampling} procedure to compute a solution for \fso with a low total travel time while guaranteeing a $\beta$ bound on unfairness.
\ifarxiv
\paragraph{Algorithm for Computation of Optimal Interpolation Parameter} 
To compute a good solution for \fso, we evaluate the optimal solution $\f(\alpha)$ of I-TAP$_\alpha$ (with corresponding edge flows $\x(\alpha)$) for $\alpha$ taken from a finite set $\A_s:=\{0,s,2s,\ldots,1\}$ for some step size $s\in (0,1)$. That is, in $O(\frac{1}{s})$ computations of I-TAP, we can return the path flow $\f(\alpha^*)$ (with unique edge decomposition $\mathbf{x}(\alpha^*)$), for some %parameter 
$\alpha^* \in \A_s$, with the lowest total travel time that is at most $\beta$-unfair, i.e., $U(\mathbf{f}(\alpha^*)) \leq \beta$, and the value $\objso(\x(\alpha^*))$ is minimized.
\else
In particular, to compute a good solution for \fso, we evaluate the optimal solution $\x(\alpha)$ of I-TAP$_\alpha$ for $\alpha$ taken from a finite set $\A_s:=\{0,s,2s,\ldots,1\}$ for some step size $s\in (0,1)$. That is, in $O(\frac{1}{s})$ computations of I-TAP, we can return the traffic assignment $\mathbf{x}(\alpha^*)$, for some %parameter 
$\alpha^* \in \A_s$, with the lowest total travel time that is at most $\beta$-unfair, i.e.,  $ U(\mathbf{x}(\alpha^*)) \leq \beta$, and the value $\objso(\x(\alpha^*))$ is minimized.
\fi

We observe experimentally (Section~\ref{sec:numerical-results}) that this method of computing the I-TAP solution \ifarxiv for a finite set of convex combination parameters \fi achieves a good solution for \fso in terms of fairness and total travel time. We note here that our approach also naturally extends to other unfairness notions wherein the user equilibrium achieves the highest possible level of fairness, while the system optimum achieves the lowest total travel times (see \ifarxiv Appendix~\ref{apdx:general-unfairness}\else Appendix F\fi). Finally, we restrict $\alpha$ to lie in the finite set $\A_s$ since the exact functional form of the optimal solution $\f(\alpha)$ (with edge flow $\x(\alpha)$), and thus the unfairness $U(\f(\alpha))$ and the total travel time $\objso(\f(\alpha))$ functions, in $\alpha$ is not directly known, though we show that $\x(\alpha)$ and $\objso(\x(\alpha))$ are continuous %with respect to 
in $\alpha$ in Section~\ref{sec:solution-properties}.
\ifarxiv \else Finally, we restrict $\alpha$ to lie in the finite set $\A_s$ since the exact functional form of the optimal solution $\x(\alpha)$, and thus the unfairness $U(\x(\alpha))$ and the total travel time $\objso(\x(\alpha))$ functions, in $\alpha$ is not directly known, though we show that  $\x(\alpha)$ and $\objso(\x(\alpha))$ are continuous %with respect to 
in $\alpha$ in Appendix B. 





\fi 

We also test (Section~\ref{sec:numerical-experiments}) an alternative approach to I-TAP, which instead of taking a convex combination of the SO-TAP and UE-TAP objectives, interpolates between their solutions. That is, we first compute the optimal solutions of UE-TAP ($\x^{UE}$) and SO-TAP ($\x^{SO}$), and return the value $(1-\gamma) \x^{UE} + \gamma \x^{SO}$ for $\gamma \in [0,1]$. While this Interpolated Solution (I-Solution) method only requires two traffic assignment computations as compared to $O(\frac{1}{s})$ computations of the I-TAP method, it leads to poor performance in comparison with the I-TAP method (see Section~\ref{sec:numerical-experiments}) and does not induce a natural marginal-cost pricing scheme, as I-TAP does (see Section~\ref{sec:main-pricing}). Thus, we focus our attention on I-TAP for this and the next sections.




\subsection{Solution Efficiency and Fairness of I-TAP} \label{sec:eff-properties}

In this section, we study the influence of the convex combination parameter $\alpha$ of I-TAP on the efficiency and fairness of the optimal solution $\f(\alpha)$ (and edge flow $\x(\alpha)$). In particular, we characterize (i) an upper bound on the inefficiency ratio as we vary $\alpha$, and (ii) a range of values of $\alpha$ that are guaranteed to achieve a specified level of unfairness $\beta$ for any optimal solution $\f(\alpha)$.

%Since I-TAP is parametrized by the convex combination parameter $\alpha$, it is instructive to study the influence of this parameter on both the efficiency and fairness of the resulting optimal solution $\x(\alpha)$. In this section, we characterize (i) an upper bound on the inefficiency ratio as we vary $\alpha$, and (ii) a range of values of $\alpha$ that are guaranteed to achieve a specified level of unfairness $\beta$.
\ifarxiv
We first evaluate the performance of I-TAP by establishing an upper bound on the inefficiency ratio as a function of $\alpha$. Theorem~\ref{thm:eff-upper-bound} shows that the upper bound of the inefficiency ratio $\rho(\x(\alpha))$ of the optimal traffic assignment of I-TAP$_{\alpha}$ is the minimum between two terms: (i) the Price of Anarchy (PoA) $\Bar{\rho}$, and (ii) a more elaborate bound that is monotonically non-increasing in $\alpha$.
\else
We first evaluate the performance of I-TAP by establishing an upper bound on the inefficiency ratio of the optimal solution of I-TAP$_{\alpha}$ as a function of $\alpha$. Theorem~\ref{thm:eff-upper-bound} shows that this bound is a minimum between (i) the PoA, which we denote as~$\Bar{\rho}$, and (ii) a more elaborate bound that is monotonically non-increasing in $\alpha$.
\fi

\begin{theorem} [I-TAP Solution Efficiency] \label{thm:eff-upper-bound}
For any $\alpha \in (0, 1)$, let $\x(\alpha)$ be the optimal solution to I-TAP$_{\alpha}$. Then, the inefficiency ratio
\[\rho(\x(\alpha))\!\leq\!\min\!\left\{ \Bar{\rho},1\!+\! \frac{1-\alpha}{\alpha}\!\cdot\! \frac{\objue(\x(1))\!-\!\objue(\x(0))}{\objso(\x(1))} \right\}.\]
\end{theorem}

\begin{proof}
To prove this result, we show that (i) $\rho(\x(\alpha)) \leq \Bar{\rho}$ and (ii) $\rho(\x(\alpha)) \leq 1+ \frac{1-\alpha}{\alpha} \frac{\objue(\x(1)) - \objue(\x(0))}{\objso(\x(1))}$.

\ifarxiv
We first prove (i) by establishing that $\objso(\x(\alpha)) \leq \objso(\x(0))$ for all $\alpha \in [0, 1]$. Since $\mathbf{x}(\alpha)$ is the optimal solution to I-TAP$_{\alpha}$
\ifarxiv
\begin{align*}
    \objitap(\x(\alpha)) & = \alpha\objso(\x(\alpha)) + (1-\alpha)\objue(\x(\alpha))\\
    & \leq \objitap(\x(0)) \\
    & =  \alpha\objso(\x(0)) + (1-\alpha)\objue(\x(0)).
\end{align*}
\else
\begin{align*}
    \objitap(\x(\alpha)) & = \alpha\objso(\x(\alpha)) + (1-\alpha)\objue(\x(\alpha))\\
    & \leq \objitap(\x(0)) =  \alpha\objso(\x(0)) + (1-\alpha)\objue(\x(0)),
\end{align*}
\fi
\else
We first prove (i) by establishing that $\objso(\x(\alpha)) \leq \objso(\x(0))$ for all $\alpha \in [0, 1]$. Since $\objitap(\x(\alpha)) \leq \objitap(\x(0))$ it follows that $\alpha\objso(\x(\alpha)) + (1-\alpha)\objue(\x(\alpha)) \leq  \alpha\objso(\x(0)) + (1-\alpha)\objue(\x(0))$.
\fi
%where $x_{e}^{a}:=\x_e(a)$ denotes the flow on edge $e$ under the traffic assignments $\mathbf{x}(a)$ for some $a\in [0,1]$. 
Next from the UE-TAP objective, it is the case that 
\ifarxiv
\[\objue(\x(0))\leq \objue(\x(\alpha)).\] 
\else
$\objue(\x(0))\leq \objue(\x(\alpha)).$
\fi
From these two inequalities, it follows that $\objso(\mathbf{x}(\alpha)) \leq \objso(\mathbf{x}(0))$ for all $\alpha \in [0, 1]$. Dividing both sides of the inequality by the minimum possible system travel time $\objso(\x(1))$ establishes that the inefficiency ratio $\rho(\x(\alpha)) \leq \Bar{\rho}$ proving claim (i).

\ifarxiv
Now, to prove claim (ii), we note that $\objitap(\x(\alpha)) \leq \objitap(\x(1))$ since $\mathbf{x}(\alpha)$ is an optimal solution to I-TAP$_{\alpha}$. It thus follows that
\else
To prove claim (ii), from $\objitap(\x(\alpha)) \leq \objitap(\x(1))$ it follows that
\fi
\ifarxiv
\begin{align*}
    &\alpha \objso(\x(\alpha)) + (1-\alpha) \objue(\x(\alpha)) \leq \alpha \objso(\x(1)) + (1-\alpha) \objue(\x(1)).
\end{align*}
\else
$\alpha \objso(\x(\alpha)) + (1-\alpha) \objue(\x(\alpha)) \leq \alpha \objso(\x(1)) + (1-\alpha) \objue(\x(1))$.
\fi
Dividing this expression by $\alpha \objso(\x(1))$ and rearranging gives \ifarxiv us that \fi
\ifarxiv
\begin{align*}
    \frac{\objso(\x(\alpha))}{\objso(\x(1))} &\leq 1+ \frac{1-\alpha}{\alpha}\cdot \frac{\objue(\x(1)) - \objue(\x(\alpha))}{\objso(\x(1))} \\
    &\leq 1+ \frac{1-\alpha}{\alpha}\cdot \frac{\objue(\x(1)) - \objue(\x(0))}{\objso(\x(1))},
\end{align*}
where the second inequality follows from the fact that $\objue(\x(0)) \leq \objue(\x(\alpha))$ for any $\alpha \in [0, 1]$. This proves claim (ii).
\else
$\frac{\objso(\x(\alpha))}{\objso(\x(1))} \leq 1+ \frac{1-\alpha}{\alpha}\cdot \frac{\objue(\x(1)) - \objue(\x(0))}{\objso(\x(1))}$,
where we used that $\objue(\x(0)) \leq \objue(\x(\alpha))$ for any $\alpha$. This proves claim (ii).
\fi
\end{proof}
Theorem~\ref{thm:eff-upper-bound} establishes that, even in the worst case, the ratio between the total travel time of the edge flow $\x(\alpha)$ \ifarxiv of I-TAP$_{\alpha}$ \fi and that of the system optimal solution is at most the PoA. This result is not guaranteed to hold for other state-of-the-art CSO algorithms, \ifarxiv \else e.g., the algorithm in~\cite{so-routing-seminal} (see Section~\ref{sec:numerical-experiments}), \fi which may output traffic assignments with much larger total travel times than the UE solution. \ifarxiv For instance, in Section~\ref{sec:numerical-experiments} we show through numerical experiments that the algorithm proposed by Jahn et al. \cite{so-routing-seminal} achieves total travel times much higher than that of the user equilibrium solution for certain ranges of unfairness. \fi Further, Theorem~\ref{thm:eff-upper-bound} shows that the upper bound on the inefficiency ratio becomes closer to one as the objective $\objitap$ gets closer to $\objso$.

\ifarxiv 
The bound on the inefficiency ratio obtained from Theorem~\ref{thm:eff-upper-bound} is depicted in Figure~\ref{fig:ineff_ratio}. Note  that in order to obtain the value of the convex combination parameter $\alpha^*$ at which the two upper bounds on the inefficiency ratio are equal we need to impose the constraint $\Bar{\rho} = \frac{1-\alpha^*}{\alpha^*}\cdot \frac{\objue(\x(1)) - \objue(\x(0))}{\objso(\x(1))}$, which yields that $\alpha^* = \frac{\objue(\x(1)) - \objue(\x(0))}{\objso(\x(0)) + \objue(\x(1)) - \objue(\x(0))}$.

\begin{figure}[tbh!]
      \centering
      \includegraphics[width=80mm]{Fig/inefficiency_ratio_bound.png}
      \vspace{-5pt}
      \caption{\small \sf Upper bound on the inefficiency ratio of the optimal solution $\x(\alpha)$ of the problem I-TAP$_{\alpha}$ for $\alpha \in [0, 1]$}
      \label{fig:ineff_ratio} %\vspace{-5pt}
   \end{figure}
\fi

\ifarxiv Having established a worst case performance guarantee for I-TAP in terms of the inefficiency ratio, we \else We \fi now establish a range of values of $\alpha$ at which any optimal solution $\f(\alpha)$ of I-TAP$_{\alpha}$ is guaranteed to attain a $\beta$ bound on \ifarxiv unfairness. In particular, we specialize the following result to polynomial travel time functions, e.g., the commonly used BPR function \cite{Sheffi1985}. \else unfairness for polynomial travel time functions, e.g., the commonly used BPR function \cite{Sheffi1985}. \fi 

\begin{theorem} [Feasibility of I-TAP for \fso] \label{thm:poly-ttf-result}
Suppose that the largest degree of the polynomial travel time functions $t_e(x_e)$ is $m$ for some $e \in E$. Then, the unfairness of any optimal solution $\f(\alpha)$ of I-TAP$_{\alpha}$ is upper bounded by $\beta$, i.e., $U(\f(\alpha)) \leq \beta$, for any $\alpha \leq \frac{\beta - 1}{m}$.
%Suppose that the travel time function $t_e(x_e)$ is a polynomial function of degree $m$ for each edge $e \in E$. Then, the unfairness of the optimal solution $\x(\alpha)$ of I-TAP$_{\alpha}$ is upper bounded by $\beta$, i.e., $U(\x(\alpha)) \leq \beta$, for any $\alpha \leq \frac{\beta - 1}{m}$.
\end{theorem}


The proof of Theorem~\ref{thm:poly-ttf-result} leverages the fact that at an equilibrium flow, under a given vector of tolls, the travel cost on all positive paths is equal for all users in any commodity $k$, as was established in~\cite[Lemma 2]{basu2017reconciling}. We provide a proof of this claim here for completeness.

\begin{lemma} [Equality of Travel Costs on Positive Paths~\cite{basu2017reconciling}] \label{lem:equalityCosts}
Let the cost on an edge be given by $c_e(x_e, \tau_e) = t_e(x_e) + \tau_e$, where the value-of-time $v$ of users is normalized to one. Then, under any equilibrium flow induced by the edge tolls $\boldsymbol{\tau}$, the total travel cost of any two positive paths $P, Q$ are equal, i.e., $\sum_{e \in P} c_e(x_e, \alpha) = \sum_{e \in Q} c_e(x_e, \alpha)$. 
\end{lemma}

\begin{proof}
To prove this claim, we consider a network with travel time functions $c_e(x_e, \tau_e) = t_e(x_e) + \tau_e$ for all $e \in E$, which is valid since the travel time function is polynomial and so $c_e(x_e, \tau_e)$ is still differentiable, convex and monotonically increasing in $x_e$. Next, the equilibrium solution under a vector of tolls $\boldsymbol{\tau}$ is given by the UE-TAP with objective $\sum_{e \in E}\int_{0}^{x_e} c_e(y, \alpha) \dd{y}$, where $c_e(x_e, \tau_e) = t_e(x_e) + \tau_e$. By the first order necessary and sufficient conditions of this UE-TAP, for any two positive flow paths $P, Q$ between the same O-D pair $k$, it holds that $\sum_{e \in P} c_e(x_e, \alpha) = \sum_{e \in Q} c_e(x_e, \alpha) = \mu_k$ for some $\mu_k$. We now show that any positive path $R$ between the same O-D pair that is not a path with positive flow, i.e., $\x_R = 0$, also has the same travel cost as any path $P$ with positive flow, i.e., $\sum_{e \in R} c_e(x_e, \alpha) = \sum_{e \in P} c_e(x_e, \alpha) = \mu_k$.

Suppose by contradiction that there is a path $R$ for a commodity $k$ whose travel cost is not equal to $\mu_k$. From the equilibrium condition of UE-TAP it must hold that $\sum_{e \in R} c_e(x_e, \tau_e)>\mu_k$. Next, let $e_1, \ldots, e_r$ denote the edges in path $R$ in the order of traversal, and for each edge $e_i \in R$, consider a path used by commodity $k$ using that edge, i.e., a path $P_i = R_i^s-e_i-R_i^t$ where $R_i^s$ is the component of that path preceding edge $e_i$ and $R_i^t$ is the component of that path following edge $e_i$. Observe that the sum of the costs of these used paths $P_i$ is given by $\sum_{i = 1}^r \sum_{e \in P_i} c_e(x_e, \tau_e) = r \mu_k$. Next, considering the paths $P_1', \ldots, P_{r-1}'$, where $P_1' = R_{i+1}^s-R_i^t$, we obtain that
\begin{align*}
    r \mu_k = \sum_{i = 1}^r \sum_{e \in P_i} c_e(x_e, \tau_e) = \sum_{i = 1}^{r-1} \sum_{e \in P_i'} c_e(x_e, \tau_e) + \sum_{e \in R} c_e(x_e, \tau_e).
\end{align*}
Since it holds from the KKT conditions of UE-TAP that $\sum_{e \in P_i'} c_e(x_e, \tau_e) \geq \mu_k$ for each $i \in \{1, \ldots, r-1 \}$, the above equality implies that $\sum_{e \in R} c_e(x_e, \tau_e) \leq \mu_k$, a contradiction. Thus, we must have that the total cost on all positive paths is exactly equal to $\mu_k$, thereby proving our claim.
\end{proof}
We now leverage Lemma~\ref{lem:equalityCosts} to complete the proof of Theorem~\ref{thm:poly-ttf-result}.


\begin{proof}
Without loss of generality, we normalize the value of time $v$ to $1$ and for notational simplicity denote $x_e = x_e(\alpha)$ and $\f = \f(\alpha)$. We now establish this result in two steps. %We leverage Observation~\ref{obs:UE-equivalency} in Section~\ref{sec:compTractability} and establish this result in two steps.
First, we show that if $c_e(x_e, \alpha) = t_e(x_e) + \alpha x_e t_e'(x_e) \in [t_e(x_e), \beta t_e(x_e)]$ for all edges $e$ then the unfairness satisfies $U(\f) \leq \beta$. Next, we show for $\alpha \leq \frac{\beta - 1}{m}$ that the cost satisfies $c_e(x_e, \alpha) \in [t_e(x_e), \beta t_e(x_e)]$, which, together with the first claim, implies the result.

To prove the first claim, we consider a network with travel time functions $c_e(x_e, \alpha)$ for all $e \in E$, which is valid since the travel time function is polynomial and so $c_e(x_e, \alpha)$ is still differentiable, convex and monotonically increasing in $x_e$. 
\begin{comment}
Next, by Observation~\ref{obs:UE-equivalency} (see Section~\ref{sec:compTractability}), I-TAP is equivalent to a UE-TAP with objective $\sum_{e \in E}\int_{0}^{x_e} c_e(y, \alpha) \dd{y}$. By the first order \ifarxiv necessary and sufficient \fi conditions of this UE-TAP, for any two positive flow paths $P, Q$, i.e., $\x_P, \x_Q>0$, between the same O-D pair, it holds that $\sum_{e \in P} c_e(x_e, \alpha) = \sum_{e \in Q} c_e(x_e, \alpha)$. %the travel time with respect to the cost $c_e(x_e, \alpha)$ on any two positive flow paths $P, Q$ between the same O-D pair with respect to the flow $\x(\alpha)$ must be equal. That is, $\sum_{e \in P} c_e(x_e, \alpha) = \sum_{e \in Q} c_e(x_e, \alpha)$ for any two positive flow paths $P, Q$ for a commodity $k$.
Since $c_e(x_e, \alpha) \in [t_e(x_e), \beta t_e(x_e)]$, it follows for any two used paths $P, Q$, i.e., $\x_P, \x_Q>0$, that \ifarxiv
\begin{align*}
    \sum_{e \in P} t_e(x_e) &\leq \sum_{e \in P} c_e(x_e, \alpha) 
    = \sum_{e \in Q} c_e(x_e, \alpha) \\
    &\leq \beta \sum_{e \in Q} t_e(x_e).
\end{align*} \else
$\sum_{e \in P} t_e(x_e) \leq \beta \sum_{e \in Q} t_e(x_e),$
\fi
\end{comment}
Next, from Lemma~\ref{lem:equalityCosts} it holds that the total cost on any two positive paths $P$ and $Q$ are also equal, i.e., $\sum_{e \in P} c_e(x_e, \alpha) = \sum_{e \in Q} c_e(x_e, \alpha)$ since at an equilibrium flow the cost of any two used paths are equal. This result implies for any commodity $k$ and any two positive paths $P, Q$ that
\begin{align*}
    \sum_{e \in P} t_e(x_e) &\leq \sum_{e \in P} c_e(x_e, \alpha) 
    = \sum_{e \in Q} c_e(x_e, \alpha) \\
    &\leq \beta \sum_{e \in Q} t_e(x_e),
\end{align*}
i.e., the ratio of the travel times on positive paths can never exceed $\beta$. Thus, $U(\f) \leq \beta$.
%\ifarxiv Since the commodity was arbitrary, it follows that the above relation holds for all commodities, i.e.,  $U(\x) \leq \beta$. \fi

\ifarxiv
Next, to prove the second claim, we note that since the travel time function is a polynomial function of degree $m$, we can let $t_{e}\left(x_{e}\right)=\sum_{i=0}^{m} \gamma_{i} x_{e}^{i}$.
Then, we have:
\begin{align*}
x_{e} t_{e}^{\prime}\left(x_{e}\right) &=x_{e} \sum_{i=1}^{m} i \gamma_{i} x_{e}^{i-1} 
=\sum_{i=1}^{m} i \gamma_{i} x_{e}^{i} \\
& \leq m \sum_{i=1}^{m} \gamma_{i} x_{e}^{i}  \leq m \sum_{i=0}^{m} \gamma_{i} x_{e}^{i}  \\
&=m t_{e}\left(x_{e}\right).
\end{align*}
\else
Next, to prove the second claim, we first observe that $x_{e} t_{e}^{\prime}(x_e) \leq m t_{e}\left(x_{e}\right)$ for all $e$ since the travel time functions are non-negative polynomials of degree at most $m$. Thus, it follows that $\alpha x_e t_e^{\prime}(x_e) \leq \alpha m t_{e}\left(x_{e}\right)$. Now, if we set $\alpha m t_{e}\left(x_{e}\right) \leq (\beta-1)t_e(x_e)$, then we have for any $\alpha \leq \frac{\beta - 1}{m}$ that the cost $c_e(x_e, \alpha) \in [t_e(x_e), \beta t_e(x_e)]$ and thus the resulting flow $\x$ has an unfairness of at most $\beta$.
\fi
\ifarxiv
Note that we used the fact that $\gamma_0 \geq 0$ in the second inequality, which follows since $t_e(x_e) \geq 0$ for all $x_e \in \mathbb{R}_{\geq 0}$. From the above inequalities, we note that $\alpha x_e t_e^{\prime}(x_e) \leq \alpha m t_{e}\left(x_{e}\right)$. Now, if we set $\alpha m t_{e}\left(x_{e}\right) \leq (\beta-1)t_e(x_e)$, then we have for any $\alpha \leq \frac{\beta - 1}{m}$ that the cost $c_e(x_e, \alpha) \in [t_e(x_e), \beta t_e(x_e)]$ and thus the resulting flow $\f$ has an unfairness of at most $\beta$.
\fi
\end{proof}
\ifarxiv Theorem~\ref{thm:poly-ttf-result} establishes a relation between the convex combination parameter $\alpha$ and the level of unfairness of any optimal path flow $\f(\alpha)$ when the edge travel-time functions are polynomial.
\fi


%\ifarxiv

%\subsection{Tightness of Unfairness Bound}
%\fi

We can further show that the bound \ifarxiv obtained \fi in Theorem~\ref{thm:poly-ttf-result} is in fact tight by demonstrating an instance such that for any $\alpha > \frac{\beta-1}{m}$ the unfairness of the solution $\f(\alpha)$ of I-TAP$_{\alpha}$ is strictly greater than $\beta$. %\ifarxiv That is, there exists a graph with associated polynomial travel time functions such that for any $\alpha > \frac{\beta-1}{m}$ it holds that the unfairness of the solution $\x(\alpha)$ of I-TAP$_{\alpha}$ is strictly greater than $\beta$. We formalize this claim through the following result. \fi

\begin{lemma} [Tightness of Unfairness Bound] \label{lem:unfairness-tight}
Suppose $\f(\alpha)$ is an optimal solution to I-TAP$_{\alpha}$ for any $\alpha \in [0, 1]$. Then, there exists a two-edge parallel network with polynomial travel time functions of degree at most $m$ such that for any $\alpha > \frac{\beta-1}{m}$, the unfairness $U(\f(\alpha)) > \beta$.
\end{lemma}
%\begin{comment}
\begin{proof}
Consider a demand of one in a two edge Pigou network, with two nodes---an origin and a destination node---connected by two parallel edges $e_1$ and $e_2$. For edge $e_1$, let $t_1(x_1) = 1 + \epsilon x$ for some small $\epsilon>0$, and let $t_2(x_2) = x_2^m$ for some $m \in \mathbb{N}$. Then, the first order necessary and sufficient KKT conditions of I-TAP$_{\alpha}$ for any $\alpha \in [0, 1]$ imply that
\begin{align*}
    t_2(x_2) + \alpha x_2 t_2'(x_2) = t_1(x_1) + \alpha x_1 t_1'(x_1).
\end{align*}
Substituting $t_2(x_2) = x_2^m$ and $t_1(x_1) = 1+ \epsilon x_1$ gives the following ratio between the travel times on the two links:
\begin{align*}
    \frac{t_1(x_1)}{t_2(x_2)} = \frac{1 + \epsilon x_1}{x_2^{m}} - \frac{\alpha \epsilon x_1}{x_2^m} = 1+m \alpha - \frac{\alpha \epsilon x_1}{x_2^m}.
\end{align*}
By the unfairness constraint that $\frac{t_1(x_1)}{t_2(x_2)} \leq \beta$, it follows that if $\alpha>\frac{\beta - 1}{m}$, then
\begin{align*}
    \frac{t_1(x_1)}{t_2(x_2)} = 1+m \alpha - \frac{\alpha \epsilon x_1}{x_2^m} > 1+m\frac{\beta - 1}{m} - \frac{\alpha \epsilon x_1}{x_2^m} = \beta - \frac{\alpha \epsilon x_1}{x_2^m}.
\end{align*}
Taking $\epsilon \rightarrow 0$, we have that $\frac{t_1(x_1)}{t_2(x_2)} \geq \beta$ for any $\alpha > \frac{\beta-1}{m}$. Thus, the unfairness of the optimal flow $\f(\alpha)$, which is identical to the edge flow $\x(\alpha)$ in a parallel network setting, is at least $\beta$.%, proving our claim.
\end{proof}

\begin{comment}
\begin{proof}
Consider a demand of one in a two edge Pigou network, with two nodes---an origin and a destination node---connected by two parallel edges $e_1$ and $e_2$. For edge $e_1$, let $t_1(x_1) = 1 + \epsilon x$ for some small $\epsilon>0$, and let $t_2(x_2) = x_2^m$ for some $m \in \mathbb{N}$. Then, the first order necessary and sufficient KKT conditions of I-TAP$_{\alpha}$ for any $\alpha \in [0, 1]$ imply that
\ifarxiv
\begin{align*}
    t_2(x_2) + \alpha x_2 t_2'(x_2) = t_1(x_1) + \alpha x_1 t_1'(x_1).
\end{align*}
\else
$t_2(x_2) + \alpha x_2 t_2'(x_2) = t_1(x_1) + \alpha x_1 t_1'(x_1)$.
\fi
Substituting $t_2(x_2) = x_2^m$ and $t_1(x_1) = 1+ \epsilon x_1$ \ifarxiv gives the following ratio between the travel times on the two links:\else gives:\fi
\ifarxiv
\begin{align*}
    \frac{t_1(x_1)}{t_2(x_2)} = \frac{1 + \epsilon x_1}{x_2^{m}} - \frac{\alpha \epsilon x_1}{x_2^m} = 1+m \alpha - \frac{\alpha \epsilon x_1}{x_2^m}.
\end{align*}
\else
$\frac{t_1(x_1)}{t_2(x_2)} = 1+m \alpha - \frac{\alpha \epsilon x_1}{x_2^m}$.
\fi
By the unfairness constraint \ifarxiv that $\frac{t_1(x_1)}{t_2(x_2)} \leq \beta$, \fi it follows that if $\alpha>\frac{\beta - 1}{m}$, then
\ifarxiv
\begin{align*}
    \frac{t_1(x_1)}{t_2(x_2)} = 1+m \alpha - \frac{\alpha \epsilon x_1}{x_2^m} > 1+m\frac{\beta - 1}{m} - \frac{\alpha \epsilon x_1}{x_2^m} = \beta - \frac{\alpha \epsilon x_1}{x_2^m}.
\end{align*}
\else
$\frac{t_1(x_1)}{t_2(x_2)} > \beta - \frac{\alpha \epsilon x_1}{x_2^m}$.
\fi
Taking $\epsilon \rightarrow 0$, we have that $\frac{t_1(x_1)}{t_2(x_2)} \geq \beta$ for any $\alpha > \frac{\beta-1}{m}$. Thus, the unfairness of the flow $\x(\alpha)$ is at least $\beta$.%, proving our claim.
\end{proof}

\end{comment}

\ifarxiv \else For a counterexample to prove Lemma~\ref{lem:unfairness-tight}, see Appendix~\ref{apdx:pf-unfairness-tight}. \fi
Together, Theorem~\ref{thm:poly-ttf-result} and Lemma~\ref{lem:unfairness-tight} imply that a $\beta$ level of unfairness can be guaranteed using I-TAP on all traffic networks only when $\alpha \leq \frac{\beta-1}{m}$, where $m$ is the maximum degree of the polynomial corresponding to the travel time functions for each edge $e \in E$.




\subsection{Optimality of I-TAP} \label{sec:optimality}

%In the previous section, we presented bounds on the total travel time and unfairness of a traffic assignment outputted by I-TAP. 
In this section, we show that I-TAP exactly computes the minimum total travel time solution for any desired level of unfairness $\beta$ in any two edge Pigou network. That is, there is some convex combination parameter $\alpha^*$ for which the solution of I-TAP$_{\alpha^*}$ is also a solution to the \fso problem for any two edge Pigou network. 

\begin{lemma} [Optimality of I-TAP] \label{lem:itap-optimal-pigou}
Consider a two edge Pigou network where the optimal solution of the \fso problem is $\x_{\beta}^*$ for any $\beta \in [1, \infty)$. Then, there exists a convex combination parameter $\alpha^*$ such that $\x(\alpha^*) = \x_{\beta}^*$, i.e., the solution of I-TAP$_{\alpha^*}$ and the optimal solution of the \fso problem coincide.
\end{lemma}

For a proof of Lemma~\ref{lem:itap-optimal-pigou}, see \ifarxiv Appendix~\ref{apdx:pf-pigou-optimal}\else Appendix A.2\fi. We mention that Lemma~\ref{lem:itap-optimal-pigou} compares only the edge flows of I-TAP and \fso since the path and edge flows coincide for a two edge Pigou network. We also note that while the optimality for a Pigou network may appear restrictive, such networks are of both theoretical~\cite{pigou,how-bad-is-selfish} and practical significance~\cite{caltrans}. %From a theoretical lens, Pigou's network~\cite{pigou}, has been used extensively in deriving price of anarchy bounds in the selfish routing literature~\cite{how-bad-is-selfish}. From a practical perspective, transportation networks can often be approximated reasonably well by parallel networks for specific use cases~\cite{caltrans}, e.g., when multiple highways connect two populated areas.



%Note that Lemma~\ref{lem:eff-upper-bound} implies that the inefficiency ratio $\rho(\x(\alpha))$ is bounded above by the Price of Anarchy for any $\alpha \in (0, 1)$. 

%Theorem~\ref{thm:eff-upper-bound} establishes that even in the worst case the ratio between the total system travel time of the solution corresponding to Algorithm~\ref{alg:convex-comb-UE-SO-objective} and the system optimal solution is at most the PoA. This result is not guaranteed to hold for other state-of-the-art CSO algorithms, which may output traffic assignments with much larger system travel times as compared to the user equilibrium solution. For instance, in Section~\ref{sec:numerical-experiments} we show through numerical experiments that the algorithm proposed by Jahn et al. \cite{so-routing-seminal} achieves system travel times much higher than that of the user equilibrium solution for certain ranges of \textit{Loaded Unfairness}. 

\subsection{Computational Tractability of I-TAP} \label{sec:compTractability}

Having established that we can solve I-TAP to obtain an approximate solution to \fso, we now establish that I-TAP can be computed efficiently due to its equivalence to a parametric UE-TAP program.

%An important property of I-TAP is that it can be computed efficiently, which follows since I-TAP$_{\alpha}$ for any $\alpha \in [0, 1]$ is equivalent to a parametric UE-TAP program that is efficiently computable.

\begin{observation} [UE Equivalency of I-TAP] \label{obs:UE-equivalency}
For any $\alpha \in [0, 1]$, I-TAP$_{\alpha}$ reduces to UE-TAP with objective function $\sum_{e \in E}\int_{0}^{x_e} c_e(y, \alpha) \dd{y}$, where $c_e(y, \alpha) = t_e(y) + \alpha y t_e'(y)$.
\end{observation}
\ifarxiv 
To see Observation~\ref{obs:UE-equivalency}, note that by the fundamental theorem of calculus, $\objso(\x)$ can be written as
$$\objso(\x) = \sum_{e \in E} x_e t_e(x_e) = \sum_{e \in E} \int_{0}^{x_e} t_e(y) + y t_e'(y) \dd{y}. $$
Then, taking a convex combination of the SO-TAP and UE-TAP objectives, it is clear that 
$$\objitap(\x) = \sum_{e \in E}\int_{0}^{x_e} t_e(y) + \alpha y t_e'(y) \dd{y}.$$
\else
Observation~\ref{obs:UE-equivalency} follows %directly 
from the fundamental theorem of calculus.
\fi 
Note that for each $\alpha \in [0, 1]$, the differentiability, monotonicity, and convexity of many typical travel time functions $t_e$, e.g., any polynomial function such as the BPR function~\cite{Sheffi1985}, imply that the corresponding properties hold for the cost functions $c_e(x_e, \alpha)$ in $x_e$. For numerical implementation, %purposes, 
the equivalency of I-TAP$_\alpha$ and UE-TAP implies that I-TAP$_\alpha$ inherits the useful property that the linearization step of the Frank-Wolfe algorithm~\cite{Sheffi1985}, when applied to I-TAP$_\alpha$, corresponds to solving multiple 
unconstrained shortest path queries. The latter motivates the highly efficient approach which we employ in Section~\ref{sec:numerical-experiments} to solve I-TAP$_\alpha$.

\ifarxiv
\subsection{Sensitivity Analysis of I-TAP} \label{sec:solution-properties}

To obtain a solution that is simultaneously of low cost while keeping within a $\beta$ bound of unfairness, it is instructive to study the sensitivity of the optimal edge flow solution $\x(\alpha)$ of I-TAP$_{\alpha}$ in the convex combination parameter $\alpha$. Specifically, performing such a sensitivity analysis is important since it allows us to characterize the continuity of the SO-TAP objective $\objso(\x(\alpha))$, which we are looking to minimize in the \fso problem. In this section, we leverage the equivalency of I-TAP and UE-TAP to establish continuity properties of the optimal edge flow solution $\x(\alpha)$ of I-TAP$_{\alpha}$ and the SO-TAP objective $\objso(\x(\alpha))$.

We first establish the Lipschitz continuity of the optimal edge flow solution $\x(\alpha)$ of I-TAP$_{\alpha}$ in the convex combination parameter
$\alpha$. This result follows from the UE-TAP reformulation of I-TAP as in Observation~\ref{obs:UE-equivalency} and a direct application of the Lipschitz continuity of the optimal solution of a parametric UE-TAP \cite[Theorem 8.6a]{parametric-still}.

\begin{corollary} (Lipschitz Continuity of $\x(\alpha)$) \label{cor:lipschitz-cont-x}
For any $\alpha \in (0, 1)$, the edge flow solution $\mathbf{x}(\alpha)$ of the problem I-TAP$_{\alpha}$ is Lipschitz continuous in $\alpha$.
\end{corollary}
Corollary~\ref{cor:lipschitz-cont-x} implies a desirable property that small changes in $\alpha$ will only result in small changes in the optimal edge flows of I-TAP$_{\alpha}$. We now use Corollary~\ref{cor:lipschitz-cont-T} to establish the Lipschitz continuity of the SO-TAP objective.

\begin{corollary} (Lipschitz Continuity of $\objso$) \label{cor:lipschitz-cont-T}
For any $\alpha \in (0, 1)$, let $\x(\alpha)$ be the optimal edge flow solution to I-TAP$_{\alpha}$. Then, %the SO-TA objective 
$\objso(\mathbf{x}(\alpha))$ is Lipschitz continuous in $\alpha$.%, and $\objso(\mathbf{x}(1)) \leq \objso(\mathbf{x}(\alpha)) \leq \objso(\mathbf{x}(0))$ for $\alpha \in (0, 1)$.
\end{corollary}

\begin{proof}
We prove the Lipschitz continuity of $\objso(\mathbf{x}(\alpha))$ in $\alpha$ through the observation that the composition of Lipschitz continuous functions is Lipschitz continuous. First, observe that $\mathbf{x}(\alpha)$ is Lipschitz continuous by Corollary~\ref{cor:lipschitz-cont-x}. Next, the SO-TAP objective $\objso(\mathbf{x}) = \sum_{e \in E} x_e t_e(x_e)$ is %certainly 
continuous in its argument $\mathbf{x}$. Furthermore, $\objso(\mathbf{x})$ is locally Lipschitz over a bounded set since the SO-TAP has a finite derivative as long as $\mathbf{x}$ is bounded. Since both $\objso(\mathbf{x})$ and $\mathbf{x}(\alpha)$ are Lipschitz continuous, it follows that $\objso(\mathbf{x}(\alpha))$ is Lipschitz continuous.
\end{proof}

While Corollary~\ref{cor:lipschitz-cont-T} establishes the continuity of $\objso(\mathbf{x}(\alpha))$ in $\alpha$, this relation is not necessarily monotone, which we show through numerical experiments in Section~\ref{sec:numerical-experiments}. We also note that, unlike the SO-TAP objective, the unfairness function $U(\f(\alpha))$ is discontinuous in $\alpha$. Its discontinuity stems from the fact that the optimal solutions $\f(\alpha_1)$ and $\f(\alpha_2)$ for convex combination parameters $\alpha_1$ and $\alpha_2$ that are arbitrarily close may not have the same set of positive paths. In particular, it may happen for some convex combination parameter $\alpha_1$ that path $P$ is a positive path, but for some $\epsilon>0$ and for any $\alpha_2$ such that $||\alpha_1 - \alpha_2 ||_2 \leq \epsilon$ we have that $P$ is not a positive path. Since the travel time on path $P$ could be very different from the travel times on other paths, the unfairness function is in general discontinuous in $\alpha$, which we validate through experiments in Section~\ref{sec:numerical-experiments}.
\fi  

\section{Pricing to Implement Flows} \label{sec:main-pricing}



\ifarxiv  In the previous section we presented a method for computing a solution to \fso that keeps within a $\beta$ bound of unfairness and strives to minimize the total travel time. \fi 
In this section, we leverage the structure of
I-TAP to develop pricing mechanisms to collectively enforce
the I-TAP solution in the presence of selfish users that independently choose routes to minimize their own travel costs. %In this section, we develop pricing schemes to induce selfish users to collectively form the flows computed through our approach. 
\ifarxiv  That is, the prices are set such that the travel cost for users in the same commodity is equivalent, ensuring the formation of an equilibrium. \fi 
We first consider the case of homogeneous users and show that I-TAP results in a natural marginal-cost pricing scheme. \ifarxiv Then, we leverage a linear programming methodology of \cite{multicommodity-extension} to set road prices to enforce the flows computed through the I-TAP method for the setting of heterogeneous users. \else Then, we characterize conditions under which tolls can be used to enforce the I-TAP flows for heterogeneous users. \fi

In this section, for the ease of exposition, we focus our discussion on inducing the optimal edge flow $\x(\alpha)$ of I-TAP$_{\alpha}$. We mention that our approach can naturally be extended to enforcing optimal path flows $\f(\alpha)$ that satisfy a given level of unfairness. In particular, we can consider a setting wherein users are recommended to use a specified path set, e.g., by traffic navigational applications, as given by $\f(\alpha)$ and the tolls set are such that no user will have an incentive to deviate from their recommended paths. Finally, we also mention by the result of Theorem~\ref{thm:poly-ttf-result} that focusing on the edge flow solution $\x(\alpha)$ is without loss of generality for certain ranges of $\alpha$ since the unfairness bound for any optimal path flow solution $\f(\alpha)$ is guaranteed to be satisfied.

\subsection{Homogeneous Pricing via Marginal Cost} \label{sec:pricing-homogeneous}

In the setting where all users have the same value of time $v$, the structure of I-TAP$_{\alpha}$ yields an interpolated variant of marginal-cost pricing to induce selfish users to collectively form the optimal edge flow $\x(\alpha)$ of I-TAP$_{\alpha}$. This result is a direct consequence of the equivalence between I-TAP and UE-TAP from Observation~\ref{obs:UE-equivalency}.

\begin{lemma} [Prices to Implement Flows] \label{lem:pricing-homogeneous}
Suppose that the edge flow $\x(\alpha)$ is a solution to I-TAP$_\alpha$ for some $\alpha\in [0,1]$. Then $\x(\alpha)$ can be enforced as a UE by setting the prices as $\tau_e = \alpha x_e(\alpha) t_e'(x_e(\alpha))$ for each $e \in E$.
\end{lemma}

\ifarxiv
\begin{proof}
Without loss of generality, normalize $v$ to 1 and for notational convenience, denote $x_e = x_e(\alpha)$. To prove this result, note from Observation~\ref{obs:UE-equivalency} that I-TAP$_{\alpha}$ is equivalent to UE-TAP with objective $\sum_{e\in E}\int_{0}^{x_e} t_e(y) + \alpha y t_e'(y) \dd{y}$. From the first-order necessary and sufficient KKT conditions~\cite{Sheffi1985} of this UE-TAP, for any two paths $P, Q \in \mathcal{P}_k$ with positive flow for a commodity $k \in K$, it must be that $\sum_{e \in P} \left( t_e(x_e) + \alpha x_e t_e'(x_e) \right) = \sum_{e \in Q} \left( t_e(x_e) + \alpha x_e t_e'(x_e) \right)$. Thus, if the prices on each edge are set as $\tau_e = \alpha x_e t_e'(x_e)$, then all users in each commodity incur the same travel cost when using any two paths $P, Q \in \mathcal{P}_k$, establishing that $\x$ is a UE.
\end{proof}
\fi

\ifarxiv  \else For a proof of Lemma~\ref{lem:pricing-homogeneous}, see Appendix A.3. \fi Note from Lemma~\ref{lem:pricing-homogeneous} that the edge prices are equal to $\alpha$ multiplied by the marginal cost of \ifarxiv users on the edges. \else users. \fi \ifarxiv For this pricing scheme, Lemma~\ref{lem:pricing-homogeneous} guarantees that selfish users will be induced to collectively form the solutions satisfying a specified bound on unfairness obtained through the I-TAP method. \fi \ifarxiv \else We also note that tradable-credit schemes~\cite{YANG2011580} can be used to implement the flows computed through I-TAP (Appendix C). \fi

\ifarxiv
\begin{remark}
We note that road tolling is not the only mechanism that can be used to induce selfish users to collectively form the flows computed through I-TAP. One of the notable mechanisms beyond road tolling to enforce the SO solution as a UE is that of tradable credit schemes, wherein users can trade initially issued credits freely in a competitive market and spend these credits to use roads with predetermined credit charges \cite{YANG2011580}. As with the marginal cost pricing scheme in Lemma~\ref{lem:pricing-homogeneous}, the equivalence between I-TAP and UE-TAP for any $\alpha \in [0, 1]$ enables us to derive a tradable credit scheme. In particular, following a similar line of reasoning to that used by Yang and Wang \cite[Proposition 5]{YANG2011580}, it can be shown that the optimal edge flow $\mathbf{x}(\alpha)$ of I-TAP$_{\alpha}$ for any $\alpha \in [0, 1]$ can be enforced as a user equilibrium through a tradable credit scheme. 
\end{remark}
\fi


\subsection{Heterogeneous Pricing via Dual Multipliers} \label{sec:pricing-heterogeneous}

\ifarxiv
The pricing mechanism in Section~\ref{sec:pricing-homogeneous} is inapplicable to the heterogeneous user setting as it would require unrealistically imposing different prices for users with different values of time for the same edges. In this section, we consider heterogeneous users and leverage a linear-programming method \cite{multicommodity-extension} to provide a necessary and sufficient condition to induce selfish users to collectively form the edge flow $\x(\alpha)$. We further establish that $\x(\alpha)$ satisfies this condition for each $\alpha \in [0, 1]$. That is, appropriate tolls can be placed on the roads of the network to induce heterogeneous selfish users to collectively form the equilibrium edge flow $\x(\alpha)$.
\else
The pricing mechanism in Section~\ref{sec:pricing-homogeneous} is inapplicable to the heterogeneous user setting as it would require unrealistically imposing different prices for users with different values of time for the same edges. In this section, we consider heterogeneous users and leverage a linear-programming method \cite{multicommodity-extension} to establish that appropriate tolls can be placed on the roads to induce heterogeneous selfish users to collectively form the equilibrium flow $\x(\alpha)$.
\fi


Before presenting the pricing scheme, we first extend the notion of a commodity to a heterogeneous user setting. In particular, each user belongs to a commodity $k \in K$ when making a trip on a set of paths $\mathcal{P}_k$ between the same O-D pair and has the value of time $v_k>0$. Then, under a vector of edge prices $\boldsymbol{\tau} = \{\tau_e\}_{e \in E}$ the travel cost that users in commodity $k$ incur on a given path $P \in \mathcal{P}_k$ under the traffic assignment $\x$ is given by $C_{P}(\x, \boldsymbol{\tau}) =  \sum_{e \in P} \left( v_k t_e(x_e) + \tau_e \right)$. Note that %, unlike the homogeneous user setting, 
more than one commodity %with different values of time 
may make trips between the same O-D pair, and a user equilibrium forms when the travel cost for all users in a particular commodity is equal. We further note that we maintain the unfairness notion presented in the work \ifarxiv thus far \fi even for heterogeneous users. That is, irrespective of the value of time of two users travelling between the same O-D pair, the maximum possible ratio between their travel times can be no more than $\beta$.

We now leverage the following result 
to provide a necessary and sufficient condition that the optimal edge flow $\x(\alpha)$ of I-TAP$_{\alpha}$ \ifarxiv for any $\alpha\in [0,1]$ \fi must satisfy for it to be enforceable as a UE through road pricing. %a specific pricing scheme.

%We now present a necessary and sufficient condition that the optimal solution $\x(\alpha)$ of I-TAP$_{\alpha}$ for any $\alpha\in [0,1]$ must satisfy for it to be enforceable as a user equilibrium. This condition is a direct consequence of \cite[Theorem 3.1]{multicommodity-extension}, which we elucidate through Lemma~\ref{lem:pricing-flow-implement}.


%presents a linear programming method to test whether $\x(\alpha)$ can be implemented as a user equilibrium.

%states that $\x(\alpha)$ can be implemented as a user equilibrium if and only if the optimal solution of the linear program is the flow $x_e(\alpha)$ for each $e \in E$.

%and provides a method to set prices using the dual variables of a linear program if $\x(\alpha)$ satisfies this condition.
\ifarxiv
\begin{lemma} (Condition for Flow Enforceability
%\ifarxiv 
\cite[Theorem 3.1]{multicommodity-extension})
%\else 
%\cite{multicommodity-extension})
%\fi 
\label{lem:pricing-flow-implement}
Suppose that the flow $\x$ satisfies the feasibility Constraints~\eqref{eq:edge-constraint}-\eqref{eq:nonnegativity-constraints}. Further, consider the linear program with the variables $d_{P}^{k}$, which represents the flow of commodity $k$ routed on path $P \in \mathcal{P}_k$, where $\mathcal{P}_k$ denotes the set of all possible paths for commodity $k$:
\begin{mini!}|s|[2]                   % mini! = minimize
    {\substack{d_{P}^{k}, \forall P \in \mathcal{P}_k, \\ \forall k \in K}}                              % optimization variable
    {\sum_{k \in K} v_k \sum_{P \in \mathcal{P}_k}  t_P(\x) d_{P}^{k}, \label{eq:OPT-Obj-Roughgarden}}   % objective function and label
    {\label{eq:Eg001}}             % label for optimizatio problem
    {}                                % optimization result
    \addConstraint{\sum_{P \in \mathcal{P}_{k}} d_{P}^{k}}{= d_{k}, \quad \forall k \in K, \label{eq:OPTcon1-Roughgarden}}    % constraint 1
    \addConstraint{d_{P}^{k}}{  \geq 0, \quad \forall P \in \mathcal{P}_k, k \in K, \label{eq:OPTcon2-Roughgarden}}
    \addConstraint{\sum_{k \in K} \sum_{P \in \mathcal{P}_{k}: e \in P} d_{P}^{k}}{  \leq x_e, \quad \forall e \in E, \label{eq:OPTcon3-Roughgarden}}
\end{mini!}
with demand Constraints~\eqref{eq:OPTcon1-Roughgarden}, non-negativity Constraints~\eqref{eq:OPTcon2-Roughgarden} and capacity Constraints~\eqref{eq:OPTcon3-Roughgarden}. Then $\x$ can be enforced as a user equilibrium if and only if Constraint~\eqref{eq:OPTcon3-Roughgarden} is met with equality for each edge $e \in E$ at the optimal solution of the linear Program~\eqref{eq:OPT-Obj-Roughgarden}-\eqref{eq:OPTcon3-Roughgarden}.
\end{lemma}
\else
\begin{lemma} [Condition for Flow Enforceability]
%\ifarxiv 
\cite[Theorem 3.1]{multicommodity-extension})
%\else 
%\cite{multicommodity-extension})
%\fi 
\label{lem:pricing-flow-implement}
Suppose that the non-negative edge flow $\x$ satisfies edge flow and demand constraints as in Definition~\ref{def:so-tap}. Further, consider the linear program: $\min_{d_{P}^{k} \in \Tilde{\Omega}} \sum_{k \in K} v_k \sum_{P \in \mathcal{P}_k}  t_P(\x) d_{P}^{k}$, where the non-negative variables $d_{P}^{k}$ represent the flow of commodity $k$ on path $P \in \mathcal{P}_k$, and $\mathcal{P}_k$ denotes the set of all possible paths for commodity $k$.
\begin{comment}
\begin{mini!}|s|[2]                   % mini! = minimize
    {\substack{d_{P}^{k} \in \Tilde{\Omega}}}                              % optimization variable
    {\sum_{k \in K} v_k \sum_{P \in \mathcal{P}_k}  t_P(\x) d_{P}^{k}, \label{eq:OPT-Obj-Roughgarden}}   % objective function and label
    {\label{eq:Eg001}}             % label for optimizatio problem
    {}                                % optimization result
\end{mini!}
\end{comment}
Here $\Tilde{\Omega}$ is the set described by non-negative flows satisfying capacity
constraints, i.e., $\sum_{k \in K} \sum_{P \in \mathcal{P}_{k}: e \in P} d_{P}^{k} \leq x_e$ for all edges $e \in E$, and demand constraints, i.e., $\sum_{P \in \mathcal{P}_{k}} d_{P}^{k} = d_{k}$ for all $k \in K$. Then $\x$ can be enforced as a UE if and only if the capacity constraints are met with equality for each edge \ifarxiv $e \in E$ \fi at the optimal solution of the linear program.
\end{lemma}
\fi
\ifarxiv
In particular, if $\x(\alpha)$ satisfies the above necessary and sufficient condition then it can be enforced as a user equilibrium 
through edge prices set based on the dual variables of the capacity constraints of the above linear program. \fi %The user equilibrium in the heterogeneous user setting is formed when the above defined travel cost is equivalent for all users belonging to a particular commodity. 
We now show that $\x(\alpha)$ satisfies the \ifarxiv necessary and sufficient \fi condition in Lemma~\ref{lem:pricing-flow-implement}.


\begin{lemma} \label{lem:single-od-result} [Heterogeneous User Flow Enforceability]
Suppose that the edge flow $\x(\alpha)$ is a solution for I-TAP$_\alpha$ for some $\alpha\in [0,1]$. Then for the heterogeneous user setting, $\x(\alpha)$ can be enforced as a user equilibrium.
\end{lemma}
\ifarxiv 
\begin{proof}
To prove this result, from Lemma~\ref{lem:pricing-flow-implement} it suffices to show that Constraints~\eqref{eq:OPTcon3-Roughgarden} are met with equality at the optimal solution of the linear Program~\eqref{eq:OPT-Obj-Roughgarden}-\eqref{eq:OPTcon3-Roughgarden} for the flow $\x(\alpha)$. We now suppose by contradiction that the optimal solution $\Tilde{\x}$ to the linear Program~\eqref{eq:OPT-Obj-Roughgarden}-\eqref{eq:OPTcon3-Roughgarden} for the edge flow $\x(\alpha)$ is such that for at least one edge $e^*\in E$ the Constraint~\eqref{eq:OPTcon3-Roughgarden} is met with a strict inequality, i.e., $\Tilde{x}_{e^*}<x_{e^*}(\alpha)$. Since the flow $\Tilde{\x}$ is optimal for this linear program it follows that $\Tilde{\x}_{P} \geq 0$ for all paths $P \in \mathcal{P}_k$ for all commodities $k \in K$, and that $\sum_{P \in \mathcal{P}_k} \Tilde{\x}_{P} = d_k$ for each commodity $k \in K$ by the constraints of the linear program. Note here that the demand constraints satisfy $\sum_{P \in \mathcal{P}_k} \Tilde{\x}_{P} = d_k$ and the non-negativity constraints $\Tilde{\x}_{P} \geq 0$ imply that the corresponding demand and non-negativity constraints for I-TAP$_{\alpha}$ are also satisfied for the flow $\Tilde{\x}$. By the edge decomposition of path flows it must further hold that $\sum_{k \in K} \sum_{P \in \mathcal{P}_k: e \in P} \Tilde{\x}_{P} = \Tilde{x}_e$. Thus, we observe that the flow $\Tilde{\x}$ is a feasible solution to I-TAP$_{\alpha}$. 

Next, from the capacity constraint of the linear program it follows that for each $e \in E$ that $\Tilde{x}_e \leq x_e(\alpha)$ and that for at least one edge $e^*$ that $\Tilde{x}_{e^*}<x_{e^*}(\alpha)$ by assumption. Then, by the monotonicity of the I-TAP$_{\alpha}$ objective in the edge flows, we observe that $\objitap(\Tilde{\x}) < \objitap(\x(\alpha))$, implying that $\x(\alpha)$ is not an optimal solution to I-TAP$_{\alpha}$, a contradiction. Thus, the flow $\Tilde{\x}$ cannot exist, proving our claim that any optimal solution to the Program~\eqref{eq:OPT-Obj-Roughgarden}-\eqref{eq:OPTcon3-Roughgarden} for the edge flow $\x(\alpha)$ must meet the capacity constraint with equality.
\end{proof}
\else
\begin{proof}
To prove this result, from Lemma~\ref{lem:pricing-flow-implement} it suffices to show that the capacity constraints are met with equality at the optimal solution of the linear program in the statement of the lemma for the flow $\x(\alpha)$. We now suppose by contradiction that the optimal solution $\Tilde{\x}$ to this linear program for the flow $\x(\alpha)$ is such that for at least one edge $e^*\in E$ the capacity constraint is met with a strict inequality, i.e., $\Tilde{x}_{e^*}<x_{e^*}(\alpha)$. Since the flow $\Tilde{\x}$ is optimal for this linear program it follows that $\Tilde{\x}_{P} \geq 0$ for all paths $P \in \mathcal{P}_k$ for all commodities $k \in K$, and that $\sum_{P \in \mathcal{P}_k} \Tilde{\x}_{P} = d_k$ for each commodity $k \in K$ by the constraints of the linear program. \ifarxiv Note here that the demand constraints satisfy $\sum_{P \in \mathcal{P}_k} \Tilde{\x}_{P} = d_k$ and the non-negativity constraints $\Tilde{\x}_{P} \geq 0$ imply that the corresponding demand and non-negativity constraints for I-TAP$_{\alpha}$ are also satisfied for the flow $\Tilde{\x}$. \fi 
By the edge decomposition of path flows it must further hold that $\sum_{k \in K} \sum_{P \in \mathcal{P}_k: e \in P} \Tilde{\x}_{P} = \Tilde{x}_e$. Thus, \ifarxiv we observe that the flow \fi $\Tilde{\x}$ is a feasible solution to I-TAP$_{\alpha}$. 

Next, from the capacity constraint of the linear program it follows for each $e \in E$ that $\Tilde{x}_e \leq x_e(\alpha)$ and for \ifarxiv at least one edge \else some \fi $e^*$ that $\Tilde{x}_{e^*}<x_{e^*}(\alpha)$ by assumption. Then, by the monotonicity of the I-TAP$_{\alpha}$ objective in the edge flows, we observe that $\objitap(\Tilde{\x}) < \objitap(\x(\alpha))$, implying that $\x(\alpha)$ is not an optimal solution to I-TAP$_{\alpha}$, a contradiction. \ifarxiv Thus, the flow $\Tilde{\x}$ cannot exist, proving our claim that any optimal solution to the linear program for the flow $\x(\alpha)$ must meet the capacity constraint with equality. \else Thus, $\x(\alpha)$ must meet the capacity constraints with equality. \fi
\end{proof}
\fi


Lemma~\ref{lem:single-od-result} implies that even when users are heterogeneous the edge flow $\x(\alpha)$ %any flow guaranteeing a $\beta$ level of unfairness computed through the I-TAP method 
can be enforced as an equilibrium flow using tolls set through the dual variables of \ifarxiv the capacity constraints of \fi a linear program. \ifarxiv \else The proof of Lemma~\ref{lem:single-od-result} points to a more general condition for flow enforceability with heterogeneous users, which is highlighted in Appendix C.\fi
\ifarxiv
\begin{remark}
We note that in the proof of Lemma~\ref{lem:single-od-result}, all that we required was that the objective function of I-TAP$_{\alpha}$ is monotonically increasing in the flow on each edge of the network. This suggests a more general sufficient condition for enforcing flows as a user equilibrium. In particular, any flow that satisfies the flow conservation constraints and is the solution of a convex program with some convex objective $f(\x)$ that is monotonically increasing in $x_e$ for each $e \in E$ can be induced as a user equilibrium. Note that the I-TAP$_{\alpha}$ objective is a special case of such a function $f(\x)$.
\end{remark}
\fi



\section{Numerical Experiments} \label{sec:numerical-experiments}



%\else
\begin{comment}
\begin{figure*}
    \centering
    \begin{subfigure}[t]{0.98\columnwidth}
        \centering
         %trim=left bottom right top
            \include{Fig/cost_v_alpha_0.01_aamas}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[t]{0.98\columnwidth}
        \centering
        \include{Fig/alpha_v_beta_outliers_aamas}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Variation in the Inefficiency Ratio (left) and the level of unfairness (right) of the optimal solution $\mathbf{x}(\alpha)$ of I-TAP$_{\alpha}$ with the parameter $\alpha \in [0, 1]$ for six different transportation networks from Table~\ref{tab:problem-instances}. The values of the convex combination parameter were chosen at increments of $0.01$.}%, i.e., the $s$-net has $s = 0.01$.
    } %\vspace{-10pt} 
    \label{fig:tt_v_alpha_and_beta_v_alpha_finer_discretization}
\end{figure*}
\end{comment}


%\fi

We now evaluate the performance of our I-TAP method for \fso on several real-world transportation networks. The results of our experiments not only characterize the behavior of I-TAP but also highlight that, compared to the algorithm in \cite{so-routing-seminal}, our approach has much smaller runtimes while %generally 
achieving lower total travel times for most levels $\beta$ of unfairness. \ifarxiv In the following, we describe the implementation details of the I-TAP method and the unfairness metric as well as the data-sets we use. We further present the corresponding results to evaluate the performance of our approach. \else We present the implementation details of the I-TAP method and the unfairness metric in Appendix D. In the following, we describe the data-sets we use and present the corresponding results to evaluate the performance of our approach. \fi

%In the following, we first describe the \ifarxiv implementation details of the I-TAP method %(Section~\ref{sec:impl-details}) 
%and the \fi %specific 
%data-sets we use to test \ifarxiv its performance \else the performance of the I-TAP method. %(Section~\ref{sec:data-sets}). 
%\ifarxiv Finally \else Then\fi, we present %the
%results to evaluate the efficacy of our approach. %\ifarxiv \else We further present a numerical assessment of our theoretical bounds on the inefficiency ratio and level of unfairness in Appendix E. \fi %as compared to the algorithm used in \cite{so-routing-seminal}
%(Section~\ref{sec:numerical-results}).

\ifarxiv
\subsection{Implementation Details and Data Sets} \label{sec:impl-details}
\else
\subsection{Data Sets} \label{sec:impl-details}
\fi
\ifarxiv
We
tested our I-TAP method using a single-thread C++ implementation of
%\ifarxiv  
the Conjugate Frank-Wolfe algorithm~\cite{MitradjievaLindberg13},
%\else
%the Frank-Wolfe algorithm,
%\fi 
which we made publicly available along with our data sets and results ({\small\texttt{github.com\slash StanfordASL\slash \{\href{https://github.com/StanfordASL/frank-wolfe-traffic}{frank-wolfe-traffic}, \href{https://github.com/StanfordASL/fair-routing}{fair-routing}\}}}). Our implementation is based on a previous repository which was developed for~\cite{BuchETAL18}. While there is a rich literature on algorithm design to solve the traffic assignment problem~\cite{BARGERA2002,BARGERA20101022}, we decided to use the Frank-Wolfe algorithm which was shown recently to be superior in terms of running time~\cite{BuchETAL18}. For shortest-path computation in the all-or-nothing routine, we used the LEMON Graph Library~\cite{Lemon}. Within the same framework we implemented the solution method for CSO that was presented in~\cite{so-routing-seminal}, where we used 
\texttt{r\_c\_shortest\_paths} within
the Boost C++ Libraries~\cite{Boost}
for constrained shortest-path search.

To compute the resulting unfairness level for a given path flow $\f$ from those approaches we first recover a path-based solution by recording the paths computed for each commodity $k$ in every Frank-Wolfe iteration, and discarding paths whose relative weight in the final solution is negligible. Denote by $\P^+_k$ the resulting collection of paths for a given commodity $k$ with strictly positive flow. We also maintain for each path $P\in \P^+_k$ the volume of flow used by the path for this commodity. Then we recover for each commodity $k$ the edge-based solution by computing for each edge $e\in E$ the total flow resulting from the paths~$\P^+_k$. Then we discard edges from the graph whose flow is $0$ for the commodity $k$, which yields the DAG $G_k = (V_k,E_k)$, with vertices $V_k$ and edges $E_k$. 

Finally, to compute the unfairness level for this commodity, we compute the shortest and longest paths from origin to destination over the graph $G_k=(V_k,E_k)$, where a weight for a given edge $e\in E_k$ is set to be $t_e(x_e)$, i.e., the travel time on the edge given the flows of all the commodities combined with respect to the edge flow solution $\x$ corresponding to the path flow $\f$. To compute the shortest path over $G_k$ we simply run a Dijkstra search, whose running time is $\Theta(|E_k|+|V_k|\log |V_k|)$. Although for general graphs computing the longest path is NP-hard, for the case of a DAG, we can compute it for the same running time as Dijkstra by negating the edge weights, i.e., using the weights $-t_e(x_e)$ and then finding the shortest path~\cite{dag-book-algos}.

All results %presented below 
were obtained using a commodity laptop equipped with 2.80GHz 4-core i7-7600U CPU, and 16GB of RAM, running 64bit Ubuntu 20.04 OS. We ran the Frank-Wolfe algorithm for $100$ iterations on each data-set, both for I-TAP and the method in~\cite{so-routing-seminal}. We mention that %a previous study has shown that 
this number of iterations generally allows the Frank-Wolfe algorithm to achieve a relative error of at most $10^{-5}$ when searching for UE and SO solutions over larger scenarios of the traffic assignment problem~\cite{MitradjievaLindberg13}.
\fi

%\subsection{Data-sets} \label{sec:data-sets}

Table~\ref{tab:problem-instances} shows the six instances we use for our study, which were obtained from \cite{tntp}. %the \textit{Transportation Network Test Problems} website \cite{tntp}. %Table~\ref{tab:problem-instances} shows the details of each of the transportation networks. 
We use %to evaluate the travel times 
the BPR travel time function~\cite{Sheffi1985}, %which is 
defined as
\ifarxiv 
\begin{align} \label{eq:BPR}
    t_e(x_e) = \xi_e \left(1+ a \left(\tfrac{x_e}{\kappa_e} \right)^b \right),
\end{align}
where $a,b$ are constants, $\xi_e$ is the free-flow travel time on edge $e$, and $\kappa_e$ is the capacity of edge $e$, which is the number of users beyond which the travel time on the edge rapidly increases. Since the constants $a = 0.15$ and $b = 4$ are typically chosen, we use these constants for the numerical experiments. 
\else
$t_e(x_e) = \xi_e \big(1+ 0.15 \big(\tfrac{x_e}{\kappa_e} \big)^4 \big)$,
where $\xi_e$ is the free-flow travel time on edge $e$, and $\kappa_e$ is the capacity of edge $e$, which is the number of users beyond which the travel time on the edge rapidly increases.
\fi 

\begin{table}[t] 
%\vspace{-15pt}
\centering
\caption{{\small \sf Problem instance attributes and computation time. For each instance we report the number of vertices $|V|$, edges $|E|$, and %distinct
OD pairs $|K|$. In addition, we report the computation time of each instance for the previous method of Jahn et al.~\cite{so-routing-seminal} and our I-TAP method using 100 iterations of the Frank-Wolfe algorithm. }  }
\footnotesize
\begin{tabular}{l|ccc|cc}
\toprule

%\cline{3-9}
 &      \multicolumn{3}{|c|}{attributes} & \multicolumn{2}{c}{runtime (sec.)}    \\ 
Region Name  & $|V|$ & $|E|$ & $|K|$ & Jahn et al. & I-TAP \\
\midrule 
Sioux Falls (SF) & 24 & 76 & 528 & 20.0 & 0.03 \\
Anaheim (A) & 416 & 914  & 1406 & 74.0 & 0.33 \\
Massachusetts (M) & 74 & 258 & 1113  & 24.3 & 0.09 \\
Tiergarten (T)  & 361 & 766 & 644  & 18.2 & 0.20 \\
Friedrichshain (F)  & 224 & 523 & 506  & 19.8 & 0.12 \\
Prenzlauerberg (P)\  & 352 & 749 & 1406  & 74.4 & 0.32 \\
\bottomrule
\end{tabular} \label{tab:problem-instances}
%\vspace{-12pt}
\end{table}

\subsection{Results} \label{sec:numerical-results}

%Furthermore, for conciseness, we refer to the ratio of the total travel time of a traffic assignment for a convex combination parameter $\alpha$ and that of the SO solution as the inefficiency ratio.

\fakeparagraph{Assessment of Theoretical Upper Bounds.} 
\ifarxiv
We first assess the theoretical upper bounds on the inefficiency ratio and level of unfairness that were obtained in Section~\ref{sec:eff-properties} with respect to the convex combination parameter~$\alpha$. The latter is obtained using a dense sampling method with increments of $0.01$. We present the results for the Prenzlauerberg data-set and note that the results and the following discussion extend to other problem instances in Table~\ref{tab:problem-instances} as well.
\else 
We now assess the theoretical upper bounds on the inefficiency ratio and unfairness that were obtained in Section~\ref{sec:eff-properties}. We present the results for the Prenzlauerberg data-set and note that the results and the following discussion extend to other problem instances in Table~\ref{tab:problem-instances} as well.
\fi

%the other transportation networks studied in this work as well.

\ifarxiv
Figure~\ref{fig:theory_bounds} (left) depicts both (i) the change in the inefficiency ratio of the solution $\x(\alpha)$ using dense sampling
%for the Prenzlauerberg data-set using the dense sampling method at increments of $\alpha$ of $0.01$, 
and (ii) the theoretical upper bound of the inefficiency ratio (Theorem~\ref{thm:eff-upper-bound}). As expected, the dense sampling procedure results in an inefficiency ratio that is below the theoretical upper bound for every value of $\alpha$.  %thereby validating the result of Lemma~\ref{lem:eff-upper-bound}. 

The comparison between the theoretically guaranteed level of unfairness for every value of $\alpha$ as obtained in Theorem~\ref{thm:poly-ttf-result} and the actual unfairness level of the I-TAP method is depicted in Figure~\ref{fig:theory_bounds} (right). Since the BPR travel time function we used in this work has a degree of four, we have that for any value of $\alpha$, we can guarantee a level of unfairness of $4 \alpha + 1$ by Theorem~\ref{thm:poly-ttf-result}. %To obtain the theoretical upper bound curve, we note that for the parameters of the BPR function we used in this work that the degree of the travel time function is four. Thus, we have that for any value of $\alpha$, we can guarantee a level of unfairness of $4 \alpha + 1$ by Lemma~\ref{lem:poly-ttf-result}.
Figure~\ref{fig:theory_bounds} (right) suggests that the theoretical upper bound is even more conservative for the case of unfairness as there is an even larger gap between the actual solution and the theoretical bound. %, since for every value of the convex combination parameter $\alpha$, we have that the level of unfairness on the Prenzlauerberg data-set obtained through the I-TAP dense sampling procedure never exceeds the upper bound on the level of unfairness of $4 \alpha + 1$.

%Note further that the theoretical bounds on the inefficiency ratio and level of unfairness are not tight. This observation follows due to the discrepancy between the inefficiency ratios and level of unfairness of the I-TAP dense sampling procedure and the theoretical upper bounds. 
These findings further highlight the efficacy of the I-TAP approach for practical applications. %and motivate the development of tighter theoretical bounds.  %applications.
\else
Figure~\ref{fig:theory_bounds} depicts both (i) the change in the inefficiency ratio (left) and unfairness (right) of the solution $\x(\alpha)$ using dense sampling, and (ii) the theoretical upper bound of the inefficiency ratio (Theorem~\ref{thm:eff-upper-bound}) and unfairness (Theorem~\ref{thm:poly-ttf-result}). Since the BPR travel time function we used in this work has a degree of four, Theorem~\ref{thm:poly-ttf-result} implies that for any $\alpha$ we can guarantee an unfairness of $4 \alpha + 1$, as depicted in Figure~\ref{fig:theory_bounds} (right). As expected, the dense sampling procedure results in both an inefficiency ratio and unfairness that is below the theoretical upper bound for every value of $\alpha$, which highlights the efficacy of the I-TAP approach for practical applications.

%To construct the theoretical bound for unfairness, we note that since the BPR travel time function we used in this work has a degree of four, we have that for any value of $\alpha$, we can guarantee a level of unfairness of $4 \alpha + 1$ by Theorem~\ref{thm:poly-ttf-result}.

%The comparison between the theoretically guaranteed level of unfairness for every value of $\alpha$ as obtained in Theorem~\ref{thm:poly-ttf-result} and the actual unfairness level of the I-TAP method is depicted in Figure~\ref{fig:theory_bounds} (right). Since the BPR travel time function we used in this work has a degree of four, we have that for any value of $\alpha$, we can guarantee a level of unfairness of $4 \alpha + 1$ by Theorem~\ref{thm:poly-ttf-result}. Figure~\ref{fig:theory_bounds} (right) suggests that the theoretical upper bound is even more conservative for the case of unfairness as there is an even larger gap between the actual solution and the theoretical bound. 


\fi

\newcommand{\sfwidth}{0.5\columnwidth}
\newcommand{\siwidth}{0.99\linewidth}
\ifarxiv
\begin{figure*}
    \centering
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
         %trim=left bottom right top
            \include{Fig/P_center_ineff_bound_arxiv}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \vspace{2.5pt}
        \include{Fig/P_center_beta_bound_arxiv}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Comparison between the inefficiency ratio of the solution $\x(\alpha)$ of I-TAP on the Prenzlauerberg data-set and the theoretical bound on the inefficiency ratio obtained in Theorem~\ref{thm:eff-upper-bound} (left). The comparison between the theoretical upper bound of the level of unfairness for any convex combination parameter $\alpha$ and the unfairness level of the solution $\x(\alpha)$ of I-TAP on the Prenzlauerberg data-set is shown on the right. The values of the convex combination parameter were chosen at increments of $0.01$.}%, i.e., the $s$-net has $s = 0.01$.
    } %\vspace{-10pt} 
    \label{fig:theory_bounds}
\end{figure*}
\else
\begin{figure}
    \centering
    \begin{subfigure}[t]{0.495\columnwidth}
        \centering
         %trim=left bottom right top
            \include{Fig/P_center_ineff_bound}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[t]{0.495\columnwidth}
        \centering
        \vspace{2.5pt}
        \include{Fig/P_center_beta_bound}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Comparison between the inefficiency ratio (left) and unfairness (right) of the solution $\x(\alpha)$ of I-TAP sampling on the Prenzlauerberg data-set and the theoretical bounds obtained in Theorems~\ref{thm:eff-upper-bound} and~\ref{thm:poly-ttf-result}. %The comparison between the theoretical upper bound of the level of unfairness for any convex combination parameter $\alpha$ and the unfairness level of the solution $\x(\alpha)$ of I-TAP on the Prenzlauerberg data-set is shown on the right. 
    The convex combination parameters were chosen at increments of $0.01$.}%, i.e., the $s$-net has $s = 0.01$.
    } \vspace{-10pt} 
    \label{fig:theory_bounds}
\end{figure}
\fi



\fakeparagraph{Behavior of I-TAP.} For each of the transportation networks in Table~\ref{tab:problem-instances}, we now study the relationship between the convex combination parameter $\alpha$ and the (i) total travel time, and (ii) unfairness. \ifarxiv To review these relationships, we consider $\alpha$ to lie in the set $\A_s$ with $s = 0.01$ increments. \fi
%in turn. To present the results, consider the values of %the convex combination parameter 
%$\alpha$ to lie in the set $\A_s$ with $s = 0.01$ increments.

%$\{0.00, 0.01, 0.02, \ldots, 1.00 \}$, i.e., the set $\A_s$ is defined with $s = 0.01$ increments.

Figure~\ref{fig:tt_v_alpha_and_beta_v_alpha_finer_discretization} (left) shows the relationship between the inefficiency ratio and %the convex combination parameter 
$\alpha$. Note that when $\alpha = 1$, the inefficiency ratio is one, since the interpolated objective is the SO-TAP objective, and when $\alpha = 0$, the inefficiency ratio is the Price of Anarchy (PoA), since the interpolated objective is the UE-TAP objective. 
\ifarxiv  As shown on the left in Figure~\ref{fig:tt_v_alpha_and_beta_v_alpha_finer_discretization}, the inefficiency ratio is always between one and the PoA for each of the transportation networks, which corroborates the bound on the total travel time for any convex combination parameter, as obtained in Theorem~\ref{thm:eff-upper-bound}. Furthermore, the inefficiency ratio varies continuously in %the convex combination parameter 
$\alpha$, which further aligns with the continuity of the total travel time function $\objso$ in $\alpha$, as is characterized in Section~\ref{sec:solution-properties}. The jumps in the inefficiency ratio that can be observed for certain values of $\alpha$ %the convex combination parameter 
for Sioux Falls aligns with the continuity result since the relative magnitude of the jumps is small. In particular, the change in the total travel time is less than 2\% for a 1\% change in the value of $\alpha$.
\else %For any $\alpha \in (0, 1)$, the inefficiency ratio for each of the transportation networks is in accordance with our bound on the total travel time for any $\alpha$, as obtained in Lemma~\ref{lem:eff-upper-bound} (see Appendix E for more details). 
Furthermore, the inefficiency ratio varies continuously in $\alpha$, which aligns with the continuity of the travel time function $\objso$ in $\alpha$ (see Appendix B) and can be observed since the relative magnitude of the jumps in the inefficiency ratio for small changes in $\alpha$ is small.
\fi    %monotonically decreasing relationship between the  and %the convex combination parameter 
%$\alpha$.

The relationship between unfairness and %the convex combination parameter
$\alpha$ is depicted on the right in Figure~\ref{fig:tt_v_alpha_and_beta_v_alpha_finer_discretization}. For readability of this figure, we marked outliers as points where large changes in the unfairness occur for small changes in $\alpha$. %\ifarxiv  
For an explanation of the jumps in the unfairness at certain values of $\alpha$, see the discussion in \ifarxiv Section~\ref{sec:solution-properties}\else Appendix B\fi.
%\else %Its discontinuity 
%This discontinuity of the unfairness function stems from the fact that the optimal solutions $\x(\alpha_1)$ and $\x(\alpha_2)$ for convex combination parameters $\alpha_1$ and $\alpha_2$ that are arbitrarily close may not have the same set of paths with positive flow. Since the travel time on different paths can be very different, the unfairness function is discontinuous in $\alpha$.
%\fi 

%the relationship between the convex combination parameter $\alpha$ and the unfairness can be quite jagged, unlike the variation in the inefficiency ratio with $\alpha$. 
Finally, for each transportation network the general trend of a decrease in the inefficiency ratio and an increase in the unfairness with an increase in $\alpha$ suggests that decreasing the total travel time comes at the cost of an increase in the unfairness and vice versa.
%Despite the discontinuity of the unfairness function, we observe a general increase in the unfairness with an increase in $\alpha$.

%The general monotonic relationships between %the convex combination parameter 
%$\alpha$ and the (i) inefficiency ratio, and (ii) unfairness suggest that decreasing the total travel time comes at the cost of an increase in the unfairness and vice versa. %We now explore this efficiency-fairness tradeoff through a characterization of the Pareto frontier in Figure~\ref{fig:vals_updated}.

%observe this efficiency-fairness tradeoff through a characterization of the Pareto frontier in Figure~\ref{fig:vals_updated}, which we now explore in more detail.

\begin{figure*}
    \centering
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
         %trim=left bottom right top
            \include{Fig/cost_v_alpha_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[t]{0.48\columnwidth}
        \centering
        \vspace{2.5pt}
        \include{Fig/alpha_v_beta_outliers}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Variation in the inefficiency ratio (left) and the level of unfairness (right) of the optimal solution $\mathbf{x}(\alpha)$ of I-TAP$_{\alpha}$ with the parameter $\alpha \in [0, 1]$ for six different transportation networks from Table~\ref{tab:problem-instances}. The values of the convex combination parameter were chosen at increments of $0.01$.}%, i.e., the $s$-net has $s = 0.01$.
    } %\vspace{-10pt} 
    \label{fig:tt_v_alpha_and_beta_v_alpha_finer_discretization}
\end{figure*}

%\ifarxiv


%\fi

%\ifarxiv


\fakeparagraph{Solution Quality Comparison.} We now explore the efficiency-fairness tradeoff through a comparison of the Pareto frontier of the I-TAP method to the approach in \cite{so-routing-seminal}, which is a benchmark solution for fair traffic routing, and the I-Solution method described in Section~\ref{sec:algos}. %that of two different algorithms. In particular, we compare the I-TAP method to the approach in \cite{so-routing-seminal}, which is a benchmark solution for fair traffic routing, and the I-Solution method described in Section~\ref{sec:algos}. 
To this end, we depict the Pareto frontier of the (i) I-TAP method for $0.01$ and $0.05$
increments of the %convex combination 
parameter \ifarxiv$\alpha$, \else $\alpha$ (see Appendix E for a comparison between these Pareto frontiers), \fi (ii) I-Solution method for $0.01$ increments of the convex combination parameter $\gamma$, and (iii) Jahn et al.'s approach \cite{so-routing-seminal} for $0.05$ increments of the normal unfairness parameter $\phi$ lying between one and two. %\ifarxiv \else Since the choice of the increments can be important to the efficacy and tractability of the solution method, we compare the Pareto frontiers corresponding to the the two increments chosen for the I-TAP method in Appendix E. \fi

%We note that the choice of the increments can be important to the efficacy as well as tractability of the solution method and present a discussion on the comparison of the Pareto frontiers corresponding to the the two increments chosen for the I-TAP method in Appendix F. \fi
%by considering the normal unfairness parameter $\phi$ at $0.05$ increments lying between one and two.

%We now compare the results of the I-TAP method with two different algorithms by characterizing the Pareto frontier to study the trade-off between the total travel time and unfairness for each approach. 

%the first algorithm we compare the I-TAP method to is the approach proposed by Jahn et al. \cite{so-routing-seminal}, which is a benchmark solution for the CSO problem. The second algorithm we compare the I-TAP method to is based on the I-Solution methodology described in Section~\ref{sec:algos}. 


\begin{figure*}
    \centering
    \begin{subfigure}[btp]{0.323\columnwidth}
        \centering
         %trim=left bottom right top
         \include{Fig/pareto_solution_Anaheim_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[btp]{0.323\columnwidth}
        \centering
        \vspace{10pt}
           \include{Fig/pareto_solution_Massachusetts_0.01}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[btp]{0.323\columnwidth}
        \centering
        \vspace{10pt}
           \include{Fig/pareto_solution_Tiergarten_0.01}
        %\includegraphics[trim=45 5 400 10, clip,width=\siwidth]{fig/four robots v4.pdf}
    \end{subfigure}\par\medskip
    \vspace{-20pt}
    \hspace{0pt}
    \begin{subfigure}[btp]{0.323\columnwidth}
        \centering
         %trim=left bottom right top
         \include{Fig/pareto_solution_Friedrichshain_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}\hspace{8pt}
    \begin{subfigure}[btp]{0.323\columnwidth}
        \centering
        \vspace{10pt}
           \include{Fig/pareto_solution_SiouxFalls_0.01}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}\hspace{-5pt}
    \begin{subfigure}[btp]{0.323\columnwidth}
        \centering
        \vspace{10pt}
           \include{Fig/pareto_solution_PrenzlauerbergCenter_0.01}
        %\includegraphics[trim=45 5 400 10, clip,width=\siwidth]{fig/four robots v4.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Pareto frontier depicting the trade-off between efficiency and fairness for the %Variation in the Inefficiency Ratio with the level of unfairness for the 
    (i) I-TAP method with a step size $s = 0.01$, (ii) I-TAP method with $s = 0.05$,
    (iii) I-Solution method with $s = 0.01$, and (iv) Jahn et al.'s method~\cite{so-routing-seminal} with $s=0.05$.}}  %\vspace{-10pt}
    \label{fig:vals_updated}
\end{figure*}


Figure~\ref{fig:vals_updated} depicts the Pareto frontiers, i.e., the set of all Pareto efficient combinations of system efficiency and user fairness, %that reflect the tradeoff between the total travel time and unfairness 
for the six transportation networks in Table~\ref{tab:problem-instances}. In particular, observe that the Pareto frontiers of the I-TAP method %for both $0.01$ and $0.05$ increments of the convex-combination parameter 
are below that of the other two approaches for most values of unfairness. This observation indicates that the I-TAP method outperforms the other two approaches since the inefficiency ratio of the I-TAP solution is the lowest for most desired levels of unfairness. %This observation indicates that for most levels of unfairness the inefficiency ratio of the solution corresponding to the I-TAP method is the lowest, indicating that it outperforms the other two approaches for most desired levels of fairness. 
Only for the Sioux Falls and Prenzlauerberg data-sets, the algorithm in \cite{so-routing-seminal} achieved lower inefficiency ratios than both the I-TAP and I-Solution methods for higher values of unfairness, which, in practice, would be undesirable. Furthermore, note that, unlike the two convex-combination approaches, the solution of the algorithm in \cite{so-routing-seminal} can result in inefficiency ratios that are much greater than the PoA for low levels of unfairness. %Furthermore, note that for low levels of unfairness the solution of the algorithm in \cite{so-routing-seminal} can result in an inefficiency ratio that is much greater than the PoA. On the other hand, the two convex-combination approaches always result in an inefficiency ratio that is at most the PoA. 
The I-TAP method outperforms the I-Solution method since the set of paths that users can traverse is not restricted to the union of the routes under the UE and SO solutions as is the case for the I-Solution method. In particular, there may be traffic assignments with lower total travel times that use paths not encapsulated by the restricted set of paths corresponding to the I-Solution method. Furthermore, while the PoA for each of the data-sets is quite low, some real-world transportation networks may have much higher PoA values (even as high as two) \cite{boston-large-poa}, which would make the trade-off between efficiency and fairness even more prominent.

%The poor performance of the I-Solution method as compared to the I-TAP method is attributable to the fact that in the I-Solution method the set of paths that users can use is limited to the union of routes under the UE-TAP and SO-TAP solutions, which may be restrictive since there may be traffic assignments with lower total travel times that use paths not encapsulated by this set of routes.



\ifarxiv 
Finally, the Pareto frontiers of the I-TAP method for the $0.01$ and $0.05$ increments of the convex combination parameter almost overlap each other for all the transportation networks other than Sioux Falls. Since Sioux Falls has a highly discontinuous unfairness function (cf. Figure~\ref{fig:tt_v_alpha_and_beta_v_alpha_finer_discretization}), it is likely that the $0.05$ increments of $\alpha$ values may not capture all the low total travel time solutions that keep within a $\beta$ bound of unfairness that the $0.01$ increments of $\alpha$ may be able to capture. For all the other datasets, the near equivalence of the Pareto frontiers for the two $\alpha$ discretizations suggests that a good performance of the I-TAP method can be achieved with coarse discretizations of the convex combination parameter set. Thus, we only need to compute a solution to the convex program I-TAP$_{\alpha}$ for relatively few values of $\alpha$ to characterize the Pareto frontier, implying the computational efficiency of the I-TAP method. 
\else
\fi 



\fakeparagraph{Runtime Comparison.} We report in Table~\ref{tab:problem-instances} the runtime of the Jahn et al.\ method~\cite{so-routing-seminal} and our I-TAP method. For each instance we report the average runtime over the parameters $\phi$ and $\alpha$ for the competitor and our method, respectively. We observe that our approach is faster by at least three orders of magnitude. This is unsurprising since our method solves \emph{unconstrained} shortest-path queries, which can be implemented in $O(|E|+|V|\log |V|)$ time, within each Frank-Wolfe iteration, whereas~\cite{so-routing-seminal} solves \emph{constrained} shortest-path queries which are \ifarxiv known to be NP-hard. \fi We do mention that a more efficient implementation of constrained shortest-path query can be achieved by directly implementing a label-correcting algorithm rather than using the \texttt{r\_c\_shortest\_paths} routine from Boost, which is overly general for our setting and hence less efficient. Nevertheless, even with this improvement it would still be much slower than the unconstrained near-linear algorithm. Notice that both approaches can be sped up via parallel computation of shortest-path queries, and our method can be made even faster through modern heuristics for shortest-path queries
\ifarxiv 
in %the context of 
transportation networks, such as contraction hierarchies~\cite{GeisbergerETAL12}, as in~\cite{BuchETAL18}.
\else
\cite{BuchETAL18}.
\fi  

\section{Conclusion and Future Work} \label{sec:future-work}

In this paper, we developed (i) a computationally efficient method for traffic routing that trades-off system efficiency and user fairness, and (ii) pricing schemes to enforce fair traffic assignments as a UE. 
\ifarxiv  We introduced the I-TAP method, which involves solving interpolated traffic assignment problems by taking a convex combination between the UE-TAP and SO-TAP objectives, to find an efficient feasible traffic assignment to the \fso problem. We then established various solution properties of I-TAP, including computational tractability and solution continuity, and developed theoretical bounds on the inefficiency ratio and unfairness level in terms of the convex combination parameter of I-TAP. To enforce the traffic assignments outputted by the I-TAP method as a UE, we developed a marginal-cost pricing scheme when users are homogeneous, and a linear programming based pricing scheme when users are heterogeneous. Finally, we presented numerical experiments to evaluate the performance of our approach on real-world transportation networks. The results indicated that our algorithm is not only very computationally efficient but also generally results in traffic assignments with lower total travel times for most levels of unfairness as compared to the algorithm in
\cite{so-routing-seminal}.
\fi 


There are various directions for future research. First, it would be worthwhile to develop theoretical bounds for I-TAP to demonstrate its applicability to other notions of unfairness, some of which are studied in \ifarxiv Appendix~\ref{apdx:general-unfairness}\else Appendix F\fi, and extend its optimality beyond two-edge Pigou networks. Next, it would be interesting to investigate fairness notions that compare user travel times across different O-D pairs. Finally, given the significant computational advantages of the I-TAP method, it would be interesting to study the generalizability of our approach when accounting for costs beyond the travel times of users, such as environmental pollution and user discomfort.

\ifarxiv 
\section{Acknowledgements}
We thank Kaidi Yang and anonymous reviewers for their detailed inputs and insightful feedback on an earlier version of this work. This work was supported in part by the National Science Foundation (NSF) CAREER Award CMMI1454737, NSF Award 1830554, Toyota Research Institute, the Israeli Ministry of Science and Technology grants no.\ 3-16079 and 3-17385, and the United States-Israel Binational Science Foundation grants no.\ 2019703 and 2021643.
\fi 


\bibliographystyle{ACM-Reference-Format} 
%\bibliography{main}
%\begin{comment}
%{\small
%\bibliographystyle{unsrt}
\bibliography{main}
%}
%\end{comment}




%\clearpage

\appendix

\section*{Appendix}

\section{Proof of Lemma~\ref{lem:itap-optimal-pigou}}
\label{apdx:pf-pigou-optimal}

To prove the claim, we first note that in a two edge Pigou network the sum of the traffic flows on the two edges must add up to the traffic demand $D$. Thus, we can reduce the problem of determining a two-dimensional vector of edge flows to a single dimensional problem of determining the flow $x_1$ on the first edge, with the flow on the other edge given by $D-x_1$ for a traffic demand $D$. With slight abuse of notation, we denote $\objso(x_1)$, $\objue(x_1)$ and $\objitap(x_1)$ to denote the system optimum, user equilibrium and I-TAP objectives, respectively.

We now complete the proof in two steps. First we show that the optimal solutions of I-TAP for any $\alpha \in [0, 1]$ and the \fso problem lie between the user equilibrium and system optimum solutions, i.e., $x_1(\alpha), x_1^{\beta} \in [x_1(0), x_1(1)]$ for all $\alpha \in [0, 1]$ and $\beta \in [1, \infty)$, where we assume without loss of generality that $x_1(0) \leq x_1(1)$. Note here that we only compare the edge flows of I-TAP and \fso since both the path and edge flows coincide for a two edge Pigou network. We then extend the result of Corollary~\ref{cor:lipschitz-cont-x} to show that the optimal solution $x_1(\alpha)$ is continuous in the closed interval $[0, 1]$. Note that both the above claims jointly imply by the intermediate value theorem that for any $\beta \in [1, \infty)$ there exists some $\alpha^* \in [0, 1]$ such that $x_1(\alpha^*) = x_1^{\beta}$. We now proceed to prove the two claims.

We begin by establishing that $x_1(\alpha) \in [x_1(0), x_1(1)]$ for any $\alpha \in [0, 1]$. In particular, we will show that for any point not in the interval $[x_1(0), x_1(1)]$ that we can find another feasible point with a lower I-TAP objective value. To see this, we proceed by contradiction. Fix some $\alpha \in [0, 1]$ and suppose that $x_1(\alpha) < x_1(0)$. Then, we observe by the optimality of $x_1(0)$ for the user equilibrium traffic assignment problem that $\objue(x_1(\alpha))>\objue(x_1(0))$ and by the strict convexity of $\objso$ that $\objso(x_1(\alpha))> \objso(x_1(0))$. Together, both the strict inequalities imply that $\objitap(x_1(\alpha))>\objitap(x_1(0))$, a contradiction. Through an almost identical argument, we can show that $x_1(\alpha)>x_1(1)$ is also not possible. Thus, we have shown that $x_1(\alpha) \in [x_1(0), x_1(1)]$ for any $\alpha \in [0, 1]$.

Next, we show that $x_1^{\beta} \in [x_1(0), x_1(1)]$ for any $\beta \in [1, \infty)$. In particular, we will show that for any point not in the interval $[x_1(0), x_1(1)]$ that we can find another feasible point with a lower system optimum objective value. To see this, we again proceed by contradiction. First suppose that $x_1^{\beta} < x_1(0)$. In this case, note that $\objso(x_1^{\beta}) > \objso(x_1(0))$ by the strict convexity of $\objso$. Since $x_1(0)$ is a feasible solution to the \fso problem for any $\beta \in [1, \infty)$ this implies that $x_1^{\beta} < x_1(0)$ cannot be an optimal solution to the \fso problem. This implies that $x_1^{\beta} \geq x_1(0)$. Next, suppose by contradiction that $x_1^{\beta}>x_1(1)$. If $x_1^{\beta} = D$, then $\objso(x_1^{\beta}) = D t_1(D) > D t_1(x_1(0)) = x_1(0) t_1(x_1(0)) + (D-x_1(0)) t_2(x_2(0)) = \objso(x_1(0))$ since $x_1(0) < x_1^{\beta} = D$. Thus, $x_1(0)$ achieves a lower total travel time and is feasible for any $\beta \in [1, \infty)$, and so $x_1^{\beta} = D$ cannot be a solution to the \fso problem. Next, suppose that $x_1(1)<x_1^{\beta} < D$. In this case, we have that $\frac{t_1(x_1^{\beta})}{t_2(D - x_1^{\beta})} > \max \{ \frac{t_1(x_1(1))}{t_2(D - x_1(1))}, 1 \}$, and thus the ratio of travel times is strictly greater than than that under the system optimal traffic assignment. Thus, we have that for any $\beta \in [1, \infty)$ it must be the case that $x_1^{\beta} \leq x_1(1)$, thereby proving our claim that $x_1^{\beta} \in [x_1(0), x_1(1)]$.

We now prove the second claim that $x_1(\alpha)$ is continuous in the closed interval $[0, 1]$. First observe by Corollary~\ref{cor:lipschitz-cont-x} that $x_1(\alpha)$ is continuous in the open interval $(0, 1)$. Thus, we just need to prove the continuity of $x_1(\alpha)$ for $\alpha = 0, 1$. To do so, we introduce a problem instance specific constant $C(G, D, \{t_e\}_{e = 1}^2)$ that denotes the system optimum objective value when $x_1 = x_2 = D$. We note that $C(G, D, \{t_e\}_{e = 1}^2)$ is an upper bound on the system optimal objective for any feasible traffic assignment and it is a constant that depends on the graph $G$, the demand $D$ and the travel time functions. We prove the continuity for $\alpha = 0$ in what follows. First, observe that
\begin{align*}
    \objitap(x_1(0)) - \objitap(x_1(\alpha)) %&= \alpha \objso(x_1(0)) + (1-\alpha) \objue(x_1(0)) \\&-  \alpha \objso(x_1(\alpha)) - (1-\alpha) \objue(x_1(\alpha)), \\
    &= \alpha \left( \objso(x_1(0)) - \objso(x_1(\alpha)) \right) \\&+ (1-\alpha) \left( \objue(x_1(0)) - \objue(x_1(\alpha)) \right), \\
    &< \alpha \left( \objso(x_1(0)) - \objso(x_1(\alpha)) \right), \\
    &\leq \alpha C(G, D, \{t_e\}_{e = 1}^2),
\end{align*}
where the strict inequality follows since $\objue(x_1(0)) < \objue(x_1(\alpha))$, and the last inequality follows by the boundedness of $\objso$ due to the finite demand $D$. Finally, by the strict convexity of the objective $\objitap(\cdot)$ it must follow that $x_1(\alpha) \rightarrow x_1(0)$ as $\alpha \rightarrow 0$ since $\objitap(x_1(0)) \rightarrow \objitap(x_1(\alpha))$ as $\alpha \rightarrow 0$ by the above analysis. Thus, we have continuity of $x_1(\alpha)$ for $\alpha = 0$. Through an analogous analysis we can also obtain continuity for $\alpha = 1$.

Finally, we note that both the above claims jointly imply by the intermediate value theorem that for any $\beta \in [1, \infty)$ there exists some $\alpha^* \in [0, 1]$ such that $x_1(\alpha^*) = x_1^{\beta}$, thereby proving our result.


\section{Additional Unfairness Measures} \label{apdx:general-unfairness}

While we presented an unfairness notion in Section~\ref{sec:fair-eff-metric} that compares the ratio of the travel times on positive paths, there have been many other unfairness notions that have been investigated in the fair traffic routing literature as well as in other economic applications to evaluate the distribution of a resource among users. In this section, we present a few other commonly-used unfairness measures used in the traffic routing and economics literature (Section~\ref{sec:apdx-new-measures}) and a numerical study of these unfairness measures (Section~\ref{sec:apdx-numerical}) on the six instances in Table~\ref{tab:problem-instances}.

%These unfairness notions are typically defined for the scenario when users are constrained to use paths as dictated by a traffic navigational application or a centrally controlled mobility system and are thus dependent on the specific path flows of the users. This is in contrast to the unfairness measure presented in Section~\ref{sec:fair-eff-metric}, which depends on the edge flows rather than a specific path decomposition.

%In particular, these unfairness metrics are dependent on the specific path flows of the users unlike the unfairness measure presented in Section~\ref{sec:fair-eff-metric}, which depends on the edge flows rather than a specific path decomposition.

%In this section, we first present a problem analogous to \fso for unfairness measures that are based on the realized path flows (Section~\ref{sec:apdx-fpso}). Then, we present a few commonly-used unfairness measures used in the traffic routing and economics literature (Section~\ref{sec:apdx-new-measures}) and a numerical study of these unfairness measures (Section~\ref{sec:apdx-numerical}) on the six instances in Table~\ref{tab:problem-instances}.
\begin{comment}
\color{red}
\subsection{Unfairness Based on Realized Path Flows} \label{sec:apdx-fpso}
The unfairness measure presented in Section~\ref{sec:fair-eff-metric} ensures that no path decomposition of an edge flow $\x$ can have a greater ratio between the travel times of any two paths for a given O-D pair. This enabled the formulation of the \fso problem, which entailed finding $\beta$-unfair flows with the minimum total travel time, solely in terms of the edge flows. As a result, this unfairness measure has the benefit that it applies to any path decomposition, and so is relevant in cases where users are not constrained to a specific decomposition, as happens in practice. Furthermore, since tolls induce unique edge flows, the satisfaction of a given bound of this unfairness measure is guaranteed to result in a path decomposition wherein the maximum ratio of user travel times is no more than the specified unfairness bound. However, a disadvantage of this unfairness measure is that it provides an upper bound as opposed to the experienced ratio of user travel times observed  through the equilibrium behavior of users in practice. Additionally, it is difficult to extend edge flow based unfairness measures to fairness metrics beyond the ratio of user travel times, e.g., the Gini coefficient, since knowledge of the distribution of user travel times is necessary.

%over all path decompositions is difficult to compute.

In contrast to the earlier presented unfairness measure, we now consider metrics that are relevant for when users are guaranteed to be using a specific path set, e.g., when they abide to paths dictated by a traffic navigational system or a centrally controlled mobility system, such as an Autonomous Mobility on Demand (AMoD) service. Furthermore, such path flow based measures enable the evaluation of a broader class of metrics such as the Gini coefficient, since the distribution of user travel times is known for the given path decomposition.

For the path flow specific unfairness measures, we thus consider the problem of the \emph{existence} of a path flow decomposition that achieves the minimum total travel time while keeping within a certain bound on unfairness $\Tilde{U}$. Here, for a given path flow $\f = \{ \x_P: P \in \cup_{k \in K} \P_k \}$, $\Tilde{U}(\f)$ is the level of unfairness for any well-defined unfairness measure. We present examples of possible unfairness measures in Section~\ref{sec:apdx-new-measures} and now formally introduce the path-based analogue of the \fso problem as follows.%, and let $\Tilde{U}$ be an arbitrary unfairness measure

\begin{problem} (Path-based $\beta$-System Optimum (\fpso))
Let $G = (V, E)$ be a road network with travel time functions $t_e$ and travel demands $d_k$ for each commodity $k \in K$. Then, the \fpso problem is to compute a vector of path flows $\f$ satisfying the travel demands that achieves the minimum total travel time while ensuring that the level of unfairness with respect to the measure $\Tilde{U}$ is no more than $\beta$, i.e., $\Tilde{U}(\f) \leq \beta$.
\end{problem}
We note that, in general, one cannot make strict theoretical claims on the efficacy of an algorithm for such unfairness measures, since these unfairness notions are likely to be very sensitive to the methodology used to compute the path decomposition. We do perform a numerical study to evaluate the performance of I-TAP for such unfairness measures in Section~\ref{sec:apdx-numerical}.

%This approach mirrors earlier work~\cite{basu2017reconciling} on finding a path flow that keeps 
\color{black}
\end{comment}


\subsection{Unfairness Measures for Path Flows} \label{sec:apdx-new-measures}

In this section, we present several measures that can be used to evaluate the level of unfairness of a traffic assignment. While many unfairness measures for traffic routing have been proposed, most notions rely on a quantification of the discrepancy between user travel times. For instance,~\citet{correa-fair} measure unfairness through the maximum ratio of the travel times between two users for a given set of path flows $\f$ of the edge flow $\x$. This definition of unfairness is termed as ``envy-free'' by~\citet{basu2017reconciling} since one user can envy another's path by a factor no more than $\beta$. An analogous notion to the envy-free definition is that of a ``Used Nash Equlibrium'', wherein the level of unfairness is calculated through the maximum ratio between the experienced travel time for any given user to the travel time on any other positive path between the same O-D pair. Note that the ``Used Nash Equlibrium'' serves as an intermediary to the unfairness notion presented Section~\ref{sec:fair-eff-metric} and the envy-free notion. There are also several other definitions of max-min fairness proposed in the traffic routing literature, and we defer the interested reader to a discussion of some of these notions to~\citet{so-routing-seminal}.

Beyond the fairness notions considered in the traffic routing literature, there have also been other measures proposed to evaluate fairness or equity in the distribution of a given resource amongst users. One such popular measure is the Gini coefficient~\cite{gini-index}, which is used to evaluate the level of dispersion of wealth in society. Applying this idea in context of traffic routing, we can use the discrete Gini coefficient measure~\cite{WU20121273,jalota-cprr} to evaluate the spread in the travel times of users travelling between the same O-D pair. We summarize the above mentioned unfairness measures in Table~\ref{tab:unfair-measures}. 

Note that some path decompositions may be more fair according to one metric as compared to another. For instance, consider the situation when a small group of users incur an exceedingly large travel time while the remaining users travelling between the same O-D pair incur a small travel time. In this case, the level of unfairness for the Envy Free and Used Nash measures will typically be high but the level of unfairness as measured according to the Gini measure will be quite low. As a result, each of these metrics has their own merit as well as limitations when applied to measuring the level of unfairness of specific path flow decompositions.

\begin{table}[!] 
%\vspace{-15pt}
\centering
\caption{{\small \sf Path-based unfairness Measures that depend on the realization of a specific path flow decomposition $\f$ of an edge flow $\x$. }  }
\small
\begin{tabular}{cc}
\toprule
Unfairness Measure  & Formula ($\Tilde{U}(\f)$) \\
\midrule 
Envy Free & $\max_{k \in K} \max_{Q, R \in \P_k: \x_Q, \x_R>0} \frac{t_Q(\x)}{t_R(\x)} $ \\
Used Nash & $\max_{k \in K}  \max_{R \in \P_k^+, Q\in \P_k: \x_Q>0} \frac{t_Q(\x)}{t_R(\x)} $ \\
Discrete Gini Coefficient & $\max_{k \in K} \frac{\sum_{P, Q \in \P_k} \x_{Q} \x_{P} |t_Q(\x) - t_P(\x)|}{2 d_k \sum_{P \in \P_k} \x_{P} t_{P}(\x)} $ \\
\bottomrule
\end{tabular} \label{tab:unfair-measures}
\end{table}
Finally, observe that each of the above defined notions of unfairness involve taking a maximum of the unfairness measure for each O-D pair. We note that different methods of aggregating across O-D pairs can also be used, e.g., averaging the unfairness measure. Furthermore, there is a key aspect of the above defined unfairness measures that makes the I-TAP a particularly natural approach for balancing efficiency and fairness. In particular, for each of the above defined unfairness notions, the user equilibrium achieves the highest possible level of fairness, while the system optimum achieves the lowest total travel times. Thus, interpolating between the UE and SO objectives can potentially achieve the best of both worlds, i.e., a low total travel time with a high level of fairness.

\subsection{Numerical Results} \label{sec:apdx-numerical}
We now present some numerical results to demonstrate the performance of I-TAP with respect to the above defined path-based unfairness measures. In particular, we use the Frank Wolfe method to compute a specific path decomposition for I-TAP and use this to evaluate the level of unfairness based on the Envy-Free and discrete Gini coefficient metrics. Figures~\ref{fig:vals_updated_envy_free} and~\ref{fig:vals_updated_gini} depict the trade-off between system efficiency and unfairness for the two metrics, Envy-Freeness and the discrete Gini coefficient, respectively.

\begin{comment}
\begin{figure*}
    \centering
    \begin{subfigure}[t]{0.98\columnwidth}
        \centering
         %trim=left bottom right top
            \include{Fig/alpha_v_envyfree}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[t]{0.98\columnwidth}
        \centering
        \include{Fig/alpha_v_gini}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Variation in the level of envy-freeness (left) and discrete Gini coefficient of the optimal solution $\mathbf{x}(\alpha)$ of the problem I-TAP$_{\alpha}$ with the convex combination parameter $\alpha \in [0, 1]$ for six different transportation networks from Table~\ref{tab:problem-instances}. The values of the convex combination parameter were chosen at increments of $0.01$.}%, i.e., the $s$-net has $s = 0.01$.
    }  
    \label{fig:unfairness_v_alpha_new_measures}
\end{figure*}
\end{comment}


%\newcommand{\sfwidth}{0.5\columnwidth}
%\newcommand{\siwidth}{0.99\linewidth}
\begin{figure*}
    \centering
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
         %trim=left bottom right top
         \include{Fig/EnvyFree_pareto_solution_Anaheim_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/EnvyFree_pareto_solution_Massachusetts_0.01}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/EnvyFree_pareto_solution_Tiergarten_0.01}
        %\includegraphics[trim=45 5 400 10, clip,width=\siwidth]{fig/four robots v4.pdf}
    \end{subfigure}\par\medskip
    \vspace{-20pt}
    \hspace{0pt}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
         %trim=left bottom right top
         \include{Fig/EnvyFree_pareto_solution_Friedrichshain_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}\hspace{8pt}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/EnvyFree_pareto_solution_SiouxFalls_0.01}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}\hspace{-5pt}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/EnvyFree_pareto_solution_PrenzlauerbergCenter_0.01}
        %\includegraphics[trim=45 5 400 10, clip,width=\siwidth]{fig/four robots v4.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Pareto frontier depicting the trade-off between efficiency and ``envy-freeness'' for the %Variation in the Inefficiency Ratio with the level of unfairness for the 
    (i) I-TAP method with a step size $s = 0.01$, and (ii) Jahn et al.'s method with $s=0.05$.}} %\ifarxiv  \vspace{-10pt} \else \vspace{-20pt} \fi 
    \label{fig:vals_updated_envy_free}
\end{figure*}

\begin{figure*}
    \centering
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
         %trim=left bottom right top
         \include{Fig/Gini_pareto_solution_Anaheim_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/Gini_pareto_solution_Massachusetts_0.01}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/Gini_pareto_solution_Tiergarten_0.01}
        %\includegraphics[trim=45 5 400 10, clip,width=\siwidth]{fig/four robots v4.pdf}
    \end{subfigure}\par\medskip
    \vspace{-20pt}
    \hspace{0pt}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
         %trim=left bottom right top
         \include{Fig/Gini_pareto_solution_Friedrichshain_0.01}
        %\includegraphics[trim=0 5 440 10, clip, width=\siwidth]{fig/optimal_length_1_bold.pdf}
    \end{subfigure}\hspace{8pt}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/Gini_pareto_solution_SiouxFalls_0.01}
        %\includegraphics[trim=0 20 470 10, clip, width=\siwidth]{fig/spiral_bold.pdf}
    \end{subfigure}\hspace{-5pt}
    \begin{subfigure}[b]{0.323\columnwidth}
        \centering
           \include{Fig/Gini_pareto_solution_PrenzlauerbergCenter_0.01}
        %\includegraphics[trim=45 5 400 10, clip,width=\siwidth]{fig/four robots v4.pdf}
    \end{subfigure}
    \vspace{-15pt}
    \caption{{\small \sf Pareto frontier depicting the trade-off between efficiency and discrete Gini coefficient for the %Variation in the Inefficiency Ratio with the level of unfairness for the 
    (i) I-TAP method with a step size $s = 0.05$, and (ii) Jahn et al.'s method with $s=0.05$.}} %\ifarxiv  \vspace{-10pt} \else \vspace{-20pt} \fi 
    \label{fig:vals_updated_gini}
\end{figure*}

We note that the Pareto-frontier depicting the Envy-Free metric in Figure~\ref{fig:vals_updated_envy_free} is almost identical to the Pareto frontier of the edge-based unfairness metric presented in Section~\ref{sec:fair-eff-metric}. This observation suggests that for many practical instances these two notions of unfairness are quite close to each other. We note this despite the fact that the Envy-Free notion involves the maximum ratio between experienced travel times for a given flow decomposition while the edge-based unfairness metric involves the maximum possible ratio between travel times on positive paths and is thus independent of the realized path decomposition. Since the Used Nash measure is an intermediary between the Envy-Free and the edge-based unfairness measure in Section~\ref{sec:fair-eff-metric}, we note that it would also correspond to near identical Pareto frontiers for the six tested instances. Thus, we do not depict the Used Nash unfairness measure.

%We do not depict the Used Nash unfairness measure since the Pareto frontiers for the six instances in Table~\ref{tab:problem-instances} corresponding to the edge-based unfairness notion in Section~\ref{sec:fair-eff-metric} and the Envy Free measure are near identical. As a result, the Used Nash measure, which serves as an intermediary between these two measures, would also have near identical Pareto frontiers for the six tested instances.

For the discrete Gini coefficient metric, we first note that at the user equilibrium solution the discrete Gini coefficient is zero, rather than having unfairness of one for the earlier explored unfairness measures. This is because all users travelling between the same O-D pair have equal travel times at the user equilibrium and thus the numerator of the discrete Gini coefficient is 0. Note that the further the discrete Gini coefficient is away from zero the more unfair the solution.

We observe from Figure~\ref{fig:vals_updated_gini} that, modulo numerical errors, the discrete Gini coefficient of the user equilibrium for all the scenarios is very close to zero. As with the earlier explored unfairness measures, we also observe that the I-TAP method outperforms the approach used in~\citet{so-routing-seminal} even on the discrete Gini coefficient metric for low levels of desired Gini coefficients for all data-sets but Prenzlauerberg. 






\end{document}