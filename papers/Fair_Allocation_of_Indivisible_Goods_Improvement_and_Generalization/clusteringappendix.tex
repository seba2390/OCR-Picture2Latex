\section{Omitted Proofs of Section \ref{additive:clusters}}\label{clusteringappendix}

\begin{proof}[of Lemma \ref{forc2c3}]
By definition, there is no edge between the vertices of $F_{G_{1/2}}(M,\itemsv_{1/2})$ and $\agentsv_{1/2} \setminus N(F_{G_{1/2}}(M,\itemsv_{1/2}))$ in $G_{1/2}$. Furthermore, all the items are in worth less than $1/2$ for the agents corresponding to the vertices in $\agentsv \setminus \agentsv_{1/2}$. Thus, for every agent $\agent_i$ and every item $\ite_j$ with $\agentv_i \in \agentsv \setminus N(F_{G_{1/2}}(M,\itemsv_{1/2}))$ and $\itemv_j \in F_{G_{1/2}}(M,\itemsv_{1/2})$, we have $\valu_i(\ite_j)<1/2$. According to the fact that the agents that are not selected in the clustering of $\cone$ either belong to $\ctwo$ or $\cthree$, we have:
\[ \forall \agent_j \in \cone \qquad \valu_i(\firstset_j) < 1/2. \]
\end{proof}

\begin{proof}[of Lemma \ref{nicematch}]
First, we prove Lemma \ref{v1size}. This lemma ensures that there exists a matching in $G_1$ that saturates all the vertices in $W_1$. Lemma \ref{v1size} is a consequence of irreducibility. In fact, we show that if the condition in Lemma \ref{v1size} does not hold, the instance is reducible.
\begin{lemma}
\label{v1size}
For graph $G_1$, we have $$ \forall R \subseteq  W_1, \qquad |N(R)| > |R|.$$ 
\end{lemma}
\begin{proof}
Let $M_1$ a matching with the maximum number of edges in $G_1$ . Regarding Lemma \ref{iff}, it only suffices to show that $F_{G_1}(M_1,W_1)$ is empty. For the sake of contradiction, suppose that $F_{G_1}(M_1,W_1)$ is not empty. As mentioned before, there exists a matching between $F_{G_1}(M_1,W_1)$ and $N(F_{G_1}(M_1,W_1))$ that saturates all the vertices in $N(F_{G_1}(M_1,W_1))$. Let 
$$M_S = \{(\itemv_{j_1},\agentv_{i_1}),(\itemv_{j_2},\agentv_{i_2}),\ldots,(\itemv_{j_k},\agentv_{i_k})\}$$
be this matching. We show that the set of agents $$T= \{\agent_{i_1}, \agent_{i_2}, \ldots, \agent_{i_k}\}$$ and the set of items $$S = \{\firstset_{i_1}, \ite_{j_1},\firstset_{i_2},\ite_{j_2},\ldots, \firstset_{i_k},\ite_{j_k} \}.$$
have all three conditions in Lemma \ref{remove3} (Note that $\firstset_{i_l}$ contains exactly one item).  The first condition is trivial: $|S| = 2|T|$. Regarding the definition of an edge in $G_1$, we know that $\firstset_{i_l} \cup \{\ite_{j_l}\}$ satisfy $\agent_{i_l}$ and hence, the second condition is held as well.  
For the third condition, we should prove that for every agent $\agent_{i_l}$ in $T$, 
$$\valu_{i'}(\firstset_{i_l} \cup \{\ite_{j_l}\}) < 1 \qquad  \forall \agent_{i'} \notin T .$$
To show this, we consider two cases separately. First, if $\agent_{i'} \notin C_1$, by Lemma \ref{forc2c3}, $\valu_{i'}(\firstset_{i_l})<1/2$ and by Observation \ref{w1small}, $\valu_{i'}(\{\ite_{j_l}\})<1/2$, which means $\valu_{i'}(\firstset_{i_l} \cup \{\ite_{j_l}\}) < 1$.

Moreover, consider the case that $\agent_{i'} \in C_1$. Note that since $\agent_{i'} \notin T$, it's corresponding vertex $\agentv_{i'}$ is not in $N(F_{G_1}(M_1,W_1))$, which means:
$$\agentv_{i'} \in V_{C_1} \setminus N(F_{G_1}(M_1,W_1)).$$
By the definition of $N(F_{G_1}(M_1,W_1)$, there is no edge between $\agentv_{i'}$ and $\itemv_{j_l}$ and hence, $\valu_{i'}(\{\ite_{j_l}\})< \epsilon_{i'} \leq 1/4$. On the other hand, by the irreducibility assumption and the fact that $\firstset_{i_l}$ contains exactly one item,  $\valu_{i'}(\firstset_{i_l}) < 3/4$. Thus, $\valu_{i'}(\firstset_{i_l} \cup \{\ite_{j_l}\}) < 1$. 

As a result, $\valu_{i'}(\firstset_{i_l} \cup \{\ite_{j_l}\}) < 1$ for every agent $\agent_{i'} \notin T$ which means the third condition of Lemma \ref{remove3} is held as well. Thus, regarding Lemma \ref{remove3}, the instance is reducible. But this contradicts the irreducibility assumption.
\end{proof}

The rest of the proof of Lemma \ref{nicematch} is as follows. Since we used $\MCMWM$ to build cluster $\cone$, regarding Lemma \ref{wm}, $\cone$ is cycle-envy-free. Consider the topological ordering of $\cone$ and let $p_{a_i}$ be the position of $\agent_i$ in this ordering. More precisely, $p_{\agent_i} = k$ if $\agent_i$ is the $k$-th agent in the topological ordering of $\cone$.

According to Lemma \ref{v1size}, the condition of Hallâ€™s Theorem holds for graph $G_1$ and as a result there exists a matching in $G_1$ that saturates all the vertices in $W_1$. Among all possible maximum matchings of $G_1$, let $M_1$ be a maximum matching that minimizes $$p_{M_1} = \sum_{\agentv_i \in M_1} p_{a_i}.$$ We claim that $M_1$ is the desired matching described in Lemma \ref{nicematch}. To prove our claim, we must show that for any edge $(\itemv_i, \agentv_j) \in M_1$ and any unsaturated vertex $\agentv_k \in N(\itemv_i)$, $\agent_j$ is a loser for the set $\{\agent_j, \agent_k\}$, which means $\agent_k$ does not envy $\agent_j$. Note that if $\agent_k$ envies $\agent_j$, $\agent_k$ appears before $\agent_j$ in the topological ordering of $\cone$ which means $p_{\agent_k} < p_{\agent_j}$. Therefore, if we replace $(\itemv_i, \agentv_j)$ by $(\itemv_i, \agentv_k)$ in $M_1$, $p_{M_1}$ will be decreased that contradicts the minimality of $p_{M_1}$.
\end{proof}

\begin{proof}[of Lemma \ref{gsmallc1r}]
Let $\ite_k$ be the item assigned to $\agent_j$ in the refinement of $\cone$. Since $\itemv_k \in W_1$, according to Observation \ref{w1small}, $\valu_i(\secondset_j)< 1/2$. 
\end{proof}

\begin{proof}[of Lemma \ref{forc2}]
Let $\agent_j$ be an agent in $\satagents_1^r$. First, note that $|\firstset_j| = |\secondset_j| = 1$. Lemma \ref{forc2c3} together with Observation \ref{w1small} state that $\valu_i(\firstset_j \cup \secondset_j)<1$. According to Inequality (\ref{saeed1}), we have  
\begin{equation}
\label{eq100}
\MMS_{\valu_i}^{|\agents \setminus \agent_j|} ( {\items} \setminus \firstset_j \cup \secondset_j) \geq 1.
\end{equation}
 Note that Equation (\ref{eq100}) holds for every agent in $\satagents_1^r$. Applying Equation (\ref{eq100}) to all the agents of $\satagents_1^r$ yields
 \[ \MMS_{\valu_i}^{|\agents \setminus \satagents_1^r|} ( {\items} \setminus \bigcup_{\agentv_i \in \satagents_1^r} \firstset_i \cup \secondset_i) \geq 1.\] 


\end{proof}

\begin{proof}[of Lemma \ref{c1small2}]
According to Observation \ref{fsmallc1}, for any agent $a_k \in \cone$ and for every $\itemv_j \in \itemsv' \setminus \itemsv'_{1/2}$ we have $V_k(\{b_j\}) < \epsilon_k$. By additivity assumption, for any $\agent_k \in \cone$  we have 
$$ \forall {x_i, x_j \in \itemsv' \setminus \itemsv'_{1/2}} \qquad V_k(\{b_i, b_j\}) < 2\epsilon_k.$$
\end{proof}

\begin{proof}[of Lemma \ref{pairsmall}]
Suppose for the sake of contradiction that the problem is $3/4$-irreducible, and there exists a vertex $y_k \in \agentsv$ such that $V_k(\{b_i, b_j\}) \geq 3/4$. According to Lemma \ref{remove2} there exists an agent $a_{k'} \neq a_k$ such that $$V_{k'}(\{b_i, b_j\}) \geq 1.$$
Since the valuations are additive, we know that one of the inequalities $V_{k'}(\{b_i\}) \geq 1/2$ or $V_{k'}(\{b_j\}) \geq 1/2$ are held, which is contradiction, since we know both $\itemv_i$ and $\itemv_j$ belong to $\itemsv' \setminus \itemsv'_{1/2}$.
\end{proof}

\begin{proof}[of Lemma \ref{sizeeq}]
We prove Lemma \ref{sizeeq} in two steps. Firstly, we show that
\begin{equation}
\label{ineqhadi2}
|F_{G'_{1/2}}(M',\itemsv'_{1/2})| \leq |N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))|.
\end{equation}
Furthermore, we prove 
\begin{equation}
\label{ineqhadi1}
|F_{G'_{1/2}}(M',\itemsv'_{1/2})| \geq |N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))|.
\end{equation}
Inequalities \eqref{ineqhadi1} and \eqref{ineqhadi1} yields
\begin{equation}
\label{ineqhadi3}
|F_{G'_{1/2}}(M',\itemsv'_{1/2})| = |N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))|.
\end{equation}


\textbf{To show Inequality \eqref{ineqhadi2},} argue that before Algorithm \ref{addvertex} starts, we have $$F_{G'_{1/2}}(M',\itemsv'_{1/2}) = \emptyset$$ and  $$N(F_{G'_{1/2}}(M',\itemsv'_{1/2})) = \emptyset$$ and all the vertices in $\itemsv'_{1/2}$ are saturated by $M'$. In each step of Algorithm \ref{addvertex}, we add a new vertex to $\itemsv'_{1/2}$, and the size of the maximum matching $M'$ is increased by one. Therefore, after each step of Algorithm \ref{addvertex}, all of the vertices in $\itemsv'_{1/2}$ remain saturated by $M'$. Since $F_{G'_{1/2}}(M',\itemsv'_{1/2}) \subseteq \itemsv'_{1/2}$, all the vertices of $F_{G'_{1/2}}(M',\itemsv'_{1/2})$ are also saturated by $M'$, which means
$$|F_{G'_{1/2}}(M',\itemsv'_{1/2})| \leq |N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))|.$$

\textbf{To prove Inequality \eqref{ineqhadi1}}, note that by definition, $F_{G'_{1/2}}(M',\itemsv'_{1/2})$ has a property that there exists a matching from $F_{G'_{1/2}}(M',\itemsv'_{1/2})$ to $N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))$ that saturates all the vertices of $N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))$. Therefore, we have
$$
|F_{G'_{1/2}}(M',\itemsv'_{1/2})| \geq |N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))|.
$$
This completes the proof.
\end{proof}

\begin{proof}[of Lemma \ref{forc3}] 
Firstly, we clarify what agents are in $\cthree$. Roughly speaking, the agents that are not selected for Clusters $\cone$ and $\ctwo$ are in $\cthree$. Thus, the agents in $\cthree$ correspond to the vertices in  
$$\agentsv' \setminus N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))$$
$$=\big(\agentsv' \setminus \agentsv'_{1/2}\big) \cup  \big(\agentsv'_{1/2} \setminus N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))\big).$$

\textbf{The term $ \agentsv' \setminus \agentsv'_{1/2} $ } refers to the vertices that are filtered in $G'_{1/2}$ which means no edge with weight at least $1/2$ is incident to any of these vertices.  
On the other hand, for every agent $\agent_j \in \ctwo$, $\firstset_j$ corresponds to a vertex in $F_{G'_{1/2}}(M',\itemsv'_{1/2})$.  Hence, for every agent $\agent_j \in \ctwo$  and every agent $\agent_i$ with corresponding vertex in $\agentsv' \setminus \agentsv'_{1/2}$ we have $\valu_i(f_j) <1/2$


\textbf{Next, consider the term $\agentsv'_{1/2} \setminus N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))$.} By definition, the vertices of $F_{G'_{1/2}}(M',\itemsv'_{1/2})$ are only incident to the vertices of $N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))$ in $G'_{1/2}$. Regarding the definition of an edge in $G'_{1/2}$, for every agent $\agent_j \in \ctwo$ and agent $\agent_i$ with $\agentv_i \in \agentsv'_{1/2} \setminus N(F_{G'_{1/2}}(M',\itemsv'_{1/2}))$ we have $\valu_i(f_j) <1/2$.

Therefore, for all $\agent_i \in \cthree$ we have: 
 $$\forall \agent_j \in \ctwo \qquad \valu_i(\firstset_j) < 1/2.$$
\end{proof}

\begin{proof}[of Lemma \ref{cr2smallc1}]
Regarding Observation \ref{fsmallc1}, after refinement of $\cone$, all the items with vertex in $\itemsv' \setminus \itemsv'_{1/2}$ are in worth less than $\epsilon_j$ for every agent $\agent_j \in \cone$. Furthermore, note that for every agent $\agent_i \in \satagents_2^r$, $\secondset_i$ is a single item with vertex in $\itemsv' \setminus \itemsv'_{1/2}$. Thus, $\valu_j(\secondset_i)< \epsilon_j$ for every agent $\agent_j \in \cone$.
\end{proof}

\begin{proof}[of Lemma \ref{cr2smallc3}]
According to Algorithm \ref{c2ref}, for any agent $\agent_i \in \satagents_2^r$, the corresponding vertex of the only member of $g_i$ is in $\itemsv' \setminus \itemsv'_{1/2}$. Therefore, for any agent $a_j \notin \cone \cup \ctwo$ we have $V_j(g_i) < 1/2$. Finally, note that the remaining agents that are not in $\cone$ and $\ctwo$ belong to $\cthree$.
\end{proof}

\begin{proof}[of Lemma \ref{lsmall_c3}] The algorithm \ref{addvertex} terminates when there is no desirable pair for the agents in $T = \agentsv' \setminus N(F_{G'_{1/2}}(M',\itemsv'_{1/2})).$ Furthermore, by definition, for every agent  $\agent_i \in \cthree$ we have  $$\agentv_i \in \agentsv' \setminus N(F_{G'_{1/2}}(M',\itemsv'_{1/2})).$$ But at the end of Algorithm \ref{addvertex}, no pair of vertices is desirable for $\agent_i$ which means for every $\itemv_j,\itemv_k \in \itemsv'' \setminus \itemsv''_{1/2}$, we have  $V_i(\{\ite_j,\ite_k\}) < {1/2}$ (note that $\itemsv'' \setminus \itemsv''_{1/2} \subseteq \itemsv' \setminus \itemsv'_{1/2}$).
\end{proof}


\section{Omitted Proofs of Section \ref{additive:allocation}}\label{clustering2appendix}
\begin{proof}[of Lemma \ref{general}]
At this point, for every agent $\agent_i \in \cone \cup \ctwo \cup \cthree^s$, $|\firstset_j| \leq 2$. If $|\firstset_i| = 1$ holds, then according to Lemma \ref{remove1}, value of the item in $\firstset_i$ is less than $3/4$ to all other agents. Moreover, if $|\firstset_i| = 2$, then $\firstset_i$ corresponds to a merged vertex. In this case, by Lemmas \ref{c1small2} and \ref{pairsmall}, value of $\firstset_i$ is less than $3/4$ to all other agents. 
\end{proof}

\begin{proof}[of Lemma \ref{c3fsmall}]
According to Lemma \ref{lsmall_c3}, value of every pair of items in $\fitems$ is less than $1/2$ to $\agent_i$. Therefore, $\firstset_i$ contains at least three items. Let $\ite_k$ be an arbitrary item in $\firstset_i$. Since $|\firstset_i| \geq 3$, $\firstset_i \setminus \{\ite_k\}$ is non-empty. On the other hand, $S$ is minimal and hence, none of the sets $\firstset_i \setminus \ite_k$ and $\{\ite_k\}$ is feasible for any agent. According to the definition of feasibility for the agents of $\cone \cup \ctwo \cup \cthree^s \cup \cthree^b$, we have
$$ \forall \agent_j \in \cone \cup \ctwo \cup \cthree^s \cup \cthree^b \qquad \valu_j(\firstset_i \setminus \{\ite_k\})< \epsilon_j $$ 
and 
$$\forall \agent_j \in \cone \cup \ctwo \cup \cthree^s \cup \cthree^b \qquad \valu_j(\{\ite_k\})< \epsilon_j$$
which means
$$ \forall \agent_j \in \cone \cup \ctwo \cup \cthree^s \cup \cthree^b \qquad \valu_j(\firstset_i)< 2\epsilon_j. $$ 

\end{proof}

\begin{proof}[of Lemma \ref{cef}]
The Lemma trivially holds for $\cone$ and $\ctwo$, since removing an agent from a cycle-envy-free set preserves this property. For $\cthree^s$, there may be multiple rounds that an agent is added to $\cthree^s$. We show that adding an agent to $\cthree^s$ preserves cycle-envy-freeness as well.

For the sake of contradiction, let $\mathbb{R}_z$ be the first round in which adding an agent $\agent_i$ to $\cthree^s$ results in a set, that is no longer cycle-envy-free. Since $\cthree^s \setminus \{\agent_i\}$ is cycle-envy-free, every subset of $\cthree^s \setminus \{\agent_i\}$ contains at least one winner and one loser. Moreover, by Lemma \ref{c3fsmall} we have:
\begin{equation}
\label{inec1}
\forall \agent_j \in \cthree^s, j \neq i, \qquad \valu_j( \firstset_i )< 2\epsilon_j.
\end{equation}

Note that $\agent_i$ previously belonged to $\cthree^f$.  By definition of $\cthree^f$  
\begin{equation}
\label{inec2}
\forall \agent_j \in \cthree^s , j \neq i, \qquad \valu_i(\firstset_j)< 1/2 .
\end{equation}

Inequalities (\ref{inec1}) and (\ref{inec2}) together imply that $\agent_i$ is both a winner and a loser for every subset of $\cthree^s$ that contains $\agent_i$. This means that every subset of $\cthree^s$ contains at least one winner and one loser, which is a contradiction.

\end{proof}

\begin{proof}[of Lemma \ref{prvalue}]

If $\agent_j \prec_{pr} \agent_i$, then $\secondset_i$ is not feasible for $\agent_j$, since the agent with the lowest 
priority is satisfied in each round of the second phase. Thus, $\valu_j(\secondset_i) < \epsilon_j$. For the case where $\agent_i \prec_{pr} \agent_j$, let $\ite_k$ be an arbitrary item of $\secondset_i$. According to the fact that $\secondset_i$ is minimal, $\secondset_i \setminus \{\ite_k\}$ is not feasible for any agent. Hence, $\valu_j(\secondset_i \setminus \{\ite_k\})< \epsilon_j$. On the other hand, by Observations \ref{fsmallc1} and \ref{fsmallc2}, $\valu_j(\{\ite_k\})<\epsilon_j $. Therefore, $\valu_j(\secondset_i)<2\epsilon_j$. 
\end{proof}

\begin{proof}[of Lemma \ref{m_1}]
Let $\mathbb{R}_z$ be the round, in which $\agent_i$ is satisfied. At that point, if $\agent_j \in \cthree^f$ then $\valu_j(\secondset_i) < {1/2}$ trivially holds. Since in round $\mathbb{R}_z$, $\agent_j \prec_{pr} \agent_i$ holds, $\secondset_i$ was not feasible for $\agent_j$ in the first place. Recall that in each round, the agent with lowest order in $\Phi(S)$ is selected. 

Furthermore, if in round $\mathbb{R}_z$, $\agent_j$ was in $\cthree^s \cup \cthree^b$, according to Observations \ref{fsmallc1} and \ref{fsmallc2}, $|S| \geq 2$, since no item alone can satisfy $\agent_i$. If $|S|=2$, then by Observation \ref{lsmall_c3}, $\valu_j(\secondset_i)<1/2$. For the case of $|S|>2$, let $\ite_k$ be the item in $S$ with the minimum value to $\agent_j$. According to Corollary \ref{small_c3}, $\valu_j(\{\ite_k\})<{1/4}$. Also, since $S$ is minimal, $S \setminus \{\ite_k\}$ is not feasible for any agent and hence, $\valu_j(S \setminus \{\ite_k\}) < \epsilon_j \leq {1/4}$. Thus, $\valu_j(S) < {1/2}$.
\end{proof}




\color{black}