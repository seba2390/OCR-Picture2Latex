\begin{figure*}[!htbp]
\begin{mathpar}
  \inferrule
  { }
  {
    \Gamma, x:\tau \vdash_{\pc} x:\tau \leadsto \eret ~ x
  }\rname{\fc-var}

  \inferrule
  {
    \Gamma, x:\tau_1 \vdash_{\llabel_e} e: \tau_2 \leadsto e_{c1}
  }
  {
    \Gamma \vdash_{\pc} \lambda x. e: (\tau_1 \fto \tau_2)^{\bot}
    \leadsto
    \eret (\elabel {} (\lambda x. e_{c1}))
  }\rname{\fc-lam}

  \inferrule
  {
    \Gamma \vdash_{\pc} e_1: (\tau_1 \fto \tau_2)^{\llabel}
    \leadsto
    e_{c1}
    \\
    \Gamma \vdash_{\pc} e_2:\tau_1
    \leadsto
    e_{c2}
    \\
    \lattice \vdash  \llabel \ljoin \pc \lbelow \llabel_e \\
    \lattice \vdash \tau_2 \searrow \llabel
  }
  {
    \Gamma \vdash_{\pc} e_1 ~ e_2:\tau_2
    \leadsto
    \coerce(\ebind(e_{c1}, a. \ebind (e_{c2}, b. \ebind(\eunlabel ~ a, c. (c ~ b)))))
  }\rname{\fc-app}

  \inferrule
  {
    \Gamma \vdash_{\pc} e_1:\tau_1 \leadsto e_{c1}
    \\
    \Gamma \vdash_{\pc} e_2:\tau_2 \leadsto e_{c2}
  }
  {
    \Gamma \vdash_{\pc} (e_1, e_2): (\tau_1 \times \tau_2)^{\bot}
    \leadsto
    \ebind(e_{c1}, a. \ebind (e_{c2}, b. \eret(\elabel {} (a,b))))
  }\rname{\fc-prod}

  \inferrule
  {
    \Gamma \vdash_{\pc} e: (\tau_1 \times \tau_2)^{\llabel} \leadsto e_{c}
    \\
    \lattice \vdash \tau_1 \searrow \llabel
  }
  {
    \Gamma \vdash_{\pc} \efst (e):\tau_1
    \leadsto
    \coerce(\ebind(e_{c}, a. \ebind(\eunlabel ~ a, b. \eret (\efst (b)))))
  }\rname{\fc-fst}

  %% \inferrule
  %% {
  %%   \Gamma \vdash_{\pc} e: (\tau_1 \times \tau_2)^{\llabel} \leadsto e_{c}
  %%   \\
  %%   \lattice \vdash \tau_2 \searrow \llabel
  %% }
  %% {
  %%   \Gamma \vdash_{\pc} \esnd (e):\tau_2
  %%   \leadsto
  %%   \coerce(\ebind(e_{c}, a. \ebind(\eunlabel ~ (a), b. \eret (\esnd (b)))))
  %% }\rname{\fc-snd}

  \inferrule
  {
    \Gamma \vdash_{\pc} e:\tau_1 \leadsto e_{c}
  }
  {
    \Gamma \vdash_{\pc} \einl (e):(\tau_1 + \tau_2)^{\bot}
    \leadsto
    \ebind(e_{c}, a. \eret (\elabel {} {(\einl (a))}))
  }\rname{\fc-inl}

  %% \inferrule
  %% {
  %%   \Gamma \vdash_{\pc} e:\tau_2 \leadsto e_{c}
  %% }
  %% {
  %%   \Gamma \vdash_{\pc} \einr (e):(\tau_1 + \tau_2)^{\bot}
  %%   \leadsto
  %%   \ebind(e_{c}, a. \eret (\elabel {} {(\einr (a))}))
  %% }\rname{\fc-inr}

  \inferrule
  {
    \Gamma \vdash_{\pc} e:(\tau_1 + \tau_2)^{\llabel} \leadsto e_{c}
    \\
    \Gamma, x:\tau_1 \vdash_{\pc \ljoin \llabel} e_1:\tau \leadsto e_{c1}
    \\
    \Gamma, x:\tau_1 \vdash_{\pc \ljoin \llabel} e_2:\tau \leadsto e_{c2}
    \\
    \lattice \vdash \tau \searrow \llabel
  }
  {
    \Gamma \vdash_{\pc} \ecase (e, x.e_1, y.e_2):\tau
    \leadsto
    \coerce(\ebind(e_{c}, a. \ebind(\eunlabel ~ a,  b. \ecase(b, x.e_{c1}, y. e_{c2}))))
  }\rname{\fc-case}

  %% \inferrule
  %% {
  %%   \Gamma \vdash_{\pc} e: \tau \leadsto e_c
  %%   \\
  %%   \lattice \vdash \tau \searrow \pc
  %% }
  %% {
  %%   \Gamma \vdash_{\pc} \enew (e): (\tref ~ \tau)^\bot
  %%   \leadsto
  %%   \ebind(e_{c}, a. \ebind(\enew (a), b. \eret (\elabel {} {b})))
  %% }\rname{\fc-ref}

  \inferrule
  {
    \Gamma \vdash_{\pc} e: (\tref ~ \tau)^{\llabel} \leadsto e_c
    \\ \lattice \vdash \tau \subtype \tau'
    \\ \lattice \vdash \tau' \searrow \llabel
  }
  {
    \Gamma \vdash_{\pc} !e: \tau
    \leadsto
    \coerce(\ebind(e_{c}, a. \ebind(\eunlabel ~ a, b. !b)))
  }\rname{\fc-deref}

  \inferrule
  {
    \Gamma \vdash_{\pc} e_1: (\tref ~ \tau)^{\llabel} \leadsto e_{c1}
    \\
    \Gamma \vdash_{\pc} e_2: \tau \leadsto e_{c2}
    \\
    \tau \searrow (\pc \ljoin \llabel)
  }
  {
    \Gamma \vdash_{\pc} e_1 := e_2: \tunit
    \leadsto
    % \etolabeled(\ebind(e_{c1}, a. \ebind(e_{c2}, b. \ebind (\eunlabel ~ a, c. c := b))))
    \ebind(\etolabeled(\ebind(e_{c1}, a. \ebind(e_{c2}, b. \ebind (\eunlabel ~ a, c. c := b)))), d. \eret ())
  }\rname{\fc-assign}
\end{mathpar}

\bigskip
\centering
where,
\framebox{
  \begin{tabular}[t]{l@{\ }c@{\ }l}
    $\coerce$ & $:$ & $\tslio{\pc}{\llabel}{\tau} \to \tslio{\pc}{\bot}{\tau}$ ~~~ when $\tau = \tlabeled{\llabel'}{\tau'}$ and $\llabel \lbelow \llabel'$ \\
    $\coerce$ & $\triangleq$ & $\lambda x. \etolabeled(\ebind(x, y.\eunlabel ~ y))$
  \end{tabular}
  }
\caption{Expression translation {\fg} to {\cg} (selected rules only)}
\label{fig:fg-2-cg-expr}
\end{figure*}

%%%Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
