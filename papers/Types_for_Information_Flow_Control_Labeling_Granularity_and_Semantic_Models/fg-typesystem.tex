\begin{figure*}[!htbp]
\newcolumntype{L}{>{$}l<{$}}
\newcolumntype{P}{>{$}X<{$}}

\begin{tabularx}{\textwidth}{lLLP}
  Expressions & e & ::= & x \mid \lambda x.e \mid e \; e \mid (e, e) \mid \efst(e) \mid \esnd(e)
  \mid \einl(e) \mid \einr(e) \mid \ecase(e, x.e, x.e) \mid \enew e \mid {!}e \mid {e := e} \\

%  Labels & \llabel, \pc & ::= & \bot \mid \top \mid \lelement \mid \llabel \ljoin \llabel \mid \llabel \lmeet \llabel\\

  (Labeled) Types & \tau & ::= & \utype^\llabel \\

  Unlabeled types & \utype & ::= & \tbase \mid \tunit \mid \tau
  \mathbin{\smash{\overset{\llabel_e}{\to}}} \tau \mid \tau \times \tau \mid \tau + \tau \mid\tref ~
  \tau ~~~~ (\tbase \mbox{ denotes a base type})
\end{tabularx}\\ \\

\textbf{Typing judgment:} \framebox{$\Gamma \vdash_\pc e: \tau$}

\begin{mathpar}
  \inferrule
    { }
    {
      \Gamma, x:\tau \vdash_\pc x: \tau
    }\rname{{\fg}-var}\vspace{-.2em}

    \inferrule
    {
      \Gamma, x:\tau_1 \vdash_{\llabel_e} e: \tau_2
    }
    {
      \Gamma \vdash_\pc \lambda x. e: (\tau_1 \fto \tau_2)^\bot
    }\rname{{\fg}-lam}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e_1: (\tau_1 \fto \tau_2)^\llabel
      \\ \Gamma \vdash_\pc e_2: \tau_1
      \\ \lattice \vdash \tau_2 \searrow \llabel
      \\ \lattice \vdash \pc \ljoin \llabel \lbelow \llabel_e
    }
    {
      \Gamma \vdash_\pc e_1 ~ e_2: \tau_2
    }\rname{{\fg}-app}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e_1: \tau_1
      \\ \Gamma \vdash_\pc e_2: \tau_2
    }
    {
      \Gamma \vdash_\pc (e_1,e_2): (\tau_1 \times \tau_2)^{\bot}
    }\rname{{\fg}-prod}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e: (\tau_1 \times \tau_2)^{\llabel}
      \\ \lattice \vdash \tau_1 \searrow \llabel
    }
    {
      \Gamma \vdash_\pc \efst (e): \tau_1
    }\rname{{\fg}-fst}\vspace{-.2em}

    \quad

    \inferrule
    {
      \Gamma \vdash_\pc e: \tau_1
    }
    {
      \Gamma \vdash_\pc \einl (e): (\tau_1 + \tau_2)^\bot
    }\rname{{\fg}-inl}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e: (\tau_1 + \tau_2)^\llabel
      \\ \Gamma, x:\tau_1 \vdash_{\pc \ljoin \llabel} e_1: \tau
      \\ \Gamma, y:\tau_2 \vdash_{\pc \ljoin \llabel} e_2: \tau
      \\ \lattice \vdash \tau \searrow \llabel
    }
    {
      \Gamma \vdash_\pc \ecase (e, x.e_1, y.e_2): \tau
    }\rname{{\fg}-case}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_{\pc'} e: \tau'
      \\ \lattice \vdash \pc \lbelow \pc'
      \\ \lattice \vdash \tau' \subtype \tau
    }
    {
      \Gamma \vdash_\pc e: \tau
    }\rname{{\fg}-sub}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e : \tau
      \\ \lattice \vdash \tau \searrow \pc
    }
    {
      \Gamma \vdash_\pc \enew e : (\tref~ \tau)^\bot
    }\rname{{\fg}-ref}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e : (\tref~ \tau)^\llabel
      \\ \lattice \vdash \tau \subtype \tau'
      \\ \lattice \vdash \tau' \searrow \llabel
    }
    {
      \Gamma \vdash_\pc {!}e : \tau'
    }\rname{{\fg}-deref}\vspace{-.2em}

    \inferrule
    {
      \Gamma \vdash_\pc e_1 : (\tref~ \tau)^\llabel
      \\ \Gamma \vdash_\pc e_2 : \tau
      \\ \lattice \vdash \tau \searrow (\pc \ljoin \llabel)
    }
    {
      \Gamma \vdash_\pc e_1 := e_2 : \tunit
    }\rname{{\fg}-assign}\vspace{-.2em}

    \inferrule
    { }
    {\Gamma \vdash_\pc (): \tunit^\bot}
    \rname{{\fg}-unitI}\vspace{-.2em}
  \end{mathpar} \\

  \textbf{Subtyping judgments:} \framebox{$\lattice \vdash \utype \subtype \utype'$} and
  \framebox{$\lattice \vdash \tau \subtype \tau'$}

  \begin{mathpar}
    \inferrule
    {\lattice \vdash \llabel \lbelow \llabel' \\
      \lattice \vdash \utype \subtype \utype'
    }
    {
      \lattice \vdash \utype^\llabel \subtype \utype'^{\llabel'}
    }\rname{{\fg}sub-label}\vspace{-.2em}

    %% \inferrule
  %% {  }
  %% { \lattice \vdash \tbase \subtype \tbase }\rname{{\fg}sub-base}

  \inferrule
  { }
  {
    \lattice \vdash \tref~ \tau \subtype \tref~ \tau
  }\rname{{\fg}sub-ref}\vspace{-.2em}

  %% \inferrule
  %% { \lattice \vdash \tau_1 \subtype \tau_1'
  %%   \\ \lattice \vdash \tau_2 \subtype \tau_2'}
  %% { \lattice \vdash \tau_1 \times \tau_2
  %%   \subtype \tau_1' \times \tau_2' }\rname{{\fg}sub-prod}

  %% \inferrule
  %% { \lattice \vdash \tau_1 \subtype \tau_1'
  %%   \\ \lattice \vdash \tau_2 \subtype \tau_2'}
  %% { \lattice \vdash \tau_1 + \tau_2
  %%   \subtype \tau_1' + \tau_2' }\rname{{\fg}sub-sum}

  \inferrule
  { \lattice \vdash \tau_1' \subtype \tau_1
    \\ \lattice \vdash \tau_2 \subtype \tau_2'
    \\ \lattice \vdash \llabel_e' \lbelow \llabel_e }
  {
    \lattice \vdash \tau_1 \fto \tau_2 \subtype
    \tau_1' \ftoP \tau_2'
  }\rname{{\fg}sub-arrow}\vspace{-.2em}

  %% \inferrule
  %% { }
  %% {\lattice \vdash \tunit \subtype \tunit}\rname{{\fg}sub-unit}
\end{mathpar}

\caption{{\fg}'s language syntax and type system (selected rules)}
\label{fig:fg-ts}
\end{figure*}

%% \begin{figure*}[!htbp]
%%   \centering
%% \begin{mathpar}

%%   \inferrule
%%   {\lattice \vdash \llabel \lbelow \llabel' \\
%%     \lattice \vdash \utype \subtype \utype'
%%   }
%%   {\lattice \vdash \utype^\llabel \subtype \utype'^{\llabel'}}\rname{{\fg}sub-label}

%%   \inferrule
%%   {  }
%%   { \lattice \vdash \tbase \subtype \tbase }\rname{{\fg}sub-base}

%%   \inferrule
%%   { }
%%   { \lattice \vdash \tref~ \tau \subtype \tref~ \tau }\rname{{\fg}sub-ref}

%%   \inferrule
%%   { \lattice \vdash \tau_1 \subtype \tau_1'
%%     \\ \lattice \vdash \tau_2 \subtype \tau_2'}
%%   { \lattice \vdash \tau_1 \times \tau_2
%%     \subtype \tau_1' \times \tau_2' }\rname{{\fg}sub-prod}

%%   \inferrule
%%   { \lattice \vdash \tau_1 \subtype \tau_1'
%%     \\ \lattice \vdash \tau_2 \subtype \tau_2'}
%%   { \lattice \vdash \tau_1 + \tau_2
%%     \subtype \tau_1' + \tau_2' }\rname{{\fg}sub-sum}

%%   \inferrule
%%   { \lattice \vdash \tau_1' \subtype \tau_1
%%     \\ \lattice \vdash \tau_2 \subtype \tau_2'
%%     \\ \lattice \vdash \llabel_e' \lbelow \llabel_e }
%%   { \lattice \vdash \tau_1 \fto \tau_2 \subtype
%%     \tau_1' \ftoP \tau_2' }\rname{{\fg}sub-arrow}

%%   \inferrule
%%   { }
%%   {\lattice \vdash \tunit \subtype \tunit}\rname{{\fg}sub-unit}
%% \end{mathpar}

%% \caption{{\fg} subtyping}
%% \label{fig:fg-sub}
%% \end{figure*}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End:
