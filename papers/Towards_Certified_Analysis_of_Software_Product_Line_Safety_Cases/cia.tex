\vspace{-0.1in}
\section{Changed Impact Assessment}
\label{sec:cia}
\vspace{-0.1in}
\newcommand{\CIA}{GSN\_IA}

In this section, we formalize the GSN-IA~\cite{Kokaly:2017} impact assessment algorithm, systematically design a lifted version of it, and prove its correctness based on the methodology in Sec.~\ref{sec:methodology}. 
%Lean has been recently used in several projects formalizing mathematics~\cite{mathlib:2020,Lewis:2019}. 

%Safety engineering is an essential part of the development process for safety-critical systems. Ensuring the correctness of analyses applied to safety artifacts is thus in many cases essential if we are to make safety-critical decisions based on the results of those analyses. Given the constructive nature of assurance cases, where evidence constructively satisfies goals, a theorem prover based on constructive logic like Lean is better suited than theorem provers based on classical logic (e.g., Isabelle/HOL~\cite{Nipkow:2002}).
\vspace{-0.1in}
\subsection{Single-Product Algorithm}
\vspace{-0.1in}

\lstinputlisting[style=lean, basicstyle=\small, firstline=8,lastline=19,caption=Type definitions of the formalized GSN\_IA algorithm.,label=lst:defs]{cia.lean}

\newcommand{\Annotation}{\code{Annotation}}
\newcommand{\Reuse}{\code{Reuse}}
\newcommand{\Recheck}{\code{Recheck}}
\newcommand{\Revise}{\code{Revise}}
\newcommand{\SysEl}{\code{SysEl}}
\newcommand{\GSNEl}{\code{GSNEl}}
\newcommand{\Sys}{\code{Sys}}
\newcommand{\GSN}{\code{GSN}}
\newcommand{\TraceRel}{\code{TraceRel}}
\newcommand{\sliceSys}{\code{sliceSys}}
\newcommand{\sliceGSNV}{\code{sliceGSN\_V}}
\newcommand{\sliceGSNR}{\code{sliceGSN\_R}}
\newcommand{\Dlta}{\code{Delta}}
\newcommand{\restrict}{\code{restrict}}
\newcommand{\trace}{\code{trace}}
\newcommand{\createAnnotation}{\code{createAnnotation}}

The data types and external dependencies of the \CIA~algorithm are defined in Listing~\ref{lst:defs}. \Annotation~is the data type of annotations assigned to GSN model elements, with the values \Reuse, \Recheck, and \Revise~(lines 1-2). \SysEl~and \GSNEl~are opaque types of system model elements and GSN model elements respectively, where a system model \Sys~and a GSN model \GSN~ are sets of each of those elements types (lines 4-6). \TraceRel~is a traceability relation between system model elements and GSN model elements, so it is a defined as a set of ordered pairs of \SysEl~and \GSNEl~(line 7). \CIA~is parameterized by three model slicers: \sliceSys~is a system model slicer, while \sliceGSNV~and \sliceGSNR~ are GSN model slicers. 
%\todo{what's the difference?} 
Each of the slicers takes a model and a set of elements used as the slicing criterion, returning a subset slice of the input model (lines 9-11). \Dlta~is composed of three sets of system elements, representing the elements added, modified and deleted (lines 12).

\lstinputlisting[style=lean, basicstyle=\small, firstline=21,lastline=43,caption=Helper functions and the formalized GSN\_IA algorithm.,label=lst:gsnia]{cia.lean}

Listing~\ref{lst:gsnia} has the definitions of the \CIA~algorithm, together with three helper functions. \restrict~ is a function taking a traceability relation ~\code{t}~and a delta ~\code{es}~as inputs, and returns a restricted subset of \code{t} only covering elements in \code{es} (lines 1-2). \trace~takes a traceability relation \code{t}~and a set of system elements~\code{es}~as inputs, and returns the set of GSN elements mapped from \code{es}~by \code{t} (lines 4-5). \createAnnotation~assigns an \Annotation~value to each element in a GSN model, given sets of elements to be rechecked and revised (lines 7-12).

%\lstinputlisting[style=lean, basicstyle=\small, firstline=48,lastline=61,caption=Formalized GSN\_IA algorithm.,label=lst:gsnia]{cia.lean}

The change impact assessment algorithm \CIA~takes two system models \name{S}~and \name{S'} and the delta \name{D}~between them. It also takes a GSN model \name{A}~and a traceability relation \name{R}~between system model elements and GSN model elements. It returns a set of ordered pairs of GSN model elements and annotations. The algorithm starts by restricting the traceability relation based on \name{D}, slices the original system model \name{S}~using the elements deleted and modified as a slicing criterion, and slices the modified system model \name{S'} using the added and modified elements as the slicing criterion (lines 16-18). Using those two slices, the corresponding GSN model elements are traced using the traceability relation (line 19). The GSN elements traced from elements deleted from the original system model are to be revised (line 20). The slice of the GSN model based on the traced elements are to be rechecked (lines 21-22), and both revise and recheck sets are used to annotate the GSN model elements (line 23). 

\input{lifting}
\input{casestudy}