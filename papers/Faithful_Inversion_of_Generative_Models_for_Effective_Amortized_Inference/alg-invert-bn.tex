\begin{wrapfigure}[18]{r}{0.567\textwidth}
\vspace{-2ex}	%\raggedleft
\begin{minipage}{0.555\textwidth}
\begin{algorithm}[H]
	\small
	\caption{NaMI Graph Inversion}
  \label{alg:invert-bn}
\begin{algorithmic}[1]
	\STATE {\bfseries Input:} BN structure $\mathcal{G}$, latent variables $\mathcal{Z}$, {\sc TopMode?}
	\STATE $\mathcal{J}\gets\textnormal{\sc Moralize}(\mathcal{G})$
	\STATE Set all vertices of $\mathcal{J}$ to be unmarked
	\STATE $\mathcal{H}\gets\textnormal{$\{\textsc{Variables}(\mathcal{G}),\emptyset\}$, i.e. unconnected graph}$
	\STATE $\text{\sc Upstream}\gets\text{``parent'' if {\sc TopMode?} else ``child''}$
	\STATE $\text{\sc Downstream}\gets\text{``child'' if {\sc TopMode?} else ``parent''}$
	\STATE $S\gets\textnormal{all latent variables without {\sc Upstream} latents in $\mathcal{G}$}$
		\WHILE{$S\not=\emptyset$}
			\STATE Select $v\in S$ according to min-fill criterion
			\STATE Add edges in $\mathcal{J}$ between unmarked neighbours of $v$
			\STATE Make unmarked neighbours of $v\in\mathcal{J}$, $v$'s parents in $\mathcal{H}$
			\STATE Mark $v$ and remove from $S$
			\FOR{unmarked latents {\sc Downstream} $u$ of $v$ in $\mathcal{G}$}
				\STATE \hspace*{-2ex}Add $u$ to $S$ if all its {\sc Upstream} latents in $\mathcal{G}$ are marked % $w$
			\ENDFOR
		\ENDWHILE
	\STATE \textbf{return} $\mathcal{H}$
\end{algorithmic}
\end{algorithm}
\end{minipage}%\vspace{-15pt}
\end{wrapfigure}
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "main"
%%% End: