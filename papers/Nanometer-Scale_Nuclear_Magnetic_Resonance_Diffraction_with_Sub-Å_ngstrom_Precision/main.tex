% APS document class
\documentclass[%
 reprint,
superscriptaddress,
%groupedaddress,
%unsortedaddress,
%runinaddress,
%frontmatterverbose, 
%preprint,
%preprintnumbers,
%nofootinbib,
%nobibnotes,
%bibnotes,
 amsmath,amssymb,
 aps
%pra,
%prb,
%rmp,
%prstab,
%prstper,
%floatfix,
]{revtex4-2}
\pdfoutput=1

%%% Document Preamble %%%

% Packages
\usepackage{graphicx}% Include figure files
\usepackage{dcolumn}% Align table columns on decimal point
\usepackage{bm}% bold math
\usepackage{amsmath,mathrsfs,amssymb,dsfont}
\usepackage{xcolor}
\usepackage{import}
\usepackage{enumitem}
\usepackage[normalem]{ulem}
\usepackage{soul}
\usepackage{physics}
\usepackage{comment}
\usepackage{float}
\usepackage{afterpage}
\usepackage{pdfpages}


% Notation
\newcommand{\ad}{\mathrm{ad}}
\newcommand{\pert}{\mathrm{per}}
\newcommand{\x}{\hat{\mathbf{x}}}
\newcommand{\y}{\hat{\mathbf{y}}}
\newcommand{\z}{\hat{\mathbf{z}}}
\newcommand{\R}[1]{\mathbb{R}^{#1}}
\newcommand{\xx}{\mathbf{x}}
\newcommand{\bb}{\mathbf{b}}
\newcommand{\maxx}{\mathrm{max}}
\newcommand{\pauli}{\boldsymbol{\sigma}}
\newcommand{\sx}{\sigma_x}
\newcommand{\sy}{\sigma_y}
\newcommand{\sz}{\sigma_z}
\newcommand{\id}{\mathds{1}}
\newcommand{\stateI}{\vert \psi_0 \rangle}
\newcommand{\stateId}{\langle \psi_0 \vert}
\newcommand{\stateT}{\vert \psi_T \rangle}
\newcommand{\stateTd}{\langle \psi_T \vert}
\newcommand{\stateAt}[1]{\vert \psi(#1) \rangle}
\newcommand{\stateAtd}[1]{\langle\psi(#1) \vert}
\newcommand{\spinup}{\left\vert \uparrow \right\rangle}
\newcommand{\spindown}{\left\vert \downarrow \right\rangle}
\newcommand{\spinupd}{\left\langle \uparrow \right\vert}
\newcommand{\spindownd}{\left\langle \downarrow \right\vert}
%\newcommand{\abs}[1]{\vert #1 \vert}
\newcommand{\dyson}[2]{\mathcal{D}_{#1}(#2)}
\newcommand{\insertref}{\textcolor{red}{[ref]}}
%%%%%%%%%%%%%%%%

\makeatletter
\AtBeginDocument{\let\LS@rot\@undefined}
\makeatother

%%% Title and Author List %%%
\begin{document}

\preprint{APS/123-QED}

\title{Nanometer-Scale Nuclear Magnetic Resonance Diffraction with Sub-\AA ngstrom Precision}

\author{Holger Haas}
%\altaffiliation{H. Haas and S. Tabatabaei contributed equally to this work.}
\altaffiliation[Present address: ]{IBM Quantum, IBM T.J. Watson Research Center, Yorktown Heights, NY 10598, USA}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Sahand Tabatabaei}
%\altaffiliation{H. Haas and S. Tabatabaei contributed equally to this work.}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{William Rose}
\affiliation{Department of Physics, University of Illinois at Urbana-Champaign, Urbana, Illinois 61801, USA}

\author{Pardis Sahafi}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Mich\`ele Piscitelli}
\altaffiliation[Present address: ]{Clarendon Laboratory, Department of Physics, University of Oxford, OX1 3PU, UK}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Andrew Jordan}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Pritam Priyadarsi}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Namanish Singh}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Ben Yager}
\altaffiliation[Present address: ]{Oxford Instruments NanoScience, Abingdon, Oxfordshire, OX13 5QX, UK}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\author{Philip J. Poole}
\affiliation{National Research Council of Canada, Ottawa, Ontario, Canada, K1A 0R6}

\author{Dan Dalacu}
\affiliation{National Research Council of Canada, Ottawa, Ontario, Canada, K1A 0R6}

\author{Raffi Budakian}
\email{rbudakian@uwaterloo.ca}
\affiliation{Department of Physics and Astronomy, University of Waterloo, Waterloo, ON, Canada, N2L3G1}
\affiliation{Institute for Quantum Computing, University of Waterloo, Waterloo, ON, Canada, N2L3G1}

\date{\today}% It is always \today, today,
             %  but any date may be explicitly specified

%%% Abstract %%%
\begin{abstract}
Achieving atomic resolution is the ultimate limit of magnetic resonance imaging (MRI), and attaining this capability offers enormous technological and scientific opportunities, from drug development to understanding the dynamics in interacting quantum systems.
In this work, we present a new approach to nanoMRI utilizing nuclear magnetic resonance diffraction (NMRd) --- a method that extends NMR imaging to probe the structure of periodic spin systems.
The realization of NMRd on the atomic scale would create a powerful new methodology for materials characterization utilizing the spectroscopic capabilities of NMR.
We describe two experiments that realize NMRd measurement of $^{31}$P spins in an indium-phosphide (InP) nanowire with sub-\AA ngstrom precision. In the first experiment, we encode a nanometer-scale spatial modulation of the $z$-axis magnetization by periodically inverting the $^{31}$P spins, and detect the period and position of the modulation with a precision of $<0.8~\text{\AA}$. In the second experiment, we demonstrate an interferometric technique, utilizing NMRd, for detecting an \AA ngstrom-scale displacement of the InP sample with a precision of 0.07\,\text{\AA}. The diffraction-based techniques developed in this work represent new measurement modalities in NMR for probing the structure and dynamics of spins on sub-\AA ngstrom length scales, and demonstrate the feasibility of crystallographic MRI measurements.
\end{abstract}

\maketitle
\section{Introduction}
Three-dimensional atomic-resolution nuclear magnetic resonance (NMR) imaging of nanometer scale materials remains a long-standing challenge. The ability to image biologically-relevant structures such as proteins and virus particles on the atomic scale with the spectroscopic capabilities of NMR would fundamentally advance our understanding of their function, and potentially lead to new drug therapies \cite{Ajoy2015,Perunicic2016,Schirhagl2014}.
In addition, atomic-scale magnetic resonance imaging (MRI) could be a powerful tool for studying magnetic correlations in condensed matter systems \cite{Casola2018}.
Over the past two decades, significant advances have been made to extend the capabilities of MRI to the nanometer and \AA ngstrom scales \cite{Rugar2004,Grinolds2013,Willke2019,Lovchinsky2016,Degen2009,Taminiau2012,Zopes2018,Grob2019,Rugar2015,Arai2015,Ziem2019,Rose2018}, including the detection of single sub-surface electron spins \cite{Rugar2004,Grinolds2013}, MRI of single atoms on a surface \cite{Willke2019}, NMR detection of single proteins \cite{Lovchinsky2016}, three-dimensional imaging of individual tobacco-mosaic virus particles \cite{Degen2009}, and the detection and coherent control of individual carbon spins in diamond \cite{Taminiau2012} with sub-\AA ngstrom resolution \cite{Zopes2018}. 

Many of these approaches rely on the use of local probes to directly detect the distribution of spins within the sample. While such techniques are well-suited for imaging arbitrary spin distributions, scattering techniques that employ coherent sources, e.g., X-rays, neutrons or electrons, offer an alternative means of determining the atomic-scale structure of crystalline materials that possess a high degree of spatial correlation. Unlike direct-space techniques that locally probe the material density, scattering techniques rely on the interference of the scattered field from each scattering center within the detection volume, providing a highly efficient means of structure determination.

MRI, like X-ray and neutron scattering, is a reciprocal space technique, in which the measured signal $s(\mathbf{k})\sim\int\rho(\mathbf{r})\,e^{i\mathbf{k}\cdot\mathbf{r}}\,d^3r$ is proportional to the Fourier transform of the matter density.
This similarity with scattering led Mansfield and Grannell in 1973 to propose NMR `diffraction' (NMRd), as a method for determining the lattice structure of crystalline materials \cite{Mansfield1973}. 
The realization of crystallographic NMRd would extend the spectroscopic capabilities of MRI to the atomic scale and provide a fundamentally new non-destructive method for measuring the structure factor of crystalline materials.
Furthermore, being a phase-sensitive technique, NMRd would permit real-space reconstruction of the spin density, without the loss  of phase information common to scattering techniques, such as X-rays, that measure the scattered field intensity.

The main challenge to achieving atomic scale NMRd lies in the difficulty of making the encoding wavenumber $k$ sufficiently large \footnote{In MRI, $k=\gamma G \tau$ is the encoding wavenumber corresponding to the spatial modulation of the nuclear spin magnetization, generated by the evolution of spins with gyromagnetic ratio $\gamma$ in the magnetic field gradient $G$ for a time $\tau$.}. For example, the largest encoding wavenumbers achieved in clinical high-resolution MRI scanners are of order $k/(2\pi)\sim 10^4\,\text{m}^{-1}$, which is more than a factor of $10^5$ smaller than what is needed to measure typical atomic spacings \cite{Vachha2021}.
In the past two decades, the principal technologies needed to overcome this challenge have been developed in the context of force-detected nanoMRI, paving the way for realizing atomic-scale NMRd, which would establish a new modality for materials characterization and imaging.

In this work, we present two experiments that utilize key advances in nanoMRI technology --- namely the ability to generate large time-dependent magnetic field gradients, and the ability to detect and coherently control nanoscale ensembles of nuclear spins --- to generate encoding wavenumbers as large as $k/(2\pi)=0.48\ \text{\AA}^{-1}$ and realize NMRd measurements of $^{31}$P spins of an indium phosphide (InP) sample with sub-\AA ngstrom precision. These results represent a significant step towards extending the spectroscopic and phase-sensitive imaging capabilities of MRI to atomic-scale materials characterization.

In the first experiment, we demonstrate phase-sensitive NMRd detection by encoding a `diffraction grating' via periodic modulation of the $^{31}$P $z$-axis magnetization, with a mean period of 4.5~nm in a $(\sim50~\text{nm})^3$ volume, and detect the position and period of the grating with a precision of $<0.8~\text{\AA}$. In the second experiment, we present a method for interferometric displacement detection using NMRd, which we apply to measure an \AA ngstrom-scale displacement of the InP sample with a precision of 0.07\,\text{\AA}.

\section{NMR\MakeLowercase{d} Concept}

To illustrate the basic concept of NMRd as envisioned in Ref.~\cite{Mansfield1973}, we consider a one-dimensional spin density having a spatially periodic modulation---such as a linear spin chain with spacing $a$ as shown in Fig.~\ref{fig:Fig1}---that evolves in a uniform field gradient $G_x=\partial B/\partial x$ for a time $\tau_e$. % HH: Added previously missing white-spaces
The wavevector corresponding to the helical winding encoded in the spins is $k_x=\gamma\,G_x\,\tau_e$, where $\gamma$ is the spin gyromagnetic ratio.
At particular encoding times $\tau_{\text{echo}}=2\pi n/(\gamma\,G_x\,a)$, corresponding to $k_x a=2\pi n$, the relative phase between neighboring spins becomes $\Delta\varphi=2\pi n$, $n\in\{1,2,3,\dots\}$ and a `diffraction echo' (DE) is observed.
At the peak of the echo, the signal from each spin adds constructively, in exact analogy to the diffraction peak observed in a scattering experiment. The lattice constant is determined from the location of the DE peak, and the shape of the sample from the Fourier transform of the DE envelope. Because the encoding wavevector is spin selective, the structure factor corresponding to each NMR-active nucleus can be determined separately.
The NMRd concept illustrated in Fig.~\ref{fig:Fig1} can be readily generalized to three dimensions, with $\mathbf{k}=\gamma\mathbf{G}\tau_e$ and $\mathbf{G}=\grad B$, where $B$ represents the magnitude of either the static or the radio frequency (RF) field at the Larmor frequency, used for phase encoding.
The diffraction condition in three dimensions corresponds to $\mathbf{k}\cdot \mathbf{a}_j = 2\pi n$, where $\mathbf{a}_j$ are the primitive vectors of the lattice.

\begin{figure}[th]
    \centering
    \includegraphics[width = \columnwidth]{Fig1.pdf}
    \caption{Time evolution of a one-dimensional periodic lattice of spins, starting from a uniform $z$~state at $\tau_e=0$, under a linearly varying external field along the lattice. The $x, y, z$ coordinate axes on the left marks the Bloch sphere directions for the spins represented by the cones. For $\tau_e>0$, the spins dephase and the expectation value of the $z$-axis magnetization $\expval{M_z}$ drops to zero. Once the spins on adjacent lattice sites complete a full rotation $(\Delta\varphi=2\pi)$, the spins rephase and a diffraction echo in $\expval{M_z}$ appears.}
    \label{fig:Fig1}
\end{figure}

Being particularly sensitive to hydrogen atoms, NMRd could enable structural characterization of nanocrystalline organic solids via NMR. For example, a lattice of $^1$H spins with $a=3~\text{\AA}$ evolving under a uniform field gradient of $10^5$~T/m would produce a DE at $\tau_e=780~\mu\text{s}$. While the dephasing times in most organic solids are much shorter, typically of order $T_2\sim 20~\mu\text{s}$, dynamical decoupling NMR pulse sequences, such as the symmetric magic echo sequence \cite{Boutis2003}, can be used to extend the coherence time into the millisecond range, while allowing for encoding with both static and resonant RF field gradient pulses.
Importantly, although the concept of NMRd was first envisioned as a technique to study crystal structures, it can be applied more broadly to probe any spatially-periodic spin-state modulation, e.g., a periodic modulation of the $z$-axis magnetization, that can be refocused by the evolution under the field gradient.
It can therefore also be used to study quantum transport of periodic spin systems on atomic length scales.
\section{Experimental Setup}
\begin{figure}[h]
    \centering
    \includegraphics[width = \columnwidth]{Fig2.pdf}
    \caption{(a) Schematic of the experimental setup, including the SiNW force sensor, the current-focusing field-gradient source (CFFGS), and the InP spin sample.
    During spin detection, 70-mA peak current was applied to the CFFGS at the resonance frequency of the SiNW, which produced a time-dependent field gradient with a peak amplitude of $\partial B_z/\partial y =$~8~G/nm, 50~nm above the surface. The Rabi field $B_1(\mathbf{r})=\sqrt{B_x^2(\mathbf{r})+B_y^2(\mathbf{r})}/2$ used for NMR was produced by driving the CFFGS with 70~mA-pk currents at the resonance frequency of  $^{31}$P spins, which produced a $B_1$ field with an amplitude of 470~G, and a $B_1$ field gradient of $\partial B_1/\partial z=-4$~G/nm, 50~nm above the surface. Further details regarding the field profile produced by the CFFGS are provided in Sec. II of Ref.~\cite{Supplements}. (b) Simulated contours of constant Rabi frequency $u(\mathbf{r})=\gamma B_1(\mathbf{r}) / (2\pi)$, where $\gamma=2\pi\times 17.235$~MHz/T is the $^{31}$P gyromagnetic ratio. The contours within the sample are nearly parallel to the $xy$~plane and vary primarily in the $z$ direction.}
    \label{fig:Fig2}
\end{figure}
Force-detected magnetic resonance measurements were performed using a silicon nanowire (SiNW) mechanical resonator, which served as the mechanical sensor to detect the force exerted on $^{31}$P spins in an InP nanowire (InPNW) placed in a magnetic field gradient. The experimental setup, shown in Fig.~\ref{fig:Fig2}(a), is similar to the one used in our previous nanoMRI work \cite{Rose2018}.
The SiNW was grown via the vapor-liquid-solid method near the edge of a $1.5~\text{mm}\times1~\text{mm}\times0.4~\text{mm}$ Si(111) substrate, and had a length of 20~$\mu$m, and a 100~nm diameter \cite{Sahafi2020}.
The frequency of the fundamental flexural mode of the as-grown SiNW was approximately 250~kHz prior to sample attachment, and had a spring constant of 0.6~mN/m.
Experiments were carried out at a base temperature of 4~K in high vacuum.
At this temperature, the quality factor of the SiNW was approximately 60,000. The SiNW chip was glued to a millimeter size piezoelectric transducer (PT), which was used to apply various control signals to the SiNW. To increase the measurement bandwidth of the resonator, a feedback signal was applied to the PT, which reduced the quality factor of the SiNW to 700 \cite{Poggio2007}.

The InPNW sample used in this work was approximately 5-$\mu$m long, with $\sim 100$-nm diameter, grown with a Wurtzite structure \cite{Dalacu2012}.
The sample was attached $\sim3-4$~$\mu$m away from the tip of the SiNW, with the axes of the two nanowires aligned parallel to each other, and the tip of the InPNW extending $\sim 2\,\mu\text{m}$ beyond the tip of the SiNW.
Details of the attachment procedure are provided in Sec.~I of Ref.~\cite{Supplements}.
A video of the sample attachment is also included in \cite{Supplements}.
After sample attachment, the resonance frequency of the SiNW decreased to 163~kHz, however no significant change in the quality factor was observed.

NMR measurements were performed by applying a static field of $B_0=3$~T parallel to the the InPNW axis. At this field, the Larmor frequency of the $^{31}$P spins is $\omega_0/(2\pi)=51.7\,\text{MHz}$. To generate time-varying magnetic fields and magnetic field gradients used for spin measurements, we fabricated a current focusing field gradient source (CFFGS) by electron-beam lithography and reactive ion-beam etching of a 100-nm thick Al film deposited on a sapphire substrate. The device contained a 150-nm-wide and 50-nm-long constriction, which served to focus electrical currents to produce the magnetic fields used for spin detection and control. All measurements were carried out with the tip of the InPNW placed at the center of the CFFGS and positioned $\sim50$~nm above the surface.

\section{Nanometer-Scale NMR\MakeLowercase{d} Measurements}\label{NMRd_18X_grating}
To observe a focused diffraction echo -- i.e., one in which the spectral weight of the echo is localized within a narrow range of encoding times -- the spin-state modulation must be a periodic function of the encoding field coordinate, e.g., for a spin density with a spatially periodic modulation, the encoding field profile must vary linearly in space (Fig. \ref{fig:Fig1}).
As a demonstration of nanometer scale NMRd, we utilize the Rabi-field gradient to (1) create a diffraction grating by periodically inverting the $z$-axis magnetization of the $^{31}$P spins within the measured volume of the InP tip [Fig.~\ref{fig:Fig3}(a)], and (2) generate the encoding wavevector for the NMRd measurements. In so doing, we ensure that the spin modulation is a periodic function of the encoding field.

\begin{figure}[h]
    \centering
    \includegraphics[width = \columnwidth]{Fig3.pdf}
    \caption{(a) Spatial configuration of the InP spin sample brought 50~nm above the surface of the CFFGS device. The CFFGS surface lies perpendicular to the static external magnetic field $B_0~\hat{\mathbf{z}}$.
    The 18 regions indicated in red represent the regions inverted by the band-inversion pulses within $g(u)$.  (Inset) Scanning electron microscope (SEM) image of a representative InPNW. The measured volume of the sample is indicated by the outlined region.
    (b) Measured Rabi-frequency distribution $p(u)$ of the $^{31}$P spins in the detection volume shown in (a). The data was obtained by sampling 20 points in the frequency range $0\leq u \leq 1~\text{MHz}$. The upper horizontal axis indicates the $z$~coordinate corresponding to the particular $u$ value on the InPNW axis at the center of the CFFGS $(x=y=0)$.
    (c) $\langle \sigma_z \rangle_u$ profile for the 100~kHz-wide band-inversion pulse, targeting spins in the Rabi frequency range 562.5~kHz $\leq u \leq$ 662.5~kHz. (d) Rabi-frequency distribution measured after applying the band-inversion pulse shown in (c).
    The data was obtained by sampling 23 points in the frequency range $325~\text{kHz} \leq u \leq 875~\text{kHz}$.
    The solid green line indicates the expected distribution calculated using the measured $p(u)$ of (b).}
    \label{fig:Fig3}
\end{figure}

\begin{figure*}[t]
    \includegraphics[width=\textwidth]{Fig4.pdf}
    \caption{NMRd data measured for the $18\times$ diffraction grating. (a) Inversion profile for the two positions ($g_1$ and $g_2$) of the periodic grating encoded with a period of 20.4~kHz.
    The top horizontal axis indicates the position-dependence of $g_1$ and $g_2$ with respect to the CFFGS. The shift in position corresponding to $\Delta u = 4.74$~kHz is indicated for the regions of the sample that are 50~nm and 140~nm away from the CFFGS.
    (b) Calculated in-phase component $s_I(\tau)$ for the grating at position 1 given the simulated $g_1(u)$ profile in (a) and measured $p(u)$ shown in Fig.~\ref{fig:Fig3}(b).
    (c) NMRd pulse sequence: the encoding part of the sequence encodes either $g_1(u)$ or $g_2(u)$ in (a) by applying 18 consecutive inversions. The second part of the sequence performs the NMRd readout.
    $s_I(\tau)$ is measured by applying a resonant RF pulse $(\mathbf{x})$ for a a duration $\tau$.
    An extra adiabatic half-passage pulse is applied for detecting the quadrature component $s_Q(\tau)$.
    (d, e) $s_I(\tau)$ and $s_Q(\tau)$ measurements for the two grating positions in (a) as a function of the effective encoding time $\tau$.
    The shaded regions in (d, e) indicate the signal amplitude.}
    \label{fig:Fig4}
\end{figure*}

We detect the statistical spin fluctuations in an ensemble of approximately $2\times 10^6$ $^{31}$P spins within the conical region of the InP sample indicated in Fig.~\ref{fig:Fig3}(a) (see Sec.~III of Ref.~\cite{Supplements}), using the MAGGIC spin detection protocol described in Ref.~\cite{Rose2018}.
The measured signal is proportional to the integrated $z$-axis magnetization $s\propto\int\,du\,p(u)\expval{\sigma_z}_u$ (see Appendix~\ref{Appendix}), where $\expval{\sigma_z}_u$ is the expectation value of the Pauli $z$ operator for a spin at Rabi frequency $u$ determined by the NMR encoding sequence used in the MAGGIC protocol, and $p(u)$ is the Rabi-frequency distribution (see Appendix~\ref{Appendix}), determined both by the geometry of the sample as well as the detection protocol which constrains the effective measurement volume near the CFFGS.
We experimentally determine $p(u)$ [Fig.~\ref{fig:Fig3}(b)] using the Fourier encoding method presented in \cite{Rose2018}.

We encode the periodic grating $g(u) = \expval{\sigma_z}_u$ by selectively inverting sequential regions in the sample that are 10.2-kHz wide and separated by 10.2~kHz in $u$, as indicated by Fig.~\ref{fig:Fig4}(a).
The physical regions targeted by the inversions are shown in
Fig.~\ref{fig:Fig3}(a).
To generate a particular $g(u)$, we implement control waveforms that invert spins within the range $(u_{\text{low}}, u_{\text{high}})$ with adjustable edge sharpness around $u_{\text{low}}$ and $u_{\text{high}}$.
To verify the performance of the inversion waveform, we implement a control sequence, shown in Fig.~\ref{fig:Fig3}(c), that targets spins within a 100-kHz bandwidth: $562.5\,\text{kHz} \leq u \leq  662.5\,\text{kHz}$. The measured Rabi-frequency distribution after the application of the band-inversion pulse [Fig.~\ref{fig:Fig3}(d)] agrees closely with the expected inversion profile.
Further details regarding the band-inversion pulses are in Sec.~IV(B) of Ref.~\cite{Supplements}, which also includes an animation depicting the operation of the 100 kHz-wide band-inversion pulse.

The NMRd protocol used to measure $g(u)$ is shown schematically in Fig.~\ref{fig:Fig4}(c).
After encoding the grating, we apply a Larmor-frequency RF pulse for a duration $\tau$.
The evolution of the spin starting from the state $\rho_0 \propto \sigma_z$, when driven with constant Rabi frequency $u$ is described by a unitary $U(u,\tau)=\exp(-i2\pi u \tau\sigma_x/2)$ in the frame rotating at $\omega_0$.
The in-phase $(s_I)$ and quadrature $(s_Q)$ components of diffraction signal are the ensemble-averaged expectation values of $\sigma_z$ and $\sigma_y$:
\begin{align}
    \begin{bmatrix}
        s_I(\tau)\\
        s_Q(\tau)
    \end{bmatrix}&=
    \int_0^\infty\,du\,p(u)\,g(u)
    \begin{bmatrix}
        \mathrm{Tr}\big[\sigma_z U(u,\tau)\rho_0 U^{\dagger}(u,\tau)\big]\\[5pt]
        \mathrm{Tr}\big[\sigma_y U(u,\tau)\rho_0 U^{\dagger}(u,\tau)\big]
    \end{bmatrix}\nonumber\\[5mm]
    &\propto \int_0^\infty\,du\,p(u)\,g(u)
    \begin{bmatrix}
        \cos(2\pi u\tau)\\
        \sin(2\pi u\tau)
    \end{bmatrix}.
    \label{eq1}
\end{align}
To measure the quadrature part of NMRd signal, we end the measurement sequence with a numerically-optimized adiabatic half-passage (AHP) pulse that rotates $\sigma_y$ to $\sigma_z$. It can be seen that if $g(u)$ has a single modulation period $\Omega$, i.e., $g(u+n\Omega)=g(u)$, $n\in\mathbb{Z}$, and varies much more rapidly than the envelope of $p(u)$, then $s_I(\tau)$ and
$s_Q(\tau)$ contain a series of diffraction echos separated by $1/\Omega$-long intervals. The amplitudes of these echos reflect the magnitude of the Fourier coefficients of $g(u)$, and the echo envelopes contain the Fourier transform of $p(u)$.

\begin{figure}[b]
    \centering
    \includegraphics[width=\columnwidth]{Fig5.pdf}
    \caption{Coordinate-space reconstruction of the diffraction grating.
    Solid lines in (a) and (b) are the calculated $p(u)g_1(u)$ $[p(u)g_2(u)]$ using $g_1(u)$ $[g_2(u)]$ in Fig.~\ref{fig:Fig4}(a) and $p(u)$ in Fig.~\ref{fig:Fig3}(b). The solid dots are the coordinate-space reconstructions of $p(u)g_1(u)$ and $p(u)g_2(u)$ by Fourier transforming the data in Fig. \ref{fig:Fig4} after padding it with zeroes. The position values indicated on the lower horizontal axis are determined from the simulated field distribution produced by the CFFGS (see Sec.~II of Ref.~\cite{Supplements}).The dashed vertical lines are placed as a guide to indicate the spatial offset between the two grating positions. The number of the inversion slice is indicated above the vertical lines.}
    \label{fig:Fig5}
\end{figure}

To demonstrate the phase sensitivity of NMRd, we
encode two spin magnetization gratings $g_1(u)$ and $g_2(u)$, shown in Fig.~\ref{fig:Fig4}(a), that differ by a 4.74~kHz translation, i.e., $g_2(u) = g_1(u + 4.74~\text{kHz})$. We refer to $g_1(u)$ and $g_2(u)$ as the grating at position 1 and 2, respectively. The physical displacement of the grating corresponding to $\Delta u = 4.74~\text{kHz}$ is $\Delta z=0.7$~nm ($\Delta z=1.9$~nm) at $z = 50$~nm ($z = 140$~nm). Both gratings are produced using the control sequences shown in Fig.~\ref{fig:Fig4}(c) that comprise 18 band inversion waveforms sandwiched between two AHPs identical to the ones used to measure $s_Q(\tau)$.

Fig.~\ref{fig:Fig4}(b) shows a plot of the expected $s_I(\tau)$ calculated using Eq.~\eqref{eq1}, $g_1(u)$, and the measured $p(u)$ shown in Fig.~\ref{fig:Fig3}(b). Because the first DE at $\tau\sim 49~\mu\text{s}$
has a significantly larger amplitude than the higher diffraction orders, we measure the NMRd signal only for $n=1$, for both grating positions, in the interval $39~\mu\text{s}\leq\tau\leq 59~\mu\text{s}$, using the NMRd measurement protocol is shown in Fig.~\ref{fig:Fig4}(c).
We note that for all measurements shown in Fig.~\ref{fig:Fig4}, the maximum duration of the resonant RF pulse used in the NMRd measurement portion of the sequence was $59\,\mu\text{s}$, which is much shorter than the transverse relaxation time  $T_{2\rho}=570\,\mu\text{s}$ measured under a continuous resonant RF drive (see Sec.~V of Ref.~\cite{Supplements}). Therefore, we ignore decoherence effects during the Rabi pulse in our analysis and simulations. The resulting data are shown in Fig.~\ref{fig:Fig4}(d, e), which also include the un-scaled calculated values for $s_I(\tau)$ and $s_Q(\tau)$.
The echo envelopes for both signal quadratures are shown as the shaded regions in Fig.~\ref{fig:Fig4}(d,~e). We see that although the small shift in the grating position produces little discernible change in the echo envelope, it is clearly visible in the change in the relative phase of the in-phase and quadrature measurements, demonstrating the importance of phase-sensitive detection for high-precision position measurements.

In Sec.~VI(A, B) of Ref.~\cite{Supplements}, we construct a statistical estimator \cite{Casella_1990} to determine the periodicity $\Omega$ from the measured data. The calculation is done assuming no prior knowledge of $g(u)$, other than the fact that it is periodic in $u$, and varies more rapidly than $p(u)$.
The resulting estimates for $\Omega$ in $g_1$ and $g_2$ are $\Omega_1 = 20.30 \pm 0.14$~kHz and $\Omega_2 = 20.26 \pm 0.10$~kHz, respectively. The 0.14~kHz (0.10~kHz) error in the period of $g_1$ ($g_2$) in $u$-space corresponds to an uncertainty of 0.2~\AA~(0.15~\AA) in the wavelength of the grating at $z = 50$~nm and 0.6~\AA~(0.4~\AA) at $z = 140$~nm.

In Sec.~VI(C, D) of Ref.~\cite{Supplements}, we construct a maximum likelihood estimator for $\Delta u$ for the data in Fig.\ref{fig:Fig4}, which yields $\Delta u = 4.67\pm 0.20$~kHz, in excellent agreement with the expected value of $\Delta u=4.74\,\text{kHz}$. The error in $\Delta u$ corresponds to an uncertainty of 0.3~\AA~(0.8~\AA) in the relative $z-$axis position of $g_1$ ($g_2$) at $z = 50$~nm ($z = 140$~nm).

We reconstruct the periodic spin modulation in coordinate space by calculating the real part of the complex Fourier transform $\Re\{\mathcal{F}^{-1}[s_I(\tau)+i\,s_Q(\tau)]\}$ using the data shown in Fig.~\ref{fig:Fig4}(d, e) for the two grating positions. In the reconstruction, we include the points around the $n=1$ DE, as well as the points sampled near $\tau=0$ to account for a small DC offset in the modulation envelope caused by a slight asymmetry in the magnitude of the positive and negative amplitude regions in $g(u)$. The time records used in the Fourier transforms are constructed to be continuous by zero-padding the un-sampled regions in the interval $0\leq\tau\leq 59.5~\mu\text{s}$ [see Fig. \ref{fig:Fig4}(b)]. The data in the interval $0\leq\tau\leq 3\,\mu\text{s}$ is not expected to change for the two grating positions. Therefore, this interval was measured only for position~1 and used in the reconstruction of both grating positions. 
We see that the position-space representation of $p(u)g_1(u)$ and $p(u)g_2(u)$, shown in Fig.~\ref{fig:Fig5}, closely follow the calculated values.

\section{Displacement Detection via NMR Interferometry}\label{NMR_Interferometer}
In Sec.~\ref{NMRd_18X_grating}, we performed phase-sensitive NMRd measurements of a nanometer-scale periodic modulation of the $z$-axis magnetization with sub-\AA ngstrom precision. In this section, we describe an interferometric detection protocol that enables us to measure a real-space displacement of the InP sample in the $z$ direction with a precision of 0.07~\AA. The protocol, shown schematically in Fig.~\ref{fig:Fig6}(a), utilizes the symmetric magic echo (SME) \cite{Boutis2003} NMR sequence to decouple the P-P and P-In interactions, thereby extending the coherence time of the $^{31}$P spins up to 12.8~ms. In Sec.~IV(D) of Ref.~\cite{Supplements}, we describe a modification to the SME4 that allows us to evolve the spins under the Rabi field gradient for a variable amount of time $\Delta\tau$ for phase encoding. By extending the spin coherence time into the millisecond range and by utilizing the large Rabi field gradients of order $2\times 10^5$~T/m, we encode a helical phase winding in the $xz$ plane with an average wavelength as short as a few \AA ngstroms, allowing us to detect displacements of the InP sample with picometer precision.

\begin{figure*}[!htbp]
    \centering
    \includegraphics[width=\textwidth]{Fig6.pdf}
    \caption{(a) Pulse sequence used for interferometric displacement detection, as well as the the voltage $V_P(t)$ applied to the PT, and the PT displacement $\delta\mathbf{r}(t)$. The unitary operations corresponding to different parts of the sequence are indicated above each block.
    The data presented in (b, c) were acquired from spins in the Rabi frequency range $400\,\text{kHz}<u<650$\,\text{kHz}, corresponding to the sample volume indicated by the shaded regions in (a). The shading indicates the $z$-axis modulation $[\cos\varphi(\mathbf{r})]$ at different times during the measurement sequence, corresponding to
    $\tau_e=\tau_d=960\,\mu\text{s}$, and a sample displacement of $\delta z = 1$~\AA.
    (b) The data were acquired using the sequence shown in (a), where $2\times$SME4 sequences were used in the encoding portion, with each SME4 designed to generate a Rabi gradient evolution time of $\Delta\tau=480\,\mu\text{s}$. From the fit to the data, we determine the ratio $\delta y/\delta z = 6.5$.
    For reference, two other curves have been included that show the variation in signal amplitude for different ratios of $\delta y / \delta z$. The calculations clearly indicate that for lateral displacements of order 1~nm, a higher ratio $\delta y/\delta z$ primarily increases the decay rate with respect to $V_P$ of the modulation envelope of the interference signal, without significantly affecting the modulation frequency; the modulation frequency, on the other hand, is primarily determined by $\delta z$. The asymmetry in the response along the $y$ and $z$ directions is caused by the relative magnitude of the Rabi field gradients near the center of the CFFGS, which is at least a factor of 100 larger in the $z$ direction than in the $y$ and $x$ directions.
    (c) In-phase and quadrature data were acquired for $V_P=0\,V$ and $V_P=7.2\,V$ with a fixed encoding time of $\tau_e=480\,\mu\text{s}$ for different decoding times. A single SME4 with $\Delta\tau=480\,\mu\text{s}$ was used for the encoding and decoding parts of the sequence.
    The displacement results in a shift in the phase of both signal quadratures.
    From the fit to the data, we determine displacement corresponding to $V_P=7.2\,V$ to be $\delta z = 0.81\pm0.07$~\AA\, and $\delta y = 9.72\pm 1.34$~\AA. The value of $\delta y$ determined from the fit is consistent with the value $\delta y = 1.0\,\text{nm}$ determined by optical interferometry (see Sec.~VII of Ref.~\cite{Supplements}.)}
    \label{fig:Fig6}
\end{figure*}

The protocol starts by encoding a helical winding for a time $\tau_e$.
The density matrix for a spin at position $\mathbf{r}$ after encoding is $\rho_1=U\left[u(\mathbf{r}),\tau_e\right]\rho_0U^{\dagger}\left[u(\mathbf{r}),\tau_e\right]$, where $U\left[u(\mathbf{r}),\tau\right]=\exp\left[{-i2\pi\tau\sigma_y u(\mathbf{r})/2}\right]$. During this time, a constant voltage is applied to the PT [inset in Fig.~\ref{fig:Fig6}(b)], which translates the InP sample with respect to the CFFGS, thereby slightly shifting the local field experienced by the $^{31}$P spins during encoding.
The PT is retracted to its equilibrium position by zeroing the voltage.
During retraction, $2\times$SME4 sequences with $\Delta\tau=0$ are applied, i.e., no gradient evolution, which refocus the homonuclear dipolar and $\sigma_z$ evolution during the time that the PT returns to its equilibrium position. The duration of the $2\times$SME4 sequences is 1.8~ms, which is chosen to be substantially longer than the $\sim 300\,\mu\text{s}$ mechanical response time of the PT.
In the decoding phase, the inverse unitary  $U^{\dagger}\left[u(\mathbf{r}+\delta\mathbf{r}),\tau_d \right]=\exp\left[i2\pi\tau_d u(\mathbf{r}+\delta\mathbf{r})\sigma_y/2\right]$ is applied for a time $\tau_d$ at the new location of the InP sample.
The density matrix at the end of the sequence is $\rho_2=\delta U \rho_0\delta U^\dagger \propto \sigma_z \cos \varphi(\mathbf{r})  +\sigma_x \sin \varphi(\mathbf{r})$, with $\delta U = \exp[-i\varphi(\mathbf{r})\sigma_y/2]$. The differential phase $\varphi(\mathbf{r})=2\pi\left[u(\mathbf{r})\tau_e-u(\mathbf{r}+\delta\mathbf{r})\tau_d\right]$ results from the interference of the encoding and decoding modulations separated by $\delta\mathbf{r}$.
The measured signal quadratures at the end of the sequence are
\begin{equation}
    \begin{bmatrix}
        s_I(\tau_e,\tau_d,\delta\mathbf{r})\\
        s_Q(\tau_e,\tau_d,\delta\mathbf{r})
    \end{bmatrix} \propto \int d^3r\,\rho(\mathbf{r})
    \begin{bmatrix}
        \cos\varphi(\mathbf{r})\\
        \sin\varphi(\mathbf{r})
    \end{bmatrix}
    \label{eq:DisplacementDiffraction}
\end{equation}
Here, $\rho(\mathbf{r})$ is the effective spin density at location $\mathbf{r}$ (see Appendix~\ref{Appendix}).

Figure~\ref{fig:Fig6}(b) shows a plot of the in-phase data acquired as a function of the voltage $V_P$ applied to the PT, using the sequence shown in Fig.~\ref{fig:Fig6}(a), with $\tau_d=\tau_e = 960~\mu\text{s}$. The modulation wavelength varies from $2.1$~\AA\, to $5.8$~\AA\, within the measured volume of the sample. 
To extract the $z$-displacement from the data, we conduct a least-squares fit \cite{sivia2006} using Eq.~\eqref{eq:DisplacementDiffraction}, where we assume that $\delta \mathbf{r}\propto V_P$ and $\delta \mathbf{r} = \delta y~\hat{\mathbf{y}}+\delta z~\hat{\mathbf{z}}$, with the fit parameters being the PT coefficient $\delta z/V_P$ and $\delta y/\delta z$.
The displacement in the $y$ direction is included because the PT used for the measurements was poled in the $y$ direction; hence $\delta y(V_P) \gg \delta z(V_P)$. The effective spin density $\rho(\mathbf{r})$ was calculated using our model for the sample geometry (Sec.~III of Ref.~\cite{Supplements}).
For details regarding the characterization of the PT, see Sec.~VII of Ref.~\cite{Supplements}.
The resulting fit is indicated by the solid line in Fig.~\ref{fig:Fig6}(b), corresponding to a displacement $\delta z/V_P = 0.15\pm 0.01$~\AA/V. The PT calibration was used to derive the top horizontal axis of Fig.~\ref{fig:Fig6}(b).

Finally, we conduct a set of measurements in which we keep the encoding time and the voltage step applied to the PT constant, and vary the decoding time. Fig.~\ref{fig:Fig6}(c) shows the in-phase and quadrature data acquired for $V_P=0$~V and $V_P=7.2$~V with $\tau_e=480\,\mu\text{s}$.
To extract the sample displacement, we fit to the data using Eq.~\eqref{eq:DisplacementDiffraction}, with the fit parameters being $\delta z$ and $\delta y$ [solid lines in Fig.~\ref{fig:Fig6}(c)].
The fit yields a sample displacement of $\delta z = 0.81\pm 0.07$~\AA.
In Sec.~VIII of Ref.~\cite{Supplements}, we also provide an alternative fitting method, which utilizes the measured $p(u)$ distribution instead of the geometric model of the sample. Consistent with the previous method, the fit yields $\delta z = 0.85\pm 0.07$~\AA.

Using the PT displacement calibration found from Fig.~\ref{fig:Fig6}(b), we would expect the displacement corresponding to $V_P=7.2$~V to be $\delta z=1.04\pm 0.04$~\AA. Although the calculated displacements from the two measurements are in reasonable agreement, the 20\% difference in $\delta z$ could be caused by systematic errors in the different methods used for determining the displacement corresponding to $V_P=7.2$~V. In particular, to determine the PT displacement for the data in Fig.~\ref{fig:Fig6}(b), we needed to assume a particular functional form for the piezo characteristic $\delta\mathbf{r}(V_P)$. For the data in Fig.~\ref{fig:Fig6}(c), however, we find the displacement directly for one particular value of $V_P$, without any assumptions on $\delta\mathbf{r}(V_P)$. It is therefore possible that a small nonlinear component in $\delta\mathbf{r}(V_P)$ could be responsible for the observed difference.

For measurements that require large encoding wavevectors, such as those that would be needed for crystallographic NMRd, the mechanical stability of the sample becomes an important consideration. To characterize the response to mechanical motion, we calculate the root-mean-square integrated phase error $\delta\varphi(\omega)$, caused by the motion of the sample relative to the gradient source during the encoding sequence.
As an example, Fig.~\ref{fig:Fig.7} shows a plot of $\delta\varphi(\omega)$ calculated for the sequence shown in Fig.~\ref{fig:Fig6}(a). We can clearly see that at low frequencies, even \AA ngstrom-scale motion can introduce large phase errors. In particular, the main peak near 100~Hz is caused by a 1~\AA-peak motion near the frequency $1/(2T)$, where $T$ is the duration of the entire sequence; the smaller peak near 5~kHz represents the motion at $1/\tau_{\text{ME}}$, where $\tau_{\text{ME}}$ is the duration of a single magic echo sequence. Overall, however the phase error decreases substantially for frequencies $\omega/(2\pi)>100\,\text{kHz}$, near the SiNW mechanical resonance, where the \AA ngstrom-scale motion of the oscillator caused by thermal fluctuations would be of concern.
Phase errors can be further minimized by applying feedback cooling to reduce the motion of the oscillator \cite{Poggio2007}. For the measurements reported here, the encoding direction is perpendicular to the oscillation direction of the SiNW, which greatly reduces phase errors caused by the resonant motion of the oscillator.
To ensure that such errors are negligible, we compare the measured the signal after applying the sequence in Fig.~\ref{fig:Fig6}(a) at zero piezo voltage, with $\tau_e = \tau_d = 0$ and $\tau_e = \tau_d= 960 \ \mu$s -- the longest encoding time used in this work.
The result shows a small $11\pm 10\%$ reduction at $960 \ \mu$s encoding, which indicates sufficient mechanical stability in the reported experiments.

\begin{figure}[!htbp]
    \centering
    \includegraphics[width = \columnwidth]{Fig7.pdf}
    \caption{Phase error $\delta\varphi(\omega)$ calculated by integrating the phase accumulated by a $^{31}$P spin oscillating at frequency $\omega$ with a peak amplitude of 1~\AA\, in the $z$ direction and experiencing the sample-averaged Rabi-field gradient of ${\partial B_1/\partial z} = 1.8$~G/nm. For the calculation, we use the sequence in Fig.~\ref{fig:Fig6}(a) with $\tau_{\text{ME}}=212\,\mu\text{s}$ and $T=5.1$~ms.}
    \label{fig:Fig.7}
\end{figure}

\section{Conclusions}
%In this work, we presented two experiments that demonstrate phase-sensitive NMRd measurements of $^{31}$P spins with sub-\AA ngstrom precision.
In this work, we presented two experiments that utilize the large encoding wavevectors generated in a nanoMRI setting to realize phase-sensitive position measurement of $^{31}$P spins with sub-\AA ngstrom precision. These results demonstrate new capabilities for studying material structure and quantum phenomena by extending the the spectroscopic and imaging capabilities of NMR to the atomic scale. Although the concept of NMRd was first envisioned for the study of material structure, it can be applied more generally to study the dynamics of spatially-periodic spin correlations. For example, experiment presented in Sec.~\ref{NMR_Interferometer} can be readily adapted to study quantum transport by replacing the storage period with an evolution under an effective Hamiltonian. In fact, such experiments have been performed to study dipolar spin diffusion of $^{19}$F spins in $\text{CaF}_2$ on the micron scale \cite{Zhang1998}. Here, we have demonstrated the ability to generate encoding wavevectors that are nearly a factor of $10^4$ times larger than these previous works, which could be used to probe spin transport on length scales as short as the lattice spacing, where quantum phenomena could become important. In addition, the interferometric method introduced in this work to measure displacement could be extended to study molecular motion on the \AA ngstrom scale using Fourier imaging techniques. More generally, atomic-scale NMRd could be applied to Hamiltonian engineering applications by providing local control of spins in periodic spin systems \cite{Ajoy2013}, and for probing correlations in nuclear spin chains, where novel quantum many-body correlations have been observed \cite{Wei2018}.

The application of  NMRd to study three-dimensional crystal structure will require devices capable of generating highly uniform field gradients. 
Upcoming experiments focusing on NMRd crystallography will utilize a new design that combines the CFFGS with four additional current carrying paths designed to generate highly uniform three-dimensional field gradients of order $3\times 10^4$~T/m with a maximum variation of 0.5\% in a $\sim(100~\text{nm})^3$ volume, suitable for crystallographic NMRd measurements. Using these gradients, $^1$H spins separated by 3~\AA, for example, would form a DE at an encoding time of 2.6~ms, which is readily achievable using dynamical-decoupling NMR sequences, such as the SME. This capability could be used to study the structure of organic nanocrystalline materials, such as protein nanocrystals, that are of great interest in structural biology.

\section{Acknowledgements}
This work was undertaken thanks in part to funding from the U.S. Army Research Office through Grant No.
W911NF1610199, the Canada First Research Excellence
Fund (CFREF), and the Natural Sciences and Engineering Research Council of Canada (NSERC). The University of Waterloo's QNFCF facility was used for this work. This infrastructure would not be possible without the significant contributions of CFREF-TQT, CFI, Industry Canada, the Ontario Ministry of Research and Innovation and Mike and Ophelia Lazaridis. Their support is gratefully acknowledged. H.H. would like to thank  F. Flicker, S. H. Simon and H. S. RÃ¸ising for insightful and inspiring discussions. R.B thanks D. G. Cory and A. Cooper for useful discussions.

H. Haas and S. Tabatabaei contributed equally to this work.




%%% References %%%
% \nocite{*}
% \bibliography{bibliography}
%apsrev4-2.bst 2019-01-14 (MD) hand-edited version of apsrev4-1.bst
%Control: key (0)
%Control: author (8) initials jnrlst
%Control: editor formatted (1) identically to author
%Control: production of article title (0) allowed
%Control: page (0) single
%Control: year (1) truncated
%Control: production of eprint (0) enabled
\providecommand{\noopsort}[1]{}\providecommand{\singleletter}[1]{#1}%
\begin{thebibliography}{31}%
\makeatletter
\providecommand \@ifxundefined [1]{%
 \@ifx{#1\undefined}
}%
\providecommand \@ifnum [1]{%
 \ifnum #1\expandafter \@firstoftwo
 \else \expandafter \@secondoftwo
 \fi
}%
\providecommand \@ifx [1]{%
 \ifx #1\expandafter \@firstoftwo
 \else \expandafter \@secondoftwo
 \fi
}%
\providecommand \natexlab [1]{#1}%
\providecommand \enquote  [1]{``#1''}%
\providecommand \bibnamefont  [1]{#1}%
\providecommand \bibfnamefont [1]{#1}%
\providecommand \citenamefont [1]{#1}%
\providecommand \href@noop [0]{\@secondoftwo}%
\providecommand \href [0]{\begingroup \@sanitize@url \@href}%
\providecommand \@href[1]{\@@startlink{#1}\@@href}%
\providecommand \@@href[1]{\endgroup#1\@@endlink}%
\providecommand \@sanitize@url [0]{\catcode `\\12\catcode `\$12\catcode
  `\&12\catcode `\#12\catcode `\^12\catcode `\_12\catcode `\%12\relax}%
\providecommand \@@startlink[1]{}%
\providecommand \@@endlink[0]{}%
\providecommand \url  [0]{\begingroup\@sanitize@url \@url }%
\providecommand \@url [1]{\endgroup\@href {#1}{\urlprefix }}%
\providecommand \urlprefix  [0]{URL }%
\providecommand \Eprint [0]{\href }%
\providecommand \doibase [0]{https://doi.org/}%
\providecommand \selectlanguage [0]{\@gobble}%
\providecommand \bibinfo  [0]{\@secondoftwo}%
\providecommand \bibfield  [0]{\@secondoftwo}%
\providecommand \translation [1]{[#1]}%
\providecommand \BibitemOpen [0]{}%
\providecommand \bibitemStop [0]{}%
\providecommand \bibitemNoStop [0]{.\EOS\space}%
\providecommand \EOS [0]{\spacefactor3000\relax}%
\providecommand \BibitemShut  [1]{\csname bibitem#1\endcsname}%
\let\auto@bib@innerbib\@empty
%</preamble>
\bibitem [{\citenamefont {Ajoy}\ \emph {et~al.}(2015)\citenamefont {Ajoy},
  \citenamefont {Bissbort}, \citenamefont {Lukin}, \citenamefont {Walsworth},\
  and\ \citenamefont {Cappellaro}}]{Ajoy2015}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {A.}~\bibnamefont
  {Ajoy}}, \bibinfo {author} {\bibfnamefont {U.}~\bibnamefont {Bissbort}},
  \bibinfo {author} {\bibfnamefont {M.~D.}\ \bibnamefont {Lukin}}, \bibinfo
  {author} {\bibfnamefont {R.~L.}\ \bibnamefont {Walsworth}},\ and\ \bibinfo
  {author} {\bibfnamefont {P.}~\bibnamefont {Cappellaro}},\ }\bibfield  {title}
  {\bibinfo {title} {\textit{Atomic-Scale Nuclear Spin Imaging Using
  Quantum-Assisted Sensors in Diamond}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Phys. Rev. X}\ }\textbf {\bibinfo {volume} {5}},\
  \bibinfo {pages} {011001} (\bibinfo {year} {2015})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Perunicic}\ \emph {et~al.}(2016)\citenamefont
  {Perunicic}, \citenamefont {Hill}, \citenamefont {Hall},\ and\ \citenamefont
  {Hollenberg}}]{Perunicic2016}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {V.~S.}\ \bibnamefont
  {Perunicic}}, \bibinfo {author} {\bibfnamefont {C.~D.}\ \bibnamefont {Hill}},
  \bibinfo {author} {\bibfnamefont {L.~T.}\ \bibnamefont {Hall}},\ and\
  \bibinfo {author} {\bibfnamefont {L.~C.}\ \bibnamefont {Hollenberg}},\
  }\bibfield  {title} {\bibinfo {title} {\textit{A Quantum Spin-Probe Molecular
  Microscope}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal}
  {{Nat. Commun.}}\ }\textbf {\bibinfo {volume} {7}},\ \bibinfo {pages} {12667}
  (\bibinfo {year} {2016})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Schirhagl}\ \emph {et~al.}(2014)\citenamefont
  {Schirhagl}, \citenamefont {Chang}, \citenamefont {Loretz},\ and\
  \citenamefont {Degen}}]{Schirhagl2014}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {R.}~\bibnamefont
  {Schirhagl}}, \bibinfo {author} {\bibfnamefont {K.}~\bibnamefont {Chang}},
  \bibinfo {author} {\bibfnamefont {M.}~\bibnamefont {Loretz}},\ and\ \bibinfo
  {author} {\bibfnamefont {C.~L.}\ \bibnamefont {Degen}},\ }\bibfield  {title}
  {\bibinfo {title} {\textit{Nitrogen-Vacancy Centers in Diamond: Nanoscale
  Sensors for Physics and Biology}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Annu. Rev. Phys. Chem.}\ }\textbf {\bibinfo {volume}
  {65}},\ \bibinfo {pages} {83} (\bibinfo {year} {2014})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Casola}\ \emph {et~al.}(2018)\citenamefont {Casola},
  \citenamefont {Sar},\ and\ \citenamefont {Yacoby}}]{Casola2018}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {F.}~\bibnamefont
  {Casola}}, \bibinfo {author} {\bibfnamefont {T.~V.~D.}\ \bibnamefont {Sar}},\
  and\ \bibinfo {author} {\bibfnamefont {A.}~\bibnamefont {Yacoby}},\
  }\bibfield  {title} {\bibinfo {title} {\textit{Probing Condensed Matter
  Physics with Magnetometry based on Nitrogen-Vacancy Centres in Diamond}},\
  }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal} {{Nat. Rev.
  Mater.}}\ }\textbf {\bibinfo {volume} {3}},\ \bibinfo {pages} {17088}
  (\bibinfo {year} {2018})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Rugar}\ \emph {et~al.}(2004)\citenamefont {Rugar},
  \citenamefont {Budakian}, \citenamefont {Mamin},\ and\ \citenamefont
  {Chui}}]{Rugar2004}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {D.}~\bibnamefont
  {Rugar}}, \bibinfo {author} {\bibfnamefont {R.}~\bibnamefont {Budakian}},
  \bibinfo {author} {\bibfnamefont {H.~J.}\ \bibnamefont {Mamin}},\ and\
  \bibinfo {author} {\bibfnamefont {B.~W.}\ \bibnamefont {Chui}},\ }\bibfield
  {title} {\bibinfo {title} {\textit{Single Spin Detection by Magnetic
  Resonance Force Microscopy}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo
   {journal} {Nature}\ }\textbf {\bibinfo {volume} {430}},\ \bibinfo {pages}
  {329} (\bibinfo {year} {2004})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Grinolds}\ \emph {et~al.}(2013)\citenamefont
  {Grinolds}, \citenamefont {Hong}, \citenamefont {Maletinsky}, \citenamefont
  {Luan}, \citenamefont {Lukin}, \citenamefont {Walsworth},\ and\ \citenamefont
  {Yacoby}}]{Grinolds2013}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {M.~S.}\ \bibnamefont
  {Grinolds}}, \bibinfo {author} {\bibfnamefont {S.}~\bibnamefont {Hong}},
  \bibinfo {author} {\bibfnamefont {P.}~\bibnamefont {Maletinsky}}, \bibinfo
  {author} {\bibfnamefont {L.}~\bibnamefont {Luan}}, \bibinfo {author}
  {\bibfnamefont {M.~D.}\ \bibnamefont {Lukin}}, \bibinfo {author}
  {\bibfnamefont {R.~L.}\ \bibnamefont {Walsworth}},\ and\ \bibinfo {author}
  {\bibfnamefont {A.}~\bibnamefont {Yacoby}},\ }\bibfield  {title} {\bibinfo
  {title} {\textit{Nanoscale Magnetic Imaging of a Single Electron Spin under
  Ambient Conditions}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo
  {journal} {Nat. Phys.}\ }\textbf {\bibinfo {volume} {9}},\ \bibinfo {pages}
  {215} (\bibinfo {year} {2013})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Willke}\ \emph {et~al.}(2019)\citenamefont {Willke},
  \citenamefont {Yang}, \citenamefont {Bae}, \citenamefont {Heinrich},\ and\
  \citenamefont {Lutz}}]{Willke2019}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {P.}~\bibnamefont
  {Willke}}, \bibinfo {author} {\bibfnamefont {K.}~\bibnamefont {Yang}},
  \bibinfo {author} {\bibfnamefont {Y.}~\bibnamefont {Bae}}, \bibinfo {author}
  {\bibfnamefont {A.~J.}\ \bibnamefont {Heinrich}},\ and\ \bibinfo {author}
  {\bibfnamefont {C.~P.}\ \bibnamefont {Lutz}},\ }\bibfield  {title} {\bibinfo
  {title} {\textit{{Magnetic Resonance Imaging of Single Atoms on a
  Surface}}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal} {Nat.
  Phys.}\ }\textbf {\bibinfo {volume} {15}},\ \bibinfo {pages} {1005} (\bibinfo
  {year} {2019})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Lovchinsky}\ \emph {et~al.}(2016)\citenamefont
  {Lovchinsky}, \citenamefont {Sushkov}, \citenamefont {Urbach}, \citenamefont
  {de~Leon}, \citenamefont {Choi}, \citenamefont {Greve}, \citenamefont
  {Evans}, \citenamefont {Gertner}, \citenamefont {Bersin}, \citenamefont
  {MÃ¼ller}, \citenamefont {McGuinness}, \citenamefont {Jelezko}, \citenamefont
  {Walsworth}, \citenamefont {Park},\ and\ \citenamefont
  {Lukin}}]{Lovchinsky2016}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {I.}~\bibnamefont
  {Lovchinsky}}, \bibinfo {author} {\bibfnamefont {A.~O.}\ \bibnamefont
  {Sushkov}}, \bibinfo {author} {\bibfnamefont {E.}~\bibnamefont {Urbach}},
  \bibinfo {author} {\bibfnamefont {N.~P.}\ \bibnamefont {de~Leon}}, \bibinfo
  {author} {\bibfnamefont {S.}~\bibnamefont {Choi}}, \bibinfo {author}
  {\bibfnamefont {K.~D.}\ \bibnamefont {Greve}}, \bibinfo {author}
  {\bibfnamefont {R.}~\bibnamefont {Evans}}, \bibinfo {author} {\bibfnamefont
  {R.}~\bibnamefont {Gertner}}, \bibinfo {author} {\bibfnamefont
  {E.}~\bibnamefont {Bersin}}, \bibinfo {author} {\bibfnamefont
  {C.}~\bibnamefont {MÃ¼ller}}, \bibinfo {author} {\bibfnamefont
  {L.}~\bibnamefont {McGuinness}}, \bibinfo {author} {\bibfnamefont
  {F.}~\bibnamefont {Jelezko}}, \bibinfo {author} {\bibfnamefont {R.~L.}\
  \bibnamefont {Walsworth}}, \bibinfo {author} {\bibfnamefont {H.}~\bibnamefont
  {Park}},\ and\ \bibinfo {author} {\bibfnamefont {M.~D.}\ \bibnamefont
  {Lukin}},\ }\bibfield  {title} {\bibinfo {title} {{\textit{Nuclear Magnetic
  Resonance Detection and Spectroscopy of Single Proteins using Quantum
  Logic}}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal}
  {Science}\ }\textbf {\bibinfo {volume} {351}},\ \bibinfo {pages} {836}
  (\bibinfo {year} {2016})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Degen}\ \emph {et~al.}(2009)\citenamefont {Degen},
  \citenamefont {Poggio}, \citenamefont {Mamin}, \citenamefont {Rettner},\ and\
  \citenamefont {Rugar}}]{Degen2009}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {C.~L.}\ \bibnamefont
  {Degen}}, \bibinfo {author} {\bibfnamefont {M.}~\bibnamefont {Poggio}},
  \bibinfo {author} {\bibfnamefont {H.~J.}\ \bibnamefont {Mamin}}, \bibinfo
  {author} {\bibfnamefont {C.~T.}\ \bibnamefont {Rettner}},\ and\ \bibinfo
  {author} {\bibfnamefont {D.}~\bibnamefont {Rugar}},\ }\bibfield  {title}
  {\bibinfo {title} {\textit{Nanoscale Magnetic Resonance Imaging}},\
  }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal} {Proc. Natl. Acad.
  Sci. U.S.A}\ }\textbf {\bibinfo {volume} {106}},\ \bibinfo {pages} {1313}
  (\bibinfo {year} {2009})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Taminiau}\ \emph {et~al.}(2012)\citenamefont
  {Taminiau}, \citenamefont {Wagenaar}, \citenamefont {Sar}, \citenamefont
  {Jelezko}, \citenamefont {Dobrovitski},\ and\ \citenamefont
  {Hanson}}]{Taminiau2012}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {T.~H.}\ \bibnamefont
  {Taminiau}}, \bibinfo {author} {\bibfnamefont {J.~J.}\ \bibnamefont
  {Wagenaar}}, \bibinfo {author} {\bibfnamefont {T.~V.~D.}\ \bibnamefont
  {Sar}}, \bibinfo {author} {\bibfnamefont {F.}~\bibnamefont {Jelezko}},
  \bibinfo {author} {\bibfnamefont {V.~V.}\ \bibnamefont {Dobrovitski}},\ and\
  \bibinfo {author} {\bibfnamefont {R.}~\bibnamefont {Hanson}},\ }\bibfield
  {title} {\bibinfo {title} {\textit{Detection and Control of Individual
  Nuclear Spins using a Weakly Coupled Electron Spin}},\ }\href@noop {}
  {\bibfield  {journal} {\bibinfo  {journal} {Phys. Rev. Lett.}\ }\textbf
  {\bibinfo {volume} {109}},\ \bibinfo {pages} {137602} (\bibinfo {year}
  {2012})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Zopes}\ \emph {et~al.}(2018)\citenamefont {Zopes},
  \citenamefont {Cujia}, \citenamefont {Sasaki}, \citenamefont {Boss},
  \citenamefont {Itoh},\ and\ \citenamefont {Degen}}]{Zopes2018}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {J.}~\bibnamefont
  {Zopes}}, \bibinfo {author} {\bibfnamefont {K.~S.}\ \bibnamefont {Cujia}},
  \bibinfo {author} {\bibfnamefont {K.}~\bibnamefont {Sasaki}}, \bibinfo
  {author} {\bibfnamefont {J.~M.}\ \bibnamefont {Boss}}, \bibinfo {author}
  {\bibfnamefont {K.~M.}\ \bibnamefont {Itoh}},\ and\ \bibinfo {author}
  {\bibfnamefont {C.~L.}\ \bibnamefont {Degen}},\ }\bibfield  {title} {\bibinfo
  {title} {\textit{Three-Dimensional Localization Spectroscopy of Individual
  Nuclear Spins with Sub-Angstrom Resolution}},\ }\href@noop {} {\bibfield
  {journal} {\bibinfo  {journal} {Nat. Commun.}\ }\textbf {\bibinfo {volume}
  {9}},\ \bibinfo {pages} {4678} (\bibinfo {year} {2018})}\BibitemShut
  {NoStop}%
\bibitem [{\citenamefont {Grob}\ \emph {et~al.}(2019)\citenamefont {Grob},
  \citenamefont {Krass}, \citenamefont {H{\'e}ritier}, \citenamefont
  {Pachlatko}, \citenamefont {Rhensius}, \citenamefont {Ko{\v{s}}ata},
  \citenamefont {Moores}, \citenamefont {Takahashi}, \citenamefont {Eichler},\
  and\ \citenamefont {Degen}}]{Grob2019}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {U.}~\bibnamefont
  {Grob}}, \bibinfo {author} {\bibfnamefont {M.~D.}\ \bibnamefont {Krass}},
  \bibinfo {author} {\bibfnamefont {M.}~\bibnamefont {H{\'e}ritier}}, \bibinfo
  {author} {\bibfnamefont {R.}~\bibnamefont {Pachlatko}}, \bibinfo {author}
  {\bibfnamefont {J.}~\bibnamefont {Rhensius}}, \bibinfo {author}
  {\bibfnamefont {J.}~\bibnamefont {Ko{\v{s}}ata}}, \bibinfo {author}
  {\bibfnamefont {B.~A.}\ \bibnamefont {Moores}}, \bibinfo {author}
  {\bibfnamefont {H.}~\bibnamefont {Takahashi}}, \bibinfo {author}
  {\bibfnamefont {A.}~\bibnamefont {Eichler}},\ and\ \bibinfo {author}
  {\bibfnamefont {C.~L.}\ \bibnamefont {Degen}},\ }\bibfield  {title} {\bibinfo
  {title} {{\textit{Magnetic Resonance Force Microscopy with a One-Dimensional
  Resolution of 0.9 Nanometers}}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Nano Lett.}\ }\textbf {\bibinfo {volume} {19}},\
  \bibinfo {pages} {7935} (\bibinfo {year} {2019})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Rugar}\ \emph {et~al.}(2015)\citenamefont {Rugar},
  \citenamefont {Mamin}, \citenamefont {Sherwood}, \citenamefont {Kim},
  \citenamefont {Rettner}, \citenamefont {Ohno},\ and\ \citenamefont
  {Awschalom}}]{Rugar2015}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {D.}~\bibnamefont
  {Rugar}}, \bibinfo {author} {\bibfnamefont {H.~J.}\ \bibnamefont {Mamin}},
  \bibinfo {author} {\bibfnamefont {M.~H.}\ \bibnamefont {Sherwood}}, \bibinfo
  {author} {\bibfnamefont {M.}~\bibnamefont {Kim}}, \bibinfo {author}
  {\bibfnamefont {C.~T.}\ \bibnamefont {Rettner}}, \bibinfo {author}
  {\bibfnamefont {K.}~\bibnamefont {Ohno}},\ and\ \bibinfo {author}
  {\bibfnamefont {D.~D.}\ \bibnamefont {Awschalom}},\ }\bibfield  {title}
  {\bibinfo {title} {{\textit{Proton Magnetic Resonance Imaging using a
  Nitrogen-Vacancy Spin Sensor}}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Nat. Nanotechnol.}\ }\textbf {\bibinfo {volume} {10}},\
  \bibinfo {pages} {120} (\bibinfo {year} {2015})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Arai}\ \emph {et~al.}(2015)\citenamefont {Arai},
  \citenamefont {Belthangady}, \citenamefont {Zhang}, \citenamefont {Bar-Gill},
  \citenamefont {DeVience}, \citenamefont {Cappellaro}, \citenamefont
  {Yacoby},\ and\ \citenamefont {Walsworth}}]{Arai2015}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {K.}~\bibnamefont
  {Arai}}, \bibinfo {author} {\bibfnamefont {C.}~\bibnamefont {Belthangady}},
  \bibinfo {author} {\bibfnamefont {H.}~\bibnamefont {Zhang}}, \bibinfo
  {author} {\bibfnamefont {N.}~\bibnamefont {Bar-Gill}}, \bibinfo {author}
  {\bibfnamefont {S.~J.}\ \bibnamefont {DeVience}}, \bibinfo {author}
  {\bibfnamefont {P.}~\bibnamefont {Cappellaro}}, \bibinfo {author}
  {\bibfnamefont {A.}~\bibnamefont {Yacoby}},\ and\ \bibinfo {author}
  {\bibfnamefont {R.~L.}\ \bibnamefont {Walsworth}},\ }\bibfield  {title}
  {\bibinfo {title} {\textit{Fourier Magnetic Imaging with Nanoscale Resolution
  and Compressed Sensing Speed-up using Electronic Spins in Diamond}},\
  }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal} {Nat.
  Nanotechnol.}\ }\textbf {\bibinfo {volume} {10}},\ \bibinfo {pages} {859}
  (\bibinfo {year} {2015})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Ziem}\ \emph {et~al.}(2019)\citenamefont {Ziem},
  \citenamefont {Garsi}, \citenamefont {Fedder},\ and\ \citenamefont
  {Wrachtrup}}]{Ziem2019}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {F.}~\bibnamefont
  {Ziem}}, \bibinfo {author} {\bibfnamefont {M.}~\bibnamefont {Garsi}},
  \bibinfo {author} {\bibfnamefont {H.}~\bibnamefont {Fedder}},\ and\ \bibinfo
  {author} {\bibfnamefont {J.}~\bibnamefont {Wrachtrup}},\ }\bibfield  {title}
  {\bibinfo {title} {\textit{Quantitative Nanoscale MRI with a Wide Field of
  View}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal} {Sci.
  Rep.}\ }\textbf {\bibinfo {volume} {9}},\ \bibinfo {pages} {12166} (\bibinfo
  {year} {2019})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Rose}\ \emph {et~al.}(2018)\citenamefont {Rose},
  \citenamefont {Haas}, \citenamefont {Chen}, \citenamefont {Jeon},
  \citenamefont {Lauhon}, \citenamefont {Cory},\ and\ \citenamefont
  {Budakian}}]{Rose2018}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {W.}~\bibnamefont
  {Rose}}, \bibinfo {author} {\bibfnamefont {H.}~\bibnamefont {Haas}}, \bibinfo
  {author} {\bibfnamefont {A.~Q.}\ \bibnamefont {Chen}}, \bibinfo {author}
  {\bibfnamefont {N.}~\bibnamefont {Jeon}}, \bibinfo {author} {\bibfnamefont
  {L.~J.}\ \bibnamefont {Lauhon}}, \bibinfo {author} {\bibfnamefont {D.~G.}\
  \bibnamefont {Cory}},\ and\ \bibinfo {author} {\bibfnamefont
  {R.}~\bibnamefont {Budakian}},\ }\bibfield  {title} {\bibinfo {title}
  {\textit{High-Resolution Nanoscale Solid-State Nuclear Magnetic Resonance
  Spectroscopy}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal}
  {Phys. Rev. X}\ }\textbf {\bibinfo {volume} {8}},\ \bibinfo {pages} {011030}
  (\bibinfo {year} {2018})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Mansfield}\ and\ \citenamefont
  {Grannell}(1973)}]{Mansfield1973}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {P.}~\bibnamefont
  {Mansfield}}\ and\ \bibinfo {author} {\bibfnamefont {P.~K.}\ \bibnamefont
  {Grannell}},\ }\bibfield  {title} {\bibinfo {title} {\textit{NMR
  âDiffractionâ in Solids?}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {J. Phys. C: Solid State Phys.}\ }\textbf {\bibinfo
  {volume} {6}},\ \bibinfo {pages} {L422} (\bibinfo {year} {1973})}\BibitemShut
  {NoStop}%
\bibitem [{Note1()}]{Note1}%
  \BibitemOpen
  \bibinfo {note} {In MRI, $k=\gamma G \tau $ is the encoding wavenumber
  corresponding to the spatial modulation of the nuclear spin magnetization,
  generated by the evolution of spins with gyromagnetic ratio $\gamma $ in the
  magnetic field gradient $G$ for a time $\tau $.}\BibitemShut {Stop}%
\bibitem [{\citenamefont {Vachha}\ and\ \citenamefont
  {Huang}(2021)}]{Vachha2021}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {B.}~\bibnamefont
  {Vachha}}\ and\ \bibinfo {author} {\bibfnamefont {S.~Y.}\ \bibnamefont
  {Huang}},\ }\bibfield  {title} {\bibinfo {title} {\textit{MRI with Ultrahigh
  Field Strength and High-Performance Gradients: Challenges and Opportunities
  for Clinical Neuroimaging at 7 T and Beyond}},\ }\href@noop {} {\bibfield
  {journal} {\bibinfo  {journal} {Eur. Radiol. Exp}\ }\textbf {\bibinfo
  {volume} {5}},\ \bibinfo {pages} {35} (\bibinfo {year} {2021})}\BibitemShut
  {NoStop}%
\bibitem [{\citenamefont {Boutis}\ \emph {et~al.}(2003)\citenamefont {Boutis},
  \citenamefont {Cappellaro}, \citenamefont {Cho}, \citenamefont {Ramanathan},\
  and\ \citenamefont {Cory}}]{Boutis2003}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {G.~S.}\ \bibnamefont
  {Boutis}}, \bibinfo {author} {\bibfnamefont {P.}~\bibnamefont {Cappellaro}},
  \bibinfo {author} {\bibfnamefont {H.}~\bibnamefont {Cho}}, \bibinfo {author}
  {\bibfnamefont {C.}~\bibnamefont {Ramanathan}},\ and\ \bibinfo {author}
  {\bibfnamefont {D.~G.}\ \bibnamefont {Cory}},\ }\bibfield  {title} {\bibinfo
  {title} {\textit{Pulse Error Compensating Symmetric Magic-Echo Trains}},\
  }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal} {J. Magn. Reson.}\
  }\textbf {\bibinfo {volume} {161}},\ \bibinfo {pages} {132} (\bibinfo {year}
  {2003})}\BibitemShut {NoStop}%
\bibitem [{Sup()}]{Supplements}%
  \BibitemOpen
  \href@noop {} {}\bibinfo {note} {See Supplemental Material for details of the
  sample attachment, CFFGS field distribution, sample geometry
  characterization, control sequences, supplementary measurements and further
  calculations, including videos of the sample attachment and the operation of
  the band inversion pulses.}\BibitemShut {Stop}%
\bibitem [{\citenamefont {Sahafi}\ \emph {et~al.}(2019)\citenamefont {Sahafi},
  \citenamefont {Rose}, \citenamefont {Jordan}, \citenamefont {Yager},
  \citenamefont {Piscitelli},\ and\ \citenamefont {Budakian}}]{Sahafi2020}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {P.}~\bibnamefont
  {Sahafi}}, \bibinfo {author} {\bibfnamefont {W.}~\bibnamefont {Rose}},
  \bibinfo {author} {\bibfnamefont {A.}~\bibnamefont {Jordan}}, \bibinfo
  {author} {\bibfnamefont {B.}~\bibnamefont {Yager}}, \bibinfo {author}
  {\bibfnamefont {M.}~\bibnamefont {Piscitelli}},\ and\ \bibinfo {author}
  {\bibfnamefont {R.}~\bibnamefont {Budakian}},\ }\bibfield  {title} {\bibinfo
  {title} {\textit{Ultralow Dissipation Patterned Silicon Nanowire Arrays for
  Scanning Probe Microscopy}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo
  {journal} {Nano Lett.}\ }\textbf {\bibinfo {volume} {20}},\ \bibinfo {pages}
  {218} (\bibinfo {year} {2019})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Poggio}\ \emph {et~al.}(2007)\citenamefont {Poggio},
  \citenamefont {Degen}, \citenamefont {Mamin},\ and\ \citenamefont
  {Rugar}}]{Poggio2007}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {M.}~\bibnamefont
  {Poggio}}, \bibinfo {author} {\bibfnamefont {C.~L.}\ \bibnamefont {Degen}},
  \bibinfo {author} {\bibfnamefont {H.~J.}\ \bibnamefont {Mamin}},\ and\
  \bibinfo {author} {\bibfnamefont {D.}~\bibnamefont {Rugar}},\ }\bibfield
  {title} {\bibinfo {title} {\textit{Feedback Cooling of a Cantilever's
  Fundamental Mode below 5 mK}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Phys. Rev. Lett}\ }\textbf {\bibinfo {volume} {99}},\
  \bibinfo {pages} {017201} (\bibinfo {year} {2007})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Dalacu}\ \emph {et~al.}(2012)\citenamefont {Dalacu},
  \citenamefont {Mnaymneh}, \citenamefont {Lapointe}, \citenamefont {Wu},
  \citenamefont {Poole}, \citenamefont {Bulgarini}, \citenamefont {Zwiller},\
  and\ \citenamefont {Reimer}}]{Dalacu2012}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {D.}~\bibnamefont
  {Dalacu}}, \bibinfo {author} {\bibfnamefont {K.}~\bibnamefont {Mnaymneh}},
  \bibinfo {author} {\bibfnamefont {J.}~\bibnamefont {Lapointe}}, \bibinfo
  {author} {\bibfnamefont {X.}~\bibnamefont {Wu}}, \bibinfo {author}
  {\bibfnamefont {P.~J.}\ \bibnamefont {Poole}}, \bibinfo {author}
  {\bibfnamefont {G.}~\bibnamefont {Bulgarini}}, \bibinfo {author}
  {\bibfnamefont {V.}~\bibnamefont {Zwiller}},\ and\ \bibinfo {author}
  {\bibfnamefont {M.~E.}\ \bibnamefont {Reimer}},\ }\bibfield  {title}
  {\bibinfo {title} {\textit{Ultraclean Emission from InAsP Quantum Dots in
  Defect-Free Wurtzite InP Nanowires}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Nano Lett.}\ }\textbf {\bibinfo {volume} {12}},\
  \bibinfo {pages} {5919} (\bibinfo {year} {2012})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Casella}\ and\ \citenamefont
  {Berger}(1990)}]{Casella_1990}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {G.}~\bibnamefont
  {Casella}}\ and\ \bibinfo {author} {\bibfnamefont {R.}~\bibnamefont
  {Berger}},\ }\href@noop {} {\emph {\bibinfo {title} {Statistical
  Inference}}},\ Duxbury advanced series\ (\bibinfo  {publisher} {Brooks/Cole
  Publishing Company},\ \bibinfo {year} {1990})\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Sivia}\ and\ \citenamefont
  {Skilling}(2006)}]{sivia2006}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {D.}~\bibnamefont
  {Sivia}}\ and\ \bibinfo {author} {\bibfnamefont {J.}~\bibnamefont
  {Skilling}},\ }\href@noop {} {\emph {\bibinfo {title} {\textit{Data Analysis:
  A Bayesian Tutorial}}}},\ Oxford science publications\ (\bibinfo  {publisher}
  {OUP Oxford},\ \bibinfo {year} {2006})\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Zhang}\ and\ \citenamefont {Cory}(1998)}]{Zhang1998}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {W.}~\bibnamefont
  {Zhang}}\ and\ \bibinfo {author} {\bibfnamefont {D.~G.}\ \bibnamefont
  {Cory}},\ }\bibfield  {title} {\bibinfo {title} {\textit{First Direct
  Measurement of the Spin Diffusion Rate in a Homogenous Solid}},\ }\href@noop
  {} {\bibfield  {journal} {\bibinfo  {journal} {Phys. Rev. Lett.}\ }\textbf
  {\bibinfo {volume} {80}},\ \bibinfo {pages} {1324} (\bibinfo {year}
  {1998})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Ajoy}\ and\ \citenamefont
  {Cappellaro}(2013)}]{Ajoy2013}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {A.}~\bibnamefont
  {Ajoy}}\ and\ \bibinfo {author} {\bibfnamefont {P.}~\bibnamefont
  {Cappellaro}},\ }\bibfield  {title} {\bibinfo {title} {\textit{Quantum
  Simulation via Filtered Hamiltonian Engineering: Application to Perfect
  Quantum Transport in Spin Networks}},\ }\href@noop {} {\bibfield  {journal}
  {\bibinfo  {journal} {Phys. Rev. Lett.}\ }\textbf {\bibinfo {volume} {110}},\
  \bibinfo {pages} {220503} (\bibinfo {year} {2013})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Wei}\ \emph {et~al.}(2018)\citenamefont {Wei},
  \citenamefont {Ramanathan},\ and\ \citenamefont {Cappellaro}}]{Wei2018}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {K.~X.}\ \bibnamefont
  {Wei}}, \bibinfo {author} {\bibfnamefont {C.}~\bibnamefont {Ramanathan}},\
  and\ \bibinfo {author} {\bibfnamefont {P.}~\bibnamefont {Cappellaro}},\
  }\bibfield  {title} {\bibinfo {title} {\textit{Exploring Localization in
  Nuclear Spin Chains}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo
  {journal} {Phys. Rev. Lett.}\ }\textbf {\bibinfo {volume} {120}},\ \bibinfo
  {pages} {070501} (\bibinfo {year} {2018})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Tabatabaei}\ \emph {et~al.}(2021)\citenamefont
  {Tabatabaei}, \citenamefont {Haas}, \citenamefont {Rose}, \citenamefont
  {Yager}, \citenamefont {Piscitelli}, \citenamefont {Sahafi}, \citenamefont
  {Jordan}, \citenamefont {Poole}, \citenamefont {Dalacu},\ and\ \citenamefont
  {Budakian}}]{Tabatabaei2021}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {S.}~\bibnamefont
  {Tabatabaei}}, \bibinfo {author} {\bibfnamefont {H.}~\bibnamefont {Haas}},
  \bibinfo {author} {\bibfnamefont {W.}~\bibnamefont {Rose}}, \bibinfo {author}
  {\bibfnamefont {B.}~\bibnamefont {Yager}}, \bibinfo {author} {\bibfnamefont
  {M.}~\bibnamefont {Piscitelli}}, \bibinfo {author} {\bibfnamefont
  {P.}~\bibnamefont {Sahafi}}, \bibinfo {author} {\bibfnamefont
  {A.}~\bibnamefont {Jordan}}, \bibinfo {author} {\bibfnamefont {P.~J.}\
  \bibnamefont {Poole}}, \bibinfo {author} {\bibfnamefont {D.}~\bibnamefont
  {Dalacu}},\ and\ \bibinfo {author} {\bibfnamefont {R.}~\bibnamefont
  {Budakian}},\ }\bibfield  {title} {\bibinfo {title} {\textit{Numerical
  Engineering of Robust Adiabatic Operations}},\ }\href@noop {} {\bibfield
  {journal} {\bibinfo  {journal} {Phys. Rev. Applied}\ }\textbf {\bibinfo
  {volume} {15}},\ \bibinfo {pages} {044043} (\bibinfo {year}
  {2021})}\BibitemShut {NoStop}%
\bibitem [{\citenamefont {Nichol}\ \emph {et~al.}(2012)\citenamefont {Nichol},
  \citenamefont {Hemesath}, \citenamefont {Lauhon},\ and\ \citenamefont
  {Budakian}}]{Nichol2012}%
  \BibitemOpen
  \bibfield  {author} {\bibinfo {author} {\bibfnamefont {J.~M.}\ \bibnamefont
  {Nichol}}, \bibinfo {author} {\bibfnamefont {E.~R.}\ \bibnamefont
  {Hemesath}}, \bibinfo {author} {\bibfnamefont {L.~J.}\ \bibnamefont
  {Lauhon}},\ and\ \bibinfo {author} {\bibfnamefont {R.}~\bibnamefont
  {Budakian}},\ }\bibfield  {title} {\bibinfo {title} {\textit{Nanomechanical
  Detection of Nuclear Magnetic Resonance using a Silicon Nanowire
  Oscillator}},\ }\href@noop {} {\bibfield  {journal} {\bibinfo  {journal}
  {Phys. Rev. B}\ }\textbf {\bibinfo {volume} {85}},\ \bibinfo {pages} {054414}
  (\bibinfo {year} {2012})}\BibitemShut {NoStop}%
\end{thebibliography}%


\appendix

\section{Spin Detection Protocol}\label{Appendix}
Here, we briefly discuss our measurement protocol, while referring to \cite{Rose2018} and the supplements therein for further details. 
We use the MAGGIC protocol \cite{Nichol2012}, shown in Fig.~\ref{fig:Fig8}, to detect the force generated by the $z$-axis magnetization from the spin ensemble.
The protocol is comprised of successive applications of a measurement block, separated by an NMR encoding block containing the spin control operations of interest -- e.g., the sequences in Fig. \ref{fig:Fig4}(c) and Fig. \ref{fig:Fig6}(a) for our two experiments.
The duration of each measurement block $(\tau_0=1.0~\text{s})$ is chosen to be shorter than the correlation time of $\tau_m=2.9$~s of the statistical fluctuations for the $^{31}$P spins, measured using the MAGGIC protocol.

The MAGGIC waveform [Fig.~\ref{fig:Fig8}(b)] applied in each measurement block consists of two periods, during which the gradient $\partial B_z/\partial y$ is modulated at the resonant frequency of the SiNW.
To avoid spurious electrical couplings to the SiNW, we ensure that the modulation waveform has no Fourier component at $\omega_c$ by applying a periodic $\pi$ phase shift to the gradient modulation. An adiabatic full passage (AFP) pulse is applied synchronously with the phase shifts, which creates a force from the spins that is on resonance with the SiNW.
The average force correlation between two consecutive measurement blocks is
\begin{align}
    s \propto \int d^3r~n(\mathbf{r}) G_R^2(\mathbf{r}) \chi\big(u(\mathbf{r})\big) \langle \sigma_z \rangle_{\mathbf{r}},\label{eq:MAGGICsignal}
\end{align}
where $n(\mathbf{r})$ is the spin density, $G_R(\mathbf{r})=\partial B_z(\mathbf{r})/\partial y$ is the peak amplitude of the readout gradient, $\langle \sigma_z \rangle_{\mathbf{r}}$ is the expectation value of $\sigma_z$ at positon $\mathbf{r}$ at the end of the NMR encoding block, and $\chi(u)$ is a filter function quantifying the performance of the AFPs at Rabi frequency $u$ \cite{Rose2018}. 
From Eq.~(\ref{eq:MAGGICsignal}), we identify the effective spin density as $\rho(\mathbf{r}) = n(\mathbf{r}) G_R^2(\mathbf{r}) \chi\big(u(\mathbf{r})\big)$.

In the case where the NMR encoding block sequence is only selective in Rabi frequency [e.g., the sequence in Fig.~\ref{fig:Fig4}(c)], $\langle \sigma_z\rangle_{\mathbf{r}}$ is the same for spins experiencing equal Rabi frequencies, which simplifies Eq.~\eqref{eq:MAGGICsignal} to $s \propto \int du~p(u) \langle \sigma_z \rangle_u$, where $p(u)$ is the effective Rabi-frequency distribution.
Given the approximate one-to-one relationship between $z$ and $u$ in our sample volume, $p(u)$ can be written as
\begin{align}
    p(u) \approx \frac{\partial z(u)}{\partial u} \int_{-\infty}^\infty dx \int_{-\infty}^\infty dy~ \rho\big(x,y, z(u)\big).
\end{align}

For the measurement blocks, we utilized the 2.3 Rabi-cycle AFP presented in Ref.~\cite{Tabatabaei2021}.
For the experiment in Sec.~\ref{NMRd_18X_grating}, the AFP was 4.8~$\mu$s long, with a near-unity fidelity over $480 \text{ kHz} \leq u \leq 960 \text{ kHz}$, and for the experiment in Sec.~\ref{NMR_Interferometer}, the pulse was rescaled to be 5.7~$\mu$s to target the Rabi range $400 \text{ kHz} \leq u \leq 800 \text{ kHz}$.
In the latter experiment, we also restrict the detection volume to $u\leq 650$~kHz by including an additional waveform in the beginning of the NMR encoding block.
Acting as a low-pass filter, the waveform evolves spins aligned with the $z$-axis to the transverse plane for $u>650$ kHz, which then dephase due to transverse relaxation.
Spins experiencing $u\leq650$~kHz are not affected
(see Ref.~\cite{Supplements}).

\begin{figure}[h!]
    \centering
    \includegraphics[width = \columnwidth]{Fig8.pdf}
    \caption{MAGGIC spin detection protocol. (a) General overview of the protocol. The blue regions indicate the spin readout period during which the MAGGIC waveform is applied. The correlation signal [Eq.~\eqref{eq:MAGGICsignal}] is constructed from the average correlation of two consecutive force measurements made before and after the NMR encoding sequence.
    (b) The MAGGIC waveform primitive.}
    \label{fig:Fig8}
\end{figure}

%%% Supplements %%%
\clearpage
\clearpage
\includepdf[pages={1,{},{},2,{},3,{},4,{},5,{},6,{},7,{},8,{},9,{},10,{},11,{},12,{},13,{},14,{},15,{},16,{},17,{},18,{},19,{},20}]{supp.pdf}
\end{document}

\end{document}