\section{Conservative quadrature}

Let $a,b \in \Real, a \leq b, I := [a,b] \subset \Real$.
Given a Lipschitz function $f: I \to \Real $ we aim to compute conservative estimates of the definitive Riemann integral \[S := \int_{I} f(t) \, \d t.\] (Remark: PERHAPS CAN LIFT RIEMANN ASSUMPTION BY
AUGMENTING INTERVAL MEASURE ACCORDING TO AN ALTERNATIVE MEASURE).
In particular, given a finite budget of $N \in \nat$ function evaluations, we desire (i) to find two  estimates $S^\decke_N , S^\boden_N$ of the definite integral that are upper and lower conservative, respectively. That is, we desire 
\[S^\boden_N \leq S \leq S^\decke_N. \] Furthermore, we desire (ii) convergence to the true value in the limit of an infinite number of function evaluations. That is, we require
$S^\boden_N, S^\decke_N \stackrel{N \to \infty}{\longrightarrow} S $.
Finally, we desire (iii) $S^\decke_N,S^\boden_N$ to be closed-form. 

In the one-dimensional case, one obvious way to achieve this is to use the integrals of the Lipschitz ceiling and floor. That is, we define $S^\decke_N := \int_I \decke_N (t) \,dt $ and $S^\boden_N := \int_I \boden_N (t) \,dt $. 

(i) follows directly from the properties of the enclosing functions established by Thm. \ref{thm:enclosure1d_desiderata}.

 (iii) is easily addressed via noticing that both ceiling and floor functions are piece-wise linear functions. Hence, their definite integrals can be determined exactly in closed-form. In particular, the definite integral of the ceiling can be determined as follows:

\begin{thm} \label{thm:quad_floor} As in Sec.\ref{sec:enclosures}, let  $\xi^{\decke}_i =  \frac{t_i+t_{i+1}}{2}+ \frac{f(t_{i+1}) - f(t_i)}{2 L_i}  $. Let $S^\decke_N = \int_I \decke_N (t) \, \d t$ denote the definite integral of the Lipschitz ceiling.
%augmented grid $\tilde G_N = (t_1, \xi_1^\decke, t_2, \xi_2^\decke, t_3,\ldots,t_{N-1},\xi_{N-1}^\decke,t_{N} )$, and let $\tau_j$ denote the $j$th element 
%of augmented grid $\tilde G_N$.
We have 
$S^\decke_N=t_N f(t_N) - t_1 f(t_1)+\sum_{i=1}^{N-1} \xi^\decke_{i} \bigl( f(t_i) - f(t_{i+1}) \bigr) + \frac{L_i}{2} \bigl( (\xi^\decke_{i}-t_i )^2+ (\xi^\decke_{i} -t_{i+1})^2 \bigr) $. 


%\[ S^\decke_N  = \frac{1}{2} \sum_{i=1}^{3N-1} \bigl(\,(\tau_{i+1} - \tau_i) \,\bigl(\decke_N^i(\xi^{\decke}_i)(
%\tau_{i+1}) - \decke_N^i(\xi^{\decke}_i)(
%\tau_{i})\bigr), \, (N > 1);\]
%
%\[ S^\decke_N  = \frac{1}{2} \sum_{i=1}^{3N} \bigl(\,(\tau_{i+1} - \tau_i) \,\bigl(\decke_N^i(\xi^{\decke}_i)(
%\tau_{i+1}) - \decke_N^i(\xi^{\decke}_i)(
%\tau_{i})\bigr), \, (N = 1).\]

\begin{proof} With 
$\alpha^\decke_i: x \mapsto f(a_i) + L_i (x - a_i)$ and $\beta^\decke_i: x \mapsto
f(b_i) -L_i (x - b_i)$ the Lipschitz ceiling is the piecewise-linear function $\decke^i_N: t \mapsto \min\{ \alpha^\decke_i(t), \beta^\decke_i(t)$. As pointed out before, for all $t \in J_i$, we have $\decke_N^i(t) = 
 \begin{cases}  
 f(a_i) + L_i (t - a_i), & t \leq \xi^\decke_i \\
 f(b_i) -L_i (t - b_i), & t > \xi^\decke_i 
 \end{cases}$.

Therefore,
$S^\decke_N = \int_I \decke_N (t) \, \d t$
 
 $= \sum_{i=1}^{N-1} \int_{J_i} \decke_N^i (t) \, \d t$
 
 $= \sum_{i=1}^{N-1} \int_{t_i}^{t_{i+1}} \decke_N^i (t) \, \d t$
  
  $= \sum_{i=1}^{N-1} \bigl( \int_{t_i}^{\xi^\decke_{i}}  f(t_i) + L_i (t - t_i) \, \d t + \int_{\xi^\decke_{i}}^{t_{i+1}}   f(t_{i+1}) -L_i (t - t_{i+1})\, \d t \bigr)$
  
  $= \sum_{i=1}^{N-1} \bigl( \bigl[t f(t_i) + \frac{L_i (t-t_i )^2}{2}\bigr]_{t_i}^{\xi^\decke_{i}}  + \bigl[t f(t_{i+1}) - \frac{L_i (t -t_{i+1})^2}{2}\bigr]^{t_{i+1}}_{\xi^\decke_{i}} \bigr)$
  
  $= \sum_{i=1}^{N-1} \Bigl( \xi^\decke_{i} f(t_i) + \frac{L_i (\xi^\decke_{i}-t_i )^2}{2} - t_i f(t_i)   
  - \xi^\decke_{i} f(t_{i+1}) + \frac{L_i (\xi^\decke_{i} -t_{i+1})^2}{2}  + t_{i+1} f(t_{i+1}) \Bigr)$
  
    $=  t_N f(t_N) - t_1 f(t_1)+\sum_{i=1}^{N-1} \xi^\decke_{i} \bigl( f(t_i) - f(t_{i+1}) \bigr) + \frac{L_i}{2} \bigl( (\xi^\decke_{i}-t_i )^2+ (\xi^\decke_{i} -t_{i+1})^2 \bigr)      $.
\end{proof}

\end{thm}

Of course, we can obtain the completely analogous statement to the Lipschitz floor. 


\begin{thm} \label{thm:quad_ceiling} As in Sec.\ref{sec:enclosures}, let $\xi^{\mathfrak l}_i := \frac{t_i+t_{i+1}}{2} - \frac{f(t_{i+1}) - f(t_i)}{2 L_i}  $. Let $S^\boden_N = \int_I \boden_N (t) \, \d t$ denote the definite integral of the Lipschitz ceiling.
%augmented grid $\tilde G_N = (t_1, \xi_1^\boden, t_2, \xi_2^\boden, t_3,\ldots,t_{N-1},\xi_{N-1}^\boden,t_{N} )$, and let $\tau_j$ denote the $j$th element 
%of augmented grid $\tilde G_N$.
We have 
$S^\boden_N=t_N f(t_N) - t_1 f(t_1)+  \sum_{i=1}^{N-1} \Bigl(\xi^\boden_{i} \bigl( f(t_i) - f(t_{i+1})\bigr) - \frac{L_i}{2} \bigl( (\xi^\boden_{i}-t_i )^2 + (\xi^\boden_{i} -t_{i+1})^2 \bigr) 
 \Bigr) $. 


%\[ S^\boden_N  = \frac{1}{2} \sum_{i=1}^{3N-1} \bigl(\,(\tau_{i+1} - \tau_i) \,\bigl(\boden_N^i(\xi^{\boden}_i)(
%\tau_{i+1}) - \boden_N^i(\xi^{\boden}_i)(
%\tau_{i})\bigr), \, (N > 1);\]
%
%\[ S^\boden_N  = \frac{1}{2} \sum_{i=1}^{3N} \bigl(\,(\tau_{i+1} - \tau_i) \,\bigl(\boden_N^i(\xi^{\boden}_i)(
%\tau_{i+1}) - \boden_N^i(\xi^{\boden}_i)(
%\tau_{i})\bigr), \, (N = 1).\]

\begin{proof} As observed in the proof of Lem. \ref{lem:floor_values}, we have 
 $\boden_N^i(t) = 
 \begin{cases}  
 \alpha_i^{\mathfrak l} (t), & t \leq \xi_i^\boden \\
 \beta_i^{\mathfrak l} (t), & t \geq \xi_i^\boden
 \end{cases}$ 
% 
 where $\alpha^\boden_i( t) = f(t_i) - L_i (t - t_i)$ and $\beta^\boden_i( t) =
f(t_{i+1}) +L_i (t - t_{i+1})$.\\

Therefore,
$S^\boden_N = \int_I \boden_N (t) \, \d t$
 
 $= \sum_{i=1}^{N-1} \int_{J_i} \boden_N^i (t) \, \d t$
  $= \sum_{i=1}^{N-1} \int_{t_i}^{t_{i+1}} \boden_N^i (t) \, \d t$
  
  $= \sum_{i=1}^{N-1} \bigl( \int_{t_i}^{\xi^\boden_{i}}  f(t_i) - L_i (t - t_i) \, \d t + \int_{\xi^\boden_{i}}^{t_{i+1}}   f(t_{i+1}) +L_i (t - t_{i+1})\, \d t \bigr)$
  
  $= \sum_{i=1}^{N-1} \bigl( \bigl[t f(t_i) - \frac{L_i (t-t_i )^2}{2}\bigr]_{t_i}^{\xi^\boden_{i}}  + \bigl[t f(t_{i+1}) + \frac{L_i (t -t_{i+1})^2}{2}\bigr]^{t_{i+1}}_{\xi^\boden_{i}} \bigr)$
  
  $= \sum_{i=1}^{N-1} \Bigl( \xi^\boden_{i} f(t_i) - \frac{L_i (\xi^\boden_{i}-t_i )^2}{2} - t_i f(t_i)   
  - \xi^\boden_{i} f(t_{i+1}) - \frac{L_i (\xi^\boden_{i} -t_{i+1})^2}{2}  + t_{i+1} f(t_{i+1}) \Bigr)$
  
    $\stackrel{telescope \sum}{=}  t_N f(t_N) - t_1 f(t_1)+\sum_{i=1}^{N-1} \Bigl(\xi^\boden_{i} f(t_i) - \frac{L_i (\xi^\boden_{i}-t_i )^2}{2}   
  - \xi^\boden_{i} f(t_{i+1}) - \frac{L_i (\xi^\boden_{i} -t_{i+1})^2}{2}  \Bigr) $
  
  $= t_N f(t_N) - t_1 f(t_1)+  \sum_{i=1}^{N-1} \Bigl(\xi^\boden_{i} \bigl( f(t_i) - f(t_{i+1})\bigr) - \frac{L_i}{2} \bigl( (\xi^\boden_{i}-t_i )^2 + (\xi^\boden_{i} -t_{i+1})^2 \bigr) 
 \Bigr)  $
 
% $\stackrel{def. \,\xi^\boden_{i}} { =} t_N f(t_N) - t_1 f(t_1)+  \sum_{i=1}^{N-1} \Bigl([\frac{t_i+t_{i+1}}{2} - \frac{f(t_{i+1}) - f(t_{i})}{2 L_i}] \bigl( f(t_i) - f(t_{i+1})\bigr) - \frac{L_i}{2} \bigl( (\frac{t_i+t_{i+1}}{2} - \frac{f(t_{i+1}) - f(t_{i})}{2 L_i}-t_i )^2 + (\frac{t_i+t_{i+1}}{2} - \frac{f(t_{i+1}) - f(t_{i})}{2 L_i} -t_{i+1})^2 \bigr) 
% \Bigr)  $
% 
%$= t_N f(t_N) - t_1 f(t_1)+  \sum_{i=1}^{N-1} \Bigl( \bigl[ \frac{t_i f(t_i)}{2}+ \frac{t_{i+1} f(t_i)}{2} - \frac{t_{i} f(t_{i+1})}{2}- \frac{t_{i+1} f(t_{i+1})}{2} - \frac{f(t_{i+1}) f(t_i)}{2 L_i} + \frac{f(t_{i+1})^2}{2 L_i} + \frac{f(t_{i})^2}{2 L_i} - \frac{f(t_{i+1}) f(t_i)}{2 L_i}  \bigr] - \frac{L_i}{2} \bigl[ (\frac{t_{i+1} - t_i}{2} - \frac{f(t_{i+1}) - f(t_{i})}{2 L_i})^2 + (\frac{t_{i+1} -t_i}{2} + \frac{f(t_{i+1}) - f(t_{i})}{2 L_i} )^2 \bigr] 
% \Bigr)  $ 
% 
%$\stackrel{regroup}{=} t_N f(t_N) - t_1 f(t_1)+  \sum_{i=1}^{N-1} \Bigl( \bigl[ \frac{t_i f(t_i)}{2}- \frac{t_{i+1} f(t_{i+1})}{2}+ \frac{t_{i+1} f(t_i)}{2} - \frac{t_{i} f(t_{i+1})}{2} - \frac{f(t_{i+1}) f(t_i)}{ L_i} + \frac{f(t_{i+1})^2}{2 L_i} + \frac{f(t_{i})^2}{2 L_i} \bigr] - L_i \bigl[ (\frac{t_{i+1} - t_i}{2})^2 + (\frac{f(t_{i+1}) - f(t_{i})}{2 L_i} )^2 \bigr] 
% \Bigr)  $  
% 
% $\stackrel{telescope \sum}{=} t_N f(t_N) - t_1 f(t_1)+   \frac{t_1 f(t_1)}{2}- \frac{t_{N} f(t_{N})}{2} + \sum_{i=1}^{N-1} \Bigl( \bigl[  \frac{t_{i+1} f(t_i)}{2} - \frac{t_{i} f(t_{i+1})}{2} - \frac{f(t_{i+1}) f(t_i)}{ L_i} + \frac{f(t_{i+1})^2}{2 L_i} + \frac{f(t_{i})^2}{2 L_i} \bigr] - \bigl[\frac{(f(t_{i+1}) - f(t_{i}))^2 }{4 L_i} \bigr] 
% \Bigr)  - \sum_{i=1}^{N-1} L_i (\frac{t_{i+1} - t_i}{2})^2$  \\
%
% ${=} \frac{t_{N} f(t_{N})}{2} - \frac{t_1 f(t_1)}{2}  + \sum_{i=1}^{N-1} \Bigl( \bigl[  \frac{t_{i+1} f(t_i)}{2} - \frac{t_{i} f(t_{i+1})}{2} - \frac{f(t_{i+1}) f(t_i)}{ L_i} + \frac{f(t_{i+1})^2}{2 L_i} + \frac{f(t_{i})^2}{2 L_i} \bigr] - \frac{f(t_{i+1})^2 - 2f(t_{i+1}) f(t_i)+  f(t_{i})^2 }{4 L_i}
% \Bigr)  - \sum_{i=1}^{N-1} L_i (\frac{t_{i+1} - t_i}{2})^2$   
%
% ${=} \frac{t_{N} f(t_{N})}{2} - \frac{t_1 f(t_1)}{2}  + \sum_{i=1}^{N-1} \Bigl( \bigl[  \frac{t_{i+1} f(t_i)}{2} - \frac{t_{i} f(t_{i+1})}{2} - \frac{f(t_{i+1}) f(t_i)}{ 2L_i} + \frac{f(t_{i+1})^2}{4 L_i} + \frac{f(t_{i})^2}{4 L_i} \bigr] 
% \Bigr)  - \sum_{i=1}^{N-1} L_i (\frac{t_{i+1} - t_i}{2})^2$.    
 

\end{proof}

\end{thm}

Note, the definite integrals only require the existing function samples on our grid $G_N$. 

\subsection{Error Analysis and convergence.} Next, we will investigate (ii). That is, we want to establish convergence of our integrals' estimates to the true definite integral. To this end, we note that $S^\decke_N - S^\boden_N$ quantifies the error or magnitude of our uncertainty about the true integral $S$. 

\begin{thm}
\[E_N := S^\decke_N - S^\boden_N = \frac{1}{2} \sum_{i=1}^{N-1} L_i (t_{i+1} -t_i)^2 - \frac{\bigl(f(t_{i+1}) -f(t_i)\bigr)^2}{L_i} \geq 0.\] 
Furthermore, we have $\lim_{N \to \infty} S^\decke_N - S^\boden_N =0$, if grid $G_N \stackrel{N \to \infty}{\to} G$, where $G$ is dense in domain interval $I$. 

\begin{proof}
Referring to Thm. \ref{thm:quad_ceiling} and Thm. \ref{thm:quad_ceiling}, using the definitions of the $\xi^\decke_i$ and $\xi^\boden_i$, as well as a bit of algebraic manipulation, yields the desired equality 
$S^\decke_N - S^\boden_N = \frac{1}{2} \sum_{i=1}^{N-1} L_i (t_{i+1} -t_i)^2 - \frac{\bigl(f(t_{i+1}) -f(t_i)\bigr)^2}{L_i}$. 

For each $i$ we have can make the following argument:
Due to Lipschitz continuity, we have  
$\frac{\bigl(f(t_{i+1}) -f(t_i)\bigr)^2}{L_i^2}  \leq (t_{i+1}-t_i)^2$.

Hence,
$a_N^i:=L_i (t_{i+1} -t_i)^2 - \frac{\bigl(f(t_{i+1}) -f(t_i)\bigr)^2}{L_i}$

$=L_i [(t_{i+1} -t_i)^2 - \frac{\bigl(f(t_{i+1}) -f(t_i)\bigr)^2}{L_i^2}]$.

$\geq L_i [(t_{i+1} -t_i)^2 - (t_{i+1} -t_i)^2] =0$.
Thus, $S^\decke_N - S^\boden_N = \sum_i a_N^i \geq 0$. \\

Finally, prove vanishing error in the limit of a dense grid. 
Let $(G_N)$ a sequence of grids converging to a grid $G$ that is dense in $I$. By Thm. \ref{thm:enclosure1d_desiderata}, we know that $\lim_{N \to \infty} \decke_N = \lim_{N \to \infty}
    \boden_N = f$ \textit{uniformly}. Due to uniform convergence, we can exchange integral and limites. That is, we have 

$0 = \int_I f(t) \, \d t - \int_I f(t) \, \d t$
$=  \int_I \lim_{N \to \infty} \decke_N(t) \, \d t  - \int_I \lim_{N \to \infty}  \boden_N (t) \, \d t$
$\stackrel{unif. conv.}{=} \lim_{N \to \infty} \int_I \decke_N(t) \, \d t  - \lim_{N \to \infty} \int_I \boden_N (t) \, \d t$    
$=\lim_{N \to \infty} S^\decke_N - S^\boden_N $.






\end{proof}

\end{thm}

We see from the expression that the error is larger for function samples whose values do not differ much. 


%Thus, $a^i_N = \abs{a^i_N}$.
%
%Hence,  sequence $(q_N)_{N \in \nat}$, $q_N := S^\decke_N - S^\boden_N = \frac{1}{2} \sum_{i=1}^{N-1} a_N^i$ is convergent, iff the series is absolutely convergent.
%
%
%Let $s_N := \max_i a^i_N = \max_i \abs{a_N^i}.$ We show $q_N \to 0$ by showing $(N-1) s_N \to 0$ (as $N \to \infty$).




