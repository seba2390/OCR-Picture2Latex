%\SetAlgoSkip{}
%%%%%%%%% outer loop of level-based control
\begin{algorithm}[t]
	\SetKwFunction{particleswarm}{particleswarm}
    \SetKwFunction{Fitness}{Fitness}
    \SetKwFunction{RecedeHorizon}{RecedeHorizon}
	\SetKwInOut{Input}{Input}
	\SetKwInOut{Output}{Output}
    \DontPrintSemicolon
	\Input{$\M,\varphi,{h}_{\mathit{max}},m,B, \texttt{Fitness}$}
	\Output{$\{\va^i\}_{1\leqslant i\leqslant\,m}$ \textit{// optimal control sequence}}
	\BlankLine
	Initialize $\ell_0\leftarrow J(s_0)$; $\widehat{J}\leftarrow\inf$; ${p}\leftarrow 2\beta B h$; $i\leftarrow 1$;  ${h}\leftarrow 1$; $\Delta_0\leftarrow (\ell_0 - \varphi)/m$;
	\BlankLine
	\While{($\ell_{i-1} > \varphi)$ $\land$ $(i < m)$}
	{
     	\textit{// find and apply first best action out of the horizon sequence of length $h$}\;
        $[\va^{h},\widehat{J}]\leftarrow$\particleswarm{$\Fitness,\M,p,h$};\\

        \eIf{$\ell_{i-1}-\widehat{J} > \Delta_i \lor h = h_{\mathit{max}}$} 
		{
        \textit{// if a new level or the maximum horizon is reached}\;
        	$\va^i\leftarrow \va^{h}_1$;
            $\M\leftarrow\M^{\va^i}$;
            \textit{// apply the action and move to the next state}\;
			$\ell_i\leftarrow J(s(\M))$; \textit{// update $\ell_i$ with the fitness of the current state}\;
            $\Delta_i\leftarrow \ell_i/(m-i)$; \textit{// update the threshold on reaching the next level}\;
            $i \leftarrow i + 1$;
			${h} \leftarrow 1$;
			${p} \leftarrow 2\beta B h$; \textit{// update parameters}\;
		}
		{
			${h} \leftarrow {h} + 1$;
            $p\leftarrow 2\beta B h$; \textit{// increase the horizon}\;
		}
	}
	\caption{AMPC: Adaptive Model-Predictive Control}
	\label{alg:lerec}
\end{algorithm}
\setlength{\floatsep}{1cm}

