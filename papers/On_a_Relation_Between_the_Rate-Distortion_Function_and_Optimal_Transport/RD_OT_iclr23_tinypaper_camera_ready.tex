 
\documentclass{article} % For LaTeX2e
\usepackage{iclr2023_conference_tinypaper,times}

% Optional math commands from https://github.com/goodfeli/dlbook_notation.
% \input{math_commands.tex}
\usepackage{amsmath,amsfonts,amsthm}
\usepackage{thmtools,thm-restate}
\usepackage{shorthands}


\usepackage{hyperref}
\usepackage{url}
\usepackage{subcaption}


\title{On a Relation Between the Rate-Distortion Function and Optimal Transport}

% Authors must not appear in the submitted version. They should be hidden
% as long as the \iclrfinalcopy macro remains commented out below.
% Non-anonymous submissions will be rejected without review.

\author{Eric Lei, Hamed Hassani and Shirin Saeedi~Bidokhti \\
Dept.\@ of Electrical and Systems Engineering, University of Pennsylvania, USA\\
\texttt{\{elei,hassani,saeedi\}@seas.upenn.edu} \\
}

% The \author macro works with any number of authors. There are two commands
% used to separate the names and addresses of multiple authors: \And and \AND.
%
% Using \And between authors leaves it to \LaTeX{} to determine where to break
% the lines. Using \AND forces a linebreak at that point. So, if \LaTeX{}
% puts 3 of 4 authors names on the first line, and the last on the second
% line, try using \AND instead of \And before the third author name.

\newcommand{\fix}{\marginpar{FIX}}
\newcommand{\new}{\marginpar{NEW}}

\iclrfinalcopy % Uncomment for camera-ready version, but NOT for submission.
\begin{document}


\maketitle

\begin{abstract}
    We discuss a relationship between rate-distortion and optimal transport (OT) theory, even though they seem to be unrelated at first glance. In particular, we show that a function defined via an extremal entropic OT distance is equivalent to the rate-distortion function. We numerically verify this result as well as previous results that connect the Monge and Kantorovich problems to optimal scalar quantization. Thus, we unify solving scalar quantization and rate-distortion functions in an alternative fashion by using their respective optimal transport solvers.
\end{abstract}

% \section{Introduction}
    % \subsection{Rate-Distortion}

    \textbf{Rate-Distortion.} Let $X \sim P_X$ be the source supported on $\mathcal{X}$. Let $\mathcal{Y}$ be the reproduction space, and $\dist: \mathcal{X} \times \mathcal{Y} \rightarrow \mathbb{R}_{\geq 0}$ be a distortion measure. The asymptotic limit on the minimum number of bits required to represent $X$ with average distortion at most $D$ is given by the rate-distortion function (\cite{CoverThomas}),  defined as
 %   \begin{definition} The rate-distortion function $R(D)$ of a source $P_X$ under distortion function $\dist$ is given by 
        \begin{equation}
    	    R(D) := \inf_{\substack{P_{Y|X}:  \EE_{P_{X,Y}}[\dist(X,Y)]  \leq D}} I(X;Y). 
    	    \label{eq:RD}
    	\end{equation} 
   % \end{definition} 
    Any rate-distortion pair $(R,D)$ satisfying $R > R(D)$ is achievable by some lossy source code, and no code can achieve a rate-distortion less than $R(D)$. 
    
    $R(D)$ has the following alternate form \cite[Ch.~10]{CoverThomas},
    \begin{equation}
    R(D) = \inf_{Q_Y} \inf_{\substack{P_{Y|X}:  \EE_{P_{X,Y}}[\dist(X,Y)]  \leq D}} \DKL(P_{X,Y}||P_X \otimes Q_Y).
    \label{eq:RD_alt}
    \end{equation}
    Due to the convex and strictly decreasing properties (\cite{CoverThomas}) of $R(D)$, it suffices to fix $\lambda > 0$ and solve
    \begin{equation}
        \inf_{Q_Y} \inf_{P_{Y|X}}\DKL(P_{X,Y}|| P_X \otimes Q_Y) + \lambda \mathop{\EE}_{P_{X,Y}}[\dist(X,Y)].
        \label{eq:RD_alt_regl}
    \end{equation}
    A solution to \eqref{eq:RD_alt_regl} corresponds to a point on $R(D)$ corresponding to $\lambda$. The Blahut-Arimoto (BA) algorithm (\cite{blahut, arimoto}) solves \eqref{eq:RD_alt} by alternating steps on $P_{Y|X}$ and $Q_Y$ until convergence. Sweeping over $\lambda$ gives the entire rate-distortion curve.
    

    % \subsection{Optimal Transport}
    \textbf{Optimal Transport.} We consider optimal transport (OT) under the Kantorovich formulation, which finds the minimum distortion coupling $\pi$ between measures $\mu$ and $\nu$\footnote{A joint distribution that marginalizes to $\mu$ and $\nu$.},
    \begin{equation}
        W(\mu, \nu) := \inf_{\substack{\pi \in \Pi(\mu, \nu)}} \EE_{X,Y\sim \pi}[\dist(X,Y)].
    \end{equation}
    Under certain conditions, the optimal coupling is induced by a fixed mapping, known as the Monge map. The Kantorovich problem is often regularized with an entropy term, 
    \begin{equation}
        S_\epsilon(\mu, \nu) := \inf_{\substack{\pi \in \Pi(\mu, \nu)}} \EE_{\pi}[\dist(X,Y)] + \epsilon \DKL(\pi||\mu \otimes \nu),
        \label{eq:entropic_OT}
    \end{equation}
    which is known as entropy-regularized optimal transport, with $\epsilon > 0$. For discrete measures $\mu,\nu$, \eqref{eq:entropic_OT} can be solved efficiently using Sinkhorn's algorithm (\cite{knopp_sinkhorn, sinkhorn}).

    % A brief introduction to optimal transport theory can be found in \cite{CourseNotesOT, ComputationalOT}. 
    \textbf{Related Work.} A connection between source coding and optimal transport was made in a talk given by \cite{GrayOT}, who discusses how scalar quantizers can be found through an extremal Monge/Kantorovich problem, and alludes to a similar connection for Shannon's rate-distortion function. Here, we concretely provide $R(D)$'s connection with entropic OT and discuss how their respective computational methods (Blahut-Arimoto and Sinkhorn-Knopp) can compute $R(D)$. In a similar vein, we empirically verify \cite{GrayOT}'s results and show that Lloyd-Max and Earth Mover's distance can both compute optimal scalar quantizers. A similar result relating rate-distortion with entropic OT was also reported in \cite{wu2022communication} which was unbeknownst to us at the time.

    % \section{Optimal Transport and the Rate-Distortion Function}
    % \subsection{Equivalence of Extremal Sinkhorn Divergence and Rate Distortion}
    \textbf{Main Result.}
    We first show that entropic OT can be used to upper bound $R(D)$. First, observe that the inner minimization problem in \eqref{eq:RD_alt_regl} looks similar to the entropic OT problem. Let us define 
    % \begin{align}
    %     S(D) := \inf_{Q_Y} \inf_{\substack{P_{Y|X}: \\ \EE_{P_{X,Y}}[\dist(X,Y)]  \leq D \\ Q_Y = \int_{\mathcal{X}} dP_{Y|X}P_X}} \DKL(P_{X,Y}||P_X \otimes Q_Y), \label{eq:SD_2}
    % \end{align}
    \begin{equation}
        S(D) := \inf_{Q_Y} \inf_{\substack{\pi \in \Pi(P_X, Q_Y): \\ \EE_{\pi}[\dist(X,Y)]  \leq D }} \DKL(\pi||P_X \otimes Q_Y), \label{eq:SD_2}
    \end{equation}
    which we call the \emph{Sinkhorn-distortion function}, and is an extremal entropic OT distance w.r.t. $P_X$. Similar to $R(D)$, we can trace out $S(D)$ by sweeping over $\lambda > 0$, and solving the inner minimization \eqref{eq:entropic_OT}, and then optimizing over all $Q_Y$, which is a convex problem in $Q_Y$ (\cite{feydy2019interpolating}). It is clear that $R(D) \leq S(D)$ by comparing \eqref{eq:SD_2} and \eqref{eq:RD_alt}. Next, we show that without further assumptions, $R(D)$ and $S(D)$ are equivalent.

	

        \begin{restatable}{theorem}{mainthm}%\emph{(Sinkhorn-Rate-Distortion Equivalence).}
        % \begin{theorem}[Sinkhorn-Rate-Distortion Equivalence]
            For any source $P_X$ and distortion function $\dist: \mathcal{X} \times \mathcal{Y} \rightarrow \mathbb{R}_{\geq 0}$, it holds that
            \begin{equation}
                R(D) = S(D).
            \end{equation}
        \end{restatable}
        % \begin{proof}
        %     See Sec.~\ref{sec:proofs}.
        % \end{proof}

        
        % \begin{figure}[t]
        %     \centering
        %     \vspace{-3em}
        %     \includegraphics[width=0.5\linewidth]{figures/5atoms_RD.pdf}
        %     \caption{Equivalence of $S(D)$ and $R(D)$ on a discrete source with $\dist(x,y)=(x-y)^2$. }
        %     \label{fig:SD-RD}
        % \end{figure}

        \begin{figure*}[t]
            \centering
            \begin{minipage}{.48\textwidth}
                \centering
                \includegraphics[width=0.9\linewidth]{figures/5atoms_RD.pdf}
                \caption{Equivalence of $S(D)$ and $R(D)$ on a 5-atom discrete source with $\dist(x,y)=(x-y)^2$. }
                \label{fig:SD-RD}
            \end{minipage}%
            \hfill
            \begin{minipage}{0.48\textwidth}
                \centering
                \includegraphics[width=0.9\linewidth]{figures/scalar_quant.pdf}
                \caption{Equivalence of extremal EMD and Lloyd-Max for $M$-level scalar quantization.}
                \label{fig:SQ_EMD}
            \end{minipage}
        \end{figure*}

        See Sec.~\ref{sec:proofs} for the proof. We numerically verify the equivalence in Fig.~\ref{fig:SD-RD} on a discrete source with 5 atoms under squared-error distortion. For $R(D)$, we use Blahut-Arimoto, and for $S(D)$, we solve the convex problem using SQP solvers (\cite{SLSQP}) with $Q \mapsto S_{\epsilon}(P_X, Q)$ as the objective function, showing that the two different objectives result in the same function. 


% \textbf{Sinkhorn-Blahut-Arimoto Algorithm.}
% The Sinkhorn-Blahut-Arimoto (SBA) algorithm numerically solves the Sinkhorn-distortion function in order to compute the rate-distortion function. 

\textbf{Discussion.}
Observe that the joint $P_{X,Y}=P_X P_{Y|X}$ defined in \eqref{eq:RD_alt} marginalizes to $P_X$ but not necessarily $Q_Y$, whereas the coupling $\pi$ in \eqref{eq:SD_2} marginalizes to both. This result says that the additional $Q_Y$ marginalization constraint in $S(D)$ plays no role when both objectives are infimized over $Q_Y$. In computing $R(D)$, this provides an alternative to Blahut-Arimoto: solve \eqref{eq:SD_2} directly over $Q_Y$, using Sinkhorn iterations as a subroutine when evaluating the objective function (or its gradient).  
A symmetrized variant of the Sinkhorn-distortion function is often used to solve generative modeling tasks with Sinkhorn divergences (\cite{sinkhornGAN, salimans2018improving, shen2020sinkhorn}), where one wishes to find some $Q_Y \approx P_X$ by solving $\min_{Q_Y} S_\epsilon (P_X, Q_Y)$. However, if one leaves the objective un-symmetrized, the optimal $Q_Y^*$ and coupling $\pi^*$ are actually $R(D)$-achieving distributions with $\lambda=1/\epsilon$, producing equivalent solutions to exact rate-distortion neural estimators (\cite{NERD}).

We also verify that in discrete settings, the extremal non-entropic OT function $\min_{Q_Y: |Q_Y| \leq M} W(P_X, Q_Y)$, where $|Q_Y|$ is the size of $Q_Y$'s alphabet, is equivalent to optimal scalar quantization of $P_X$ as shown in \cite{GrayOT}. In Fig.~\ref{fig:SQ_EMD}, we solve the $\min_{Q_Y: |Q_Y| \leq M} W(P_X, Q_Y)$ on a 10-atom source using a linear program to compute the Earth Mover's distance (EMD) $W(\cdot, \cdot)$ and pass the function to a SQP solver as before. The achieved rate-distortion is equivalent to that of Lloyd-Max ($M$-means). 

% Potential future work include further applications in using this result to connect generalization bounds that use rate-distortion theory \cite{sefidgaran2022rate} and those that use optimal transport \cite{8849359}. 


% \subsubsection*{Author Contributions}
% If you'd like to, you may include  a section for author contributions as is done
% in many journals. This is optional and at the discretion of the authors.

% \subsubsection*{Acknowledgements}
% Use unnumbered third level headings for the acknowledgements. All
% acknowledgements, including those to funding agencies, go at the end of the paper.

\subsubsection*{URM Statement}
All authors meet the URM criteria of ICLR 2023 Tiny Papers Track.

\bibliography{ref}
\bibliographystyle{iclr2023_conference_tinypaper}

\appendix
\section{Appendix}

\subsection{Proofs}
\label{sec:proofs}
% \begin{proposition}[Sinkhorn Distortion Upper Bound]
% 	    \label{prop:SD_UB}
% 	    Given source $P_X$ on $\mathcal{X}$, reconstruction space $\mathcal{Y}$, and distortion measure $\dist$,  
% 	    \begin{equation}
% 	        R(D) \leq S(D).
% 	        \label{eq:RD-Sinkhorn}
% 	    \end{equation}
% 	    \end{proposition}
% 	   \begin{proof}
%             The inner minimization problem of $R(D)$ in \eqref{eq:RD_alt} only has a marginal constraint on $P_X$, whereas the inner minimization of $S(D)$ in  \eqref{eq:SD_2} has an additional marginal constraint on $Q_Y$ as well.
%     	\end{proof}

     % \begin{theorem}[Sinkhorn-Rate-Distortion Equivalence]
     %        For any source $P_X$ and distortion function $\dist: \mathcal{X} \times \mathcal{Y} \rightarrow \mathbb{R}_{\geq 0}$, it holds that
     %        \begin{equation}
     %            R(D) = S(D).
     %        \end{equation}
     %    \end{theorem}
        \mainthm*
        \begin{proof}
        From \cite[Ch.~9]{CoverThomas}, the optimizers $Q^*_Y, P^*_{Y|X}$ of \eqref{eq:RD_alt_regl} for a fixed $\lambda > 0$ satisfy
        \begin{align}
            \frac{dP^*_{Y|X=x}}{dQ_Y}(x,y) &= \frac{e^{-\lambda \dist(x,y)}}{\int_{\mathcal{Y}} e^{-\lambda \dist(x,\tilde{y})}dQ^*_Y} , \label{eq:BA_1} \\
            Q^*_Y &= \int_{\mathcal{X}}  dP^*_{Y|X} dP_X, 
            \label{eq:BA_2}
        \end{align}
        simultaneously, which achieves a unique point on $R(D)$ corresponding to $\lambda$. 
             To show that $S(D)$ achieves the same objective as $R(D)$ on the same $P_X$ and distortion measure, it suffices to show that the $R(D)$-optimal $Q_Y^*$ and $P_{Y|X}^*$ are feasible for $S(D)$, since $R(D) \leq S(D)$. From \cite[Ch.~4, Prop.~4.3]{ComputationalOT}, the optimal coupling $\pi^*$ in entropic OT is unique and has the form 
            \begin{equation}
            \frac{d\pi^*}{dP_X dQ_Y} (x,y) = u(x) e^{-\lambda \dist(x,y)} v(y),
            \end{equation}
            where $u(x), v(y)$ are dual variables that ensure $\pi^*$ is a valid coupling. The $R(D)$-optimal joint distribution $P_XP_{Y|X}^*$, which is guaranteed to be a coupling between $P_X$ and $Q_Y^*$ due to \eqref{eq:BA_2}, indeed has the form
            \begin{equation}
                \frac{dP_XP_{Y|X}^*}{dP_X dQ_Y^*}(x,y) = \frac{1}{\int_{\mathcal{Y}}e^{-\lambda \dist(x,y')}dQ_Y^*} \cdot e^{-\lambda \dist(x,y)} \cdot 1,
            \end{equation}
           where the first term only depends on $x$ and the last term only depends on $y$.
            Since $R(D)$ is a lower bound of $S(D)$, we are done.
        \end{proof}



\end{document}
