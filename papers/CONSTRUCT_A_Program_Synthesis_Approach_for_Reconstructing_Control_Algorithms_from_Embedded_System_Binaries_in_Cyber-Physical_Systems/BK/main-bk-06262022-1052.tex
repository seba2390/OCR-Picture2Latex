%%
%% This is file `sample-sigconf.tex',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% samples.dtx  (with options: `sigconf')
%% 
%% IMPORTANT NOTICE:
%% 
%% For the copyright see the source file.
%% 
%% Any modified versions of this file must be renamed
%% with new filenames distinct from sample-sigconf.tex.
%% 
%% For distribution of the original source see the terms
%% for copying and modification in the file samples.dtx.
%% 
%% This generated file may be distributed as long as the
%% original source files, as listed above, are part of the
%% same distribution. (The sources need not necessarily be
%% in the same archive or directory.)
%%
%%
%% Commands for TeXCount
%TC:macro \cite [option:text,text]
%TC:macro \citep [option:text,text]
%TC:macro \citet [option:text,text]
%TC:envir table 0 1
%TC:envir table* 0 1
%TC:envir tabular [ignore] word
%TC:envir displaymath 0 word
%TC:envir math 0 word
%TC:envir comment 0 0
%%
%%
%% The first command in your LaTeX source must be the \documentclass command.
\documentclass[sigconf,review]{acmart}
%\usepackage{subcaption}
\usepackage{color,soul}
%%
%% \BibTeX command to typeset BibTeX logo in the docs
\AtBeginDocument{%
  \providecommand\BibTeX{{%
    \normalfont B\kern-0.5em{\scshape i\kern-0.25em b}\kern-0.8em\TeX}}}

%% Rights management information.  This information is sent to you
%% when you complete the rights form.  These commands have SAMPLE
%% values in them; it is your responsibility as an author to replace
%% the commands and values with those provided to you when you
%% complete the rights form.
\setcopyright{acmcopyright}
\copyrightyear{2021}
\acmYear{2021}
\acmDOI{10.1145/nnnnnnn.nnnnnnn}

%% These commands are for a PROCEEDINGS abstract or paper.
\acmConference[ASE 2022]{The 37th IEEE/ACM International Conference on Automated Software Engineering}{October 10â€“14, 2022}{Ann Arbor, Michigan, United States}

\acmPrice{15.00}
\acmISBN{978-x-xxxx-xxxx-x/YY/MM}

\definecolor{codeColor}{RGB}{139,26,26}

% Define your commands here
% \newcommand{\ali}[1]{\textcolor{blue}{{\it Ali:#1}}}
\newcommand{\ali}[1]{\textcolor{blue}{{\it Ali:#1}}}
\newcommand{\shantanu}[1]{\textcolor{red Shantanu:#1}{{\it}}}
\newcommand{\code}[1]{\textcolor{codeColor}{\textsf{#1}}}
\newcommand{\concept}[1]{\textbf{\textsf{#1}}}
\newcommand{\figref}[1]{Figure~\ref{#1}}
\newcommand{\secref}[1]{Section~\ref{#1}}
\newcommand{\listref}[1]{Listing~\ref{#1}}
\newcommand{\equationref}[1]{Equation~\eqref{#1}}
\newcommand{\tableref}[1]{Table~\ref{#1}}

\renewcommand{\hl}[1]{#1}

\newcommand{\citeme}[1]{%
  \begingroup
  \definecolor{hlcolor}{RGB}{255, 226, 176}\sethlcolor{hlcolor}%
  [\textcolor{orange}{\hl{\textbf{CITE}}}]%
  \endgroup
}

\newcommand{\subsubsubsection}[1]{\paragraph{\textbf{\textit{#1:}}}}

\usepackage{tikz}
\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
% \node[shape=circle,draw,inner sep=0.8pt] (char) {#1};}}
\node[shape=circle,font=\bfseries,thick,draw=black,fill=black,text=white,inner sep=0.8pt] (char) {#1};}}

\newcommand*\squared[1]{\tikz[baseline=(char.base)]{
% \node[shape=circle,draw,inner sep=0.8pt] (char) {#1};}}
\node[shape=rectangle,font=\bfseries,thin,draw=black,fill=yellow,text=black,inner sep=1pt] (char) {#1};}}


\graphicspath{{figures/}}


%%
%% Submission ID.
%% Use this when submitting an article to a sponsored event. You'll
%% receive a unique submission ID from the organizers
%% of the event, and this ID should be used as the parameter to this command.
%%\acmSubmissionID{123-A56-BU3}

%%
%% The majority of ACM publications use numbered citations and
%% references.  The command \citestyle{authoryear} switches to the
%% "author year" style.
%%
%% If you are preparing content for an event
%% sponsored by ACM SIGGRAPH, you must use the "author year" style of
%% citations and references.
%% Uncommenting
%% the next command will enable that style.
%%\citestyle{acmauthoryear}

%%
%% end of the preamble, start of the body of the document source.
\begin{document}

%%
%% The "title" command has an optional parameter,
%% allowing the author to define a "short title" to be used in page headers.
\title[A Program Synthesis Approach for Reconstructing Control Algorithms from Embedded System Binaries.]{A Program Synthesis Approach for Reconstructing Control Algorithms from Embedded System Binaries in Cyber-Physical Systems}
%%
%% The "author" command and its associated commands are used to define
%% the authors and their affiliations.
%% Of note is the shared affiliation of the first two authors, and the
%% "authornote" and "authornotemark" commands
%% used to denote shared contribution to the research.


\author{$^\dagger$Ali Shokri, $^\beta$Alexandre Perez, $^\alpha$Souma Chowdhury, $^\alpha$Chen Zeng, $^\beta$Gerald Kaloor, $^\beta$Ion Matei, $^\beta$Peter-Patel Schneider, $^\beta$Akshith Gunasekaran, $^\beta$Shantanu Rane}
\affiliation{\institution{$^\dagger$Rochester Institute of Technology, NY, USA, as8308@rit.edu} \country{}}
\affiliation{\institution{$^\beta$Palo Alto Research Center (PARC), CA, USA, \{aperez, imatei, pfps, agunasekar, srane\}@parc.com} \country{}}
\affiliation{\institution{$^\alpha$University at Buffalo, NY, USA, \{soumacho, czeng2, geraldka\}@buffalo.edu} \country{}}

\renewcommand{\shortauthors}{A. Shokri et al.}


%%
%% By default, the full list of authors will be used in the page
%% headers. Often, this list is too long, and will overlap
%% other information printed in the page headers. This command allows
%% the author to define a more concise list
%% of authors' names for this purpose.
%\renewcommand{\shortauthors}{Trovato and Tobin, et al.}

%%
%% The abstract is a short summary of the work to be presented in the
%% article.

\begin{abstract}
Cyber-physical systems are composed of physical and computational components integrated and controlled by computer-based algorithms implemented as a controller software. Due to their vast usage in mission- and safety-critical systems, it is crucial for subject matter experts (SME) to obtain a clear understanding of the behavior of the controller software to accurately assess the safety of the system, before deployment. Current approaches for supporting SMEs require skilled programmers to review the code and manually create a high-level representation of the underlying control algorithms. This is a time-consuming and error-prone task.
To address this challenge, we introduce a novel approach that synthesizes high-level mathematical representations of the controller software in cyber-physical systems, given the embedded system binary. The output of this approach can be used by SMEs for assessment of the system's compliance with expected behavior, and also for forensic applications. 
%Our approach first performs static analysis on the decompiled binary files of the controller to create the sketch of mathematical representations and then, performs an evolutionary-based search to find the correct semantic for the created representation. 
We demonstrate the effectiveness of the introduced approach in practice via three case studies conducted on real-life cyber-physical systems. 

\end{abstract}



%%
%% The code below is generated by the tool at http://dl.acm.org/ccs.cfm.
%% Please copy and paste the code instead of the example below.
%%
\begin{CCSXML}
<ccs2012>
<concept>
<concept_id>10011007.10011074</concept_id>
<concept_desc>Software and its engineering~Software creation and management</concept_desc>
<concept_significance>500</concept_significance>
</concept>
</ccs2012>
\end{CCSXML}

\ccsdesc[500]{Software and its engineering~Software creation and management}

%%
%% Keywords. The author(s) should pick words that accurately describe
%% the work being presented. Separate the keywords with commas.

% Note that keywords are not normally used for peerreview papers.
\keywords{Program Synthesis, Cyber-physical Systems, Symbolic Equations}

\settopmatter{printacmref=false}



%%
%% This command processes the author and affiliation and title
%% information and builds the first part of the formatted document.
\maketitle

% \input{Introduction}
% \input{CONSTRUCT}
% \input{ExperimentalStudy}
% \input{Limitations}
% \input{RelatedWork}
% \input{Conclusion}

\begin{figure*}[h]
  \centering
  \includegraphics[width=.97\textwidth]{figures/CONSTRUCT_4.pdf}
    \vspace{-6pt}

  \caption{An overview of the \textsc{CONSTRUCT} approach.}
  \label{fig:CONSTRUCT}
          \vspace{-6pt}
\end{figure*}

\section{Background and the Problem}
\label{sec:Introduction}
Cyber-physical systems (CPS) consist of different components, including physical as well as computational parts. A key component of such systems is the embedded software that orchestrates interactions between different parts, performs needed processing, and implements the controlling algorithms prescribed by the system designer.
%
CPS designers use different tools, including Simulink~\cite{documentationsimulation} and Modelica~\cite{fritzson2006openmodelica} to design the system and perform corresponding simulations. They then export the designed model as a standardized portable container called a  \textit{Functional Mockup Unit (FMU)}~\cite{blochwitz2011functional} which is transportable between different tools. An FMU contains binary files (e.g., compiled C files) that implement the functionality of the CPS (e.g., the controller part), alongside some text-based description files which provide information about the inputs, outputs, and other variables used in the binary files. 
%
Since a CPS can be used in mission- and safety-critical domains such as military, medical, transportation, and agriculture \cite{serpanos2018cyber}, it is crucial for subject matter experts (SME) to gain a clear and accurate understanding of the system's behavior to better assess the safety of the system before deployment.
%and prevent any damaging threats in the run-time (e.g., the system is malicious or weaponized). 
%
However, not only the SMEs are often unfamiliar with low-level programming languages, in forensic applications, only the system's binary is available \cite{ming2016straighttaint}. Therefore, it is necessary to derive an interpretable model from the binaries which accurately represents the functionality of the underlying code~\cite{shbita2022automated}. 
%For instance, this functionality could be a widely used proportionalâ€“integralâ€“derivative (PID) controller~\citeme{} that is a control loop mechanism leveraging feedback.     
%
There have been approaches developed by researchers to create such representations of the code to assist SMEs, however, these techniques heavily rely on intelligent experts (e.g., professional programmers) to manually review either the source code or the decompiled binaries and create an initial abstraction of the software~\citeme{}. This is a non-trivial, time-consuming, and error-prone task. 
%In addition, the controller part of a cyber-physical system in the FMU is mostly in form of a binary file. Hence, intelligent experts need to de-compile the binaries to be able to manually review the code. However, through the de-compilation process, the generated source code will be obfuscated, meaning that variable names, method names, and even in some cases class names are changed to meaningless and strange names which makes it dramatically hard to follow and understand the code.

To address these challenges, we introduce a novel approach for automatically synthesizing a high-level mathematical representation of controller software in a CPS. This representation enables SMEs to easily identify possible drifts from the expected behavior of CPS and avoid damaging threats (e.g., malicious or weaponized software). The synthesized mathematical representation follows the syntax and semantic of Modelica language~\cite{fritzson1998modelica}, which is a multi-domain modeling language and is easily interpretable by subject matter experts (SME). 
\vspace{-15pt}
%
\section{Approach}
\label{sec:Construct}
Figure~\ref{fig:CONSTRUCT} shows an overview of our approach, called \textbf{Code-based MOdel SyNthesiS PlaTform foR re-ConstrUcting Control AlgoriThms} \textsc{\textbf{(CONSTRUCT)}}, which automatically constructs mathematical representations of controller parts of CPS. \textsc{CONSTRUCT} takes in an FMU file which contains binaries and some descriptions about the CPS. 
The main idea is to create the \textbf{structure} of the mathematical representation by translating the symbolic ASTs of decompiled C binary codes to symbolic ASTs in Modelica language. Then, leverage an evolutionary search technique to find correct actual variable names for each symbolic names and add the \textbf{semantic} to the created structure. In the following, we provide more details on each step.

    \squared{1} \textbf{Decompile Binaries:} From the description files inside the FMU, \textsc{CONSTRUCT} identifies the variable names and their attributes (e.g., type, initial value, etc.) that should be used in the final mathematical model. It also decompiles the binary files inside the FMU using Ghidra~\cite{Ghidra} as an off-the-shelf popular decompiler. The decompiled code is contains symbolic variable names. 
    
    \squared{2} \textbf{Isolate Mathematical Primitives:} Next, based on its rule-based engine, CONSTRUCT localizes the mathematical primitives that are commonly used in controller parts of CPS. Some mathematical primitives might differ in the decompiled code comparing to the original source code. CONSTRUCT is able to identify these primitives as well. 
    
    \squared{3} \textbf{Code-level AST to Model-level AST:} In this step, CONSTRUCT creates ASTs of the decompiled binaries (C files) and translates the sub-ASTs that correspond to localized mathematical primitives (previous step) to mathematical-formed ASTs. The mathematical-formed ASTs follow syntax of Modelica language. Note that due to the decompilation, the created mathematical-formed ASTs contain non-real symbolic names. %Therefore, we need to find the correct mapping between symbolic names and the actual variable names collected through the first step.
    
    \squared{4} \textbf{Modelica Model Synthesis} We use Genetic Algorithm (GA) as an evolutionary search-based approach to find a correct mapping between the generated symbolic variable names in the created mathematical representation and the original variable names retrieved from the description file inside the FMU. We follow the \textbf{correct-by-construction} paradigm throughout this process meaning that we carefully design GA operators (i.e., first population generation, mutation, and cross-over) such that every generated chromosome (a solution candidate) by the GA approach complies with syntax and semantic of Modelica language. This significantly prunes the search space and reduces try and errors. For instance, if the type of variable $v_1$ is \textit{Real} but the type of symbol $s_1$ is \textit{Boolean}, then, our correct-by-construction approach does not consider mapping $v_1$ to $s_1$. In contrast, the baseline GA approach (\textit{correct-by-testing}) does not take these constraints into account and might generate faulty solutions that result in crashes while simulating the synthesized model on simulators. %The case study result (section~\ref{sec:PreliminaryResult}) shows how our correct-by-construction approach dramatically improves the quality of the solutions generated by GA in comparison with the base-line \textit{correct-by-testing} approach.
 
The output of \textsc{CONSTRUCT} is a mathematical representation of the controller part of CPS in form of  Modelica language. 

\section{Case Study}
\label{sec:PreliminaryResult}
In order to showcase the performance of the introduced approach, we present case studies conducted on three different controllers used in two real-world CPS, a \textit{Turtlebot Waffle Pi}~\citeme{} which is an inherently stable wheeled robot, and a \textit{PX4 Quadcopter}~\citeme{} which is statically unstable robot. The complexity of controllers increases by the number of cases i.e., the synthesized mathematical representation for Case 1 consists of 8 equations, 18 variables, and 23 symbols, and the mathematical representations for Case 2 and Case 3 contain 6 equations, 37 variables, and 20 symbols and 13 equations, 80 variables, and 39 symbols respectively. Also, the type of all variables and symbols in Case 1 are of type Real, whilst the types of variables and symbols in Case 2 and Case 3 are of different types, making the correct mapping finding problem much harder in the later two cases. In our experiments, the population size for the GA was considered as 400 and the maximum number of generations was 10.
%
\begin{figure}[ht]
  \centering
  \includegraphics[width=.47\textwidth]{Case_Study_4.pdf}
  \caption{The result of synthesizing mathematical models based on the Correct-by-Testing (base-line) and our Correct-by-Construction approach.}
  \label{fig:correct_by_construct_result}
\end{figure}
%
 Figure~\ref{fig:correct_by_construct_result} summarizes the result of this study. Even in the simplest Case (Case 1) that all the variables and symbols are from the same type (i.e., Real), the correct-by-construction approach is able to find better mathematical representations compared to the base-line (correct-by-testing) approach. Interestingly, while in complex cases (cases 2 and 3) the correct-by-testing approach is not able to generate even one single representation runnable by the simulator, the correct-by-construction approach can generate simulatable models that comply with Modelica syntax and semantic and also have relatively good fitness scores.


\section{Conclusion and Future Work}
\label{sec:Conclusion}
In this paper we introduced CONSTRUCT, a novel program synthesis approach that automatically creates mathematical representations of control algorithms in cyber-physical systems. This approach leverages a genetic algorithm for injecting the semantic into the created representation. In future work, we are interested in evaluating the utility of constraint-based solvers, such as SMT solvers, for making the model synthesis more efficient.

%%
%% The next two lines define the bibliography style to be used, and
%% the bibliography file.
\bibliographystyle{ACM-Reference-Format}
\bibliography{bibliography}

\end{document}
\endinput
%%
%% End of file `sample-sigconf.tex'.
