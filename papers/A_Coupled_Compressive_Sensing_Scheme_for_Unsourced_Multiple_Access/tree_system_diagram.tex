\begin{tikzpicture}
\def\nodewidth{0.6in}
\def\fsize{\Large}
\def\sfsize{\normalsize}
\def\xoffs{0.5in}
\def\ya{2.5}
\def\xr{4.5}
\def\xadder{9}
\def\xslots{13.5}
\def\xdec{20}
\tikzstyle{block} = [rectangle, draw, thick, opacity=0.7,line width =2, minimum size=\nodewidth]
\tikzstyle{vertRectangle} = [rectangle, draw, opacity=0.7,line width =2, minimum width=\nodewidth, minimum height=8*\nodewidth]
\tikzstyle{opnode} = [rectangle, draw, thick,opacity=0.7,line width=1, minimum size=0.2in]


\foreach \i/\j in {1/1,2/i,4/\Ka}{ 
\node[block] (r1\i) at (0,-\i*\ya){\fsize Tree Encoder};
\node[block] (r2\i) at (\xr,-\i*\ya) {\fsize CS Encoder};

\draw[<-, thick, line width=2] (r1\i.west)--node[midway, above]{\fsize $\vec{\mathit{w}}_{\j}$}+(-\xoffs,0);
\draw[->, thick, line width=2] (r1\i.east)--node[midway, above]{\fsize $\tilde{\vec{\mathit{w}}}_{\j}$}(r2\i.west);
}
\node  at (0.5*\xr,-3*\ya) {\Huge $\vdots$};

\node[draw,circle] (adder) at (\xadder,-2.5*\ya) {\Large $\sum$};

%------Encoders to Adder 
\draw[thick] (r21.east) -- +(1.8,0) [->]-- (adder.north);
\draw[thick] (r22.east) -- +(1.6,0) [->]-- (adder.north west);
\draw[thick] (r24.east) -- +(1.4,0) [->]-- (adder.south west);
\draw[thick,<-] (adder.south) -- node[midway,right] {\Large $\vec{\mathrm{z}}$} +(0,-\xoffs);

\node[vertRectangle,align=center] (r3) at (\xslots,-2.5*\ya){\fsize \bf CS decoder};
\node[vertRectangle,align=center] (r4) at (\xdec,-2.5*\ya){\fsize \bf Tree Decoder};

%------Adder to CS decoder
\draw[<-, thick] (r3.north west)++(0,-0.5*\nodewidth)-- +(-1,0) -- (adder.north east);
\draw[<-, thick] (r3.north west)++(0,-1.5*\nodewidth)-- +(-0.7,0) --(adder.north east);
\draw[<-, thick] (r3.south west)++(0,0.5*\nodewidth)-- +(-0.9,0) --(adder.south east);

%-----Sub-Blocks division in CS decoder
\draw[transform canvas={yshift=-\nodewidth},thick] (r3.north west) -- (r3.north east);
\draw[transform canvas={yshift=-2*\nodewidth},thick] (r3.north west) -- (r3.north east);
%\draw[transform canvas={yshift=-3*\nodewidth},thick] (r3.north west) -- (r3.north east);
\draw[transform canvas={yshift=\nodewidth}] (r3.south west) -- (r3.south east);
\node [below=0.3*\nodewidth of r3.north](s1) {\fsize  sub-block 0};
\node [below=1.3*\nodewidth of r3.north](s2) {\fsize sub-block 1};
%\node [below=2.3*\nodewidth of r3.north](s3) {\fsize sub-block 2};
\node [above=0.3*\nodewidth of r3.south](s4) {\fsize sub-block n-1};
\node [below=3*\nodewidth of r3.north]() {\Huge $\vdots$};
\node [above=2*\nodewidth of r3.south]() {\Huge $\vdots$};


%-----Sub-Blocks division in Tree decoder
\draw[transform canvas={yshift=-\nodewidth},thick] (r4.north west) -- (r4.north east);
\draw[transform canvas={yshift=-2*\nodewidth},thick] (r4.north west) -- (r4.north east);
%\draw[transform canvas={yshift=-3*\nodewidth},thick] (r4.north west) -- (r4.north east);
\draw[transform canvas={yshift=\nodewidth}] (r4.south west) -- (r4.south east);
\node [below=0.3*\nodewidth of r4.north]() {\fsize  Depth 0};
\node [below=1.3*\nodewidth of r4.north]() {\fsize Depth 1};
%\node [below=2.3*\nodewidth of r4.north]() {\fsize Depth 2};
\node [above=0.3*\nodewidth of r4.south]() {\fsize Depth n-1};
\node [below=3*\nodewidth of r4.north]() {\rotatebox{-90}{\Huge $\rightarrow$}};
\node [above=2*\nodewidth of r4.south]() {\rotatebox{-90}{\Huge $\rightarrow$}};




\begin{scope}[very thick,decoration={
    markings,
    mark=at position 0.5 with {\arrow{>}}}
    ] 
\draw[transform canvas={yshift=-0.5*\nodewidth},postaction={decorate}] (r3.north east) -- (r4.north west);
\draw[transform canvas={yshift=-1.5*\nodewidth},postaction={decorate}] (r3.north east) -- (r4.north west);
\draw[transform canvas={yshift=-2.5*\nodewidth},postaction={decorate}] (r3.north east) -- (r4.north west);
\draw[transform canvas={yshift=0.5*\nodewidth},postaction={decorate}] (r3.south east) -- (r4.south west);
\end{scope}

\draw[->, thick, line width=2] (r4.east)--node[midway, above]{\fsize $\widehat{\vec{\mathit{w}}}_1,\ldots, \widehat{\vec{\mathit{w}}}_{K_a}$}+(2.5*\xoffs,0);
\end{tikzpicture}
