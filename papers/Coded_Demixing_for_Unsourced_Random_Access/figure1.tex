\begin{tikzpicture}
    [
    font=\small, >=stealth', line width=1pt, draw=black,
    block/.style={rectangle, draw, minimum height=5mm, minimum width=7mm, rounded corners},
    section/.style={circle, minimum size=7mm, draw=black},
    check/.style={rectangle, minimum height=6mm, minimum width=6mm, draw=black, fill=gray!20, rounded corners},
    trivialcheck/.style={rectangle, minimum height=4mm, minimum width=4mm, draw=black, fill=gray!20},
    section/.style={circle, minimum size=7mm, draw=black},
    ]

% Stage 1: user's starting message block
\node[block](wj) at (0.25, 3.25) {$\mathbf{w}_j$};

% Stage 2: user's message fragments
\node[block](wj1) at (1.5, 4.5) {$\mathbf{w}_j(1)$};
\node[draw=none](wjdots1) at (1.5, 3.25) {$\vdots$};
\node[block](wjkappa) at (1.5, 1.5) {$\mathbf{w}_j(\varkappa)$};

% Stage 1-2 connections
\draw[->, rounded corners] (wj.north east) -- (wj1.south west);
\draw[->] (wj.east) -- (wjdots1.west);
\draw[->] (wj.south east) -- (wjkappa.north west);

% Stage 3: Non-binary LDPC Encoder
\draw[draw=black, fill=white, rounded corners] (2.375, 0) rectangle (2.875, 5);
\node[draw=none, rotate=90] (ldpclabel) at (2.625, 2.5) {$GF\left(2^{v}\right)$ LDPC};

% Stage 2-3 connections
\draw[->] (wj1.east) -- (2.375, 4.5);
\draw[->] (wjdots1.east) -- (2.375, 3.25);
\draw[->] (wjkappa.east) -- (2.375, 1.5);

% Stage 4: Codeword fragments
\node[block](vj1) at (3.75, 4.5) {$\mathbf{v}_j(1)$};
\node[draw=none](vjdots1) at (3.75, 3.5) {$\vdots$};
\node[block](vjell) at (3.75, 2.5) {$\mathbf{v}_j(\ell)$};
\node[draw=none](vjdots2) at (3.75, 1.5) {$\vdots$};
\node[block](vjL) at (3.75, 0.5) {$\mathbf{v}_j(L)$};

% Stage 3-4 connections
\draw[->] (2.875, 4.5) -- (vj1.west);
\draw[->] (2.875, 2.5) -- (vjell.west);
\draw[->] (2.875, 0.5) -- (vjL.west);

% Stage 5: sparse message fragments
\node[block](mj1) at (5.5, 4.5) {$\mathbf{m}_j(1)$};
\node[draw=none](mjdots1) at (5.5, 3.5) {$\vdots$};
\node[block](mjell) at (5.5, 2.5) {$\mathbf{m}_j(\ell)$};
\node[draw=none](mjdots2) at (5.5, 1.5) {$\vdots$};
\node[block](mjL) at (5.5, 0.5) {$\mathbf{m}_j(L)$};

% Stage 4-5 connections
\draw[->] (vj1.east) -- node[above,yshift=1.5mm] {$f(\cdot)$} (mj1.west);
% \node[draw=none] (flabel1) at (4.45, 4.8) {$f(\cdot)$};
\draw[->] (vjell.east) -- node[above,yshift=1.5mm] {$f(\cdot)$} (mjell.west);
% \node[draw=none] (flabelell) at (4.45, 2.8) {$f(\cdot)$};
\draw[->] (vjL.east) -- node[above,yshift=1.5mm] {$f(\cdot)$} (mjL.west);
% \node[draw=none] (flabelL) at (4.45, 0.8) {$f(\cdot)$};

% Stage 6: CS compression
\node[block, rotate=90] (encode) at (7.0, 2.5) {$\mathbf{A}\operatorname{concat}(\cdot)$};

% Stage 5-6 connections
\draw[->] (mj1.east) -- (encode.north);
\draw[->] (mjell.east) -- (encode.north);
\draw[->] (mjL.east) -- (encode.north);

% Stage 7 MAC channel
\node[draw, circle] (MAC) at (8, 2.5) {$\Sigma$};
% \node[draw, circle] (MAC) at (8.5, 3.375) {$\Sigma$}; Other

% % Stage 6-7 connections
% \draw[->] (encode.south) -- (MAC.west);
% \node[draw=none] (xj) at (7.5, 2.75) {$\mathbf{x}_j$};
% \draw[->] (8, 3.5) -- (MAC.north);
% % \node[draw=none] (awgn) at (8, 3.75) {$\mathbf{z}$};
% \node[draw=none] (awgn) at (8, 3.625) {$\mathbf{z}$};
% \draw[->] (7.75, 1.5) -- (MAC);
% \node[draw=none] (mjp) at (7.50, 1.25) {$\mathbf{x}_{\Acute{j}}$};
% \draw[->] (8.25, 1.5) -- (MAC);
% \node[draw=none] (mjpp) at (8.50, 1.25) {$\mathbf{x}_{\Tilde{j}}$};
% \draw[->] (MAC.east) -- (8.75, 2.5);
% \node[draw=none] (output) at (8.625, 2.75) {$\mathbf{y}$};


% Stage 5-6 connections
\draw[->] (8, 3.5) -- (MAC.north);
\node[draw=none] (awgn) at (8, 3.625) {$\mathbf{z}$};
\draw[->, rounded corners] (7.5, 1.3625) -- (7.5, 1.875) -- (MAC.south west);
\draw[->, rounded corners] (7.5, 3.5) -- (7.5, 3.125) --  (MAC.north west);


% \draw[->] (MAC.south) -- (8.5, 1.5);
% \node[draw=none] (ylabel) at (8.5, 1.25) {$\mathbf{y}$};

\draw[->] (encode.south) -- (MAC.west);
% \node[draw=none] at (7.5, 2.625) {$\xv_j$};
% \draw[->] (8.5, 3.25) -- (MAC.north);
% \draw[->, rounded corners] (7.5, 1.1125) -- (7.5, 1.625) -- (MAC.south west);
% \draw[->, rounded corners] (7.5, 3.25) -- (7.5, 2.875) --  (MAC.north west);
\draw[->] (MAC.south) -- (8, 0.625);
\node[draw=none] (ylabel) at (8, 0.375) {$\mathbf{y}$};


% Fancy labels?
\draw[densely dotted, rounded corners] (0, -0.25) -- (0, -0.5) -- (2, -0.5) -- (2, -0.25);
\node[draw=none] (fragmentationlabel) at (1, -0.75) {Fragmentation};
\draw[densely dotted, rounded corners] (2.125, -0.25) -- (2.125, -0.5) -- (4.5, -0.5) -- (4.5, -0.25);
\node[draw=none] (ldpcencodinglabel) at (3.3125, -0.75) {LDPC Encoding};
\draw[densely dotted, rounded corners] (4.625, -0.25) -- (4.625, -0.5) -- (7.25, -0.5) -- (7.25, -0.25);
\node[draw=none] (csencodinglabel) at (5.9375, -0.75) {CS Encoding};
\draw[densely dotted, rounded corners] (7.375, -0.25) -- (7.375, -0.5) -- (8.30, -0.5) -- (8.30, -0.25);
\node[draw=none] (macchannellabel) at (7.8375, -0.75) {MAC};
    
\end{tikzpicture}