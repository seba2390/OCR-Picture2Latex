\section{Preliminaries}
\label{sec: prelim}

In this section, we review preliminaries on control Lyapunov and barrier functions and discuss their use in synthesizing a safe stabilizing controller for dynamics in~\eqref{eq: dynamic}.

\subsection{Control Lyapunov Function}
The notion of a control Lyapunov function (CLF) was introduced in \cite{Artstein1983StabilizationWR, SONTAG1989117} to verify the stabilizability of control-affine systems \eqref{eq: dynamic}. Specifically, a (exponentially stabilizing) CLF $V: \calX \mapsto \bbR$ is defined as follows,
%
\begin{definition}
A function $V \in \mathbb{C}^1(\calX,\mathbb{R})$ is a \emph{control Lyapunov function (CLF)} on $\calX$ for system \eqref{eq: dynamic} if $V(\bfx)>0, \forall \bfx \in \calX \setminus \{\boldsymbol{0} \}, V(\boldsymbol{0}) = 0$, and it satisfies:
%
\begin{equation}\label{eq: clf}
    \inf_{\bfu \in \bbR^m} \text{CLC}(\bfx,\bfu) \leq 0, \quad \forall \bfx \in \calX,
\end{equation}
%
where $\text{CLC}(\bfx,\bfu) := \mathcal{L}_f V(\bfx) + \mathcal{L}_g V(\bfx)\bfu + \alpha_V( V(\bfx))$
is the \emph{control Lyapunov condition} (CLC) defined for some class $K$ function $\alpha_V$.
\end{definition}


\subsection{Control Barrier Function}

To facilitate safe control synthesis, we consider a time-varying set $\calC(t)$ defined as the super zero-level set of a continuously differentiable function $h: \calX \times \bbR \mapsto \bbR$:
%
\begin{equation}
\label{eq: safe_set}  
    \calC(t) := \{\bfx \in \calX \subseteq \bbR^n: h(\bfx, t) \geq 0 \}.
\end{equation}
%
Safety of the system \eqref{eq: dynamic} can then be ensured by keeping the state $\bfx$ within the safe set $\calC(t)$.

\begin{definition}
\label{def: tv_cbf}
A function $h: \mathbb{R}^n \times \bbR_{\geq 0} \mapsto {\mathbb{R}}$ is a valid time-varying \emph{control barrier function (CBF)} on $\mathcal{X} \subseteq \mathbb{R}^n$ for \eqref{eq: dynamic} if there exists an extended class $\mathcal{K}_{\infty}$ function $\alpha_h$ with:
%
\begin{equation}\label{eq:tv_cbf}
    \sup_{\bfu\in \mathcal{U}} \text{CBC}(\bfx,\bfu, t) \geq 0, \quad \forall \; (\bfx,t) \in \calX \times \bbR_{\geq 0},
\end{equation}
where the \emph{control barrier condition (CBC)} is:
\begin{equation}
\label{eq:tvcbc_define}
\begin{aligned}
    &\text{CBC}(\bfx,\bfu, t) := \dot{h}(\bfx, t) + \alpha_h(h(\bfx,t)) \\
    & = \mathcal{L}_f h(\bfx, t) + \mathcal{L}_g h(\bfx, t)\bfu + \frac{\partial h(\bfx,t)}{\partial t} + \alpha_h(h(\bfx,t)).
\end{aligned}
\end{equation}
\end{definition}


% \textcolor{blue}{Note that the above definition assumes that the TV-CBF depends only first order in time explicitly. If $h$ has a higher order time dependency, we would need to modify \eqref{eq:tvcbc_define} to include higher order time derivatives.}

Definition~\ref{def: tv_cbf} allows us to consider the following set of control values that render the safe set $\calC$ forward invariant, 
\begin{equation}
\label{eq: safe_control_set}
    K_{\text{CBF}}(\bfx, t) := \left \{  \bfu \in \calU: \text{CBC}(\bfx,\bfu, t) \geq 0 \right \}. 
\end{equation}

% \begin{lemma}
% \label{lemma: 1}
% Suppose $\alpha: \bbR_{\geq 0} \mapsto \bbR_{\geq 0}$ is a locally Lipschitz continuous class $\calK$ function and $\eta : [t_0, t_1] \mapsto \bbR$ is an absolutely continuous function. If $\dot{\eta}(t) \geq - \alpha(\eta(t))$ for every $t \in [t_0, t_1]$, and $\eta(t_0) \geq 0$, then $\eta(t) \geq 0$ for all $t \in [t_0, t_1]$.
% \end{lemma}

% \begin{theorem}
% \label{theorem: tv_cbc_validity}
% Assume that $\bfu(\bfx, t) \in K_{\text{CBF}}(\bfx, t)$ is locally Lipschitz continuous in $\bfx$ and piecewise continuous in $t$ and that the unique solutions to \eqref{eq: dynamic} are defined over $[t_0, t_1]$. Then, if $h(\bfx, t)$ is a valid time-varying control barrier function, the set $\calC(t)$ is forward invariant under the control law $\bfu(\bfx, t)$.

% \begin{proof}
% We start by assuming that $\bfx(t_0) \in \calC(t_0)$, which implies that $h(\bfx(t_0), t_0) \geq 0$. Given that $h(\bfx, t)$ is a valid TV-CBF and hence $\bfu(\bfx, t) \in K_{\text{CBC}}(\bfx, t) \neq \emptyset$ results in a solution $\bfx$ to \eqref{eq: dynamic} with initial condition $\bfx(t_0)$ that satisfies $\dot{h}(\bfx(t), t) \geq -\alpha_h(h(\bfx(t), t))$ for all $t \in [t_0, t_1]$. Note that the solution $\bfx : [t_0, t_1] \mapsto \mathbb{R}^n$ exists by assumption. We then set $\eta(t) := h(\bfx(t), t)$. Applying Lemma~\ref{lemma: 1}, we deduce that $\eta(t) \geq 0$ for all $t \in [t_0, t_1]$. Hence, $\calC(t)$ is forward invariant, since $h(\mathbf{x}(t), t) \geq 0$ leads to $\bfx(t) \in \calC(t)$.

% \end{proof}
% \end{theorem}


% %
% Theorem.~\ref{theorem: tv_cbc_validity} implies that if there exists a TV-CBF for \eqref{eq: dynamic}, then the robot state evolves within the safe set $\calC(t)$ under a locally Lipschitz control law $\bfk(\bfx, t) \in K_{\text{CBF}}(\bfx, t)$.


Suppose we are given a baseline feedback controller $\bfu = \bfk(\bfx)$ for the control-affine systems \eqref{eq: dynamic}, and we aim to ensure the safety and stability of the system. By observing that both the CLC and CBC constraints are affine in the control input $\bfu$, a quadratic program (QP) can be formulated for online synthesis of a safe stabilizing controller for \eqref{eq: dynamic}:
%
\begin{equation}
\begin{aligned}
\label{eq: clf_cbf_qp}
    \bfu(\bfx) = &\argmin_{\bfu \in \bbR^m,\delta \in \bbR} \| \bfu - \bfk(\bfx)\|^2 + \lambda \delta^2,  \\
    \mathrm{s.t.} \, \,  &\text{CLC}(\bfx,\bfu) \leq \delta,  \text{CBC}(\bfx,\bfu, t) \geq 0,
\end{aligned}
\end{equation}
%
where $\delta \geq 0$ denotes a slack variable that relaxes the CLF constraints to ensure the feasibility of the QP, controlled by the scaling factor $\lambda > 0$.
